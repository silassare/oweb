import OWebEvent from "./OWebEvent";
import OWebKeyStorage from "./OWebKeyStorage";
import Utils from "./utils/Utils";
export default class OWebCurrentUser extends OWebEvent {
    constructor(app_context) {
        super();
        this.app_context = app_context;
        this._key_store = new OWebKeyStorage(app_context, OWebCurrentUser.SELF);
        console.log("[OWebCurrentUser] ready!");
    }
    getCurrentUser() {
        let user = this._key_store.getItem("user_data");
        if (user) {
            if ("id" in user) {
                return user;
            }
            else {
                console.error("[OWebCurrentUser] invalid user data!");
            }
        }
        return undefined;
    }
    setCurrentUser(user) {
        console.log("[OWebCurrentUser] setting new user ->", user);
        this._key_store.setItem("user_data", user);
        return this._notifyChange();
    }
    setSessionExpire(expire) {
        this._key_store.setItem("session_expire", expire);
        return this;
    }
    getSessionExpire() {
        let expire = this._key_store.getItem("session_expire");
        return isNaN(expire) ? 0 : expire;
    }
    clear() {
        this._key_store.clear();
        return this._notifyChange();
    }
    _notifyChange() {
        this.trigger(OWebCurrentUser.EVT_USER_INFO_UPDATE, [this]);
        return this;
    }
}
OWebCurrentUser.SELF = Utils.id();
OWebCurrentUser.EVT_USER_INFO_UPDATE = Utils.id();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1dlYkN1cnJlbnRVc2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL09XZWJDdXJyZW50VXNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLFNBQVMsTUFBTSxhQUFhLENBQUM7QUFDcEMsT0FBTyxjQUFjLE1BQU0sa0JBQWtCLENBQUM7QUFDOUMsT0FBTyxLQUFLLE1BQU0sZUFBZSxDQUFDO0FBRWxDLE1BQU0sQ0FBQyxPQUFPLHNCQUF1QixTQUFRLFNBQVM7SUFNckQsWUFBNkIsV0FBb0I7UUFDaEQsS0FBSyxFQUFFLENBQUM7UUFEb0IsZ0JBQVcsR0FBWCxXQUFXLENBQVM7UUFHaEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLGNBQWMsQ0FBQyxXQUFXLEVBQUUsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3hFLE9BQU8sQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQsY0FBYztRQUNiLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRWhELElBQUksSUFBSSxFQUFFO1lBQ1QsSUFBSSxJQUFJLElBQUksSUFBSSxFQUFFO2dCQUNqQixPQUFPLElBQUksQ0FBQzthQUNaO2lCQUFNO2dCQUNOLE9BQU8sQ0FBQyxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQzthQUN0RDtTQUNEO1FBRUQsT0FBTyxTQUFTLENBQUM7SUFDbEIsQ0FBQztJQUVELGNBQWMsQ0FBQyxJQUFTO1FBQ3ZCLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUNBQXVDLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRTNDLE9BQU8sSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCxnQkFBZ0IsQ0FBQyxNQUFjO1FBQzlCLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ2xELE9BQU8sSUFBSSxDQUFDO0lBQ2IsQ0FBQztJQUVELGdCQUFnQjtRQUNmLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDdkQsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQ25DLENBQUM7SUFFRCxLQUFLO1FBQ0osSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN4QixPQUFPLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBRU8sYUFBYTtRQUNwQixJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDM0QsT0FBTyxJQUFJLENBQUM7SUFDYixDQUFDOztBQW5EZSxvQkFBSSxHQUFtQixLQUFLLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDbEMsb0NBQW9CLEdBQUcsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9XZWJBcHAgZnJvbSBcIi4vT1dlYkFwcFwiO1xyXG5pbXBvcnQgT1dlYkV2ZW50IGZyb20gXCIuL09XZWJFdmVudFwiO1xyXG5pbXBvcnQgT1dlYktleVN0b3JhZ2UgZnJvbSBcIi4vT1dlYktleVN0b3JhZ2VcIjtcclxuaW1wb3J0IFV0aWxzIGZyb20gXCIuL3V0aWxzL1V0aWxzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBPV2ViQ3VycmVudFVzZXIgZXh0ZW5kcyBPV2ViRXZlbnQge1xyXG5cdHN0YXRpYyByZWFkb25seSBTRUxGICAgICAgICAgICAgICAgICA9IFV0aWxzLmlkKCk7XHJcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9VU0VSX0lORk9fVVBEQVRFID0gVXRpbHMuaWQoKTtcclxuXHJcblx0cHJpdmF0ZSBfa2V5X3N0b3JlOiBPV2ViS2V5U3RvcmFnZTtcclxuXHJcblx0Y29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBhcHBfY29udGV4dDogT1dlYkFwcCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHJcblx0XHR0aGlzLl9rZXlfc3RvcmUgPSBuZXcgT1dlYktleVN0b3JhZ2UoYXBwX2NvbnRleHQsIE9XZWJDdXJyZW50VXNlci5TRUxGKTtcclxuXHRcdGNvbnNvbGUubG9nKFwiW09XZWJDdXJyZW50VXNlcl0gcmVhZHkhXCIpO1xyXG5cdH1cclxuXHJcblx0Z2V0Q3VycmVudFVzZXIoKTogYW55IHtcclxuXHRcdGxldCB1c2VyID0gdGhpcy5fa2V5X3N0b3JlLmdldEl0ZW0oXCJ1c2VyX2RhdGFcIik7XHJcblxyXG5cdFx0aWYgKHVzZXIpIHtcclxuXHRcdFx0aWYgKFwiaWRcIiBpbiB1c2VyKSB7XHJcblx0XHRcdFx0cmV0dXJuIHVzZXI7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcIltPV2ViQ3VycmVudFVzZXJdIGludmFsaWQgdXNlciBkYXRhIVwiKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB1bmRlZmluZWQ7XHJcblx0fVxyXG5cclxuXHRzZXRDdXJyZW50VXNlcih1c2VyOiBhbnkpOiB0aGlzIHtcclxuXHRcdGNvbnNvbGUubG9nKFwiW09XZWJDdXJyZW50VXNlcl0gc2V0dGluZyBuZXcgdXNlciAtPlwiLCB1c2VyKTtcclxuXHRcdHRoaXMuX2tleV9zdG9yZS5zZXRJdGVtKFwidXNlcl9kYXRhXCIsIHVzZXIpO1xyXG5cclxuXHRcdHJldHVybiB0aGlzLl9ub3RpZnlDaGFuZ2UoKTtcclxuXHR9XHJcblxyXG5cdHNldFNlc3Npb25FeHBpcmUoZXhwaXJlOiBudW1iZXIpOiB0aGlzIHtcclxuXHRcdHRoaXMuX2tleV9zdG9yZS5zZXRJdGVtKFwic2Vzc2lvbl9leHBpcmVcIiwgZXhwaXJlKTtcclxuXHRcdHJldHVybiB0aGlzO1xyXG5cdH1cclxuXHJcblx0Z2V0U2Vzc2lvbkV4cGlyZSgpOiBudW1iZXIge1xyXG5cdFx0bGV0IGV4cGlyZSA9IHRoaXMuX2tleV9zdG9yZS5nZXRJdGVtKFwic2Vzc2lvbl9leHBpcmVcIik7XHJcblx0XHRyZXR1cm4gaXNOYU4oZXhwaXJlKSA/IDAgOiBleHBpcmU7XHJcblx0fVxyXG5cclxuXHRjbGVhcigpOiB0aGlzIHtcclxuXHRcdHRoaXMuX2tleV9zdG9yZS5jbGVhcigpO1xyXG5cdFx0cmV0dXJuIHRoaXMuX25vdGlmeUNoYW5nZSgpO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBfbm90aWZ5Q2hhbmdlKCk6IHRoaXMge1xyXG5cdFx0dGhpcy50cmlnZ2VyKE9XZWJDdXJyZW50VXNlci5FVlRfVVNFUl9JTkZPX1VQREFURSwgW3RoaXNdKTtcclxuXHRcdHJldHVybiB0aGlzO1xyXG5cdH1cclxufSJdfQ==