import OWebEvent from './OWebEvent';
import OWebKeyStorage from './OWebKeyStorage';
import Utils from './utils/Utils';
import { GoblEntity } from 'gobl-utils-ts';
export default class OWebCurrentUser extends OWebEvent {
    constructor(app_context) {
        super();
        this.app_context = app_context;
        this._key_store = new OWebKeyStorage(app_context, OWebCurrentUser.SELF);
        console.log('[OWebCurrentUser] ready!');
    }
    /**
     * Returns current user data.
     */
    getCurrentUser() {
        let data = this._key_store.getItem('user_data');
        let user = undefined;
        if (data && data.id && typeof data.getId === 'function') {
            return data;
        }
        else if (Utils.isPlainObject(data) &&
            (user = GoblEntity.toInstance(data, true))) {
            return user;
        }
        else {
            console.error('[OWebCurrentUser] invalid user data!', data);
        }
        return undefined;
    }
    /**
     * Sets current user data.
     *
     * @param user
     */
    setCurrentUser(user) {
        console.log('[OWebCurrentUser] setting new user ->', user);
        this._key_store.setItem('user_data', user);
        return this._notifyChange();
    }
    /**
     * Sets current user session expire time.
     *
     * @param expire
     */
    setSessionExpire(expire) {
        this._key_store.setItem('session_expire', expire);
        return this;
    }
    /**
     * Returns current user session expire time.
     */
    getSessionExpire() {
        let expire = this._key_store.getItem('session_expire');
        return isNaN(expire) ? 0 : expire;
    }
    /**
     * Clear user data.
     */
    clear() {
        this._key_store.clear();
        return this._notifyChange();
    }
    /**
     * Trigger notification for user data change.
     *
     * @private
     */
    _notifyChange() {
        this.trigger(OWebCurrentUser.EVT_USER_DATA_UPDATE, [this]);
        return this;
    }
}
OWebCurrentUser.SELF = Utils.id();
OWebCurrentUser.EVT_USER_DATA_UPDATE = Utils.id();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1dlYkN1cnJlbnRVc2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL09XZWJDdXJyZW50VXNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLFNBQVMsTUFBTSxhQUFhLENBQUM7QUFDcEMsT0FBTyxjQUFjLE1BQU0sa0JBQWtCLENBQUM7QUFDOUMsT0FBTyxLQUFLLE1BQU0sZUFBZSxDQUFDO0FBQ2xDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsTUFBTSxDQUFDLE9BQU8sT0FBTyxlQUFnQixTQUFRLFNBQVM7SUFNckQsWUFBNkIsV0FBb0I7UUFDaEQsS0FBSyxFQUFFLENBQUM7UUFEb0IsZ0JBQVcsR0FBWCxXQUFXLENBQVM7UUFHaEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLGNBQWMsQ0FBQyxXQUFXLEVBQUUsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3hFLE9BQU8sQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxjQUFjO1FBQ2IsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDaEQsSUFBSSxJQUFJLEdBQUcsU0FBUyxDQUFDO1FBRXJCLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxFQUFFLElBQUksT0FBTyxJQUFJLENBQUMsS0FBSyxLQUFLLFVBQVUsRUFBRTtZQUN4RCxPQUFPLElBQUksQ0FBQztTQUNaO2FBQU0sSUFDTixLQUFLLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQztZQUN6QixDQUFDLElBQUksR0FBRyxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUN6QztZQUNELE9BQU8sSUFBSSxDQUFDO1NBQ1o7YUFBTTtZQUNOLE9BQU8sQ0FBQyxLQUFLLENBQUMsc0NBQXNDLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDNUQ7UUFFRCxPQUFPLFNBQVMsQ0FBQztJQUNsQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGNBQWMsQ0FBQyxJQUFTO1FBQ3ZCLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUNBQXVDLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRTNDLE9BQU8sSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsZ0JBQWdCLENBQUMsTUFBYztRQUM5QixJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNsRCxPQUFPLElBQUksQ0FBQztJQUNiLENBQUM7SUFFRDs7T0FFRztJQUNILGdCQUFnQjtRQUNmLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDdkQsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQ25DLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUs7UUFDSixJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3hCLE9BQU8sSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ssYUFBYTtRQUNwQixJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDM0QsT0FBTyxJQUFJLENBQUM7SUFDYixDQUFDOztBQS9FZSxvQkFBSSxHQUFHLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUNsQixvQ0FBb0IsR0FBRyxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgT1dlYkFwcCBmcm9tICcuL09XZWJBcHAnO1xyXG5pbXBvcnQgT1dlYkV2ZW50IGZyb20gJy4vT1dlYkV2ZW50JztcclxuaW1wb3J0IE9XZWJLZXlTdG9yYWdlIGZyb20gJy4vT1dlYktleVN0b3JhZ2UnO1xyXG5pbXBvcnQgVXRpbHMgZnJvbSAnLi91dGlscy9VdGlscyc7XHJcbmltcG9ydCB7IEdvYmxFbnRpdHkgfSBmcm9tICdnb2JsLXV0aWxzLXRzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE9XZWJDdXJyZW50VXNlciBleHRlbmRzIE9XZWJFdmVudCB7XHJcblx0c3RhdGljIHJlYWRvbmx5IFNFTEYgPSBVdGlscy5pZCgpO1xyXG5cdHN0YXRpYyByZWFkb25seSBFVlRfVVNFUl9EQVRBX1VQREFURSA9IFV0aWxzLmlkKCk7XHJcblxyXG5cdHByaXZhdGUgX2tleV9zdG9yZTogT1dlYktleVN0b3JhZ2U7XHJcblxyXG5cdGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgYXBwX2NvbnRleHQ6IE9XZWJBcHApIHtcclxuXHRcdHN1cGVyKCk7XHJcblxyXG5cdFx0dGhpcy5fa2V5X3N0b3JlID0gbmV3IE9XZWJLZXlTdG9yYWdlKGFwcF9jb250ZXh0LCBPV2ViQ3VycmVudFVzZXIuU0VMRik7XHJcblx0XHRjb25zb2xlLmxvZygnW09XZWJDdXJyZW50VXNlcl0gcmVhZHkhJyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBSZXR1cm5zIGN1cnJlbnQgdXNlciBkYXRhLlxyXG5cdCAqL1xyXG5cdGdldEN1cnJlbnRVc2VyKCk6IGFueSB7XHJcblx0XHRsZXQgZGF0YSA9IHRoaXMuX2tleV9zdG9yZS5nZXRJdGVtKCd1c2VyX2RhdGEnKTtcclxuXHRcdGxldCB1c2VyID0gdW5kZWZpbmVkO1xyXG5cclxuXHRcdGlmIChkYXRhICYmIGRhdGEuaWQgJiYgdHlwZW9mIGRhdGEuZ2V0SWQgPT09ICdmdW5jdGlvbicpIHtcclxuXHRcdFx0cmV0dXJuIGRhdGE7XHJcblx0XHR9IGVsc2UgaWYgKFxyXG5cdFx0XHRVdGlscy5pc1BsYWluT2JqZWN0KGRhdGEpICYmXHJcblx0XHRcdCh1c2VyID0gR29ibEVudGl0eS50b0luc3RhbmNlKGRhdGEsIHRydWUpKVxyXG5cdFx0KSB7XHJcblx0XHRcdHJldHVybiB1c2VyO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0Y29uc29sZS5lcnJvcignW09XZWJDdXJyZW50VXNlcl0gaW52YWxpZCB1c2VyIGRhdGEhJywgZGF0YSk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHVuZGVmaW5lZDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFNldHMgY3VycmVudCB1c2VyIGRhdGEuXHJcblx0ICpcclxuXHQgKiBAcGFyYW0gdXNlclxyXG5cdCAqL1xyXG5cdHNldEN1cnJlbnRVc2VyKHVzZXI6IGFueSk6IHRoaXMge1xyXG5cdFx0Y29uc29sZS5sb2coJ1tPV2ViQ3VycmVudFVzZXJdIHNldHRpbmcgbmV3IHVzZXIgLT4nLCB1c2VyKTtcclxuXHRcdHRoaXMuX2tleV9zdG9yZS5zZXRJdGVtKCd1c2VyX2RhdGEnLCB1c2VyKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcy5fbm90aWZ5Q2hhbmdlKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBTZXRzIGN1cnJlbnQgdXNlciBzZXNzaW9uIGV4cGlyZSB0aW1lLlxyXG5cdCAqXHJcblx0ICogQHBhcmFtIGV4cGlyZVxyXG5cdCAqL1xyXG5cdHNldFNlc3Npb25FeHBpcmUoZXhwaXJlOiBudW1iZXIpOiB0aGlzIHtcclxuXHRcdHRoaXMuX2tleV9zdG9yZS5zZXRJdGVtKCdzZXNzaW9uX2V4cGlyZScsIGV4cGlyZSk7XHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFJldHVybnMgY3VycmVudCB1c2VyIHNlc3Npb24gZXhwaXJlIHRpbWUuXHJcblx0ICovXHJcblx0Z2V0U2Vzc2lvbkV4cGlyZSgpOiBudW1iZXIge1xyXG5cdFx0bGV0IGV4cGlyZSA9IHRoaXMuX2tleV9zdG9yZS5nZXRJdGVtKCdzZXNzaW9uX2V4cGlyZScpO1xyXG5cdFx0cmV0dXJuIGlzTmFOKGV4cGlyZSkgPyAwIDogZXhwaXJlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQ2xlYXIgdXNlciBkYXRhLlxyXG5cdCAqL1xyXG5cdGNsZWFyKCk6IHRoaXMge1xyXG5cdFx0dGhpcy5fa2V5X3N0b3JlLmNsZWFyKCk7XHJcblx0XHRyZXR1cm4gdGhpcy5fbm90aWZ5Q2hhbmdlKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBUcmlnZ2VyIG5vdGlmaWNhdGlvbiBmb3IgdXNlciBkYXRhIGNoYW5nZS5cclxuXHQgKlxyXG5cdCAqIEBwcml2YXRlXHJcblx0ICovXHJcblx0cHJpdmF0ZSBfbm90aWZ5Q2hhbmdlKCk6IHRoaXMge1xyXG5cdFx0dGhpcy50cmlnZ2VyKE9XZWJDdXJyZW50VXNlci5FVlRfVVNFUl9EQVRBX1VQREFURSwgW3RoaXNdKTtcclxuXHRcdHJldHVybiB0aGlzO1xyXG5cdH1cclxufVxyXG4iXX0=