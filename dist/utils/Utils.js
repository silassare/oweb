// ==========TYPE CHECKERS====================================
let _naturalId = 0;
let isArray = Array.isArray;
let naturalId = () => "id_" + (_naturalId++);
let isPlainObject = (a) => Object.prototype.toString.call(a) === "[object Object]";
let isString = (a) => typeof a === "string";
let isFunction = (a) => typeof a === "function";
let isEmpty = function (a) {
    if (isArray(a)) {
        return !a.length;
    }
    if (isPlainObject(a)) {
        return !Object.keys(a).length;
    }
    if (typeof a === "string") {
        return a.trim().length === 0;
    }
    if (typeof a === "number") {
        return isNaN(a);
    }
    return !a;
};
let isNotEmpty = (a) => !isEmpty(a);
let toArray = (a) => [].concat.apply([], a);
// ==========HELPERS====================================
let callback = function (fn, args, ctx) {
    if (typeof fn === "function") {
        return fn.apply(ctx, args);
    }
    return null;
};
let forEach = function (obj, fn) {
    Object.keys(obj).forEach((key) => {
        let value = obj[key];
        fn(value, key);
    });
};
let assign = Object.assign || function (target, source) {
    let to = target, from, symbols;
    for (let s = 1; s < arguments.length; s++) {
        from = Object(arguments[s]);
        for (let key in from) {
            if (from.hasOwnProperty(key)) {
                to[key] = from[key];
            }
        }
        if ("getOwnPropertySymbols" in Object) {
            symbols = Object.getOwnPropertySymbols(from);
            for (let i = 0; i < symbols.length; i++) {
                if (from.propertyIsEnumerable(symbols[i])) {
                    to[symbols[i]] = from[symbols[i]];
                }
            }
        }
    }
    return to;
};
let stringKeyReplace = function (str, data) {
    if (isString(str) && str.length && isPlainObject(data)) {
        let keys = Object.keys(data).sort().reverse(), reg;
        if (keys.length) {
            let m = keys.join("|");
            reg = new RegExp(":(" + m + ")", "g");
            return str.replace(reg, function () {
                let replacement = data[arguments[1]];
                if (replacement === undefined) {
                    return arguments[0];
                }
                return replacement;
            });
        }
    }
    return str;
};
let textToLineString = (text) => {
    let reg = /["'\\\n\r\t\u2028\u2029]/g, to_escapes = {
        "\"": "\"",
        "'": "'",
        "\\": "\\",
        "\n": "n",
        "\r": "r",
        "\t": "t",
        "\u2028": "2028",
        "\u2029": "2029"
    };
    return text.replace(reg, (match) => "\\" + to_escapes[match]);
};
let expose = function (items, ctx) {
    let out = {};
    items.forEach(function (key) {
        let item = ctx[key];
        // methods and properties
        if (isFunction(item)) {
            out[key] = function () {
                let res = item.apply(ctx, arguments);
                return (res === ctx) ? out : res;
            };
        }
        else {
            out[key] = item;
        }
    });
    return out;
};
let getFrom = function (from, key) {
    let { [key]: value } = from || {};
    return value;
};
// ==========MATH====================================
let _setDigitsSep = function (x, sep) {
    let s = String(x), count = 0, ans = [], j = s.indexOf("."), start = (j !== -1) ? j : s.length, end = (j !== -1) ? s.slice(start + 1) : [], i = start;
    for (; i >= 0; i--) {
        if (count === 3) {
            count = 0;
            ans[i] = (i !== 0) ? sep + s[i] : s[i];
        }
        else {
            ans[i] = s[i];
        }
        count++;
    }
    return ans.concat(end).join("");
};
let math = {
    numberFormat: function (x, dec = 2, decimalSep = ".", digitsSep = " ") {
        if (!x) {
            return "";
        }
        let ans = parseFloat(String(x)), decimalPos;
        if (dec >= 0) {
            let decimalPow = Math.pow(10, dec);
            ans = Math.floor(ans * decimalPow) / decimalPow;
        }
        let n = _setDigitsSep(ans, digitsSep);
        let a = n.split("");
        decimalPos = a.lastIndexOf(".");
        if (decimalPos >= 0 && decimalSep !== ".") {
            a[decimalPos] = decimalSep;
        }
        return a.join("");
    }
};
let isInDOM = function (element, inBody = false) {
    let _ = element, last;
    while (_) {
        last = _;
        if (inBody && last === document.body) {
            break;
        }
        _ = _.parentNode;
    }
    return inBody ? last === document.body : last === document;
};
let buildQueryString = function (object, prefix) {
    let duplicates = {}, str = [];
    for (let prop in object) {
        if (!Object.prototype.hasOwnProperty.call(object, prop)) {
            continue;
        }
        let key = prefix ? prefix + "[" + prop + "]" : prop, value = object[prop], pair;
        if (value !== undefined) {
            if (value === null) {
                pair = encodeURIComponent(key);
            }
            else if (Utils.isPlainObject(value)) {
                pair = buildQueryString(value, key);
            }
            else if (Utils.isArray(value)) {
                pair = value.reduce(function (memo, item) {
                    if (!duplicates[key])
                        duplicates[key] = {};
                    if (!duplicates[key][item]) {
                        duplicates[key][item] = true;
                        return memo.concat(encodeURIComponent(key) + "=" + encodeURIComponent(item));
                    }
                    return memo;
                }, []).join("&");
            }
            else {
                pair = encodeURIComponent(key) + "=" + encodeURIComponent(value);
            }
            str.push(pair);
        }
    }
    return str.join("&");
};
let shuffle = (a) => {
    let j, x, i;
    for (i = a.length - 1; i > 0; i--) {
        j = Math.floor(Math.random() * (i + 1));
        x = a[i];
        a[i] = a[j];
        a[j] = x;
    }
    return a;
};
let parseQueryString = function (str) {
    if (str.charAt(0) === "?")
        str = str.substring(1);
    if (!str.length)
        return {};
    let pairs = str.split("&"), params = {};
    for (let i = 0, len = pairs.length; i < len; i++) {
        let pair = pairs[i].split("="), key = decodeURIComponent(pair[0]), value = pair.length == 2 ? decodeURIComponent(pair[1]) : null;
        if (params[key] != null) {
            if (!Utils.isArray(params[key])) {
                params[key] = [params[key]];
            }
            params[key].push(value);
        }
        else
            params[key] = value;
    }
    return params;
};
let eventCancel = function (e) {
    if (!e) {
        if (window.event)
            e = window.event;
        else
            return;
    }
    if (e.cancelBubble != null)
        e.cancelBubble = true;
    if (e.stopPropagation)
        e.stopPropagation();
    if (e.preventDefault)
        e.preventDefault();
    if (window.event)
        e.returnValue = false;
    // if (e.cancel != null) e.cancel = true;
};
let isValidAge = (day, month, year, minAge, maxAge) => {
    // depending on the year, calculate the number of days in the month
    let daysInMonth, februaryDays = (year % 4 === 0) ? 29 : 28;
    daysInMonth = [31, februaryDays, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
    // first, check the incoming month and year are valid.
    if (!month || !day || !year) {
        return false;
    }
    if (1 > month || month > 12) {
        return false;
    }
    if (year < 0) {
        return false;
    }
    if (1 > day || day > daysInMonth[month - 1]) {
        return false;
    }
    // if required, verify the current date is LATER than the incoming date.
    if (minAge !== undefined || maxAge !== undefined) {
        // get current year
        let currentYear = (new Date).getFullYear(), age = currentYear - year;
        if (age < 0) {
            return false;
        }
        if (age < minAge) {
            return false;
        }
        if (age > maxAge) {
            return false;
        }
    }
    return true;
};
let fileSizeFormat = function (size, decimalSep = ".", digitsSep = " ") {
    let units = ["Kb", "Mb", "Gb", "Tb"], i_max = units.length, i = 0, ko = 1024, result = 0;
    size = parseFloat(String(size));
    while (size >= 1 && i < i_max) {
        result = size;
        size /= ko;
        i++;
    }
    if (!i) {
        i = 1;
    }
    let parts = String(result).split("."), head = (parseInt(parts[0]) === result) ? result : Utils.math.numberFormat(result, 2, decimalSep, digitsSep);
    return head + " " + units[i - 1];
};
let Utils = {
    isPlainObject, isString, isArray,
    isFunction, isEmpty, isNotEmpty,
    toArray, isInDOM, shuffle, id: naturalId,
    // ============
    callback, assign, expose, getFrom,
    stringKeyReplace, textToLineString,
    forEach,
    // ============
    math, isValidAge,
    // ============
    buildQueryString, parseQueryString,
    // ============
    eventCancel,
    // ============
    fileSizeFormat
};
export default Utils;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbHMvVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOERBQThEO0FBQzlELElBQUksVUFBVSxHQUFNLENBQUMsQ0FBQztBQUN0QixJQUFJLE9BQU8sR0FBUyxLQUFLLENBQUMsT0FBTyxDQUFDO0FBQ2xDLElBQUksU0FBUyxHQUFPLEdBQVcsRUFBRSxDQUFDLEtBQUssR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUM7QUFDekQsSUFBSSxhQUFhLEdBQUcsQ0FBQyxDQUFNLEVBQVcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxpQkFBaUIsQ0FBQztBQUNqRyxJQUFJLFFBQVEsR0FBUSxDQUFDLENBQU0sRUFBZSxFQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssUUFBUSxDQUFDO0FBQ25FLElBQUksVUFBVSxHQUFNLENBQUMsQ0FBTSxFQUFpQixFQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssVUFBVSxDQUFDO0FBQ3ZFLElBQUksT0FBTyxHQUFTLFVBQVUsQ0FBTTtJQUVuQyxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtRQUNmLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0tBQ2pCO0lBQ0QsSUFBSSxhQUFhLENBQUMsQ0FBQyxDQUFDLEVBQUU7UUFDckIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0tBQzlCO0lBRUQsSUFBSSxPQUFPLENBQUMsS0FBSyxRQUFRLEVBQUU7UUFDMUIsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQTtLQUM1QjtJQUVELElBQUksT0FBTyxDQUFDLEtBQUssUUFBUSxFQUFFO1FBQzFCLE9BQU8sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tB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QUFDbEMsQ0FBQyxDQUFDO0FBRUYsSUFBSSxLQUFLLEdBQUc7SUFDWCxhQUFhLEVBQUUsUUFBUSxFQUFFLE9BQU87SUFDaEMsVUFBVSxFQUFFLE9BQU8sRUFBRSxVQUFVO0lBQy9CLE9BQU8sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxTQUFTO0lBQ3pDLGVBQWU7SUFDZCxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPO0lBQ2pDLGdCQUFnQixFQUFFLGdCQUFnQjtJQUNsQyxPQUFPO0lBQ1IsZUFBZTtJQUNkLElBQUksRUFBRSxVQUFVO0lBQ2pCLGVBQWU7SUFDZCxnQkFBZ0IsRUFBRSxnQkFBZ0I7SUFDbkMsZUFBZTtJQUNkLFdBQVc7SUFDWixlQUFlO0lBQ2QsY0FBYztDQUNkLENBQUM7QUFFRixlQUFlLEtBQUssQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT1UWVBFIENIRUNLRVJTPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5sZXQgX25hdHVyYWxJZCAgICA9IDA7XG5sZXQgaXNBcnJheSAgICAgICA9IEFycmF5LmlzQXJyYXk7XG5sZXQgbmF0dXJhbElkICAgICA9ICgpOiBzdHJpbmcgPT4gXCJpZF9cIiArIChfbmF0dXJhbElkKyspO1xubGV0IGlzUGxhaW5PYmplY3QgPSAoYTogYW55KTogYm9vbGVhbiA9PiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYSkgPT09IFwiW29iamVjdCBPYmplY3RdXCI7XG5sZXQgaXNTdHJpbmcgICAgICA9IChhOiBhbnkpOiBhIGlzIHN0cmluZyA9PiB0eXBlb2YgYSA9PT0gXCJzdHJpbmdcIjtcbmxldCBpc0Z1bmN0aW9uICAgID0gKGE6IGFueSk6IGEgaXMgRnVuY3Rpb24gPT4gdHlwZW9mIGEgPT09IFwiZnVuY3Rpb25cIjtcbmxldCBpc0VtcHR5ICAgICAgID0gZnVuY3Rpb24gKGE6IGFueSk6IGJvb2xlYW4ge1xuXG5cdGlmIChpc0FycmF5KGEpKSB7XG5cdFx0cmV0dXJuICFhLmxlbmd0aDtcblx0fVxuXHRpZiAoaXNQbGFpbk9iamVjdChhKSkge1xuXHRcdHJldHVybiAhT2JqZWN0LmtleXMoYSkubGVuZ3RoO1xuXHR9XG5cblx0aWYgKHR5cGVvZiBhID09PSBcInN0cmluZ1wiKSB7XG5cdFx0cmV0dXJuIGEudHJpbSgpLmxlbmd0aCA9PT0gMFxuXHR9XG5cblx0aWYgKHR5cGVvZiBhID09PSBcIm51bWJlclwiKSB7XG5cdFx0cmV0dXJuIGlzTmFOKGEpO1xuXHR9XG5cblx0cmV0dXJuICFhO1xufTtcblxubGV0IGlzTm90RW1wdHkgPSAoYTogYW55KTogYm9vbGVhbiA9PiAhaXNFbXB0eShhKTtcbmxldCB0b0FycmF5ICAgID0gKGE6IGFueSk6IEFycmF5PGFueT4gPT4gW10uY29uY2F0LmFwcGx5KFtdLCBhKTtcblxuLy8gPT09PT09PT09PUhFTFBFUlM9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbmxldCBjYWxsYmFjayA9IGZ1bmN0aW9uIChmbjogYW55LCBhcmdzPzogQXJyYXk8YW55PiwgY3R4PzogYW55KTogYW55IHtcblx0aWYgKHR5cGVvZiBmbiA9PT0gXCJmdW5jdGlvblwiKSB7XG5cdFx0cmV0dXJuIGZuLmFwcGx5KGN0eCwgYXJncyk7XG5cdH1cblxuXHRyZXR1cm4gbnVsbDtcbn07XG5cbmxldCBmb3JFYWNoID0gZnVuY3Rpb24gPFQ+KG9iajogeyBba2V5OiBzdHJpbmddOiBUIH0gfCBBcnJheTxUPiwgZm46ICh2YWx1ZTogVCwga2V5OiBhbnkpID0+IHZvaWQpIHtcblx0T2JqZWN0LmtleXMob2JqKS5mb3JFYWNoKChrZXk6IHN0cmluZykgPT4ge1xuXHRcdGxldCB2YWx1ZTogVCA9IChvYmogYXMgYW55KVtrZXldO1xuXHRcdGZuKHZhbHVlLCBrZXkpO1xuXHR9KTtcbn07XG5cbmxldCBhc3NpZ24gPSAoT2JqZWN0IGFzIGFueSkuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQ6IG9iamVjdCwgc291cmNlOiBvYmplY3QpIHtcblxuXHRsZXQgdG8gPSB0YXJnZXQsIGZyb20sIHN5bWJvbHM7XG5cblx0Zm9yIChsZXQgcyA9IDE7IHMgPCBhcmd1bWVudHMubGVuZ3RoOyBzKyspIHtcblx0XHRmcm9tID0gT2JqZWN0KGFyZ3VtZW50c1tzXSk7XG5cblx0XHRmb3IgKGxldCBrZXkgaW4gZnJvbSkge1xuXHRcdFx0aWYgKGZyb20uaGFzT3duUHJvcGVydHkoa2V5KSkge1xuXHRcdFx0XHQodG8gYXMgYW55KVtrZXldID0gZnJvbVtrZXldO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChcImdldE93blByb3BlcnR5U3ltYm9sc1wiIGluIE9iamVjdCkge1xuXHRcdFx0c3ltYm9scyA9IChPYmplY3QgYXMgYW55KS5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZnJvbSk7XG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHN5bWJvbHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYgKGZyb20ucHJvcGVydHlJc0VudW1lcmFibGUoc3ltYm9sc1tpXSkpIHtcblx0XHRcdFx0XHQodG8gYXMgYW55KVtzeW1ib2xzW2ldXSA9IGZyb21bc3ltYm9sc1tpXV07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gdG87XG59O1xuXG5sZXQgc3RyaW5nS2V5UmVwbGFjZSA9IGZ1bmN0aW9uIChzdHI6IHN0cmluZywgZGF0YTogb2JqZWN0KTogc3RyaW5nIHtcblx0aWYgKGlzU3RyaW5nKHN0cikgJiYgc3RyLmxlbmd0aCAmJiBpc1BsYWluT2JqZWN0KGRhdGEpKSB7XG5cdFx0bGV0IGtleXMgPSBPYmplY3Qua2V5cyhkYXRhKS5zb3J0KCkucmV2ZXJzZSgpLFxuXHRcdFx0cmVnO1xuXG5cdFx0aWYgKGtleXMubGVuZ3RoKSB7XG5cdFx0XHRsZXQgbSA9IGtleXMuam9pbihcInxcIik7XG5cdFx0XHRyZWcgICA9IG5ldyBSZWdFeHAoXCI6KFwiICsgbSArIFwiKVwiLCBcImdcIik7XG5cblx0XHRcdHJldHVybiBzdHIucmVwbGFjZShyZWcsIGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0bGV0IHJlcGxhY2VtZW50ID0gKGRhdGEgYXMgYW55KVthcmd1bWVudHNbMV1dO1xuXG5cdFx0XHRcdGlmIChyZXBsYWNlbWVudCA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGFyZ3VtZW50c1swXTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiByZXBsYWNlbWVudDtcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiBzdHI7XG59O1xuXG5sZXQgdGV4dFRvTGluZVN0cmluZyA9ICh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuXHRsZXQgcmVnICAgICAgICAgICAgICAgID0gL1tcIidcXFxcXFxuXFxyXFx0XFx1MjAyOFxcdTIwMjldL2csXG5cdFx0dG9fZXNjYXBlczogb2JqZWN0ID0ge1xuXHRcdFx0XCJcXFwiXCIgICAgOiBcIlxcXCJcIixcblx0XHRcdFwiJ1wiICAgICA6IFwiJ1wiLFxuXHRcdFx0XCJcXFxcXCIgICAgOiBcIlxcXFxcIixcblx0XHRcdFwiXFxuXCIgICAgOiBcIm5cIixcblx0XHRcdFwiXFxyXCIgICAgOiBcInJcIixcblx0XHRcdFwiXFx0XCIgICAgOiBcInRcIixcblx0XHRcdFwiXFx1MjAyOFwiOiBcIjIwMjhcIixcblx0XHRcdFwiXFx1MjAyOVwiOiBcIjIwMjlcIlxuXHRcdH07XG5cblx0cmV0dXJuIHRleHQucmVwbGFjZShyZWcsXG5cdFx0KG1hdGNoKSA9PiBcIlxcXFxcIiArICh0b19lc2NhcGVzIGFzIGFueSlbbWF0Y2hdKTtcbn07XG5cbmxldCBleHBvc2UgPSBmdW5jdGlvbiAoaXRlbXM6IEFycmF5PHN0cmluZz4sIGN0eDogYW55KTogb2JqZWN0IHtcblx0bGV0IG91dDogb2JqZWN0ID0ge307XG5cdGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuXHRcdGxldCBpdGVtID0gY3R4W2tleV07XG5cdFx0Ly8gbWV0aG9kcyBhbmQgcHJvcGVydGllc1xuXHRcdGlmIChpc0Z1bmN0aW9uKGl0ZW0pKSB7XG5cdFx0XHQob3V0IGFzIGFueSlba2V5XSA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0bGV0IHJlcyA9IGl0ZW0uYXBwbHkoY3R4LCBhcmd1bWVudHMpO1xuXG5cdFx0XHRcdHJldHVybiAocmVzID09PSBjdHgpID8gb3V0IDogcmVzO1xuXHRcdFx0fTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0KG91dCBhcyBhbnkpW2tleV0gPSBpdGVtO1xuXHRcdH1cblx0fSk7XG5cblx0cmV0dXJuIG91dDtcbn07XG5cbmxldCBnZXRGcm9tID0gZnVuY3Rpb24gKGZyb206IG9iamVjdCwga2V5OiBzdHJpbmcpOiBhbnkge1xuXHRsZXQge1trZXldOiB2YWx1ZX06IGFueSA9IGZyb20gfHwge307XG5cblx0cmV0dXJuIHZhbHVlO1xufTtcblxuLy8gPT09PT09PT09PU1BVEg9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxubGV0IF9zZXREaWdpdHNTZXAgPSBmdW5jdGlvbiAoeDogbnVtYmVyLCBzZXA6IHN0cmluZyk6IHN0cmluZyB7XG5cdGxldCBzICAgICA9IFN0cmluZyh4KSxcblx0XHRjb3VudCA9IDAsXG5cdFx0YW5zICAgPSBbXSxcblx0XHRqICAgICA9IHMuaW5kZXhPZihcIi5cIiksXG5cdFx0c3RhcnQgPSAoaiAhPT0gLTEpID8gaiA6IHMubGVuZ3RoLFxuXHRcdGVuZCAgID0gKGogIT09IC0xKSA/IHMuc2xpY2Uoc3RhcnQgKyAxKSA6IFtdLFxuXHRcdGkgICAgID0gc3RhcnQ7XG5cblx0Zm9yICg7IGkgPj0gMDsgaS0tKSB7XG5cdFx0aWYgKGNvdW50ID09PSAzKSB7XG5cdFx0XHRjb3VudCAgPSAwO1xuXHRcdFx0YW5zW2ldID0gKGkgIT09IDApID8gc2VwICsgc1tpXSA6IHNbaV07XG5cdFx0fSBlbHNlIHtcblx0XHRcdGFuc1tpXSA9IHNbaV07XG5cdFx0fVxuXHRcdGNvdW50Kys7XG5cdH1cblxuXHRyZXR1cm4gYW5zLmNvbmNhdChlbmQpLmpvaW4oXCJcIik7XG59O1xuXG5sZXQgbWF0aCA9IHtcblx0bnVtYmVyRm9ybWF0OiBmdW5jdGlvbiAoeDogbnVtYmVyIHwgc3RyaW5nLCBkZWM6IG51bWJlciA9IDIsIGRlY2ltYWxTZXA6IHN0cmluZyA9IFwiLlwiLCBkaWdpdHNTZXA6IHN0cmluZyA9IFwiIFwiKTogc3RyaW5nIHtcblxuXHRcdGlmICgheCkge1xuXHRcdFx0cmV0dXJuIFwiXCI7XG5cdFx0fVxuXG5cdFx0bGV0IGFucyA9IHBhcnNlRmxvYXQoU3RyaW5nKHgpKSwgZGVjaW1hbFBvcztcblxuXHRcdGlmIChkZWMgPj0gMCkge1xuXHRcdFx0bGV0IGRlY2ltYWxQb3cgPSBNYXRoLnBvdygxMCwgZGVjKTtcblx0XHRcdGFucyAgICAgICAgICAgID0gTWF0aC5mbG9vcihhbnMgKiBkZWNpbWFsUG93KSAvIGRlY2ltYWxQb3c7XG5cdFx0fVxuXG5cdFx0bGV0IG4gPSBfc2V0RGlnaXRzU2VwKGFucywgZGlnaXRzU2VwKTtcblx0XHRsZXQgYSA9IG4uc3BsaXQoXCJcIik7XG5cblx0XHRkZWNpbWFsUG9zID0gYS5sYXN0SW5kZXhPZihcIi5cIik7XG5cdFx0aWYgKGRlY2ltYWxQb3MgPj0gMCAmJiBkZWNpbWFsU2VwICE9PSBcIi5cIikge1xuXHRcdFx0YVtkZWNpbWFsUG9zXSA9IGRlY2ltYWxTZXA7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGEuam9pbihcIlwiKTtcblx0fVxufTtcblxubGV0IGlzSW5ET00gPSBmdW5jdGlvbiAoZWxlbWVudDogYW55LCBpbkJvZHk6IGJvb2xlYW4gPSBmYWxzZSk6IGJvb2xlYW4ge1xuXHRsZXQgXyA9IGVsZW1lbnQsIGxhc3Q7XG5cblx0d2hpbGUgKF8pIHtcblx0XHRsYXN0ID0gXztcblx0XHRpZiAoaW5Cb2R5ICYmIGxhc3QgPT09IGRvY3VtZW50LmJvZHkpIHtcblx0XHRcdGJyZWFrO1xuXHRcdH1cblx0XHRfID0gXy5wYXJlbnROb2RlO1xuXHR9XG5cblx0cmV0dXJuIGluQm9keSA/IGxhc3QgPT09IGRvY3VtZW50LmJvZHkgOiBsYXN0ID09PSBkb2N1bWVudDtcbn07XG5cbmxldCBidWlsZFF1ZXJ5U3RyaW5nID0gZnVuY3Rpb24gKG9iamVjdDogb2JqZWN0LCBwcmVmaXg6IHN0cmluZyk6IHN0cmluZyB7XG5cdGxldCBkdXBsaWNhdGVzID0ge30sXG5cdFx0c3RyICAgICAgICA9IFtdO1xuXG5cdGZvciAobGV0IHByb3AgaW4gb2JqZWN0KSB7XG5cdFx0aWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wKSkge1xuXHRcdFx0Y29udGludWU7XG5cdFx0fVxuXG5cdFx0bGV0IGtleSAgID0gcHJlZml4ID8gcHJlZml4ICsgXCJbXCIgKyBwcm9wICsgXCJdXCIgOiBwcm9wLFxuXHRcdFx0dmFsdWUgPSAob2JqZWN0IGFzIGFueSlbcHJvcF0sXG5cdFx0XHRwYWlyO1xuXHRcdGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRpZiAodmFsdWUgPT09IG51bGwpIHtcblx0XHRcdFx0cGFpciA9IGVuY29kZVVSSUNvbXBvbmVudChrZXkpO1xuXHRcdFx0fSBlbHNlIGlmIChVdGlscy5pc1BsYWluT2JqZWN0KHZhbHVlKSkge1xuXHRcdFx0XHRwYWlyID0gYnVpbGRRdWVyeVN0cmluZyh2YWx1ZSwga2V5KTtcblx0XHRcdH0gZWxzZSBpZiAoVXRpbHMuaXNBcnJheSh2YWx1ZSkpIHtcblx0XHRcdFx0cGFpciA9IHZhbHVlLnJlZHVjZShmdW5jdGlvbiAobWVtbywgaXRlbSkge1xuXHRcdFx0XHRcdGlmICghKGR1cGxpY2F0ZXMgYXMgYW55KVtrZXldKSAoZHVwbGljYXRlcyBhcyBhbnkpW2tleV0gPSB7fTtcblx0XHRcdFx0XHRpZiAoIShkdXBsaWNhdGVzIGFzIGFueSlba2V5XVtpdGVtXSkge1xuXHRcdFx0XHRcdFx0KGR1cGxpY2F0ZXMgYXMgYW55KVtrZXldW2l0ZW1dID0gdHJ1ZTtcblx0XHRcdFx0XHRcdHJldHVybiBtZW1vLmNvbmNhdChlbmNvZGVVUklDb21wb25lbnQoa2V5KSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KGl0ZW0pKVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gbWVtbztcblx0XHRcdFx0fSwgW10pLmpvaW4oXCImXCIpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cGFpciA9IGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpO1xuXHRcdFx0fVxuXG5cdFx0XHRzdHIucHVzaChwYWlyKTtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gc3RyLmpvaW4oXCImXCIpXG59O1xuXG5sZXQgc2h1ZmZsZSA9IChhOiBBcnJheTxhbnk+KTogQXJyYXk8YW55PiA9PiB7XG5cdGxldCBqLCB4LCBpO1xuXG5cdGZvciAoaSA9IGEubGVuZ3RoIC0gMTsgaSA+IDA7IGktLSkge1xuXHRcdGogICAgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoaSArIDEpKTtcblx0XHR4ICAgID0gYVtpXTtcblx0XHRhW2ldID0gYVtqXTtcblx0XHRhW2pdID0geDtcblx0fVxuXG5cdHJldHVybiBhO1xufTtcblxubGV0IHBhcnNlUXVlcnlTdHJpbmcgPSBmdW5jdGlvbiAoc3RyOiBzdHJpbmcpIHtcblx0aWYgKHN0ci5jaGFyQXQoMCkgPT09IFwiP1wiKSBzdHIgPSBzdHIuc3Vic3RyaW5nKDEpO1xuXHRpZiAoIXN0ci5sZW5ndGgpIHJldHVybiB7fTtcblxuXHRsZXQgcGFpcnMgPSBzdHIuc3BsaXQoXCImXCIpLCBwYXJhbXMgPSB7fTtcblx0Zm9yIChsZXQgaSA9IDAsIGxlbiA9IHBhaXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cdFx0bGV0IHBhaXIgID0gcGFpcnNbaV0uc3BsaXQoXCI9XCIpLFxuXHRcdFx0a2V5ICAgPSBkZWNvZGVVUklDb21wb25lbnQocGFpclswXSksXG5cdFx0XHR2YWx1ZSA9IHBhaXIubGVuZ3RoID09IDIgPyBkZWNvZGVVUklDb21wb25lbnQocGFpclsxXSkgOiBudWxsO1xuXHRcdGlmICgocGFyYW1zIGFzIGFueSlba2V5XSAhPSBudWxsKSB7XG5cdFx0XHRpZiAoIVV0aWxzLmlzQXJyYXkoKHBhcmFtcyBhcyBhbnkpW2tleV0pKSB7XG5cdFx0XHRcdChwYXJhbXMgYXMgYW55KVtrZXldID0gWyhwYXJhbXMgYXMgYW55KVtrZXldXTtcblx0XHRcdH1cblx0XHRcdChwYXJhbXMgYXMgYW55KVtrZXldLnB1c2godmFsdWUpXG5cdFx0fSBlbHNlIChwYXJhbXMgYXMgYW55KVtrZXldID0gdmFsdWU7XG5cdH1cblx0cmV0dXJuIHBhcmFtc1xufTtcblxubGV0IGV2ZW50Q2FuY2VsID0gZnVuY3Rpb24gKGU6IEV2ZW50KSB7XG5cblx0aWYgKCFlKSB7XG5cdFx0aWYgKHdpbmRvdy5ldmVudCkgZSA9IHdpbmRvdy5ldmVudDtcblx0XHRlbHNlIHJldHVybjtcblx0fVxuXG5cdGlmIChlLmNhbmNlbEJ1YmJsZSAhPSBudWxsKSBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XG5cdGlmIChlLnN0b3BQcm9wYWdhdGlvbikgZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0aWYgKGUucHJldmVudERlZmF1bHQpIGUucHJldmVudERlZmF1bHQoKTtcblx0aWYgKHdpbmRvdy5ldmVudCkgZS5yZXR1cm5WYWx1ZSA9IGZhbHNlO1xuXHQvLyBpZiAoZS5jYW5jZWwgIT0gbnVsbCkgZS5jYW5jZWwgPSB0cnVlO1xufTtcblxubGV0IGlzVmFsaWRBZ2UgPSAoZGF5OiBudW1iZXIsIG1vbnRoOiBudW1iZXIsIHllYXI6IG51bWJlciwgbWluQWdlOiBudW1iZXIsIG1heEFnZTogbnVtYmVyKTogYm9vbGVhbiA9PiB7XG5cdC8vIGRlcGVuZGluZyBvbiB0aGUgeWVhciwgY2FsY3VsYXRlIHRoZSBudW1iZXIgb2YgZGF5cyBpbiB0aGUgbW9udGhcblx0bGV0IGRheXNJbk1vbnRoLFxuXHRcdGZlYnJ1YXJ5RGF5cyA9ICh5ZWFyICUgNCA9PT0gMCkgPyAyOSA6IDI4O1xuXG5cdGRheXNJbk1vbnRoID0gWzMxLCBmZWJydWFyeURheXMsIDMxLCAzMCwgMzEsIDMwLCAzMSwgMzEsIDMwLCAzMSwgMzAsIDMxXTtcblxuXHQvLyBmaXJzdCwgY2hlY2sgdGhlIGluY29taW5nIG1vbnRoIGFuZCB5ZWFyIGFyZSB2YWxpZC5cblx0aWYgKCFtb250aCB8fCAhZGF5IHx8ICF5ZWFyKSB7XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cdGlmICgxID4gbW9udGggfHwgbW9udGggPiAxMikge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXHRpZiAoeWVhciA8IDApIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblx0aWYgKDEgPiBkYXkgfHwgZGF5ID4gZGF5c0luTW9udGhbbW9udGggLSAxXSkge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdC8vIGlmIHJlcXVpcmVkLCB2ZXJpZnkgdGhlIGN1cnJlbnQgZGF0ZSBpcyBMQVRFUiB0aGFuIHRoZSBpbmNvbWluZyBkYXRlLlxuXHRpZiAobWluQWdlICE9PSB1bmRlZmluZWQgfHwgbWF4QWdlICE9PSB1bmRlZmluZWQpIHtcblx0XHQvLyBnZXQgY3VycmVudCB5ZWFyXG5cdFx0bGV0IGN1cnJlbnRZZWFyID0gKG5ldyBEYXRlKS5nZXRGdWxsWWVhcigpLFxuXHRcdFx0YWdlICAgICAgICAgPSBjdXJyZW50WWVhciAtIHllYXI7XG5cblx0XHRpZiAoYWdlIDwgMCkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0XHRpZiAoYWdlIDwgbWluQWdlKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHRcdGlmIChhZ2UgPiBtYXhBZ2UpIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gdHJ1ZTtcbn07XG5cbmxldCBmaWxlU2l6ZUZvcm1hdCA9IGZ1bmN0aW9uIChzaXplOiBudW1iZXIsIGRlY2ltYWxTZXA6IHN0cmluZyA9IFwiLlwiLCBkaWdpdHNTZXA6IHN0cmluZyA9IFwiIFwiKSB7XG5cdGxldCB1bml0cyAgPSBbXCJLYlwiLCBcIk1iXCIsIFwiR2JcIiwgXCJUYlwiXSxcblx0XHRpX21heCAgPSB1bml0cy5sZW5ndGgsXG5cdFx0aSAgICAgID0gMCxcblx0XHRrbyAgICAgPSAxMDI0LFxuXHRcdHJlc3VsdCA9IDA7XG5cblx0c2l6ZSA9IHBhcnNlRmxvYXQoU3RyaW5nKHNpemUpKTtcblxuXHR3aGlsZSAoc2l6ZSA+PSAxICYmIGkgPCBpX21heCkge1xuXHRcdHJlc3VsdCA9IHNpemU7XG5cdFx0c2l6ZSAvPSBrbztcblx0XHRpKys7XG5cdH1cblxuXHRpZiAoIWkpIHtcblx0XHRpID0gMTtcblx0fVxuXG5cdGxldCBwYXJ0cyA9IFN0cmluZyhyZXN1bHQpLnNwbGl0KFwiLlwiKSxcblx0XHRoZWFkICA9IChwYXJzZUludChwYXJ0c1swXSkgPT09IHJlc3VsdCkgPyByZXN1bHQgOiBVdGlscy5tYXRoLm51bWJlckZvcm1hdChyZXN1bHQsIDIsIGRlY2ltYWxTZXAsIGRpZ2l0c1NlcCk7XG5cblx0cmV0dXJuIGhlYWQgKyBcIiBcIiArIHVuaXRzW2kgLSAxXTtcbn07XG5cbmxldCBVdGlscyA9IHtcblx0aXNQbGFpbk9iamVjdCwgaXNTdHJpbmcsIGlzQXJyYXksXG5cdGlzRnVuY3Rpb24sIGlzRW1wdHksIGlzTm90RW1wdHksXG5cdHRvQXJyYXksIGlzSW5ET00sIHNodWZmbGUsIGlkOiBuYXR1cmFsSWQsXG4vLyA9PT09PT09PT09PT1cblx0Y2FsbGJhY2ssIGFzc2lnbiwgZXhwb3NlLCBnZXRGcm9tLFxuXHRzdHJpbmdLZXlSZXBsYWNlLCB0ZXh0VG9MaW5lU3RyaW5nLFxuXHRmb3JFYWNoLFxuLy8gPT09PT09PT09PT09XG5cdG1hdGgsIGlzVmFsaWRBZ2UsXG4vLyA9PT09PT09PT09PT1cblx0YnVpbGRRdWVyeVN0cmluZywgcGFyc2VRdWVyeVN0cmluZyxcbi8vID09PT09PT09PT09PVxuXHRldmVudENhbmNlbCxcbi8vID09PT09PT09PT09PVxuXHRmaWxlU2l6ZUZvcm1hdFxufTtcblxuZXhwb3J0IGRlZmF1bHQgVXRpbHM7XG4iXX0=