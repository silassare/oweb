// ==========TYPE CHECKERS====================================
let isArray = Array.isArray;
let isPlainObject = (a) => Object.prototype.toString.call(a) === "[object Object]";
let isString = (a) => typeof a === "string";
let isFunction = (a) => typeof a === "function";
let isEmpty = function (a) {
    if (isArray(a)) {
        return !a.length;
    }
    if (isPlainObject(a)) {
        return !Object.keys(a).length;
    }
    if (typeof a === "string") {
        return a.trim().length === 0;
    }
    if (typeof a === "number") {
        return isNaN(a);
    }
    return !a;
};
let isNotEmpty = (a) => !isEmpty(a);
let toArray = (a) => [].concat.apply([], a);
// ==========HELPERS====================================
let callback = function (fn, args, ctx) {
    if (typeof fn === "function") {
        return fn.apply(ctx, args);
    }
    return null;
};
let forEach = function (obj, fn) {
    Object.keys(obj).forEach((key) => {
        let value = obj[key];
        fn(value, key);
    });
};
let assign = Object.assign || function (target, source) {
    let to = target, from, symbols;
    for (let s = 1; s < arguments.length; s++) {
        from = Object(arguments[s]);
        for (let key in from) {
            if (from.hasOwnProperty(key)) {
                to[key] = from[key];
            }
        }
        if ("getOwnPropertySymbols" in Object) {
            symbols = Object.getOwnPropertySymbols(from);
            for (let i = 0; i < symbols.length; i++) {
                if (from.propertyIsEnumerable(symbols[i])) {
                    to[symbols[i]] = from[symbols[i]];
                }
            }
        }
    }
    return to;
};
let stringKeyReplace = function (str, data) {
    if (isString(str) && str.length && isPlainObject(data)) {
        let keys = Object.keys(data).sort().reverse(), reg;
        if (keys.length) {
            let m = keys.join("|");
            reg = new RegExp(":(" + m + ")", "g");
            return str.replace(reg, function () {
                let replacement = data[arguments[1]];
                if (replacement === undefined) {
                    return arguments[0];
                }
                return replacement;
            });
        }
    }
    return str;
};
let textToLineString = (text) => {
    let reg = /["'\\\n\r\t\u2028\u2029]/g, to_escapes = {
        "\"": "\"",
        "'": "'",
        "\\": "\\",
        "\n": "n",
        "\r": "r",
        "\t": "t",
        "\u2028": "2028",
        "\u2029": "2029"
    };
    return text.replace(reg, (match) => "\\" + to_escapes[match]);
};
let expose = function (items, ctx) {
    let out = {};
    items.forEach(function (key) {
        let item = ctx[key];
        // methods and properties
        if (isFunction(item)) {
            out[key] = function () {
                let res = item.apply(ctx, arguments);
                return (res === ctx) ? out : res;
            };
        }
        else {
            out[key] = item;
        }
    });
    return out;
};
let getFrom = function (from, key) {
    let { [key]: value } = from || {};
    return value;
};
// ==========MATH====================================
let _setDigitsSep = function (x, sep) {
    let s = String(x), count = 0, ans = [], j = s.indexOf("."), start = (j !== -1) ? j : s.length, end = (j !== -1) ? s.slice(start + 1) : [], i = start;
    for (; i >= 0; i--) {
        if (count === 3) {
            count = 0;
            ans[i] = (i !== 0) ? sep + s[i] : s[i];
        }
        else {
            ans[i] = s[i];
        }
        count++;
    }
    return ans.concat(end).join("");
};
let math = {
    numberFormat: function (x, dec = 2, decimalSep = ".", digitsSep = " ") {
        if (!x) {
            return "";
        }
        let ans = parseFloat(String(x)), decimalPos;
        if (dec >= 0) {
            let decimalPow = Math.pow(10, dec);
            ans = Math.floor(ans * decimalPow) / decimalPow;
        }
        let n = _setDigitsSep(ans, digitsSep);
        let a = n.split("");
        decimalPos = a.lastIndexOf(".");
        if (decimalPos >= 0 && decimalSep !== ".") {
            a[decimalPos] = decimalSep;
        }
        return a.join("");
    }
};
let isInDOM = function (element, inBody = false) {
    let _ = element, last;
    while (_) {
        last = _;
        if (inBody && last === document.body) {
            break;
        }
        _ = _.parentNode;
    }
    return inBody ? last === document.body : last === document;
};
let buildQueryString = function (object, prefix) {
    let duplicates = {}, str = [];
    for (let prop in object) {
        if (!Object.prototype.hasOwnProperty.call(object, prop)) {
            continue;
        }
        let key = prefix ? prefix + "[" + prop + "]" : prop, value = object[prop], pair;
        if (value !== undefined) {
            if (value === null) {
                pair = encodeURIComponent(key);
            }
            else if (Utils.isPlainObject(value)) {
                pair = buildQueryString(value, key);
            }
            else if (Utils.isArray(value)) {
                pair = value.reduce(function (memo, item) {
                    if (!duplicates[key])
                        duplicates[key] = {};
                    if (!duplicates[key][item]) {
                        duplicates[key][item] = true;
                        return memo.concat(encodeURIComponent(key) + "=" + encodeURIComponent(item));
                    }
                    return memo;
                }, []).join("&");
            }
            else {
                pair = encodeURIComponent(key) + "=" + encodeURIComponent(value);
            }
            str.push(pair);
        }
    }
    return str.join("&");
};
let shuffle = (a) => {
    let j, x, i;
    for (i = a.length - 1; i > 0; i--) {
        j = Math.floor(Math.random() * (i + 1));
        x = a[i];
        a[i] = a[j];
        a[j] = x;
    }
    return a;
};
let parseQueryString = function (str) {
    if (str.charAt(0) === "?")
        str = str.substring(1);
    if (!str.length)
        return {};
    let pairs = str.split("&"), params = {};
    for (let i = 0, len = pairs.length; i < len; i++) {
        let pair = pairs[i].split("="), key = decodeURIComponent(pair[0]), value = pair.length == 2 ? decodeURIComponent(pair[1]) : null;
        if (params[key] != null) {
            if (!Utils.isArray(params[key])) {
                params[key] = [params[key]];
            }
            params[key].push(value);
        }
        else
            params[key] = value;
    }
    return params;
};
let eventCancel = function (e) {
    if (!e) {
        if (window.event)
            e = window.event;
        else
            return;
    }
    if (e.cancelBubble != null)
        e.cancelBubble = true;
    if (e.stopPropagation)
        e.stopPropagation();
    if (e.preventDefault)
        e.preventDefault();
    if (window.event)
        e.returnValue = false;
    // if (e.cancel != null) e.cancel = true;
};
let isValidAge = (day, month, year, minAge, maxAge) => {
    // depending on the year, calculate the number of days in the month
    let daysInMonth, februaryDays = (year % 4 === 0) ? 29 : 28;
    daysInMonth = [31, februaryDays, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
    // first, check the incoming month and year are valid.
    if (!month || !day || !year) {
        return false;
    }
    if (1 > month || month > 12) {
        return false;
    }
    if (year < 0) {
        return false;
    }
    if (1 > day || day > daysInMonth[month - 1]) {
        return false;
    }
    // if required, verify the current date is LATER than the incoming date.
    if (minAge !== undefined || maxAge !== undefined) {
        // get current year
        let currentYear = (new Date).getFullYear(), age = currentYear - year;
        if (age < 0) {
            return false;
        }
        if (age < minAge) {
            return false;
        }
        if (age > maxAge) {
            return false;
        }
    }
    return true;
};
let Utils = {
    isPlainObject, isString, isArray,
    isFunction, isEmpty, isNotEmpty,
    toArray, isInDOM, shuffle,
    // ============
    callback, assign, expose, getFrom,
    stringKeyReplace, textToLineString,
    forEach,
    // ============
    math, isValidAge,
    // ============
    buildQueryString, parseQueryString,
    // ============
    eventCancel
};
export default Utils;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbHMvVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOERBQThEO0FBRTlELElBQUksT0FBTyxHQUFTLEtBQUssQ0FBQyxPQUFPLENBQUM7QUFDbEMsSUFBSSxhQUFhLEdBQUcsQ0FBQyxDQUFNLEVBQVcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxpQkFBaUIsQ0FBQztBQUNqRyxJQUFJLFFBQVEsR0FBUSxDQUFDLENBQU0sRUFBZSxFQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssUUFBUSxDQUFDO0FBQ25FLElBQUksVUFBVSxHQUFNLENBQUMsQ0FBTSxFQUFpQixFQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssVUFBVSxDQUFDO0FBQ3ZFLElBQUksT0FBTyxHQUFTLFVBQVUsQ0FBTTtJQUVuQyxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtRQUNmLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0tBQ2pCO0lBQ0QsSUFBSSxhQUFhLENBQUMsQ0FBQyxDQUFDLEVBQUU7UUFDckIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0tBQzlCO0lBRUQsSUFBSSxPQUFPLENBQUMsS0FBSyxRQUFRLEVBQUU7UUFDMUIsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQTtLQUM1QjtJQUVELElBQUksT0FBTyxDQUFDLEtBQUssUUFBUSxFQUFFO1FBQzFCLE9BQU8sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ2hCO0lBRUQsT0FBTyxDQUFDLENBQUMsQ0FBQztBQUNYLENBQUMsQ0FBQztBQUVGLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBTSxFQUFXLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FB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QUFJLENBQUM7QUFDYixDQUFDLENBQUM7QUFFRixJQUFJLEtBQUssR0FBRztJQUNYLGFBQWEsRUFBRSxRQUFRLEVBQUUsT0FBTztJQUNoQyxVQUFVLEVBQUUsT0FBTyxFQUFFLFVBQVU7SUFDL0IsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPO0lBQzFCLGVBQWU7SUFDZCxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPO0lBQ2pDLGdCQUFnQixFQUFFLGdCQUFnQjtJQUNsQyxPQUFPO0lBQ1IsZUFBZTtJQUNkLElBQUksRUFBRSxVQUFVO0lBQ2pCLGVBQWU7SUFDZCxnQkFBZ0IsRUFBRSxnQkFBZ0I7SUFDbkMsZUFBZTtJQUNkLFdBQVc7Q0FDWCxDQUFDO0FBRUYsZUFBZSxLQUFLLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09VFlQRSBDSEVDS0VSUz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5sZXQgaXNBcnJheSAgICAgICA9IEFycmF5LmlzQXJyYXk7XG5sZXQgaXNQbGFpbk9iamVjdCA9IChhOiBhbnkpOiBib29sZWFuID0+IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChhKSA9PT0gXCJbb2JqZWN0IE9iamVjdF1cIjtcbmxldCBpc1N0cmluZyAgICAgID0gKGE6IGFueSk6IGEgaXMgc3RyaW5nID0+IHR5cGVvZiBhID09PSBcInN0cmluZ1wiO1xubGV0IGlzRnVuY3Rpb24gICAgPSAoYTogYW55KTogYSBpcyBGdW5jdGlvbiA9PiB0eXBlb2YgYSA9PT0gXCJmdW5jdGlvblwiO1xubGV0IGlzRW1wdHkgICAgICAgPSBmdW5jdGlvbiAoYTogYW55KTogYm9vbGVhbiB7XG5cblx0aWYgKGlzQXJyYXkoYSkpIHtcblx0XHRyZXR1cm4gIWEubGVuZ3RoO1xuXHR9XG5cdGlmIChpc1BsYWluT2JqZWN0KGEpKSB7XG5cdFx0cmV0dXJuICFPYmplY3Qua2V5cyhhKS5sZW5ndGg7XG5cdH1cblxuXHRpZiAodHlwZW9mIGEgPT09IFwic3RyaW5nXCIpIHtcblx0XHRyZXR1cm4gYS50cmltKCkubGVuZ3RoID09PSAwXG5cdH1cblxuXHRpZiAodHlwZW9mIGEgPT09IFwibnVtYmVyXCIpIHtcblx0XHRyZXR1cm4gaXNOYU4oYSk7XG5cdH1cblxuXHRyZXR1cm4gIWE7XG59O1xuXG5sZXQgaXNOb3RFbXB0eSA9IChhOiBhbnkpOiBib29sZWFuID0+ICFpc0VtcHR5KGEpO1xubGV0IHRvQXJyYXkgICAgPSAoYTogYW55KTogQXJyYXk8YW55PiA9PiBbXS5jb25jYXQuYXBwbHkoW10sIGEpO1xuXG4vLyA9PT09PT09PT09SEVMUEVSUz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxubGV0IGNhbGxiYWNrID0gZnVuY3Rpb24gKGZuOiBhbnksIGFyZ3M/OiBBcnJheTxhbnk+LCBjdHg/OiBhbnkpOiBhbnkge1xuXHRpZiAodHlwZW9mIGZuID09PSBcImZ1bmN0aW9uXCIpIHtcblx0XHRyZXR1cm4gZm4uYXBwbHkoY3R4LCBhcmdzKTtcblx0fVxuXG5cdHJldHVybiBudWxsO1xufTtcblxubGV0IGZvckVhY2ggPSBmdW5jdGlvbiA8VD4ob2JqOiB7IFtrZXk6IHN0cmluZ106IFQgfSB8IEFycmF5PFQ+LCBmbjogKHZhbHVlOiBULCBrZXk6IGFueSkgPT4gdm9pZCkge1xuXHRPYmplY3Qua2V5cyhvYmopLmZvckVhY2goKGtleTogc3RyaW5nKSA9PiB7XG5cdFx0bGV0IHZhbHVlOiBUID0gKG9iaiBhcyBhbnkpW2tleV07XG5cdFx0Zm4odmFsdWUsIGtleSk7XG5cdH0pO1xufTtcblxubGV0IGFzc2lnbiA9IChPYmplY3QgYXMgYW55KS5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldDogb2JqZWN0LCBzb3VyY2U6IG9iamVjdCkge1xuXG5cdGxldCB0byA9IHRhcmdldCwgZnJvbSwgc3ltYm9scztcblxuXHRmb3IgKGxldCBzID0gMTsgcyA8IGFyZ3VtZW50cy5sZW5ndGg7IHMrKykge1xuXHRcdGZyb20gPSBPYmplY3QoYXJndW1lbnRzW3NdKTtcblxuXHRcdGZvciAobGV0IGtleSBpbiBmcm9tKSB7XG5cdFx0XHRpZiAoZnJvbS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG5cdFx0XHRcdCh0byBhcyBhbnkpW2tleV0gPSBmcm9tW2tleV07XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKFwiZ2V0T3duUHJvcGVydHlTeW1ib2xzXCIgaW4gT2JqZWN0KSB7XG5cdFx0XHRzeW1ib2xzID0gKE9iamVjdCBhcyBhbnkpLmdldE93blByb3BlcnR5U3ltYm9scyhmcm9tKTtcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgc3ltYm9scy5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRpZiAoZnJvbS5wcm9wZXJ0eUlzRW51bWVyYWJsZShzeW1ib2xzW2ldKSkge1xuXHRcdFx0XHRcdCh0byBhcyBhbnkpW3N5bWJvbHNbaV1dID0gZnJvbVtzeW1ib2xzW2ldXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHJldHVybiB0bztcbn07XG5cbmxldCBzdHJpbmdLZXlSZXBsYWNlID0gZnVuY3Rpb24gKHN0cjogc3RyaW5nLCBkYXRhOiBvYmplY3QpOiBzdHJpbmcge1xuXHRpZiAoaXNTdHJpbmcoc3RyKSAmJiBzdHIubGVuZ3RoICYmIGlzUGxhaW5PYmplY3QoZGF0YSkpIHtcblx0XHRsZXQga2V5cyA9IE9iamVjdC5rZXlzKGRhdGEpLnNvcnQoKS5yZXZlcnNlKCksXG5cdFx0XHRyZWc7XG5cblx0XHRpZiAoa2V5cy5sZW5ndGgpIHtcblx0XHRcdGxldCBtID0ga2V5cy5qb2luKFwifFwiKTtcblx0XHRcdHJlZyAgID0gbmV3IFJlZ0V4cChcIjooXCIgKyBtICsgXCIpXCIsIFwiZ1wiKTtcblxuXHRcdFx0cmV0dXJuIHN0ci5yZXBsYWNlKHJlZywgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRsZXQgcmVwbGFjZW1lbnQgPSAoZGF0YSBhcyBhbnkpW2FyZ3VtZW50c1sxXV07XG5cblx0XHRcdFx0aWYgKHJlcGxhY2VtZW50ID09PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRyZXR1cm4gYXJndW1lbnRzWzBdO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHJlcGxhY2VtZW50O1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHN0cjtcbn07XG5cbmxldCB0ZXh0VG9MaW5lU3RyaW5nID0gKHRleHQ6IHN0cmluZyk6IHN0cmluZyA9PiB7XG5cdGxldCByZWcgICAgICAgICAgICAgICAgPSAvW1wiJ1xcXFxcXG5cXHJcXHRcXHUyMDI4XFx1MjAyOV0vZyxcblx0XHR0b19lc2NhcGVzOiBvYmplY3QgPSB7XG5cdFx0XHRcIlxcXCJcIiAgICA6IFwiXFxcIlwiLFxuXHRcdFx0XCInXCIgICAgIDogXCInXCIsXG5cdFx0XHRcIlxcXFxcIiAgICA6IFwiXFxcXFwiLFxuXHRcdFx0XCJcXG5cIiAgICA6IFwiblwiLFxuXHRcdFx0XCJcXHJcIiAgICA6IFwiclwiLFxuXHRcdFx0XCJcXHRcIiAgICA6IFwidFwiLFxuXHRcdFx0XCJcXHUyMDI4XCI6IFwiMjAyOFwiLFxuXHRcdFx0XCJcXHUyMDI5XCI6IFwiMjAyOVwiXG5cdFx0fTtcblxuXHRyZXR1cm4gdGV4dC5yZXBsYWNlKHJlZyxcblx0XHQobWF0Y2gpID0+IFwiXFxcXFwiICsgKHRvX2VzY2FwZXMgYXMgYW55KVttYXRjaF0pO1xufTtcblxubGV0IGV4cG9zZSA9IGZ1bmN0aW9uIChpdGVtczogQXJyYXk8c3RyaW5nPiwgY3R4OiBhbnkpOiBvYmplY3Qge1xuXHRsZXQgb3V0OiBvYmplY3QgPSB7fTtcblx0aXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG5cdFx0bGV0IGl0ZW0gPSBjdHhba2V5XTtcblx0XHQvLyBtZXRob2RzIGFuZCBwcm9wZXJ0aWVzXG5cdFx0aWYgKGlzRnVuY3Rpb24oaXRlbSkpIHtcblx0XHRcdChvdXQgYXMgYW55KVtrZXldID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRsZXQgcmVzID0gaXRlbS5hcHBseShjdHgsIGFyZ3VtZW50cyk7XG5cblx0XHRcdFx0cmV0dXJuIChyZXMgPT09IGN0eCkgPyBvdXQgOiByZXM7XG5cdFx0XHR9O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQob3V0IGFzIGFueSlba2V5XSA9IGl0ZW07XG5cdFx0fVxuXHR9KTtcblxuXHRyZXR1cm4gb3V0O1xufTtcblxubGV0IGdldEZyb20gPSBmdW5jdGlvbiAoZnJvbTogb2JqZWN0LCBrZXk6IHN0cmluZyk6IGFueSB7XG5cdGxldCB7W2tleV06IHZhbHVlfTogYW55ID0gZnJvbSB8fCB7fTtcblxuXHRyZXR1cm4gdmFsdWU7XG59O1xuXG4vLyA9PT09PT09PT09TUFUSD09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5sZXQgX3NldERpZ2l0c1NlcCA9IGZ1bmN0aW9uICh4OiBudW1iZXIsIHNlcDogc3RyaW5nKTogc3RyaW5nIHtcblx0bGV0IHMgICAgID0gU3RyaW5nKHgpLFxuXHRcdGNvdW50ID0gMCxcblx0XHRhbnMgICA9IFtdLFxuXHRcdGogICAgID0gcy5pbmRleE9mKFwiLlwiKSxcblx0XHRzdGFydCA9IChqICE9PSAtMSkgPyBqIDogcy5sZW5ndGgsXG5cdFx0ZW5kICAgPSAoaiAhPT0gLTEpID8gcy5zbGljZShzdGFydCArIDEpIDogW10sXG5cdFx0aSAgICAgPSBzdGFydDtcblxuXHRmb3IgKDsgaSA+PSAwOyBpLS0pIHtcblx0XHRpZiAoY291bnQgPT09IDMpIHtcblx0XHRcdGNvdW50ICA9IDA7XG5cdFx0XHRhbnNbaV0gPSAoaSAhPT0gMCkgPyBzZXAgKyBzW2ldIDogc1tpXTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0YW5zW2ldID0gc1tpXTtcblx0XHR9XG5cdFx0Y291bnQrKztcblx0fVxuXG5cdHJldHVybiBhbnMuY29uY2F0KGVuZCkuam9pbihcIlwiKTtcbn07XG5cbmxldCBtYXRoID0ge1xuXHRudW1iZXJGb3JtYXQ6IGZ1bmN0aW9uICh4OiBudW1iZXIgfCBzdHJpbmcsIGRlYzogbnVtYmVyID0gMiwgZGVjaW1hbFNlcDogc3RyaW5nID0gXCIuXCIsIGRpZ2l0c1NlcDogc3RyaW5nID0gXCIgXCIpOiBzdHJpbmcge1xuXG5cdFx0aWYgKCF4KSB7XG5cdFx0XHRyZXR1cm4gXCJcIjtcblx0XHR9XG5cblx0XHRsZXQgYW5zID0gcGFyc2VGbG9hdChTdHJpbmcoeCkpLCBkZWNpbWFsUG9zO1xuXG5cdFx0aWYgKGRlYyA+PSAwKSB7XG5cdFx0XHRsZXQgZGVjaW1hbFBvdyA9IE1hdGgucG93KDEwLCBkZWMpO1xuXHRcdFx0YW5zICAgICAgICAgICAgPSBNYXRoLmZsb29yKGFucyAqIGRlY2ltYWxQb3cpIC8gZGVjaW1hbFBvdztcblx0XHR9XG5cblx0XHRsZXQgbiA9IF9zZXREaWdpdHNTZXAoYW5zLCBkaWdpdHNTZXApO1xuXHRcdGxldCBhID0gbi5zcGxpdChcIlwiKTtcblxuXHRcdGRlY2ltYWxQb3MgPSBhLmxhc3RJbmRleE9mKFwiLlwiKTtcblx0XHRpZiAoZGVjaW1hbFBvcyA+PSAwICYmIGRlY2ltYWxTZXAgIT09IFwiLlwiKSB7XG5cdFx0XHRhW2RlY2ltYWxQb3NdID0gZGVjaW1hbFNlcDtcblx0XHR9XG5cblx0XHRyZXR1cm4gYS5qb2luKFwiXCIpO1xuXHR9XG59O1xuXG5sZXQgaXNJbkRPTSA9IGZ1bmN0aW9uIChlbGVtZW50OiBhbnksIGluQm9keTogYm9vbGVhbiA9IGZhbHNlKTogYm9vbGVhbiB7XG5cdGxldCBfID0gZWxlbWVudCwgbGFzdDtcblxuXHR3aGlsZSAoXykge1xuXHRcdGxhc3QgPSBfO1xuXHRcdGlmIChpbkJvZHkgJiYgbGFzdCA9PT0gZG9jdW1lbnQuYm9keSkge1xuXHRcdFx0YnJlYWs7XG5cdFx0fVxuXHRcdF8gPSBfLnBhcmVudE5vZGU7XG5cdH1cblxuXHRyZXR1cm4gaW5Cb2R5ID8gbGFzdCA9PT0gZG9jdW1lbnQuYm9keSA6IGxhc3QgPT09IGRvY3VtZW50O1xufTtcblxubGV0IGJ1aWxkUXVlcnlTdHJpbmcgPSBmdW5jdGlvbiAob2JqZWN0OiBvYmplY3QsIHByZWZpeDogc3RyaW5nKTogc3RyaW5nIHtcblx0bGV0IGR1cGxpY2F0ZXMgPSB7fSxcblx0XHRzdHIgICAgICAgID0gW107XG5cblx0Zm9yIChsZXQgcHJvcCBpbiBvYmplY3QpIHtcblx0XHRpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3ApKSB7XG5cdFx0XHRjb250aW51ZTtcblx0XHR9XG5cblx0XHRsZXQga2V5ICAgPSBwcmVmaXggPyBwcmVmaXggKyBcIltcIiArIHByb3AgKyBcIl1cIiA6IHByb3AsXG5cdFx0XHR2YWx1ZSA9IChvYmplY3QgYXMgYW55KVtwcm9wXSxcblx0XHRcdHBhaXI7XG5cdFx0aWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGlmICh2YWx1ZSA9PT0gbnVsbCkge1xuXHRcdFx0XHRwYWlyID0gZW5jb2RlVVJJQ29tcG9uZW50KGtleSk7XG5cdFx0XHR9IGVsc2UgaWYgKFV0aWxzLmlzUGxhaW5PYmplY3QodmFsdWUpKSB7XG5cdFx0XHRcdHBhaXIgPSBidWlsZFF1ZXJ5U3RyaW5nKHZhbHVlLCBrZXkpO1xuXHRcdFx0fSBlbHNlIGlmIChVdGlscy5pc0FycmF5KHZhbHVlKSkge1xuXHRcdFx0XHRwYWlyID0gdmFsdWUucmVkdWNlKGZ1bmN0aW9uIChtZW1vLCBpdGVtKSB7XG5cdFx0XHRcdFx0aWYgKCEoZHVwbGljYXRlcyBhcyBhbnkpW2tleV0pIChkdXBsaWNhdGVzIGFzIGFueSlba2V5XSA9IHt9O1xuXHRcdFx0XHRcdGlmICghKGR1cGxpY2F0ZXMgYXMgYW55KVtrZXldW2l0ZW1dKSB7XG5cdFx0XHRcdFx0XHQoZHVwbGljYXRlcyBhcyBhbnkpW2tleV1baXRlbV0gPSB0cnVlO1xuXHRcdFx0XHRcdFx0cmV0dXJuIG1lbW8uY29uY2F0KGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoaXRlbSkpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiBtZW1vO1xuXHRcdFx0XHR9LCBbXSkuam9pbihcIiZcIik7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRwYWlyID0gZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyBcIj1cIiArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdHN0ci5wdXNoKHBhaXIpO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiBzdHIuam9pbihcIiZcIilcbn07XG5cbmxldCBzaHVmZmxlID0gKGE6IEFycmF5PGFueT4pOiBBcnJheTxhbnk+ID0+IHtcblx0bGV0IGosIHgsIGk7XG5cblx0Zm9yIChpID0gYS5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7XG5cdFx0aiAgICA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpICsgMSkpO1xuXHRcdHggICAgPSBhW2ldO1xuXHRcdGFbaV0gPSBhW2pdO1xuXHRcdGFbal0gPSB4O1xuXHR9XG5cblx0cmV0dXJuIGE7XG59O1xuXG5sZXQgcGFyc2VRdWVyeVN0cmluZyA9IGZ1bmN0aW9uIChzdHI6IHN0cmluZykge1xuXHRpZiAoc3RyLmNoYXJBdCgwKSA9PT0gXCI/XCIpIHN0ciA9IHN0ci5zdWJzdHJpbmcoMSk7XG5cdGlmICghc3RyLmxlbmd0aCkgcmV0dXJuIHt9O1xuXG5cdGxldCBwYWlycyA9IHN0ci5zcGxpdChcIiZcIiksIHBhcmFtcyA9IHt9O1xuXHRmb3IgKGxldCBpID0gMCwgbGVuID0gcGFpcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcblx0XHRsZXQgcGFpciAgPSBwYWlyc1tpXS5zcGxpdChcIj1cIiksXG5cdFx0XHRrZXkgICA9IGRlY29kZVVSSUNvbXBvbmVudChwYWlyWzBdKSxcblx0XHRcdHZhbHVlID0gcGFpci5sZW5ndGggPT0gMiA/IGRlY29kZVVSSUNvbXBvbmVudChwYWlyWzFdKSA6IG51bGw7XG5cdFx0aWYgKChwYXJhbXMgYXMgYW55KVtrZXldICE9IG51bGwpIHtcblx0XHRcdGlmICghVXRpbHMuaXNBcnJheSgocGFyYW1zIGFzIGFueSlba2V5XSkpIHtcblx0XHRcdFx0KHBhcmFtcyBhcyBhbnkpW2tleV0gPSBbKHBhcmFtcyBhcyBhbnkpW2tleV1dO1xuXHRcdFx0fVxuXHRcdFx0KHBhcmFtcyBhcyBhbnkpW2tleV0ucHVzaCh2YWx1ZSlcblx0XHR9XG5cdFx0ZWxzZSAocGFyYW1zIGFzIGFueSlba2V5XSA9IHZhbHVlO1xuXHR9XG5cdHJldHVybiBwYXJhbXNcbn07XG5cbmxldCBldmVudENhbmNlbCA9IGZ1bmN0aW9uIChlOiBFdmVudCkge1xuXG5cdGlmICghZSkge1xuXHRcdGlmICh3aW5kb3cuZXZlbnQpIGUgPSB3aW5kb3cuZXZlbnQ7XG5cdFx0ZWxzZSByZXR1cm47XG5cdH1cblxuXHRpZiAoZS5jYW5jZWxCdWJibGUgIT0gbnVsbCkgZS5jYW5jZWxCdWJibGUgPSB0cnVlO1xuXHRpZiAoZS5zdG9wUHJvcGFnYXRpb24pIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdGlmIChlLnByZXZlbnREZWZhdWx0KSBlLnByZXZlbnREZWZhdWx0KCk7XG5cdGlmICh3aW5kb3cuZXZlbnQpIGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcblx0Ly8gaWYgKGUuY2FuY2VsICE9IG51bGwpIGUuY2FuY2VsID0gdHJ1ZTtcbn07XG5cbmxldCBpc1ZhbGlkQWdlID0gKGRheTogbnVtYmVyLCBtb250aDogbnVtYmVyLCB5ZWFyOiBudW1iZXIsIG1pbkFnZTogbnVtYmVyLCBtYXhBZ2U6IG51bWJlcik6IGJvb2xlYW4gPT4ge1xuXHQvLyBkZXBlbmRpbmcgb24gdGhlIHllYXIsIGNhbGN1bGF0ZSB0aGUgbnVtYmVyIG9mIGRheXMgaW4gdGhlIG1vbnRoXG5cdGxldCBkYXlzSW5Nb250aCxcblx0XHRmZWJydWFyeURheXMgPSAoeWVhciAlIDQgPT09IDApID8gMjkgOiAyODtcblxuXHRkYXlzSW5Nb250aCA9IFszMSwgZmVicnVhcnlEYXlzLCAzMSwgMzAsIDMxLCAzMCwgMzEsIDMxLCAzMCwgMzEsIDMwLCAzMV07XG5cblx0Ly8gZmlyc3QsIGNoZWNrIHRoZSBpbmNvbWluZyBtb250aCBhbmQgeWVhciBhcmUgdmFsaWQuXG5cdGlmICghbW9udGggfHwgIWRheSB8fCAheWVhcikge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXHRpZiAoMSA+IG1vbnRoIHx8IG1vbnRoID4gMTIpIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblx0aWYgKHllYXIgPCAwKSB7XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cdGlmICgxID4gZGF5IHx8IGRheSA+IGRheXNJbk1vbnRoW21vbnRoIC0gMV0pIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHQvLyBpZiByZXF1aXJlZCwgdmVyaWZ5IHRoZSBjdXJyZW50IGRhdGUgaXMgTEFURVIgdGhhbiB0aGUgaW5jb21pbmcgZGF0ZS5cblx0aWYgKG1pbkFnZSAhPT0gdW5kZWZpbmVkIHx8IG1heEFnZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0Ly8gZ2V0IGN1cnJlbnQgeWVhclxuXHRcdGxldCBjdXJyZW50WWVhciA9IChuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSxcblx0XHRcdGFnZSAgICAgICAgID0gY3VycmVudFllYXIgLSB5ZWFyO1xuXG5cdFx0aWYgKGFnZSA8IDApIHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdFx0aWYgKGFnZSA8IG1pbkFnZSkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0XHRpZiAoYWdlID4gbWF4QWdlKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHRydWU7XG59O1xuXG5sZXQgVXRpbHMgPSB7XG5cdGlzUGxhaW5PYmplY3QsIGlzU3RyaW5nLCBpc0FycmF5LFxuXHRpc0Z1bmN0aW9uLCBpc0VtcHR5LCBpc05vdEVtcHR5LFxuXHR0b0FycmF5LCBpc0luRE9NLCBzaHVmZmxlLFxuLy8gPT09PT09PT09PT09XG5cdGNhbGxiYWNrLCBhc3NpZ24sIGV4cG9zZSwgZ2V0RnJvbSxcblx0c3RyaW5nS2V5UmVwbGFjZSwgdGV4dFRvTGluZVN0cmluZyxcblx0Zm9yRWFjaCxcbi8vID09PT09PT09PT09PVxuXHRtYXRoLCBpc1ZhbGlkQWdlLFxuLy8gPT09PT09PT09PT09XG5cdGJ1aWxkUXVlcnlTdHJpbmcsIHBhcnNlUXVlcnlTdHJpbmcsXG4vLyA9PT09PT09PT09PT1cblx0ZXZlbnRDYW5jZWxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFV0aWxzO1xuIl19