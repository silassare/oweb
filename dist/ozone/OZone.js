import { stringPlaceholderReplace } from '../utils';
const SERVICE_URL_FORMAT = ':host/:service', SERVICE_ENTITY_FORMAT = ':host/:service/:id', SERVICE_ENTITY_RELATION_FORMAT = ':host/:service/:id/:relation';
const apiCache = {};
export const getApiForHost = function getApiForHost(url) {
    for (const apiHost in apiCache) {
        if (url.startsWith(apiHost)) {
            return apiCache[apiHost];
        }
    }
    return undefined;
};
export default class OZone {
    _appContext;
    apiHost;
    /**
     * OZone constructor.
     *
     * @param _appContext
     */
    constructor(_appContext) {
        this._appContext = _appContext;
        this.apiHost = _appContext.configs.get('OZ_API_BASE_URL').replace(/\/$/g, '');
    }
    /**
     * Create new ozone api instance or get from cache
     *
     */
    static instantiate(_appContext) {
        const apiHost = _appContext.configs.get('OZ_API_BASE_URL');
        if (!(apiHost in apiCache)) {
            apiCache[apiHost] = new OZone(_appContext);
        }
        return apiCache[apiHost];
    }
    /**
     * Makes a request.
     *
     * @param url The request url
     * @param options The request options
     */
    request(url, options = {}) {
        const _this = this, api = getApiForHost(url);
        if (api) {
            if (!options.headers) {
                options.headers = {};
            }
            if (this._appContext.configs.get('OZ_API_ALLOW_REAL_METHOD_HEADER')) {
                const realMethod = (options.method || 'get').toUpperCase(), replaceMethods = ['PATCH', 'PUT', 'DELETE'], realMethodHeader = this._appContext.configs.get('OZ_API_REAL_METHOD_HEADER_NAME');
                // we update request method
                if (~replaceMethods.indexOf(realMethod)) {
                    options.headers[realMethodHeader] = realMethod;
                    options.method = 'POST';
                }
            }
            const headerName = this._appContext.configs.get('OZ_API_KEY_HEADER_NAME');
            if (!options.headers[headerName]) {
                options.headers[headerName] = this._appContext.configs.get('OZ_API_KEY');
            }
            if (!options.isGoodNews) {
                options.isGoodNews = (json) => {
                    return Boolean(json && json.error === 0);
                };
            }
            if (!options.errorResponseToDialog) {
                options.errorResponseToDialog = (response) => {
                    const json = response.json;
                    return { text: json.msg, data: json.data };
                };
            }
        }
        const o = this._appContext.request(url, options);
        o.onResponse(function responseHandler(response) {
            const { json } = response;
            if (json && json.stime) {
                _this._appContext.user.setSessionExpire(json.stime);
            }
            if (json && json.stoken) {
                _this._appContext.user.setSessionToken(json.stoken);
            }
        });
        return o;
    }
    /**
     * Returns the service URI.
     *
     * @param service The service name.
     */
    getServiceURI(service) {
        return stringPlaceholderReplace(SERVICE_URL_FORMAT, {
            host: this.apiHost,
            service,
        });
    }
    /**
     * Returns entity URI.
     *
     * @param service The service name.
     * @param id The entity id.
     */
    getItemURI(service, id) {
        return stringPlaceholderReplace(SERVICE_ENTITY_FORMAT, {
            host: this.apiHost,
            service, id,
        });
    }
    /**
     * Returns entity relation URI.
     *
     * @param service The service name.
     * @param id The entity id.
     * @param relation The relation name.
     */
    getItemRelationURI(service, id, relation) {
        return stringPlaceholderReplace(SERVICE_ENTITY_RELATION_FORMAT, {
            host: this.apiHost,
            service, id, relation,
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1pvbmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvb3pvbmUvT1pvbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLHdCQUF3QixFQUFDLE1BQU0sVUFBVSxDQUFDO0FBS2xELE1BQU0sa0JBQWtCLEdBQWUsZ0JBQWdCLEVBQ3BELHFCQUFxQixHQUFZLG9CQUFvQixFQUNyRCw4QkFBOEIsR0FBRyw4QkFBOEIsQ0FBQztBQUVuRSxNQUFNLFFBQVEsR0FFVixFQUFFLENBQUM7QUFFUCxNQUFNLENBQUMsTUFBTSxhQUFhLEdBQUcsU0FBUyxhQUFhLENBQUMsR0FBVztJQUM5RCxLQUFLLE1BQU0sT0FBTyxJQUFJLFFBQVEsRUFBRTtRQUMvQixJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDNUIsT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDekI7S0FDRDtJQUVELE9BQU8sU0FBUyxDQUFDO0FBQ2xCLENBQUMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxPQUFPLE9BQU8sS0FBSztJQVFLO0lBUGIsT0FBTyxDQUFTO0lBRWpDOzs7O09BSUc7SUFDSCxZQUE4QixXQUFvQjtRQUFwQixnQkFBVyxHQUFYLFdBQVcsQ0FBUztRQUNqRCxJQUFJLENBQUMsT0FBTyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztJQUMvRSxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsTUFBTSxDQUFDLFdBQVcsQ0FBQyxXQUFvQjtRQUN0QyxNQUFNLE9BQU8sR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBRTNELElBQUksQ0FBQyxDQUFDLE9BQU8sSUFBSSxRQUFRLENBQUMsRUFBRTtZQUMzQixRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFB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Q0FBQyxDQUFDO0lBQ1YsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxhQUFhLENBQUMsT0FBZTtRQUM1QixPQUFPLHdCQUF3QixDQUFDLGtCQUFrQixFQUFFO1lBQ25ELElBQUksRUFBRSxJQUFJLENBQUMsT0FBTztZQUNsQixPQUFPO1NBQ1AsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsVUFBVSxDQUFDLE9BQWUsRUFBRSxFQUFtQjtRQUM5QyxPQUFPLHdCQUF3QixDQUFDLHFCQUFxQixFQUFFO1lBQ3RELElBQUksRUFBRSxJQUFJLENBQUMsT0FBTztZQUNsQixPQUFPLEVBQUUsRUFBRTtTQUNYLENBQUMsQ0FBQztJQUNKLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSCxrQkFBa0IsQ0FBQyxPQUFlLEVBQUUsRUFBVSxFQUFFLFFBQWdCO1FBQy9ELE9BQU8sd0JBQXdCLENBQUMsOEJBQThCLEVBQUU7WUFDL0QsSUFBSSxFQUFFLElBQUksQ0FBQyxPQUFPO1lBQ2xCLE9BQU8sRUFBRSxFQUFFLEVBQUUsUUFBUTtTQUNyQixDQUFDLENBQUM7SUFDSixDQUFDO0NBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge3N0cmluZ1BsYWNlaG9sZGVyUmVwbGFjZX0gZnJvbSAnLi4vdXRpbHMnO1xuaW1wb3J0IHtPTmV0UmVxdWVzdE9wdGlvbnN9IGZyb20gJy4uL09XZWJOZXQnO1xuaW1wb3J0IE9XZWJYSFIgZnJvbSAnLi4vT1dlYlhIUic7XG5pbXBvcnQge09BcGlSZXNwb25zZSwgT1dlYkFwcH0gZnJvbSAnLi4vb3dlYic7XG5cbmNvbnN0IFNFUlZJQ0VfVVJMX0ZPUk1BVCAgICAgICAgICAgICA9ICc6aG9zdC86c2VydmljZScsXG5cdCAgU0VSVklDRV9FTlRJVFlfRk9STUFUICAgICAgICAgID0gJzpob3N0LzpzZXJ2aWNlLzppZCcsXG5cdCAgU0VSVklDRV9FTlRJVFlfUkVMQVRJT05fRk9STUFUID0gJzpob3N0LzpzZXJ2aWNlLzppZC86cmVsYXRpb24nO1xuXG5jb25zdCBhcGlDYWNoZToge1xuXHRbYXBpSG9zdDogc3RyaW5nXTogT1pvbmU7XG59ID0ge307XG5cbmV4cG9ydCBjb25zdCBnZXRBcGlGb3JIb3N0ID0gZnVuY3Rpb24gZ2V0QXBpRm9ySG9zdCh1cmw6IHN0cmluZyk6IE9ab25lIHwgdW5kZWZpbmVkIHtcblx0Zm9yIChjb25zdCBhcGlIb3N0IGluIGFwaUNhY2hlKSB7XG5cdFx0aWYgKHVybC5zdGFydHNXaXRoKGFwaUhvc3QpKSB7XG5cdFx0XHRyZXR1cm4gYXBpQ2FjaGVbYXBpSG9zdF07XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIHVuZGVmaW5lZDtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE9ab25lIHtcblx0cHJpdmF0ZSByZWFkb25seSBhcGlIb3N0OiBzdHJpbmc7XG5cblx0LyoqXG5cdCAqIE9ab25lIGNvbnN0cnVjdG9yLlxuXHQgKlxuXHQgKiBAcGFyYW0gX2FwcENvbnRleHRcblx0ICovXG5cdHByb3RlY3RlZCBjb25zdHJ1Y3Rvcihwcml2YXRlIF9hcHBDb250ZXh0OiBPV2ViQXBwKSB7XG5cdFx0dGhpcy5hcGlIb3N0ID0gX2FwcENvbnRleHQuY29uZmlncy5nZXQoJ09aX0FQSV9CQVNFX1VSTCcpLnJlcGxhY2UoL1xcLyQvZywgJycpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENyZWF0ZSBuZXcgb3pvbmUgYXBpIGluc3RhbmNlIG9yIGdldCBmcm9tIGNhY2hlXG5cdCAqXG5cdCAqL1xuXHRzdGF0aWMgaW5zdGFudGlhdGUoX2FwcENvbnRleHQ6IE9XZWJBcHApOiBPWm9uZSB7XG5cdFx0Y29uc3QgYXBpSG9zdCA9IF9hcHBDb250ZXh0LmNvbmZpZ3MuZ2V0KCdPWl9BUElfQkFTRV9VUkwnKTtcblxuXHRcdGlmICghKGFwaUhvc3QgaW4gYXBpQ2FjaGUpKSB7XG5cdFx0XHRhcGlDYWNoZVthcGlIb3N0XSA9IG5ldyBPWm9uZShfYXBwQ29udGV4dCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGFwaUNhY2hlW2FwaUhvc3RdO1xuXHR9XG5cblx0LyoqXG5cdCAqIE1ha2VzIGEgcmVxdWVzdC5cblx0ICpcblx0ICogQHBhcmFtIHVybCBUaGUgcmVxdWVzdCB1cmxcblx0ICogQHBhcmFtIG9wdGlvbnMgVGhlIHJlcXVlc3Qgb3B0aW9uc1xuXHQgKi9cblx0cmVxdWVzdDxSZXNwb25zZSBleHRlbmRzIE9BcGlSZXNwb25zZTxhbnk+Pihcblx0XHR1cmw6IHN0cmluZyxcblx0XHRvcHRpb25zOiBQYXJ0aWFsPE9OZXRSZXF1ZXN0T3B0aW9uczxSZXNwb25zZT4+ID0ge31cblx0KTogT1dlYlhIUjxSZXNwb25zZT4ge1xuXHRcdGNvbnN0IF90aGlzID0gdGhpcyxcblx0XHRcdCAgYXBpICAgPSBnZXRBcGlGb3JIb3N0KHVybCk7XG5cblx0XHRpZiAoYXBpKSB7XG5cdFx0XHRpZiAoIW9wdGlvbnMuaGVhZGVycykge1xuXHRcdFx0XHRvcHRpb25zLmhlYWRlcnMgPSB7fTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMuX2FwcENvbnRleHQuY29uZmlncy5nZXQoJ09aX0FQSV9BTExPV19SRUFMX01FVEhPRF9IRUFERVInKSkge1xuXHRcdFx0XHRjb25zdCByZWFsTWV0aG9kICAgICAgID0gKG9wdGlvbnMubWV0aG9kIHx8ICdnZXQnKS50b1VwcGVyQ2FzZSgpLFxuXHRcdFx0XHRcdCAgcmVwbGFjZU1ldGhvZHMgICA9IFsnUEFUQ0gnLCAnUFVUJywgJ0RFTEVURSddLFxuXHRcdFx0XHRcdCAgcmVhbE1ldGhvZEhlYWRlciA9IHRoaXMuX2FwcENvbnRleHQuY29uZmlncy5nZXQoJ09aX0FQSV9SRUFMX01FVEhPRF9IRUFERVJfTkFNRScpO1xuXG5cdFx0XHRcdC8vIHdlIHVwZGF0ZSByZXF1ZXN0IG1ldGhvZFxuXHRcdFx0XHRpZiAofnJlcGxhY2VNZXRob2RzLmluZGV4T2YocmVhbE1ldGhvZCkpIHtcblx0XHRcdFx0XHRvcHRpb25zLmhlYWRlcnNbcmVhbE1ldGhvZEhlYWRlcl0gPSByZWFsTWV0aG9kO1xuXHRcdFx0XHRcdG9wdGlvbnMubWV0aG9kICAgICAgICAgICAgICAgICAgICA9ICdQT1NUJztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCBoZWFkZXJOYW1lID0gdGhpcy5fYXBwQ29udGV4dC5jb25maWdzLmdldCgnT1pfQVBJX0tFWV9IRUFERVJfTkFNRScpO1xuXG5cdFx0XHRpZiAoIW9wdGlvbnMuaGVhZGVyc1toZWFkZXJOYW1lXSkge1xuXHRcdFx0XHRvcHRpb25zLmhlYWRlcnNbaGVhZGVyTmFtZV0gPSB0aGlzLl9hcHBDb250ZXh0LmNvbmZpZ3MuZ2V0KCdPWl9BUElfS0VZJyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghb3B0aW9ucy5pc0dvb2ROZXdzKSB7XG5cdFx0XHRcdG9wdGlvbnMuaXNHb29kTmV3cyA9IChqc29uKTogYm9vbGVhbiA9PiB7XG5cdFx0XHRcdFx0cmV0dXJuIEJvb2xlYW4oanNvbiAmJiBqc29uLmVycm9yID09PSAwKTtcblx0XHRcdFx0fTtcblx0XHRcdH1cblx0XHRcdGlmICghb3B0aW9ucy5lcnJvclJlc3BvbnNlVG9EaWFsb2cpIHtcblx0XHRcdFx0b3B0aW9ucy5lcnJvclJlc3BvbnNlVG9EaWFsb2cgPSAocmVzcG9uc2UpID0+IHtcblx0XHRcdFx0XHRjb25zdCBqc29uID0gcmVzcG9uc2UuanNvbiBhcyBhbnkgYXMgT0FwaVJlc3BvbnNlPGFueT47XG5cdFx0XHRcdFx0cmV0dXJuIHt0ZXh0OiBqc29uLm1zZywgZGF0YToganNvbi5kYXRhfTtcblx0XHRcdFx0fTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRjb25zdCBvID0gdGhpcy5fYXBwQ29udGV4dC5yZXF1ZXN0PFJlc3BvbnNlPih1cmwsIG9wdGlvbnMpO1xuXG5cdFx0by5vblJlc3BvbnNlKGZ1bmN0aW9uIHJlc3BvbnNlSGFuZGxlcihyZXNwb25zZSkge1xuXHRcdFx0IGNvbnN0IHtqc29ufSA9IHJlc3BvbnNlO1xuXHRcdFx0IGlmIChqc29uICYmIGpzb24uc3RpbWUpIHtcblx0XHRcdFx0IF90aGlzLl9hcHBDb250ZXh0LnVzZXIuc2V0U2Vzc2lvbkV4cGlyZShqc29uLnN0aW1lKTtcblx0XHRcdCB9XG5cdFx0XHQgaWYgKGpzb24gJiYganNvbi5zdG9rZW4pIHtcblx0XHRcdFx0IF90aGlzLl9hcHBDb250ZXh0LnVzZXIuc2V0U2Vzc2lvblRva2VuKGpzb24uc3Rva2VuKTtcblx0XHRcdCB9XG5cdFx0IH0pO1xuXG5cdFx0cmV0dXJuIG87XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyB0aGUgc2VydmljZSBVUkkuXG5cdCAqXG5cdCAqIEBwYXJhbSBzZXJ2aWNlIFRoZSBzZXJ2aWNlIG5hbWUuXG5cdCAqL1xuXHRnZXRTZXJ2aWNlVVJJKHNlcnZpY2U6IHN0cmluZyk6IHN0cmluZyB7XG5cdFx0cmV0dXJuIHN0cmluZ1BsYWNlaG9sZGVyUmVwbGFjZShTRVJWSUNFX1VSTF9GT1JNQVQsIHtcblx0XHRcdGhvc3Q6IHRoaXMuYXBpSG9zdCxcblx0XHRcdHNlcnZpY2UsXG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyBlbnRpdHkgVVJJLlxuXHQgKlxuXHQgKiBAcGFyYW0gc2VydmljZSBUaGUgc2VydmljZSBuYW1lLlxuXHQgKiBAcGFyYW0gaWQgVGhlIGVudGl0eSBpZC5cblx0ICovXG5cdGdldEl0ZW1VUkkoc2VydmljZTogc3RyaW5nLCBpZDogc3RyaW5nIHwgbnVtYmVyKTogc3RyaW5nIHtcblx0XHRyZXR1cm4gc3RyaW5nUGxhY2Vob2xkZXJSZXBsYWNlKFNFUlZJQ0VfRU5USVRZX0ZPUk1BVCwge1xuXHRcdFx0aG9zdDogdGhpcy5hcGlIb3N0LFxuXHRcdFx0c2VydmljZSwgaWQsXG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyBlbnRpdHkgcmVsYXRpb24gVVJJLlxuXHQgKlxuXHQgKiBAcGFyYW0gc2VydmljZSBUaGUgc2VydmljZSBuYW1lLlxuXHQgKiBAcGFyYW0gaWQgVGhlIGVudGl0eSBpZC5cblx0ICogQHBhcmFtIHJlbGF0aW9uIFRoZSByZWxhdGlvbiBuYW1lLlxuXHQgKi9cblx0Z2V0SXRlbVJlbGF0aW9uVVJJKHNlcnZpY2U6IHN0cmluZywgaWQ6IHN0cmluZywgcmVsYXRpb246IHN0cmluZyk6IHN0cmluZyB7XG5cdFx0cmV0dXJuIHN0cmluZ1BsYWNlaG9sZGVyUmVwbGFjZShTRVJWSUNFX0VOVElUWV9SRUxBVElPTl9GT1JNQVQsIHtcblx0XHRcdGhvc3Q6IHRoaXMuYXBpSG9zdCxcblx0XHRcdHNlcnZpY2UsIGlkLCByZWxhdGlvbixcblx0XHR9KTtcblx0fVxufSJdfQ==