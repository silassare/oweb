import { escapeRegExp, isArray, isPlainObject, isString } from './utils';
const tokenTypesRegMap = {
    'num': /\d+/.source,
    'alpha': /[a-zA-Z]+/.source,
    'alpha-fullUrl': /[a-z]+/.source,
    'alpha-l': /[A-Z]+/.source,
    'alpha-num': /[a-zA-Z0-9]+/.source,
    'alpha-num-l': /[a-z0-9]+/.source,
    'alpha-num-fullUrl': /[A-Z0-9]+/.source,
    'any': /[^/]+/.source,
}, tokenReg = /:([a-z][a-z0-9_]*)/i, stringReg = (str) => new RegExp(escapeRegExp(str)), wrapReg = (str, capture = false) => capture ? '(' + str + ')' : '(?:' + str + ')';
export default class OWebRoute {
    path;
    reg;
    tokens;
    action;
    constructor(path, options, action) {
        if (path instanceof RegExp) {
            this.path = path.toString();
            this.reg = path;
            this.tokens = isArray(options) ? options : [];
        }
        else if (isString(path) && path.length) {
            options = (isPlainObject(options) ? options : {});
            const p = OWebRoute.parseDynamicPath(path, options);
            this.path = path;
            this.reg = p.reg;
            this.tokens = p.tokens;
        }
        else {
            throw new TypeError('[OWebRoute] invalid route path, string or RegExp required.');
        }
        if ('function' !== typeof action) {
            throw new TypeError(`[OWebRoute] invalid action type, got "${typeof action}" instead of "function".`);
        }
        this.action = action;
    }
    isDynamic() {
        return this.reg != null;
    }
    getAction() {
        return this.action;
    }
    is(pathname) {
        return this.reg ? this.reg.test(pathname) : this.path === pathname;
    }
    parse(pathname) {
        if (this.isDynamic()) {
            const founds = String(pathname).match(this.reg);
            if (founds) {
                return this.tokens.reduce((acc, key, index) => {
                    acc[key] = founds[index + 1];
                    return acc;
                }, {});
            }
        }
        return {};
    }
    static parseDynamicPath(path, options) {
        const tokens = [];
        let reg = '', _path = path, match;
        while ((match = tokenReg.exec(_path)) != null) {
            const found = match[0], token = match[1], rule = options[token] || 'any', head = _path.slice(0, match.index);
            if (head.length) {
                reg += wrapReg(stringReg(head).source);
            }
            if (typeof rule === 'string' && rule in tokenTypesRegMap) {
                reg += wrapReg(tokenTypesRegMap[rule], true);
            }
            else if (rule instanceof RegExp) {
                reg += wrapReg(rule.source, true);
            }
            else {
                throw new Error(`Invalid rule for token ':${token}' in path '${path}'`);
            }
            tokens.push(token);
            _path = _path.slice(match.index + found.length);
        }
        if (!reg.length) {
            return {
                reg: null,
                tokens,
            };
        }
        if (_path.length) {
            reg += wrapReg(stringReg(_path).source);
        }
        return {
            reg: new RegExp('^' + reg + '$'),
            tokens,
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1dlYlJvdXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL09XZWJSb3V0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBR3pFLE1BQU0sZ0JBQWdCLEdBQUc7SUFDdkIsS0FBSyxFQUFFLEtBQUssQ0FBQyxNQUFNO0lBQ25CLE9BQU8sRUFBRSxXQUFXLENBQUMsTUFBTTtJQUMzQixlQUFlLEVBQUUsUUFBUSxDQUFDLE1BQU07SUFDaEMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxNQUFNO0lBQzFCLFdBQVcsRUFBRSxjQUFjLENBQUMsTUFBTTtJQUNsQyxhQUFhLEVBQUUsV0FBVyxDQUFDLE1BQU07SUFDakMsbUJBQW1CLEVBQUUsV0FBVyxDQUFDLE1BQU07SUFDdkMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxNQUFNO0NBQ3JCLEVBQ0QsUUFBUSxHQUFHLHFCQUFxQixFQUNoQyxTQUFTLEdBQUcsQ0FBQyxHQUFXLEVBQUUsRUFBRSxDQUFDLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUMxRCxPQUFPLEdBQUcsQ0FBQyxHQUFXLEVBQUUsT0FBTyxHQUFHLEtBQUssRUFBRSxFQUFFLENBQzFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDO0FBVWhELE1BQU0sQ0FBQyxPQUFPLE9BQU8sU0FBUztJQUNaLElBQUksQ0FBUztJQUNiLEdBQUcsQ0FBZ0I7SUFDNUIsTUFBTSxDQUFXO0lBQ1IsTUFBTSxDQUFlO0lBU3RDLFlBQ0MsSUFBcUIsRUFDckIsT0FBcUMsRUFDckMsTUFBb0I7UUFFcEIsSUFBSSxJQUFJLFlBQVksTUFBTSxFQUFFO1lBQzNCLElBQUksQ0FBQyxJQUFJLEdB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cmluZyB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IE9XZWJSb3V0ZUNvbnRleHQgZnJvbSAnLi9PV2ViUm91dGVDb250ZXh0JztcblxuY29uc3QgdG9rZW5UeXBlc1JlZ01hcCA9IHtcblx0XHQnbnVtJzogL1xcZCsvLnNvdXJjZSxcblx0XHQnYWxwaGEnOiAvW2EtekEtWl0rLy5zb3VyY2UsXG5cdFx0J2FscGhhLWZ1bGxVcmwnOiAvW2Etel0rLy5zb3VyY2UsXG5cdFx0J2FscGhhLWwnOiAvW0EtWl0rLy5zb3VyY2UsXG5cdFx0J2FscGhhLW51bSc6IC9bYS16QS1aMC05XSsvLnNvdXJjZSxcblx0XHQnYWxwaGEtbnVtLWwnOiAvW2EtejAtOV0rLy5zb3VyY2UsXG5cdFx0J2FscGhhLW51bS1mdWxsVXJsJzogL1tBLVowLTldKy8uc291cmNlLFxuXHRcdCdhbnknOiAvW14vXSsvLnNvdXJjZSxcblx0fSxcblx0dG9rZW5SZWcgPSAvOihbYS16XVthLXowLTlfXSopL2ksXG5cdHN0cmluZ1JlZyA9IChzdHI6IHN0cmluZykgPT4gbmV3IFJlZ0V4cChlc2NhcGVSZWdFeHAoc3RyKSksXG5cdHdyYXBSZWcgPSAoc3RyOiBzdHJpbmcsIGNhcHR1cmUgPSBmYWxzZSkgPT5cblx0XHRjYXB0dXJlID8gJygnICsgc3RyICsgJyknIDogJyg/OicgKyBzdHIgKyAnKSc7XG5cbmV4cG9ydCB0eXBlIE9Sb3V0ZVBhdGggPSBzdHJpbmcgfCBSZWdFeHA7XG5leHBvcnQgdHlwZSBPUm91dGVQYXRoT3B0aW9ucyA9IHtcblx0W2tleTogc3RyaW5nXTogUmVnRXhwIHwga2V5b2YgdHlwZW9mIHRva2VuVHlwZXNSZWdNYXA7XG59O1xuZXhwb3J0IHR5cGUgT1JvdXRlVG9rZW5zID0gUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbmV4cG9ydCB0eXBlIE9Sb3V0ZUFjdGlvbiA9IChjdHg6IE9XZWJSb3V0ZUNvbnRleHQpID0+IHZvaWQ7XG5leHBvcnQgdHlwZSBPUm91dGVJbmZvID0geyByZWc6IFJlZ0V4cCB8IG51bGw7IHRva2Vuczogc3RyaW5nW10gfTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT1dlYlJvdXRlIHtcblx0cHJpdmF0ZSByZWFkb25seSBwYXRoOiBzdHJpbmc7XG5cdHByaXZhdGUgcmVhZG9ubHkgcmVnOiBSZWdFeHAgfCBudWxsO1xuXHRwcml2YXRlIHRva2Vuczogc3RyaW5nW107XG5cdHByaXZhdGUgcmVhZG9ubHkgYWN0aW9uOiBPUm91dGVBY3Rpb247XG5cblx0LyoqXG5cdCAqIE9XZWJSb3V0ZSBDb25zdHJ1Y3Rvci5cblx0ICpcblx0ICogQHBhcmFtIHBhdGggVGhlIHJvdXRlIHBhdGggc3RyaW5nIG9yIHJlZ2V4cC5cblx0ICogQHBhcmFtIG9wdGlvbnMgVGhlIHJvdXRlIG9wdGlvbnMuXG5cdCAqIEBwYXJhbSBhY3Rpb24gVGhlIHJvdXRlIGFjdGlvbiBmdW5jdGlvbi5cblx0ICovXG5cdGNvbnN0cnVjdG9yKFxuXHRcdHBhdGg6IHN0cmluZyB8IFJlZ0V4cCxcblx0XHRvcHRpb25zOiBPUm91dGVQYXRoT3B0aW9ucyB8IHN0cmluZ1tdLFxuXHRcdGFjdGlvbjogT1JvdXRlQWN0aW9uXG5cdCkge1xuXHRcdGlmIChwYXRoIGluc3RhbmNlb2YgUmVnRXhwKSB7XG5cdFx0XHR0aGlzLnBhdGggPSBwYXRoLnRvU3RyaW5nKCk7XG5cdFx0XHR0aGlzLnJlZyA9IHBhdGg7XG5cdFx0XHR0aGlzLnRva2VucyA9IGlzQXJyYXkob3B0aW9ucykgPyBvcHRpb25zIDogW107XG5cdFx0fSBlbHNlIGlmIChpc1N0cmluZyhwYXRoKSAmJiBwYXRoLmxlbmd0aCkge1xuXHRcdFx0b3B0aW9ucyA9IChpc1BsYWluT2JqZWN0KG9wdGlvbnMpID8gb3B0aW9ucyA6IHt9KSBhcyBPUm91dGVQYXRoT3B0aW9ucztcblx0XHRcdGNvbnN0IHAgPSBPV2ViUm91dGUucGFyc2VEeW5hbWljUGF0aChwYXRoLCBvcHRpb25zKTtcblx0XHRcdHRoaXMucGF0aCA9IHBhdGg7XG5cdFx0XHR0aGlzLnJlZyA9IHAucmVnO1xuXHRcdFx0dGhpcy50b2tlbnMgPSBwLnRva2Vucztcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcihcblx0XHRcdFx0J1tPV2ViUm91dGVdIGludmFsaWQgcm91dGUgcGF0aCwgc3RyaW5nIG9yIFJlZ0V4cCByZXF1aXJlZC4nXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmICgnZnVuY3Rpb24nICE9PSB0eXBlb2YgYWN0aW9uKSB7XG5cdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKFxuXHRcdFx0XHRgW09XZWJSb3V0ZV0gaW52YWxpZCBhY3Rpb24gdHlwZSwgZ290IFwiJHt0eXBlb2YgYWN0aW9ufVwiIGluc3RlYWQgb2YgXCJmdW5jdGlvblwiLmBcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0dGhpcy5hY3Rpb24gPSBhY3Rpb247XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyB0cnVlIGlmIHRoaXMgcm91dGUgaXMgZHluYW1pYyBmYWxzZSBvdGhlcndpc2UuXG5cdCAqL1xuXHRpc0R5bmFtaWMoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMucmVnICE9IG51bGw7XG5cdH1cblxuXHQvKipcblx0ICogR2V0cyByb3V0ZSBhY3Rpb24uXG5cdCAqL1xuXHRnZXRBY3Rpb24oKTogT1JvdXRlQWN0aW9uIHtcblx0XHRyZXR1cm4gdGhpcy5hY3Rpb247XG5cdH1cblxuXHQvKipcblx0ICogQ2hlY2tzIGlmIGEgZ2l2ZW4gcGF0aG5hbWUgbWF0Y2ggdGhpcyByb3V0ZS5cblx0ICpcblx0ICogQHBhcmFtIHBhdGhuYW1lXG5cdCAqL1xuXHRpcyhwYXRobmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMucmVnID8gdGhpcy5yZWcudGVzdChwYXRobmFtZSkgOiB0aGlzLnBhdGggPT09IHBhdGhuYW1lO1xuXHR9XG5cblx0LyoqXG5cdCAqIFBhcnNlIGEgZ2l2ZW4gcGF0aG5hbWUuXG5cdCAqXG5cdCAqIEBwYXJhbSBwYXRobmFtZVxuXHQgKi9cblx0cGFyc2UocGF0aG5hbWU6IHN0cmluZyk6IE9Sb3V0ZVRva2VucyB7XG5cdFx0aWYgKHRoaXMuaXNEeW5hbWljKCkpIHtcblx0XHRcdGNvbnN0IGZvdW5kczogYW55ID0gU3RyaW5nKHBhdGhuYW1lKS5tYXRjaCh0aGlzLnJlZyBhcyBSZWdFeHApO1xuXG5cdFx0XHRpZiAoZm91bmRzKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLnRva2Vucy5yZWR1Y2UoKGFjYzogYW55LCBrZXk6IHN0cmluZywgaW5kZXg6IG51bWJlcikgPT4ge1xuXHRcdFx0XHRcdGFjY1trZXldID0gZm91bmRzW2luZGV4ICsgMV07XG5cdFx0XHRcdFx0cmV0dXJuIGFjYztcblx0XHRcdFx0fSwge30pO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiB7fTtcblx0fVxuXG5cdC8qKlxuXHQgKiBQYXJzZSBkeW5hbWljIHBhdGggYW5kIHJldHVybnMgYXBwcm9wcmlhdGUgcmVnZXhwIGFuZCB0b2tlbnMgbGlzdC5cblx0ICpcblx0ICogYGBganNcblx0ICogbGV0IGZvcm1hdCA9IFwicGF0aC90by86aWQvZmlsZS86aW5kZXgvbmFtZS46Zm9ybWF0XCI7XG5cdCAqIGxldCBvcHRpb25zID0ge1xuXHQgKiBcdFx0aWQ6IFwibnVtXCIsXG5cdCAqIFx0XHRpbmRleDogXCJhbHBoYVwiLFxuXHQgKiBcdFx0Zm9ybWF0Olx0XCJhbHBoYS1udW1cIlxuXHQgKiB9O1xuXHQgKiBsZXQgaW5mbyA9IHBhcnNlRHluYW1pY1BhdGgoZm9ybWF0LG9wdGlvbnMpO1xuXHQgKlxuXHQgKiBpbmZvID09PSB7XG5cdCAqICAgICByZWc6IFJlZ0V4cCxcblx0ICogICAgIHRva2VuczogW1wiaWRcIixcImluZGV4XCIsXCJmb3JtYXRcIl1cblx0ICogfTtcblx0ICogYGBgXG5cdCAqIEBwYXJhbSBwYXRoIFRoZSBwYXRoIGZvcm1hdCBzdHJpbmcuXG5cdCAqIEBwYXJhbSBvcHRpb25zIFRoZSBwYXRoIG9wdGlvbnMuXG5cdCAqL1xuXHRzdGF0aWMgcGFyc2VEeW5hbWljUGF0aChcblx0XHRwYXRoOiBzdHJpbmcsXG5cdFx0b3B0aW9uczogT1JvdXRlUGF0aE9wdGlvbnNcblx0KTogT1JvdXRlSW5mbyB7XG5cdFx0Y29uc3QgdG9rZW5zOiBzdHJpbmdbXSA9IFtdO1xuXHRcdGxldCByZWcgPSAnJyxcblx0XHRcdF9wYXRoOiBzdHJpbmcgPSBwYXRoLFxuXHRcdFx0bWF0Y2g6IFJlZ0V4cEV4ZWNBcnJheSB8IG51bGw7XG5cblx0XHR3aGlsZSAoKG1hdGNoID0gdG9rZW5SZWcuZXhlYyhfcGF0aCkpICE9IG51bGwpIHtcblx0XHRcdGNvbnN0IGZvdW5kOiBhbnkgPSBtYXRjaFswXSxcblx0XHRcdFx0dG9rZW46IGFueSA9IG1hdGNoWzFdLFxuXHRcdFx0XHRydWxlOiBhbnkgPSBvcHRpb25zW3Rva2VuXSB8fCAnYW55Jyxcblx0XHRcdFx0aGVhZDogc3RyaW5nID0gX3BhdGguc2xpY2UoMCwgbWF0Y2guaW5kZXgpO1xuXG5cdFx0XHRpZiAoaGVhZC5sZW5ndGgpIHtcblx0XHRcdFx0cmVnICs9IHdyYXBSZWcoc3RyaW5nUmVnKGhlYWQpLnNvdXJjZSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YgcnVsZSA9PT0gJ3N0cmluZycgJiYgcnVsZSBpbiB0b2tlblR5cGVzUmVnTWFwKSB7XG5cdFx0XHRcdHJlZyArPSB3cmFwUmVnKCh0b2tlblR5cGVzUmVnTWFwIGFzIGFueSlbcnVsZV0sIHRydWUpO1xuXHRcdFx0fSBlbHNlIGlmIChydWxlIGluc3RhbmNlb2YgUmVnRXhwKSB7XG5cdFx0XHRcdHJlZyArPSB3cmFwUmVnKHJ1bGUuc291cmNlLCB0cnVlKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBydWxlIGZvciB0b2tlbiAnOiR7dG9rZW59JyBpbiBwYXRoICcke3BhdGh9J2ApO1xuXHRcdFx0fVxuXG5cdFx0XHR0b2tlbnMucHVzaCh0b2tlbik7XG5cblx0XHRcdF9wYXRoID0gX3BhdGguc2xpY2UobWF0Y2guaW5kZXggKyBmb3VuZC5sZW5ndGgpO1xuXHRcdH1cblxuXHRcdGlmICghcmVnLmxlbmd0aCkge1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0cmVnOiBudWxsLFxuXHRcdFx0XHR0b2tlbnMsXG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdGlmIChfcGF0aC5sZW5ndGgpIHtcblx0XHRcdHJlZyArPSB3cmFwUmVnKHN0cmluZ1JlZyhfcGF0aCkuc291cmNlKTtcblx0XHR9XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0cmVnOiBuZXcgUmVnRXhwKCdeJyArIHJlZyArICckJyksXG5cdFx0XHR0b2tlbnMsXG5cdFx0fTtcblx0fVxufVxuIl19