import OWebFormValidator from "../OWebFormValidator";
import OWebDate from "../plugins/OWebDate";
import Utils from "../utils/Utils";
import { OTelInput } from "o-tel-input";
OWebFormValidator.addFieldValidators({
    "code": (value, name, fv) => {
        let codeReg = new RegExp(fv.getConfig("OZ_CODE_REG"));
        fv.assert(codeReg.test(value), "OZ_AUTH_CODE_INVALID");
    },
    "uname": (value, name, fv) => {
        value = value.replace(/\s+/g, " ").trim();
        fv.assert(value.length >= fv.getConfig("OZ_USER_NAME_MIN_LENGTH"), "OZ_FIELD_USER_NAME_TOO_SHORT")
            .assert(value.length <= fv.getConfig("OZ_USER_NAME_MAX_LENGTH"), "OZ_FIELD_USER_NAME_TOO_LONG")
            .setField(name, value);
    },
    "login_pass": (value, name, fv) => {
        let pass = value, min = fv.getConfig("OZ_PASS_MIN_LENGTH"), max = fv.getConfig("OZ_PASS_MAX_LENGTH");
        fv.assert(pass.length >= min, "OZ_FIELD_PASS_INVALID")
            .assert(pass.length <= max, "OZ_FIELD_PASS_INVALID");
    },
    "cpass": (value, name, fv) => {
        let pass = value, min = fv.getConfig("OZ_PASS_MIN_LENGTH"), max = fv.getConfig("OZ_PASS_MAX_LENGTH");
        fv.assert(pass.length >= min, "OZ_FIELD_PASS_INVALID")
            .assert(pass.length <= max, "OZ_FIELD_PASS_INVALID");
    },
    "pass": (value, name, fv) => {
        let pass = value, min = fv.getConfig("OZ_PASS_MIN_LENGTH"), max = fv.getConfig("OZ_PASS_MAX_LENGTH");
        fv.assert(pass.length >= min, "OZ_FIELD_PASS_TOO_SHORT", { "min": min, "max": max })
            .assert(pass.length <= max, "OZ_FIELD_PASS_TOO_LONG", { "min": min, "max": max });
    },
    "vpass": (value, name, fv) => {
        fv.assert(value === fv.getField("pass"), "OZ_FIELD_PASS_AND_VPASS_NOT_EQUAL");
    },
    "birth_date": (value, name, fv) => {
        let od = new OWebDate(fv.getAppContext(), value), date = od.describe(), min_age = fv.getConfig("OZ_USER_MIN_AGE"), max_age = fv.getConfig("OZ_USER_MAX_AGE"), isValid = date && Utils.isValidAge(date.d, parseInt(date.mm), date.Y, min_age, max_age);
        fv.assert(isValid, "OZ_FIELD_BIRTH_DATE_INVALID", { "input": value, "min": min_age, "max": max_age });
        date && fv.setField(name, `${date.Y}-${date.mm}-${date.d}`);
    },
    "gender": (value, name, fv) => {
        let genders = fv.getConfig("OZ_USER_ALLOWED_GENDERS");
        fv.assert(genders.indexOf(value) >= 0, "OZ_FIELD_GENDER_INVALID");
    },
    "phone": (value, name, fv) => {
        fv.assert(OTelInput.isPhoneNumberPossible(value), "OZ_FIELD_PHONE_INVALID");
        let t = OTelInput(null, { "number": value });
        let phone = t.getInput();
        let cc2 = t.getCurrentData().cc2;
        fv.setField(name, phone.replace(/[ -]/g, ""));
        // set only if it is not already set
        // we may have multiple phone field or a cc2 field
        if (!fv.getField("cc2")) {
            fv.setField("cc2", cc2);
        }
    },
    "email": (value, name, fv) => {
        /**
         * Email matching regex
         *
         * source: http://www.w3.org/TR/html5/forms.html#valid-e-mail-address
         *        - TLD not required
         *            /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/
         *        - must have TLD
         *            /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/
         */
        let emailReg = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/;
        let email = value.replace(/\s/g, " ").trim();
        fv.assert(emailReg.test(email), "OZ_FIELD_EMAIL_INVALID")
            .setField(name, email);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnYuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZGVmYXVsdC9mdi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLGlCQUFpQixNQUFNLHNCQUFzQixDQUFDO0FBQ3JELE9BQU8sUUFBUSxNQUFNLHFCQUFxQixDQUFDO0FBQzNDLE9BQU8sS0FBSyxNQUFNLGdCQUFnQixDQUFDO0FBQ25DLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxhQUFhLENBQUM7QUFFdEMsaUJBQWlCLENBQUMsa0JBQWtCLENBQUM7SUFDcEMsTUFBTSxFQUFRLENBQUMsS0FBVSxFQUFFLElBQVksRUFBRSxFQUFxQixFQUFFLEVBQUU7UUFDakUsSUFBSSxPQUFPLEdBQUcsSUFBSSxNQUFNLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO1FBQ3RELEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFDRCxPQUFPLEVBQU8sQ0FBQyxLQUFVLEVBQUUsSUFBWSxFQUFFLEVBQXFCLEVBQUUsRUFBRTtRQUNqRSxLQUFLLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFMUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxTQUFTLENBQUMseUJBQXlCLENBQUMsRUFBRSw4QkFBOEIsQ0FBQzthQUMvRixNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sSUFBSSxFQUFFLENBQUMsU0FBUyxDQUFDLHlCQUF5QixDQUFDLEVBQUUsNkJBQTZCLENBQUM7YUFDOUYsUUFBUSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBQ0QsWUFBWSxFQUFFLENBQUMsS0FBVSxFQUFFLElBQVksRUFB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c0lBQXNJLENBQUM7UUFDdEosSUFBSSxLQUFLLEdBQU0sS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFaEQsRUFBRSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLHdCQUF3QixDQUFDO2FBQ3RELFFBQVEsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDMUIsQ0FBQztDQUNELENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBPV2ViRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vT1dlYkZvcm1WYWxpZGF0b3JcIjtcbmltcG9ydCBPV2ViRGF0ZSBmcm9tIFwiLi4vcGx1Z2lucy9PV2ViRGF0ZVwiO1xuaW1wb3J0IFV0aWxzIGZyb20gXCIuLi91dGlscy9VdGlsc1wiO1xuaW1wb3J0IHtPVGVsSW5wdXR9IGZyb20gXCJvLXRlbC1pbnB1dFwiO1xuXG5PV2ViRm9ybVZhbGlkYXRvci5hZGRGaWVsZFZhbGlkYXRvcnMoe1xuXHRcImNvZGVcIiAgICAgIDogKHZhbHVlOiBhbnksIG5hbWU6IHN0cmluZywgZnY6IE9XZWJGb3JtVmFsaWRhdG9yKSA9PiB7XG5cdFx0bGV0IGNvZGVSZWcgPSBuZXcgUmVnRXhwKGZ2LmdldENvbmZpZyhcIk9aX0NPREVfUkVHXCIpKTtcblx0XHRmdi5hc3NlcnQoY29kZVJlZy50ZXN0KHZhbHVlKSwgXCJPWl9BVVRIX0NPREVfSU5WQUxJRFwiKTtcblx0fSxcblx0XCJ1bmFtZVwiICAgICA6ICh2YWx1ZTogYW55LCBuYW1lOiBzdHJpbmcsIGZ2OiBPV2ViRm9ybVZhbGlkYXRvcikgPT4ge1xuXHRcdHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxzKy9nLCBcIiBcIikudHJpbSgpO1xuXG5cdFx0ZnYuYXNzZXJ0KHZhbHVlLmxlbmd0aCA+PSBmdi5nZXRDb25maWcoXCJPWl9VU0VSX05BTUVfTUlOX0xFTkdUSFwiKSwgXCJPWl9GSUVMRF9VU0VSX05BTUVfVE9PX1NIT1JUXCIpXG5cdFx0ICAuYXNzZXJ0KHZhbHVlLmxlbmd0aCA8PSBmdi5nZXRDb25maWcoXCJPWl9VU0VSX05BTUVfTUFYX0xFTkdUSFwiKSwgXCJPWl9GSUVMRF9VU0VSX05BTUVfVE9PX0xPTkdcIilcblx0XHQgIC5zZXRGaWVsZChuYW1lLCB2YWx1ZSk7XG5cdH0sXG5cdFwibG9naW5fcGFzc1wiOiAodmFsdWU6IGFueSwgbmFtZTogc3RyaW5nLCBmdjogT1dlYkZvcm1WYWxpZGF0b3IpID0+IHtcblx0XHRsZXQgcGFzcyA9IHZhbHVlLFxuXHRcdFx0bWluICA9IGZ2LmdldENvbmZpZyhcIk9aX1BBU1NfTUlOX0xFTkdUSFwiKSxcblx0XHRcdG1heCAgPSBmdi5nZXRDb25maWcoXCJPWl9QQVNTX01BWF9MRU5HVEhcIik7XG5cdFx0ZnYuYXNzZXJ0KHBhc3MubGVuZ3RoID49IG1pbiwgXCJPWl9GSUVMRF9QQVNTX0lOVkFMSURcIilcblx0XHQgIC5hc3NlcnQocGFzcy5sZW5ndGggPD0gbWF4LCBcIk9aX0ZJRUxEX1BBU1NfSU5WQUxJRFwiKTtcblx0fSxcblx0XCJjcGFzc1wiICAgICA6ICh2YWx1ZTogYW55LCBuYW1lOiBzdHJpbmcsIGZ2OiBPV2ViRm9ybVZhbGlkYXRvcikgPT4ge1xuXHRcdGxldCBwYXNzID0gdmFsdWUsXG5cdFx0XHRtaW4gID0gZnYuZ2V0Q29uZmlnKFwiT1pfUEFTU19NSU5fTEVOR1RIXCIpLFxuXHRcdFx0bWF4ICA9IGZ2LmdldENvbmZpZyhcIk9aX1BBU1NfTUFYX0xFTkdUSFwiKTtcblx0XHRmdi5hc3NlcnQocGFzcy5sZW5ndGggPj0gbWluLCBcIk9aX0ZJRUxEX1BBU1NfSU5WQUxJRFwiKVxuXHRcdCAgLmFzc2VydChwYXNzLmxlbmd0aCA8PSBtYXgsIFwiT1pfRklFTERfUEFTU19JTlZBTElEXCIpO1xuXHR9LFxuXHRcInBhc3NcIiAgICAgIDogKHZhbHVlOiBhbnksIG5hbWU6IHN0cmluZywgZnY6IE9XZWJGb3JtVmFsaWRhdG9yKSA9PiB7XG5cdFx0bGV0IHBhc3MgPSB2YWx1ZSxcblx0XHRcdG1pbiAgPSBmdi5nZXRDb25maWcoXCJPWl9QQVNTX01JTl9MRU5HVEhcIiksXG5cdFx0XHRtYXggID0gZnYuZ2V0Q29uZmlnKFwiT1pfUEFTU19NQVhfTEVOR1RIXCIpO1xuXHRcdGZ2LmFzc2VydChwYXNzLmxlbmd0aCA+PSBtaW4sIFwiT1pfRklFTERfUEFTU19UT09fU0hPUlRcIiwge1wibWluXCI6IG1pbiwgXCJtYXhcIjogbWF4fSlcblx0XHQgIC5hc3NlcnQocGFzcy5sZW5ndGggPD0gbWF4LCBcIk9aX0ZJRUxEX1BBU1NfVE9PX0xPTkdcIiwge1wibWluXCI6IG1pbiwgXCJtYXhcIjogbWF4fSk7XG5cdH0sXG5cdFwidnBhc3NcIiAgICAgOiAodmFsdWU6IGFueSwgbmFtZTogc3RyaW5nLCBmdjogT1dlYkZvcm1WYWxpZGF0b3IpID0+IHtcblx0XHRmdi5hc3NlcnQodmFsdWUgPT09IGZ2LmdldEZpZWxkKFwicGFzc1wiKSwgXCJPWl9GSUVMRF9QQVNTX0FORF9WUEFTU19OT1RfRVFVQUxcIik7XG5cdH0sXG5cdFwiYmlydGhfZGF0ZVwiOiAodmFsdWU6IGFueSwgbmFtZTogc3RyaW5nLCBmdjogT1dlYkZvcm1WYWxpZGF0b3IpID0+IHtcblx0XHRsZXQgb2QgICAgICA9IG5ldyBPV2ViRGF0ZShmdi5nZXRBcHBDb250ZXh0KCksIHZhbHVlKSxcblx0XHRcdGRhdGUgICAgPSBvZC5kZXNjcmliZSgpLFxuXHRcdFx0bWluX2FnZSA9IGZ2LmdldENvbmZpZyhcIk9aX1VTRVJfTUlOX0FHRVwiKSxcblx0XHRcdG1heF9hZ2UgPSBmdi5nZXRDb25maWcoXCJPWl9VU0VSX01BWF9BR0VcIiksXG5cdFx0XHRpc1ZhbGlkID0gZGF0ZSAmJiBVdGlscy5pc1ZhbGlkQWdlKGRhdGUuZCwgcGFyc2VJbnQoZGF0ZS5tbSksIGRhdGUuWSwgbWluX2FnZSwgbWF4X2FnZSk7XG5cblx0XHRmdi5hc3NlcnQoaXNWYWxpZCwgXCJPWl9GSUVMRF9CSVJUSF9EQVRFX0lOVkFMSURcIiwge1wiaW5wdXRcIjogdmFsdWUsIFwibWluXCI6IG1pbl9hZ2UsIFwibWF4XCI6IG1heF9hZ2V9KTtcblxuXHRcdGRhdGUgJiYgZnYuc2V0RmllbGQobmFtZSwgYCR7ZGF0ZS5ZfS0ke2RhdGUubW19LSR7ZGF0ZS5kfWApO1xuXHR9LFxuXHRcImdlbmRlclwiICAgIDogKHZhbHVlOiBhbnksIG5hbWU6IHN0cmluZywgZnY6IE9XZWJGb3JtVmFsaWRhdG9yKSA9PiB7XG5cdFx0bGV0IGdlbmRlcnMgPSBmdi5nZXRDb25maWcoXCJPWl9VU0VSX0FMTE9XRURfR0VOREVSU1wiKTtcblx0XHRmdi5hc3NlcnQoZ2VuZGVycy5pbmRleE9mKHZhbHVlKSA+PSAwLCBcIk9aX0ZJRUxEX0dFTkRFUl9JTlZBTElEXCIpO1xuXHR9LFxuXHRcInBob25lXCIgICAgIDogKHZhbHVlOiBhbnksIG5hbWU6IHN0cmluZywgZnY6IE9XZWJGb3JtVmFsaWRhdG9yKSA9PiB7XG5cdFx0ZnYuYXNzZXJ0KE9UZWxJbnB1dC5pc1Bob25lTnVtYmVyUG9zc2libGUodmFsdWUpLCBcIk9aX0ZJRUxEX1BIT05FX0lOVkFMSURcIik7XG5cblx0XHRsZXQgdCAgICAgPSBPVGVsSW5wdXQobnVsbCwge1wibnVtYmVyXCI6IHZhbHVlfSk7XG5cdFx0bGV0IHBob25lID0gdC5nZXRJbnB1dCgpO1xuXHRcdGxldCBjYzIgICA9IHQuZ2V0Q3VycmVudERhdGEoKS5jYzI7XG5cblx0XHRmdi5zZXRGaWVsZChuYW1lLCBwaG9uZS5yZXBsYWNlKC9bIC1dL2csIFwiXCIpKTtcblxuXHRcdC8vIHNldCBvbmx5IGlmIGl0IGlzIG5vdCBhbHJlYWR5IHNldFxuXHRcdC8vIHdlIG1heSBoYXZlIG11bHRpcGxlIHBob25lIGZpZWxkIG9yIGEgY2MyIGZpZWxkXG5cdFx0aWYgKCFmdi5nZXRGaWVsZChcImNjMlwiKSkge1xuXHRcdFx0ZnYuc2V0RmllbGQoXCJjYzJcIiwgY2MyKTtcblx0XHR9XG5cdH0sXG5cdFwiZW1haWxcIiAgICAgOiAodmFsdWU6IGFueSwgbmFtZTogc3RyaW5nLCBmdjogT1dlYkZvcm1WYWxpZGF0b3IpID0+IHtcblx0XHQvKipcblx0XHQgKiBFbWFpbCBtYXRjaGluZyByZWdleFxuXHRcdCAqXG5cdFx0ICogc291cmNlOiBodHRwOi8vd3d3LnczLm9yZy9UUi9odG1sNS9mb3Jtcy5odG1sI3ZhbGlkLWUtbWFpbC1hZGRyZXNzXG5cdFx0ICogICAgICAgIC0gVExEIG5vdCByZXF1aXJlZFxuXHRcdCAqICAgICAgICAgICAgL15bYS16QS1aMC05LiEjJCUmJyorLz0/Xl9ge3x9fi1dK0BbYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfVthLXpBLVowLTldKT8oPzpcXC5bYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfVthLXpBLVowLTldKT8pKiQvXG5cdFx0ICogICAgICAgIC0gbXVzdCBoYXZlIFRMRFxuXHRcdCAqICAgICAgICAgICAgL15bYS16QS1aMC05LiEjJCUmJyorLz0/Xl9ge3x9fi1dK0BbYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfVthLXpBLVowLTldKT8oPzpcXC5bYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfVthLXpBLVowLTldKT8pKyQvXG5cdFx0ICovXG5cdFx0bGV0IGVtYWlsUmVnID0gL15bYS16QS1aMC05LiEjJCUmJyorLz0/Xl9ge3x9fi1dK0BbYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfVthLXpBLVowLTldKT8oPzpcXC5bYS16QS1aMC05XSg/OlthLXpBLVowLTktXXswLDYxfVthLXpBLVowLTldKT8pKyQvO1xuXHRcdGxldCBlbWFpbCAgICA9IHZhbHVlLnJlcGxhY2UoL1xccy9nLCBcIiBcIikudHJpbSgpO1xuXG5cdFx0ZnYuYXNzZXJ0KGVtYWlsUmVnLnRlc3QoZW1haWwpLCBcIk9aX0ZJRUxEX0VNQUlMX0lOVkFMSURcIilcblx0XHQgIC5zZXRGaWVsZChuYW1lLCBlbWFpbCk7XG5cdH1cbn0pOyJdfQ==