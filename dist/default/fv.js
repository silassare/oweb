import OWebFormValidator from '../OWebFormValidator';
import OWebDate from '../plugins/OWebDate';
import OWebInput from 'oweb-tel-input';
import { isValidAge } from '../utils/Utils';
OWebFormValidator.addFieldValidators({
    code: (value, name, fv) => {
        const codeReg = new RegExp(fv.getConfig('OZ_CODE_REG'));
        fv.assert(codeReg.test(value), 'OZ_AUTH_CODE_INVALID');
    },
    uname: (value, name, fv) => {
        value = value.replace(/\s+/g, ' ').trim();
        fv.assert(value.length >= fv.getConfig('OZ_USER_NAME_MIN_LENGTH'), 'OZ_FIELD_USER_NAME_TOO_SHORT')
            .assert(value.length <= fv.getConfig('OZ_USER_NAME_MAX_LENGTH'), 'OZ_FIELD_USER_NAME_TOO_LONG')
            .setField(name, value);
    },
    login_pass: (value, name, fv) => {
        const pass = value, min = fv.getConfig('OZ_PASS_MIN_LENGTH'), max = fv.getConfig('OZ_PASS_MAX_LENGTH');
        fv.assert(pass.length >= min, 'OZ_FIELD_PASS_INVALID').assert(pass.length <= max, 'OZ_FIELD_PASS_INVALID');
    },
    cpass: (value, name, fv) => {
        const pass = value, min = fv.getConfig('OZ_PASS_MIN_LENGTH'), max = fv.getConfig('OZ_PASS_MAX_LENGTH');
        fv.assert(pass.length >= min, 'OZ_FIELD_PASS_INVALID').assert(pass.length <= max, 'OZ_FIELD_PASS_INVALID');
    },
    pass: (value, name, fv) => {
        const pass = value, min = fv.getConfig('OZ_PASS_MIN_LENGTH'), max = fv.getConfig('OZ_PASS_MAX_LENGTH');
        fv.assert(pass.length >= min, 'OZ_FIELD_PASS_TOO_SHORT', {
            min,
            max,
        }).assert(pass.length <= max, 'OZ_FIELD_PASS_TOO_LONG', {
            min,
            max,
        });
    },
    vpass: (value, name, fv) => {
        fv.assert(value === fv.getField('pass'), 'OZ_FIELD_PASS_AND_VPASS_NOT_EQUAL');
    },
    birth_date: (value, name, fv) => {
        const od = new OWebDate(fv.getAppContext(), value), date = od.describe(), minAge = fv.getConfig('OZ_USER_MIN_AGE'), maxAge = fv.getConfig('OZ_USER_MAX_AGE'), isValid = date &&
            isValidAge(date.d, parseInt(date.mm), date.Y, minAge, maxAge);
        fv.assert(isValid, 'OZ_FIELD_BIRTH_DATE_INVALID', {
            input: value,
            min: minAge,
            max: maxAge,
        });
        date && fv.setField(name, `${date.Y}-${date.mm}-${date.d}`);
    },
    gender: (value, name, fv) => {
        const genders = fv.getConfig('OZ_USER_ALLOWED_GENDERS');
        fv.assert(genders.indexOf(value) >= 0, 'OZ_FIELD_GENDER_INVALID');
    },
    phone: (value, name, fv) => {
        fv.assert(OWebInput.isPhoneNumberPossible(value), 'OZ_FIELD_PHONE_INVALID');
        const t = new OWebInput({ number: value }), phone = t.getInput(), cc2 = t.getCurrentCountry().cc2;
        fv.setField(name, phone.replace(/[ -]/g, ''));
        // we set only if it is not already done
        // we may have multiple phone field or a cc2 field
        if (!fv.getField('cc2')) {
            fv.setField('cc2', cc2);
        }
    },
    email: (value, name, fv) => {
        /**
         * Email matching regex
         *
         * source: http://www.w3.org/TR/html5/forms.html#valid-e-mail-address
         *        - TLD not required
         *            /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/
         *        - must have TLD
         *            /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/
         */
        const emailReg = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/;
        const email = value.replace(/\s/g, ' ').trim();
        fv.assert(emailReg.test(email), 'OZ_FIELD_EMAIL_INVALID').setField(name, email);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnYuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZGVmYXVsdC9mdi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLGlCQUFpQixNQUFNLHNCQUFzQixDQUFDO0FBQ3JELE9BQU8sUUFBUSxNQUFNLHFCQUFxQixDQUFDO0FBQzNDLE9BQU8sU0FBUyxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU1QyxpQkFBaUIsQ0FBQyxrQkFBa0IsQ0FBQztJQUNwQyxJQUFJLEVBQUUsQ0FBQyxLQUFVLEVBQUUsSUFBWSxFQUFFLEVBQXFCLEVBQUUsRUFBRTtRQUN6RCxNQUFNLE9BQU8sR0FBRyxJQUFJLE1BQU0sQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDeEQsRUFBRSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLHNCQUFzQixDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUNELEtBQUssRUFBRSxDQUFDLEtBQVUsRUFBRSxJQUFZLEVBQUUsRUFBcUIsRUFBRSxFQUFFO1FBQzFELEtBQUssR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUUxQyxFQUFFLENBQUMsTUFBTSxDQUNSLEtBQUssQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLFNBQVMsQ0FBQyx5QkFBeUIsQ0FBQyxFQUN2RCw4QkFBOEIsQ0FDOUI7YUFDQyxNQUFNLENBQ04sS0FBSyxDQUFDLE1BQU0sSUFBSSxFQUFFLENBQUMsU0FBUyxDQUFDLHlCQUF5QixDQUFDLEVBQ3ZELDZCQUE2QixDQUM3QjthQUNBLFFBQVEsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUNELFVBQVUsRUFBRSxDQUFDLEtBQVUsRUFBRSxJQUFZ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LEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBRS9DLEVBQUUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSx3QkFBd0IsQ0FBQyxDQUFDLFFBQVEsQ0FDakUsSUFBSSxFQUNKLEtBQUssQ0FDTCxDQUFDO0lBQ0gsQ0FBQztDQUNELENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBPV2ViRm9ybVZhbGlkYXRvciBmcm9tICcuLi9PV2ViRm9ybVZhbGlkYXRvcic7XG5pbXBvcnQgT1dlYkRhdGUgZnJvbSAnLi4vcGx1Z2lucy9PV2ViRGF0ZSc7XG5pbXBvcnQgT1dlYklucHV0IGZyb20gJ293ZWItdGVsLWlucHV0JztcbmltcG9ydCB7IGlzVmFsaWRBZ2UgfSBmcm9tICcuLi91dGlscy9VdGlscyc7XG5cbk9XZWJGb3JtVmFsaWRhdG9yLmFkZEZpZWxkVmFsaWRhdG9ycyh7XG5cdGNvZGU6ICh2YWx1ZTogYW55LCBuYW1lOiBzdHJpbmcsIGZ2OiBPV2ViRm9ybVZhbGlkYXRvcikgPT4ge1xuXHRcdGNvbnN0IGNvZGVSZWcgPSBuZXcgUmVnRXhwKGZ2LmdldENvbmZpZygnT1pfQ09ERV9SRUcnKSk7XG5cdFx0ZnYuYXNzZXJ0KGNvZGVSZWcudGVzdCh2YWx1ZSksICdPWl9BVVRIX0NPREVfSU5WQUxJRCcpO1xuXHR9LFxuXHR1bmFtZTogKHZhbHVlOiBhbnksIG5hbWU6IHN0cmluZywgZnY6IE9XZWJGb3JtVmFsaWRhdG9yKSA9PiB7XG5cdFx0dmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cXHMrL2csICcgJykudHJpbSgpO1xuXG5cdFx0ZnYuYXNzZXJ0KFxuXHRcdFx0dmFsdWUubGVuZ3RoID49IGZ2LmdldENvbmZpZygnT1pfVVNFUl9OQU1FX01JTl9MRU5HVEgnKSxcblx0XHRcdCdPWl9GSUVMRF9VU0VSX05BTUVfVE9PX1NIT1JUJyxcblx0XHQpXG5cdFx0XHQuYXNzZXJ0KFxuXHRcdFx0XHR2YWx1ZS5sZW5ndGggPD0gZnYuZ2V0Q29uZmlnKCdPWl9VU0VSX05BTUVfTUFYX0xFTkdUSCcpLFxuXHRcdFx0XHQnT1pfRklFTERfVVNFUl9OQU1FX1RPT19MT05HJyxcblx0XHRcdClcblx0XHRcdC5zZXRGaWVsZChuYW1lLCB2YWx1ZSk7XG5cdH0sXG5cdGxvZ2luX3Bhc3M6ICh2YWx1ZTogYW55LCBuYW1lOiBzdHJpbmcsIGZ2OiBPV2ViRm9ybVZhbGlkYXRvcikgPT4ge1xuXHRcdGNvbnN0IHBhc3MgPSB2YWx1ZSxcblx0XHRcdG1pbiA9IGZ2LmdldENvbmZpZygnT1pfUEFTU19NSU5fTEVOR1RIJyksXG5cdFx0XHRtYXggPSBmdi5nZXRDb25maWcoJ09aX1BBU1NfTUFYX0xFTkdUSCcpO1xuXHRcdGZ2LmFzc2VydChwYXNzLmxlbmd0aCA+PSBtaW4sICdPWl9GSUVMRF9QQVNTX0lOVkFMSUQnKS5hc3NlcnQoXG5cdFx0XHRwYXNzLmxlbmd0aCA8PSBtYXgsXG5cdFx0XHQnT1pfRklFTERfUEFTU19JTlZBTElEJyxcblx0XHQpO1xuXHR9LFxuXHRjcGFzczogKHZhbHVlOiBhbnksIG5hbWU6IHN0cmluZywgZnY6IE9XZWJGb3JtVmFsaWRhdG9yKSA9PiB7XG5cdFx0Y29uc3QgcGFzcyA9IHZhbHVlLFxuXHRcdFx0bWluID0gZnYuZ2V0Q29uZmlnKCdPWl9QQVNTX01JTl9MRU5HVEgnKSxcblx0XHRcdG1heCA9IGZ2LmdldENvbmZpZygnT1pfUEFTU19NQVhfTEVOR1RIJyk7XG5cdFx0ZnYuYXNzZXJ0KHBhc3MubGVuZ3RoID49IG1pbiwgJ09aX0ZJRUxEX1BBU1NfSU5WQUxJRCcpLmFzc2VydChcblx0XHRcdHBhc3MubGVuZ3RoIDw9IG1heCxcblx0XHRcdCdPWl9GSUVMRF9QQVNTX0lOVkFMSUQnLFxuXHRcdCk7XG5cdH0sXG5cdHBhc3M6ICh2YWx1ZTogYW55LCBuYW1lOiBzdHJpbmcsIGZ2OiBPV2ViRm9ybVZhbGlkYXRvcikgPT4ge1xuXHRcdGNvbnN0IHBhc3MgPSB2YWx1ZSxcblx0XHRcdG1pbiA9IGZ2LmdldENvbmZpZygnT1pfUEFTU19NSU5fTEVOR1RIJyksXG5cdFx0XHRtYXggPSBmdi5nZXRDb25maWcoJ09aX1BBU1NfTUFYX0xFTkdUSCcpO1xuXHRcdGZ2LmFzc2VydChwYXNzLmxlbmd0aCA+PSBtaW4sICdPWl9GSUVMRF9QQVNTX1RPT19TSE9SVCcsIHtcblx0XHRcdG1pbixcblx0XHRcdG1heCxcblx0XHR9KS5hc3NlcnQocGFzcy5sZW5ndGggPD0gbWF4LCAnT1pfRklFTERfUEFTU19UT09fTE9ORycsIHtcblx0XHRcdG1pbixcblx0XHRcdG1heCxcblx0XHR9KTtcblx0fSxcblx0dnBhc3M6ICh2YWx1ZTogYW55LCBuYW1lOiBzdHJpbmcsIGZ2OiBPV2ViRm9ybVZhbGlkYXRvcikgPT4ge1xuXHRcdGZ2LmFzc2VydChcblx0XHRcdHZhbHVlID09PSBmdi5nZXRGaWVsZCgncGFzcycpLFxuXHRcdFx0J09aX0ZJRUxEX1BBU1NfQU5EX1ZQQVNTX05PVF9FUVVBTCcsXG5cdFx0KTtcblx0fSxcblx0YmlydGhfZGF0ZTogKHZhbHVlOiBhbnksIG5hbWU6IHN0cmluZywgZnY6IE9XZWJGb3JtVmFsaWRhdG9yKSA9PiB7XG5cdFx0Y29uc3Qgb2QgPSBuZXcgT1dlYkRhdGUoZnYuZ2V0QXBwQ29udGV4dCgpLCB2YWx1ZSksXG5cdFx0XHRkYXRlID0gb2QuZGVzY3JpYmUoKSxcblx0XHRcdG1pbkFnZSA9IGZ2LmdldENvbmZpZygnT1pfVVNFUl9NSU5fQUdFJyksXG5cdFx0XHRtYXhBZ2UgPSBmdi5nZXRDb25maWcoJ09aX1VTRVJfTUFYX0FHRScpLFxuXHRcdFx0aXNWYWxpZCA9XG5cdFx0XHRcdGRhdGUgJiZcblx0XHRcdFx0aXNWYWxpZEFnZShkYXRlLmQsIHBhcnNlSW50KGRhdGUubW0pLCBkYXRlLlksIG1pbkFnZSwgbWF4QWdlKTtcblxuXHRcdGZ2LmFzc2VydChpc1ZhbGlkLCAnT1pfRklFTERfQklSVEhfREFURV9JTlZBTElEJywge1xuXHRcdFx0aW5wdXQ6IHZhbHVlLFxuXHRcdFx0bWluOiBtaW5BZ2UsXG5cdFx0XHRtYXg6IG1heEFnZSxcblx0XHR9KTtcblxuXHRcdGRhdGUgJiYgZnYuc2V0RmllbGQobmFtZSwgYCR7ZGF0ZS5ZfS0ke2RhdGUubW19LSR7ZGF0ZS5kfWApO1xuXHR9LFxuXHRnZW5kZXI6ICh2YWx1ZTogYW55LCBuYW1lOiBzdHJpbmcsIGZ2OiBPV2ViRm9ybVZhbGlkYXRvcikgPT4ge1xuXHRcdGNvbnN0IGdlbmRlcnMgPSBmdi5nZXRDb25maWcoJ09aX1VTRVJfQUxMT1dFRF9HRU5ERVJTJyk7XG5cdFx0ZnYuYXNzZXJ0KGdlbmRlcnMuaW5kZXhPZih2YWx1ZSkgPj0gMCwgJ09aX0ZJRUxEX0dFTkRFUl9JTlZBTElEJyk7XG5cdH0sXG5cdHBob25lOiAodmFsdWU6IGFueSwgbmFtZTogc3RyaW5nLCBmdjogT1dlYkZvcm1WYWxpZGF0b3IpID0+IHtcblx0XHRmdi5hc3NlcnQoXG5cdFx0XHRPV2ViSW5wdXQuaXNQaG9uZU51bWJlclBvc3NpYmxlKHZhbHVlKSxcblx0XHRcdCdPWl9GSUVMRF9QSE9ORV9JTlZBTElEJyxcblx0XHQpO1xuXG5cdFx0Y29uc3QgdCA9IG5ldyBPV2ViSW5wdXQoeyBudW1iZXI6IHZhbHVlIH0pLFxuXHRcdFx0cGhvbmUgPSB0LmdldElucHV0KCksXG5cdFx0XHRjYzIgPSB0LmdldEN1cnJlbnRDb3VudHJ5KCkuY2MyO1xuXG5cdFx0ZnYuc2V0RmllbGQobmFtZSwgcGhvbmUucmVwbGFjZSgvWyAtXS9nLCAnJykpO1xuXG5cdFx0Ly8gd2Ugc2V0IG9ubHkgaWYgaXQgaXMgbm90IGFscmVhZHkgZG9uZVxuXHRcdC8vIHdlIG1heSBoYXZlIG11bHRpcGxlIHBob25lIGZpZWxkIG9yIGEgY2MyIGZpZWxkXG5cdFx0aWYgKCFmdi5nZXRGaWVsZCgnY2MyJykpIHtcblx0XHRcdGZ2LnNldEZpZWxkKCdjYzInLCBjYzIpO1xuXHRcdH1cblx0fSxcblx0ZW1haWw6ICh2YWx1ZTogYW55LCBuYW1lOiBzdHJpbmcsIGZ2OiBPV2ViRm9ybVZhbGlkYXRvcikgPT4ge1xuXHRcdC8qKlxuXHRcdCAqIEVtYWlsIG1hdGNoaW5nIHJlZ2V4XG5cdFx0ICpcblx0XHQgKiBzb3VyY2U6IGh0dHA6Ly93d3cudzMub3JnL1RSL2h0bWw1L2Zvcm1zLmh0bWwjdmFsaWQtZS1tYWlsLWFkZHJlc3Ncblx0XHQgKiAgICAgICAgLSBUTEQgbm90IHJlcXVpcmVkXG5cdFx0ICogICAgICAgICAgICAvXlthLXpBLVowLTkuISMkJSYnKisvPT9eX2B7fH1+LV0rQFthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPyg/OlxcLlthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPykqJC9cblx0XHQgKiAgICAgICAgLSBtdXN0IGhhdmUgVExEXG5cdFx0ICogICAgICAgICAgICAvXlthLXpBLVowLTkuISMkJSYnKisvPT9eX2B7fH1+LV0rQFthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPyg/OlxcLlthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPykrJC9cblx0XHQgKi9cblx0XHRjb25zdCBlbWFpbFJlZyA9IC9eW2EtekEtWjAtOS4hIyQlJicqKy89P15fYHt8fX4tXStAW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KD86XFwuW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KSskLztcblx0XHRjb25zdCBlbWFpbCA9IHZhbHVlLnJlcGxhY2UoL1xccy9nLCAnICcpLnRyaW0oKTtcblxuXHRcdGZ2LmFzc2VydChlbWFpbFJlZy50ZXN0KGVtYWlsKSwgJ09aX0ZJRUxEX0VNQUlMX0lOVkFMSUQnKS5zZXRGaWVsZChcblx0XHRcdG5hbWUsXG5cdFx0XHRlbWFpbCxcblx0XHQpO1xuXHR9LFxufSk7XG4iXX0=