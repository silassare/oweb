import OWebFormValidator from "../OWebFormValidator";
import OWebDate from "../plugins/OWebDate";
import Utils from "../utils/Utils";
import OTelInput from "o-tel-input";
OWebFormValidator.addFieldValidators({
    "code": (value, name, fv) => {
        let codeReg = new RegExp(fv.getConfig("OZ_CODE_REG"));
        fv.assert(codeReg.test(value), "OZ_AUTH_CODE_INVALID");
    },
    "uname": (value, name, fv) => {
        value = value.replace(/\s+/g, " ").trim();
        fv.assert(value.length >= fv.getConfig("OZ_USER_NAME_MIN_LENGTH"), "OZ_FIELD_USER_NAME_TOO_SHORT")
            .assert(value.length <= fv.getConfig("OZ_USER_NAME_MAX_LENGTH"), "OZ_FIELD_USER_NAME_TOO_LONG")
            .setField(name, value);
    },
    "login_pass": (value, name, fv) => {
        let pass = value, min = fv.getConfig("OZ_PASS_MIN_LENGTH"), max = fv.getConfig("OZ_PASS_MAX_LENGTH");
        fv.assert(pass.length >= min, "OZ_FIELD_PASS_INVALID")
            .assert(pass.length <= max, "OZ_FIELD_PASS_INVALID");
    },
    "cpass": (value, name, fv) => {
        let pass = value, min = fv.getConfig("OZ_PASS_MIN_LENGTH"), max = fv.getConfig("OZ_PASS_MAX_LENGTH");
        fv.assert(pass.length >= min, "OZ_FIELD_PASS_INVALID")
            .assert(pass.length <= max, "OZ_FIELD_PASS_INVALID");
    },
    "pass": (value, name, fv) => {
        let pass = value, min = fv.getConfig("OZ_PASS_MIN_LENGTH"), max = fv.getConfig("OZ_PASS_MAX_LENGTH");
        fv.assert(pass.length >= min, "OZ_FIELD_PASS_TOO_SHORT", { "min": min, "max": max })
            .assert(pass.length <= max, "OZ_FIELD_PASS_TOO_LONG", { "min": min, "max": max });
    },
    "vpass": (value, name, fv) => {
        fv.assert(value === fv.getField("pass"), "OZ_FIELD_PASS_AND_VPASS_NOT_EQUAL");
    },
    "birth_date": (value, name, fv) => {
        let od = new OWebDate(fv.getAppContext(), value), date = od.describe(), min_age = fv.getConfig("OZ_USER_MIN_AGE"), max_age = fv.getConfig("OZ_USER_MAX_AGE"), isValid = date && Utils.isValidAge(date.d, parseInt(date.mm), date.Y, min_age, max_age);
        fv.assert(isValid, "OZ_FIELD_BIRTH_DATE_INVALID", { "input": value, "min": min_age, "max": max_age });
        date && fv.setField(name, `${date.Y}-${date.mm}-${date.d}`);
    },
    "gender": (value, name, fv) => {
        let genders = fv.getConfig("OZ_USER_ALLOWED_GENDERS");
        fv.assert(genders.indexOf(value) >= 0, "OZ_FIELD_GENDER_INVALID");
    },
    "phone": (value, name, fv) => {
        fv.assert(OTelInput.isPhoneNumberPossible(value), "OZ_FIELD_PHONE_INVALID");
        let t = new OTelInput({ "number": value });
        let phone = t.getInput();
        let cc2 = t.getCurrentCountry().cc2;
        fv.setField(name, phone.replace(/[ -]/g, ""));
        // we set only if it is not already done
        // we may have multiple phone field or a cc2 field
        if (!fv.getField("cc2")) {
            fv.setField("cc2", cc2);
        }
    },
    "email": (value, name, fv) => {
        /**
         * Email matching regex
         *
         * source: http://www.w3.org/TR/html5/forms.html#valid-e-mail-address
         *        - TLD not required
         *            /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/
         *        - must have TLD
         *            /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/
         */
        let emailReg = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/;
        let email = value.replace(/\s/g, " ").trim();
        fv.assert(emailReg.test(email), "OZ_FIELD_EMAIL_INVALID")
            .setField(name, email);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnYuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZGVmYXVsdC9mdi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLGlCQUFpQixNQUFNLHNCQUFzQixDQUFDO0FBQ3JELE9BQU8sUUFBUSxNQUFNLHFCQUFxQixDQUFDO0FBQzNDLE9BQU8sS0FBSyxNQUFNLGdCQUFnQixDQUFDO0FBQ25DLE9BQU8sU0FBUyxNQUFNLGFBQWEsQ0FBQztBQUVwQyxpQkFBaUIsQ0FBQyxrQkFBa0IsQ0FBQztJQUNwQyxNQUFNLEVBQVEsQ0FBQyxLQUFVLEVBQUUsSUFBWSxFQUFFLEVBQXFCLEVBQUUsRUFBRTtRQUNqRSxJQUFJLE9BQU8sR0FBRyxJQUFJLE1BQU0sQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDdEQsRUFBRSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLHNCQUFzQixDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUNELE9BQU8sRUFBTyxDQUFDLEtBQVUsRUFBRSxJQUFZLEVBQUUsRUFBcUIsRUFBRSxFQUFFO1FBQ2pFLEtBQUssR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUUxQyxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLFNBQVMsQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFLDhCQUE4QixDQUFDO2FBQy9GLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxTQUFTLENBQUMseUJBQXlCLENBQUMsRUFBRSw2QkFBNkIsQ0FBQzthQUM5RixRQUFRLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFDRCxZQUFZLEVBQUUsQ0FBQyxLQUFVLEVBQUUsSUFBWSxFQUFFLEVBQXFCLEVB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QUN0SixJQUFJLEtBQUssR0FBTSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUVoRCxFQUFFLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsd0JBQXdCLENBQUM7YUFDdEQsUUFBUSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztJQUMxQixDQUFDO0NBQ0QsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9XZWJGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9PV2ViRm9ybVZhbGlkYXRvclwiO1xuaW1wb3J0IE9XZWJEYXRlIGZyb20gXCIuLi9wbHVnaW5zL09XZWJEYXRlXCI7XG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4uL3V0aWxzL1V0aWxzXCI7XG5pbXBvcnQgT1RlbElucHV0IGZyb20gXCJvLXRlbC1pbnB1dFwiO1xuXG5PV2ViRm9ybVZhbGlkYXRvci5hZGRGaWVsZFZhbGlkYXRvcnMoe1xuXHRcImNvZGVcIiAgICAgIDogKHZhbHVlOiBhbnksIG5hbWU6IHN0cmluZywgZnY6IE9XZWJGb3JtVmFsaWRhdG9yKSA9PiB7XG5cdFx0bGV0IGNvZGVSZWcgPSBuZXcgUmVnRXhwKGZ2LmdldENvbmZpZyhcIk9aX0NPREVfUkVHXCIpKTtcblx0XHRmdi5hc3NlcnQoY29kZVJlZy50ZXN0KHZhbHVlKSwgXCJPWl9BVVRIX0NPREVfSU5WQUxJRFwiKTtcblx0fSxcblx0XCJ1bmFtZVwiICAgICA6ICh2YWx1ZTogYW55LCBuYW1lOiBzdHJpbmcsIGZ2OiBPV2ViRm9ybVZhbGlkYXRvcikgPT4ge1xuXHRcdHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxzKy9nLCBcIiBcIikudHJpbSgpO1xuXG5cdFx0ZnYuYXNzZXJ0KHZhbHVlLmxlbmd0aCA+PSBmdi5nZXRDb25maWcoXCJPWl9VU0VSX05BTUVfTUlOX0xFTkdUSFwiKSwgXCJPWl9GSUVMRF9VU0VSX05BTUVfVE9PX1NIT1JUXCIpXG5cdFx0ICAuYXNzZXJ0KHZhbHVlLmxlbmd0aCA8PSBmdi5nZXRDb25maWcoXCJPWl9VU0VSX05BTUVfTUFYX0xFTkdUSFwiKSwgXCJPWl9GSUVMRF9VU0VSX05BTUVfVE9PX0xPTkdcIilcblx0XHQgIC5zZXRGaWVsZChuYW1lLCB2YWx1ZSk7XG5cdH0sXG5cdFwibG9naW5fcGFzc1wiOiAodmFsdWU6IGFueSwgbmFtZTogc3RyaW5nLCBmdjogT1dlYkZvcm1WYWxpZGF0b3IpID0+IHtcblx0XHRsZXQgcGFzcyA9IHZhbHVlLFxuXHRcdFx0bWluICA9IGZ2LmdldENvbmZpZyhcIk9aX1BBU1NfTUlOX0xFTkdUSFwiKSxcblx0XHRcdG1heCAgPSBmdi5nZXRDb25maWcoXCJPWl9QQVNTX01BWF9MRU5HVEhcIik7XG5cdFx0ZnYuYXNzZXJ0KHBhc3MubGVuZ3RoID49IG1pbiwgXCJPWl9GSUVMRF9QQVNTX0lOVkFMSURcIilcblx0XHQgIC5hc3NlcnQocGFzcy5sZW5ndGggPD0gbWF4LCBcIk9aX0ZJRUxEX1BBU1NfSU5WQUxJRFwiKTtcblx0fSxcblx0XCJjcGFzc1wiICAgICA6ICh2YWx1ZTogYW55LCBuYW1lOiBzdHJpbmcsIGZ2OiBPV2ViRm9ybVZhbGlkYXRvcikgPT4ge1xuXHRcdGxldCBwYXNzID0gdmFsdWUsXG5cdFx0XHRtaW4gID0gZnYuZ2V0Q29uZmlnKFwiT1pfUEFTU19NSU5fTEVOR1RIXCIpLFxuXHRcdFx0bWF4ICA9IGZ2LmdldENvbmZpZyhcIk9aX1BBU1NfTUFYX0xFTkdUSFwiKTtcblx0XHRmdi5hc3NlcnQocGFzcy5sZW5ndGggPj0gbWluLCBcIk9aX0ZJRUxEX1BBU1NfSU5WQUxJRFwiKVxuXHRcdCAgLmFzc2VydChwYXNzLmxlbmd0aCA8PSBtYXgsIFwiT1pfRklFTERfUEFTU19JTlZBTElEXCIpO1xuXHR9LFxuXHRcInBhc3NcIiAgICAgIDogKHZhbHVlOiBhbnksIG5hbWU6IHN0cmluZywgZnY6IE9XZWJGb3JtVmFsaWRhdG9yKSA9PiB7XG5cdFx0bGV0IHBhc3MgPSB2YWx1ZSxcblx0XHRcdG1pbiAgPSBmdi5nZXRDb25maWcoXCJPWl9QQVNTX01JTl9MRU5HVEhcIiksXG5cdFx0XHRtYXggID0gZnYuZ2V0Q29uZmlnKFwiT1pfUEFTU19NQVhfTEVOR1RIXCIpO1xuXHRcdGZ2LmFzc2VydChwYXNzLmxlbmd0aCA+PSBtaW4sIFwiT1pfRklFTERfUEFTU19UT09fU0hPUlRcIiwge1wibWluXCI6IG1pbiwgXCJtYXhcIjogbWF4fSlcblx0XHQgIC5hc3NlcnQocGFzcy5sZW5ndGggPD0gbWF4LCBcIk9aX0ZJRUxEX1BBU1NfVE9PX0xPTkdcIiwge1wibWluXCI6IG1pbiwgXCJtYXhcIjogbWF4fSk7XG5cdH0sXG5cdFwidnBhc3NcIiAgICAgOiAodmFsdWU6IGFueSwgbmFtZTogc3RyaW5nLCBmdjogT1dlYkZvcm1WYWxpZGF0b3IpID0+IHtcblx0XHRmdi5hc3NlcnQodmFsdWUgPT09IGZ2LmdldEZpZWxkKFwicGFzc1wiKSwgXCJPWl9GSUVMRF9QQVNTX0FORF9WUEFTU19OT1RfRVFVQUxcIik7XG5cdH0sXG5cdFwiYmlydGhfZGF0ZVwiOiAodmFsdWU6IGFueSwgbmFtZTogc3RyaW5nLCBmdjogT1dlYkZvcm1WYWxpZGF0b3IpID0+IHtcblx0XHRsZXQgb2QgICAgICA9IG5ldyBPV2ViRGF0ZShmdi5nZXRBcHBDb250ZXh0KCksIHZhbHVlKSxcblx0XHRcdGRhdGUgICAgPSBvZC5kZXNjcmliZSgpLFxuXHRcdFx0bWluX2FnZSA9IGZ2LmdldENvbmZpZyhcIk9aX1VTRVJfTUlOX0FHRVwiKSxcblx0XHRcdG1heF9hZ2UgPSBmdi5nZXRDb25maWcoXCJPWl9VU0VSX01BWF9BR0VcIiksXG5cdFx0XHRpc1ZhbGlkID0gZGF0ZSAmJiBVdGlscy5pc1ZhbGlkQWdlKGRhdGUuZCwgcGFyc2VJbnQoZGF0ZS5tbSksIGRhdGUuWSwgbWluX2FnZSwgbWF4X2FnZSk7XG5cblx0XHRmdi5hc3NlcnQoaXNWYWxpZCwgXCJPWl9GSUVMRF9CSVJUSF9EQVRFX0lOVkFMSURcIiwge1wiaW5wdXRcIjogdmFsdWUsIFwibWluXCI6IG1pbl9hZ2UsIFwibWF4XCI6IG1heF9hZ2V9KTtcblxuXHRcdGRhdGUgJiYgZnYuc2V0RmllbGQobmFtZSwgYCR7ZGF0ZS5ZfS0ke2RhdGUubW19LSR7ZGF0ZS5kfWApO1xuXHR9LFxuXHRcImdlbmRlclwiICAgIDogKHZhbHVlOiBhbnksIG5hbWU6IHN0cmluZywgZnY6IE9XZWJGb3JtVmFsaWRhdG9yKSA9PiB7XG5cdFx0bGV0IGdlbmRlcnMgPSBmdi5nZXRDb25maWcoXCJPWl9VU0VSX0FMTE9XRURfR0VOREVSU1wiKTtcblx0XHRmdi5hc3NlcnQoZ2VuZGVycy5pbmRleE9mKHZhbHVlKSA+PSAwLCBcIk9aX0ZJRUxEX0dFTkRFUl9JTlZBTElEXCIpO1xuXHR9LFxuXHRcInBob25lXCIgICAgIDogKHZhbHVlOiBhbnksIG5hbWU6IHN0cmluZywgZnY6IE9XZWJGb3JtVmFsaWRhdG9yKSA9PiB7XG5cdFx0ZnYuYXNzZXJ0KE9UZWxJbnB1dC5pc1Bob25lTnVtYmVyUG9zc2libGUodmFsdWUpLCBcIk9aX0ZJRUxEX1BIT05FX0lOVkFMSURcIik7XG5cblx0XHRsZXQgdCAgICAgPSBuZXcgT1RlbElucHV0KHtcIm51bWJlclwiOiB2YWx1ZX0pO1xuXHRcdGxldCBwaG9uZSA9IHQuZ2V0SW5wdXQoKTtcblx0XHRsZXQgY2MyICAgPSB0LmdldEN1cnJlbnRDb3VudHJ5KCkuY2MyO1xuXG5cdFx0ZnYuc2V0RmllbGQobmFtZSwgcGhvbmUucmVwbGFjZSgvWyAtXS9nLCBcIlwiKSk7XG5cblx0XHQvLyB3ZSBzZXQgb25seSBpZiBpdCBpcyBub3QgYWxyZWFkeSBkb25lXG5cdFx0Ly8gd2UgbWF5IGhhdmUgbXVsdGlwbGUgcGhvbmUgZmllbGQgb3IgYSBjYzIgZmllbGRcblx0XHRpZiAoIWZ2LmdldEZpZWxkKFwiY2MyXCIpKSB7XG5cdFx0XHRmdi5zZXRGaWVsZChcImNjMlwiLCBjYzIpO1xuXHRcdH1cblx0fSxcblx0XCJlbWFpbFwiICAgICA6ICh2YWx1ZTogYW55LCBuYW1lOiBzdHJpbmcsIGZ2OiBPV2ViRm9ybVZhbGlkYXRvcikgPT4ge1xuXHRcdC8qKlxuXHRcdCAqIEVtYWlsIG1hdGNoaW5nIHJlZ2V4XG5cdFx0ICpcblx0XHQgKiBzb3VyY2U6IGh0dHA6Ly93d3cudzMub3JnL1RSL2h0bWw1L2Zvcm1zLmh0bWwjdmFsaWQtZS1tYWlsLWFkZHJlc3Ncblx0XHQgKiAgICAgICAgLSBUTEQgbm90IHJlcXVpcmVkXG5cdFx0ICogICAgICAgICAgICAvXlthLXpBLVowLTkuISMkJSYnKisvPT9eX2B7fH1+LV0rQFthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPyg/OlxcLlthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPykqJC9cblx0XHQgKiAgICAgICAgLSBtdXN0IGhhdmUgVExEXG5cdFx0ICogICAgICAgICAgICAvXlthLXpBLVowLTkuISMkJSYnKisvPT9eX2B7fH1+LV0rQFthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPyg/OlxcLlthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPykrJC9cblx0XHQgKi9cblx0XHRsZXQgZW1haWxSZWcgPSAvXlthLXpBLVowLTkuISMkJSYnKisvPT9eX2B7fH1+LV0rQFthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPyg/OlxcLlthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPykrJC87XG5cdFx0bGV0IGVtYWlsICAgID0gdmFsdWUucmVwbGFjZSgvXFxzL2csIFwiIFwiKS50cmltKCk7XG5cblx0XHRmdi5hc3NlcnQoZW1haWxSZWcudGVzdChlbWFpbCksIFwiT1pfRklFTERfRU1BSUxfSU5WQUxJRFwiKVxuXHRcdCAgLnNldEZpZWxkKG5hbWUsIGVtYWlsKTtcblx0fVxufSk7Il19