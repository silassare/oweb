const FORMAT_REG = /(?<!\\)(?:\\\\)*(ms|ss|ii|hh|mm|ll|A|a|s|i|H|h|y|Y|m|F|M|d|l|L|D)/g;
export default class OWebDate {
    _appContext;
    date;
    constructor(_appContext, date = new Date()) {
        this._appContext = _appContext;
        this.date = date;
    }
    /**
     * Format date with a given format.
     *
     * @param format
     */
    format(format = 'OW_TIME_DEFAULT_FORMAT') {
        format = this._appContext.i18n.toHuman(format);
        const o = this.describe();
        return format.replace(FORMAT_REG, function stringChunkReplacer(...args) {
            return o[args[1]];
        });
    }
    fromNow() {
        return this.format(this.compare(this.date, Date.now()).format);
    }
    compare(_startDate, _endDate) {
        const startDate = new Date(_startDate);
        const endDate = new Date(_endDate);
        let format;
        const start = {
            time: startDate.getTime(),
            year: startDate.getFullYear(),
            month: startDate.getMonth(),
            date: startDate.getDate(),
            hour: startDate.getHours(),
            minute: startDate.getMinutes(),
        };
        const end = {
            time: endDate.getTime(),
            year: endDate.getFullYear(),
            month: endDate.getMonth(),
            date: endDate.getDate(),
            hour: endDate.getHours(),
            minute: endDate.getMinutes(),
        };
        const aSecond = 1000;
        const aMinute = 60 * aSecond;
        const anHour = 60 * aMinute;
        const aDay = 24 * anHour;
        const aWeek = 7 * aDay;
        const inPast = start.time > end.time;
        const msCount = Math.abs(start.time - end.time);
        const nSeconds = Math.floor(msCount / aSecond);
        const nMinutes = Math.floor(msCount / aMinute);
        const nHours = Math.floor(msCount / anHour);
        const nDays = Math.floor(msCount / aDay);
        const nWeeks = Math.floor(msCount / aWeek);
        const nMonths = Math.abs(end.year - start.year) * 12 + (end.month - start.month);
        const nYears = Math.floor(nMonths / 12);
        if (nSeconds < 5) {
            format = inPast ? 'OW_TIME_JUST_NOW' : 'OW_TIME_IN_FEW_SECONDS';
        }
        else if (nSeconds < 10) {
            format = inPast ? 'OW_TIME_FEW_SECONDS_AGO' : 'OW_TIME_IN_FEW_SECONDS';
        }
        else if (nSeconds < 55) {
            format = inPast ? 'OW_TIME_N_SECONDS_AGO' : 'OW_TIME_IN_N_SECONDS';
        }
        else if (nSeconds < 60) {
            format = inPast
                ? 'OW_TIME_LESS_THAN_A_MINUTE_AGO'
                : 'OW_TIME_IN_LESS_THAN_A_MINUTE';
        }
        else if (nSeconds < 70) {
            format = inPast
                ? 'OW_TIME_ABOUT_A_MINUTE_AGO'
                : 'OW_TIME_IN_ABOUT_A_MINUTE';
        }
        else if (nMinutes < 55) {
            format = inPast ? 'OW_TIME_N_MINUTES_AGO' : 'OW_TIME_IN_N_MINUTES';
        }
        else if (nMinutes < 70) {
            format = inPast
                ? 'OW_TIME_ABOUT_AN_HOUR_AGO'
                : 'OW_TIME_IN_ABOUT_AN_HOUR';
        }
        else if (nHours < 24) {
            format = inPast ? 'OW_TIME_N_HOURS_AGO' : 'OW_TIME_IN_N_HOURS';
        }
        else if (nDays < 7) {
            format = inPast ? 'OW_TIME_N_DAYS_AGO' : 'OW_TIME_IN_N_DAYS';
        }
        else if (nWeeks < 4) {
            format = inPast ? 'OW_TIME_N_WEEKS_AGO' : 'OW_TIME_IN_N_WEEKS';
        }
        else if (nMonths < 12) {
            format = inPast ? 'OW_TIME_N_MONTHS_AGO' : 'OW_TIME_IN_N_MONTHS';
        }
        else {
            format = inPast ? 'OW_TIME_N_YEARS_AGO' : 'OW_TIME_IN_N_YEARS';
        }
        // used in an elapse time or duration counter
        const cSeconds = Math.floor((msCount / aSecond) % 60);
        const cMinutes = Math.floor((msCount / aMinute) % 60);
        const cHours = Math.floor((msCount / anHour) % 24);
        const cDays = Math.floor(msCount / aDay);
        return {
            format,
            nSeconds,
            nMinutes,
            nHours,
            nDays,
            nWeeks,
            nMonths,
            nYears,
            inPast,
            cDays,
            cHours,
            cMinutes,
            cSeconds,
        };
    }
    /**
     * Returns date description object.
     */
    describe() {
        const i18n = this._appContext.i18n, dayNamesShort = i18n.toHuman('OW_TIME_DAY_NAMES_SHORT').split(','), dayNamesFull = i18n.toHuman('OW_TIME_DAY_NAMES_FULL').split(','), monthNamesShort = i18n.toHuman('OW_TIME_MONTH_NAMES_SHORT').split(','), monthNamesFull = i18n.toHuman('OW_TIME_MONTH_NAMES_FULL').split(','), date = new Date(this.date), y = date.getYear(), Y = date.getFullYear(), m = date.getMonth(), mm = String(m < 9 ? '0' + (m + 1) : m + 1), d = date.getDate(), l = date.getDay(), ll = l + 1, // l? l : 7,
        L = dayNamesFull[l], D = dayNamesShort[l], M = monthNamesShort[m], F = monthNamesFull[m], H = date.getHours(), h = H === 12 ? 12 : H % 12, hh = String(m <= 9 ? '0' + m : m), i = date.getMinutes(), ii = String(i < 10 ? '0' + i : i), s = date.getSeconds(), ss = String(s < 10 ? '0' + s : s), ms = date.getMilliseconds(), a = H < 12 ? 'am' : 'pm', A = a.toUpperCase();
        return {
            D,
            L,
            l,
            ll,
            d,
            M,
            F,
            m,
            mm,
            Y,
            y,
            h,
            hh,
            H,
            i,
            ii,
            s,
            ss,
            ms,
            a,
            A,
            ...this.compare(this.date, Date.now()),
        };
    }
    /**
     * Date setter.
     *
     * @param date
     */
    setDate(date) {
        this.date = new Date(date);
        return this;
    }
    /**
     * Date getter.
     */
    getDate() {
        return this.date;
    }
    /**
     * Returns unix like timestamp.
     */
    static timestamp() {
        return Number(String(Date.now()).slice(0, -3));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1dlYkRhdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvcGx1Z2lucy9PV2ViRGF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE4QkEsTUFBTSxVQUFVLEdBQ2Ysb0VBQW9FLENBQUM7QUFFdEUsTUFBTSxDQUFDLE9BQU8sT0FBTyxRQUFRO0lBRW5CO0lBQ0E7SUFGVCxZQUNTLFdBQW9CLEVBQ3BCLE9BQW1CLElBQUksSUFBSSxFQUFFO1FBRDdCLGdCQUFXLEdBQVgsV0FBVyxDQUFTO1FBQ3BCLFNBQUksR0FBSixJQUFJLENBQXlCO0lBQ25DLENBQUM7SUFFSjs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLE1BQU0sR0FBRyx3QkFBd0I7UUFDdkMsTUFBTSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUUvQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFTLENBQUM7UUFDakMsT0FBTyxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxTQUFTLG1CQUFtQixDQUFDLEdBQUcsSUFBSTtZQUNyRSxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztJQUNKLENBQUM7SUFFRCxPQUFPO1FBQ04sT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBRUQsT0FBTyxDQUFDLFVBQXNCLEVBQUUsUUFBb0I7UUFDbkQsTUFBTSxTQUFTLEdBQUcsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDdkMsTUFBTSxPQUFPLEdBQUcsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbkMsSUFBSSxNQUFjLENB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QUMsV0FBVyxFQUFFLEVBQzlCLENBQUMsR0FBVyxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQzNCLEVBQUUsR0FBRyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQzFDLENBQUMsR0FBVyxJQUFJLENBQUMsT0FBTyxFQUFFLEVBQzFCLENBQUMsR0FBVyxJQUFJLENBQUMsTUFBTSxFQUFFLEVBQ3pCLEVBQUUsR0FBVyxDQUFDLEdBQUcsQ0FBQyxFQUFFLFlBQVk7UUFDaEMsQ0FBQyxHQUFXLFlBQVksQ0FBQyxDQUFDLENBQUMsRUFDM0IsQ0FBQyxHQUFXLGFBQWEsQ0FBQyxDQUFDLENBQUMsRUFDNUIsQ0FBQyxHQUFXLGVBQWUsQ0FBQyxDQUFDLENBQUMsRUFDOUIsQ0FBQyxHQUFXLGNBQWMsQ0FBQyxDQUFDLENBQUMsRUFDN0IsQ0FBQyxHQUFXLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFDM0IsQ0FBQyxHQUFXLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFDbEMsRUFBRSxHQUFHLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFDakMsQ0FBQyxHQUFXLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFDN0IsRUFBRSxHQUFHLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFDakMsQ0FBQyxHQUFXLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFDN0IsRUFBRSxHQUFHLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFDakMsRUFBRSxHQUFXLElBQUksQ0FBQyxlQUFlLEVBQUUsRUFDbkMsQ0FBQyxHQUFXLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUNoQyxDQUFDLEdBQVcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBRTdCLE9BQU87WUFDTixDQUFDO1lBQ0QsQ0FBQztZQUNELENBQUM7WUFDRCxFQUFFO1lBQ0YsQ0FBQztZQUNELENBQUM7WUFDRCxDQUFDO1lBQ0QsQ0FBQztZQUNELEVBQUU7WUFDRixDQUFDO1lBQ0QsQ0FBQztZQUNELENBQUM7WUFDRCxFQUFFO1lBQ0YsQ0FBQztZQUNELENBQUM7WUFDRCxFQUFFO1lBQ0YsQ0FBQztZQUNELEVBQUU7WUFDRixFQUFFO1lBQ0YsQ0FBQztZQUNELENBQUM7WUFDRCxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7U0FDdEMsQ0FBQztJQUNILENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsT0FBTyxDQUFDLElBQWdCO1FBQ3ZCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsT0FBTyxJQUFJLENBQUM7SUFDYixDQUFDO0lBRUQ7O09BRUc7SUFDSCxPQUFPO1FBQ04sT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ2xCLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxTQUFTO1FBQ2YsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2hELENBQUM7Q0FDRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRCBUaGUgZGF5IG9mIHRoZSB3ZWVrIHNob3J0IG5hbWVcbiAqIEwgIFRoZSBkYXkgb2YgdGhlIHdlZWsgZnVsbCBuYW1lXG4gKiBsIFRoZSBkYXkgb2YgdGhlIHdlZWsgMCB0byA2XG4gKiBsbCBUaGUgZGF5IG9mIHRoZSB3ZWVrIDEgdG8gN1xuICogZCBUaGUgZGF5IG9mIHRoZSBtb250aFxuICogTSBUaGUgbmFtZSBvZiB0aGUgbW9udGggaW4gdGhyZWUgb3IgZm91ciBsZXR0ZXJzXG4gKiBGIFRoZSBmdWxsIG5hbWUgb2YgdGhlIG1vbnRoXG4gKiBtIFRoZSBudW1iZXIgb2YgdGhlIG1vbnRoIDAgdG8gMTFcbiAqIG1tIFRoZSBudW1iZXIgb2YgdGhlIG1vbnRoIDAxIHRvIDEyXG4gKiBZIFRoZSB5ZWFyIGluIGZvdXIgZGlnaXRzXG4gKiB5IFRoZSB5ZWFyIGluIHR3byBkaWdpdHNcbiAqIGggVGhlIGhvdXIgdXNpbmcgMCB0byAxMlxuICogSCBUaGUgaG91ciB1c2luZyAwIHRvIDIzXG4gKiBpIFRoZSBtaW51dGVzIDAgdG8gNTlcbiAqIHMgVGhlIHNlY29uZHMgMCB0byA1OVxuICogYSBhbSAvIHBtIERpc3BsYXlcbiAqIEEgQU0gLyBQTSBkaXNwbGF5XG4gKlxuICogaWkgVGhlIG1pbnV0ZXMgMDAsIDAxLC4uLiwgNTlcbiAqIHNzIFRoZSBzZWNvbmRzIDAwLCAwMSwuLi4sIDU5XG4gKiBoaCBUaGUgaG91ciAwMSwuLi4sIDEyXG4gKi9cbmltcG9ydCBPV2ViQXBwIGZyb20gJy4uL09XZWJBcHAnO1xuXG4vKlxuXG4gKi9cbmV4cG9ydCB0eXBlIE9EYXRlVmFsdWUgPSBEYXRlIHwgbnVtYmVyIHwgc3RyaW5nO1xuXG5jb25zdCBGT1JNQVRfUkVHID1cblx0Lyg/PCFcXFxcKSg/OlxcXFxcXFxcKSoobXN8c3N8aWl8aGh8bW18bGx8QXxhfHN8aXxIfGh8eXxZfG18RnxNfGR8bHxMfEQpL2c7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE9XZWJEYXRlIHtcblx0Y29uc3RydWN0b3IoXG5cdFx0cHJpdmF0ZSBfYXBwQ29udGV4dDogT1dlYkFwcCxcblx0XHRwcml2YXRlIGRhdGU6IE9EYXRlVmFsdWUgPSBuZXcgRGF0ZSgpXG5cdCkge31cblxuXHQvKipcblx0ICogRm9ybWF0IGRhdGUgd2l0aCBhIGdpdmVuIGZvcm1hdC5cblx0ICpcblx0ICogQHBhcmFtIGZvcm1hdFxuXHQgKi9cblx0Zm9ybWF0KGZvcm1hdCA9ICdPV19USU1FX0RFRkFVTFRfRk9STUFUJyk6IHN0cmluZyB7XG5cdFx0Zm9ybWF0ID0gdGhpcy5fYXBwQ29udGV4dC5pMThuLnRvSHVtYW4oZm9ybWF0KTtcblxuXHRcdGNvbnN0IG8gPSB0aGlzLmRlc2NyaWJlKCkgYXMgYW55O1xuXHRcdHJldHVybiBmb3JtYXQucmVwbGFjZShGT1JNQVRfUkVHLCBmdW5jdGlvbiBzdHJpbmdDaHVua1JlcGxhY2VyKC4uLmFyZ3MpIHtcblx0XHRcdHJldHVybiBvW2FyZ3NbMV1dO1xuXHRcdH0pO1xuXHR9XG5cblx0ZnJvbU5vdygpOiBzdHJpbmcge1xuXHRcdHJldHVybiB0aGlzLmZvcm1hdCh0aGlzLmNvbXBhcmUodGhpcy5kYXRlLCBEYXRlLm5vdygpKS5mb3JtYXQpO1xuXHR9XG5cblx0Y29tcGFyZShfc3RhcnREYXRlOiBPRGF0ZVZhbHVlLCBfZW5kRGF0ZTogT0RhdGVWYWx1ZSkge1xuXHRcdGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKF9zdGFydERhdGUpO1xuXHRcdGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZShfZW5kRGF0ZSk7XG5cdFx0bGV0IGZvcm1hdDogc3RyaW5nO1xuXG5cdFx0Y29uc3Qgc3RhcnQgPSB7XG5cdFx0XHR0aW1lOiBzdGFydERhdGUuZ2V0VGltZSgpLFxuXHRcdFx0eWVhcjogc3RhcnREYXRlLmdldEZ1bGxZZWFyKCksXG5cdFx0XHRtb250aDogc3RhcnREYXRlLmdldE1vbnRoKCksXG5cdFx0XHRkYXRlOiBzdGFydERhdGUuZ2V0RGF0ZSgpLFxuXHRcdFx0aG91cjogc3RhcnREYXRlLmdldEhvdXJzKCksXG5cdFx0XHRtaW51dGU6IHN0YXJ0RGF0ZS5nZXRNaW51dGVzKCksXG5cdFx0fTtcblx0XHRjb25zdCBlbmQgPSB7XG5cdFx0XHR0aW1lOiBlbmREYXRlLmdldFRpbWUoKSxcblx0XHRcdHllYXI6IGVuZERhdGUuZ2V0RnVsbFllYXIoKSxcblx0XHRcdG1vbnRoOiBlbmREYXRlLmdldE1vbnRoKCksXG5cdFx0XHRkYXRlOiBlbmREYXRlLmdldERhdGUoKSxcblx0XHRcdGhvdXI6IGVuZERhdGUuZ2V0SG91cnMoKSxcblx0XHRcdG1pbnV0ZTogZW5kRGF0ZS5nZXRNaW51dGVzKCksXG5cdFx0fTtcblxuXHRcdGNvbnN0IGFTZWNvbmQgPSAxMDAwO1xuXHRcdGNvbnN0IGFNaW51dGUgPSA2MCAqIGFTZWNvbmQ7XG5cdFx0Y29uc3QgYW5Ib3VyID0gNjAgKiBhTWludXRlO1xuXHRcdGNvbnN0IGFEYXkgPSAyNCAqIGFuSG91cjtcblx0XHRjb25zdCBhV2VlayA9IDcgKiBhRGF5O1xuXG5cdFx0Y29uc3QgaW5QYXN0ID0gc3RhcnQudGltZSA+IGVuZC50aW1lO1xuXHRcdGNvbnN0IG1zQ291bnQgPSBNYXRoLmFicyhzdGFydC50aW1lIC0gZW5kLnRpbWUpO1xuXHRcdGNvbnN0IG5TZWNvbmRzID0gTWF0aC5mbG9vcihtc0NvdW50IC8gYVNlY29uZCk7XG5cdFx0Y29uc3Qgbk1pbnV0ZXMgPSBNYXRoLmZsb29yKG1zQ291bnQgLyBhTWludXRlKTtcblx0XHRjb25zdCBuSG91cnMgPSBNYXRoLmZsb29yKG1zQ291bnQgLyBhbkhvdXIpO1xuXHRcdGNvbnN0IG5EYXlzID0gTWF0aC5mbG9vcihtc0NvdW50IC8gYURheSk7XG5cdFx0Y29uc3QgbldlZWtzID0gTWF0aC5mbG9vcihtc0NvdW50IC8gYVdlZWspO1xuXHRcdGNvbnN0IG5Nb250aHMgPVxuXHRcdFx0TWF0aC5hYnMoZW5kLnllYXIgLSBzdGFydC55ZWFyKSAqIDEyICsgKGVuZC5tb250aCAtIHN0YXJ0Lm1vbnRoKTtcblx0XHRjb25zdCBuWWVhcnMgPSBNYXRoLmZsb29yKG5Nb250aHMgLyAxMik7XG5cblx0XHRpZiAoblNlY29uZHMgPCA1KSB7XG5cdFx0XHRmb3JtYXQgPSBpblBhc3QgPyAnT1dfVElNRV9KVVNUX05PVycgOiAnT1dfVElNRV9JTl9GRVdfU0VDT05EUyc7XG5cdFx0fSBlbHNlIGlmIChuU2Vjb25kcyA8IDEwKSB7XG5cdFx0XHRmb3JtYXQgPSBpblBhc3QgPyAnT1dfVElNRV9GRVdfU0VDT05EU19BR08nIDogJ09XX1RJTUVfSU5fRkVXX1NFQ09ORFMnO1xuXHRcdH0gZWxzZSBpZiAoblNlY29uZHMgPCA1NSkge1xuXHRcdFx0Zm9ybWF0ID0gaW5QYXN0ID8gJ09XX1RJTUVfTl9TRUNPTkRTX0FHTycgOiAnT1dfVElNRV9JTl9OX1NFQ09ORFMnO1xuXHRcdH0gZWxzZSBpZiAoblNlY29uZHMgPCA2MCkge1xuXHRcdFx0Zm9ybWF0ID0gaW5QYXN0XG5cdFx0XHRcdD8gJ09XX1RJTUVfTEVTU19USEFOX0FfTUlOVVRFX0FHTydcblx0XHRcdFx0OiAnT1dfVElNRV9JTl9MRVNTX1RIQU5fQV9NSU5VVEUnO1xuXHRcdH0gZWxzZSBpZiAoblNlY29uZHMgPCA3MCkge1xuXHRcdFx0Zm9ybWF0ID0gaW5QYXN0XG5cdFx0XHRcdD8gJ09XX1RJTUVfQUJPVVRfQV9NSU5VVEVfQUdPJ1xuXHRcdFx0XHQ6ICdPV19USU1FX0lOX0FCT1VUX0FfTUlOVVRFJztcblx0XHR9IGVsc2UgaWYgKG5NaW51dGVzIDwgNTUpIHtcblx0XHRcdGZvcm1hdCA9IGluUGFzdCA/ICdPV19USU1FX05fTUlOVVRFU19BR08nIDogJ09XX1RJTUVfSU5fTl9NSU5VVEVTJztcblx0XHR9IGVsc2UgaWYgKG5NaW51dGVzIDwgNzApIHtcblx0XHRcdGZvcm1hdCA9IGluUGFzdFxuXHRcdFx0XHQ/ICdPV19USU1FX0FCT1VUX0FOX0hPVVJfQUdPJ1xuXHRcdFx0XHQ6ICdPV19USU1FX0lOX0FCT1VUX0FOX0hPVVInO1xuXHRcdH0gZWxzZSBpZiAobkhvdXJzIDwgMjQpIHtcblx0XHRcdGZvcm1hdCA9IGluUGFzdCA/ICdPV19USU1FX05fSE9VUlNfQUdPJyA6ICdPV19USU1FX0lOX05fSE9VUlMnO1xuXHRcdH0gZWxzZSBpZiAobkRheXMgPCA3KSB7XG5cdFx0XHRmb3JtYXQgPSBpblBhc3QgPyAnT1dfVElNRV9OX0RBWVNfQUdPJyA6ICdPV19USU1FX0lOX05fREFZUyc7XG5cdFx0fSBlbHNlIGlmIChuV2Vla3MgPCA0KSB7XG5cdFx0XHRmb3JtYXQgPSBpblBhc3QgPyAnT1dfVElNRV9OX1dFRUtTX0FHTycgOiAnT1dfVElNRV9JTl9OX1dFRUtTJztcblx0XHR9IGVsc2UgaWYgKG5Nb250aHMgPCAxMikge1xuXHRcdFx0Zm9ybWF0ID0gaW5QYXN0ID8gJ09XX1RJTUVfTl9NT05USFNfQUdPJyA6ICdPV19USU1FX0lOX05fTU9OVEhTJztcblx0XHR9IGVsc2Uge1xuXHRcdFx0Zm9ybWF0ID0gaW5QYXN0ID8gJ09XX1RJTUVfTl9ZRUFSU19BR08nIDogJ09XX1RJTUVfSU5fTl9ZRUFSUyc7XG5cdFx0fVxuXG5cdFx0Ly8gdXNlZCBpbiBhbiBlbGFwc2UgdGltZSBvciBkdXJhdGlvbiBjb3VudGVyXG5cdFx0Y29uc3QgY1NlY29uZHMgPSBNYXRoLmZsb29yKChtc0NvdW50IC8gYVNlY29uZCkgJSA2MCk7XG5cdFx0Y29uc3QgY01pbnV0ZXMgPSBNYXRoLmZsb29yKChtc0NvdW50IC8gYU1pbnV0ZSkgJSA2MCk7XG5cdFx0Y29uc3QgY0hvdXJzID0gTWF0aC5mbG9vcigobXNDb3VudCAvIGFuSG91cikgJSAyNCk7XG5cdFx0Y29uc3QgY0RheXMgPSBNYXRoLmZsb29yKG1zQ291bnQgLyBhRGF5KTtcblxuXHRcdHJldHVybiB7XG5cdFx0XHRmb3JtYXQsXG5cdFx0XHRuU2Vjb25kcyxcblx0XHRcdG5NaW51dGVzLFxuXHRcdFx0bkhvdXJzLFxuXHRcdFx0bkRheXMsXG5cdFx0XHRuV2Vla3MsXG5cdFx0XHRuTW9udGhzLFxuXHRcdFx0blllYXJzLFxuXHRcdFx0aW5QYXN0LFxuXHRcdFx0Y0RheXMsXG5cdFx0XHRjSG91cnMsXG5cdFx0XHRjTWludXRlcyxcblx0XHRcdGNTZWNvbmRzLFxuXHRcdH07XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyBkYXRlIGRlc2NyaXB0aW9uIG9iamVjdC5cblx0ICovXG5cdGRlc2NyaWJlKCkge1xuXHRcdGNvbnN0IGkxOG4gPSB0aGlzLl9hcHBDb250ZXh0LmkxOG4sXG5cdFx0XHRkYXlOYW1lc1Nob3J0ID0gaTE4bi50b0h1bWFuKCdPV19USU1FX0RBWV9OQU1FU19TSE9SVCcpLnNwbGl0KCcsJyksXG5cdFx0XHRkYXlOYW1lc0Z1bGwgPSBpMThuLnRvSHVtYW4oJ09XX1RJTUVfREFZX05BTUVTX0ZVTEwnKS5zcGxpdCgnLCcpLFxuXHRcdFx0bW9udGhOYW1lc1Nob3J0ID0gaTE4bi50b0h1bWFuKCdPV19USU1FX01PTlRIX05BTUVTX1NIT1JUJykuc3BsaXQoJywnKSxcblx0XHRcdG1vbnRoTmFtZXNGdWxsID0gaTE4bi50b0h1bWFuKCdPV19USU1FX01PTlRIX05BTUVTX0ZVTEwnKS5zcGxpdCgnLCcpLFxuXHRcdFx0ZGF0ZSA9IG5ldyBEYXRlKHRoaXMuZGF0ZSksXG5cdFx0XHR5OiBudW1iZXIgPSAoZGF0ZSBhcyBhbnkpLmdldFllYXIoKSxcblx0XHRcdFk6IG51bWJlciA9IGRhdGUuZ2V0RnVsbFllYXIoKSxcblx0XHRcdG06IG51bWJlciA9IGRhdGUuZ2V0TW9udGgoKSxcblx0XHRcdG1tID0gU3RyaW5nKG0gPCA5ID8gJzAnICsgKG0gKyAxKSA6IG0gKyAxKSxcblx0XHRcdGQ6IG51bWJlciA9IGRhdGUuZ2V0RGF0ZSgpLFxuXHRcdFx0bDogbnVtYmVyID0gZGF0ZS5nZXREYXkoKSxcblx0XHRcdGxsOiBudW1iZXIgPSBsICsgMSwgLy8gbD8gbCA6IDcsXG5cdFx0XHRMOiBzdHJpbmcgPSBkYXlOYW1lc0Z1bGxbbF0sXG5cdFx0XHREOiBzdHJpbmcgPSBkYXlOYW1lc1Nob3J0W2xdLFxuXHRcdFx0TTogc3RyaW5nID0gbW9udGhOYW1lc1Nob3J0W21dLFxuXHRcdFx0Rjogc3RyaW5nID0gbW9udGhOYW1lc0Z1bGxbbV0sXG5cdFx0XHRIOiBudW1iZXIgPSBkYXRlLmdldEhvdXJzKCksXG5cdFx0XHRoOiBudW1iZXIgPSBIID09PSAxMiA/IDEyIDogSCAlIDEyLFxuXHRcdFx0aGggPSBTdHJpbmcobSA8PSA5ID8gJzAnICsgbSA6IG0pLFxuXHRcdFx0aTogbnVtYmVyID0gZGF0ZS5nZXRNaW51dGVzKCksXG5cdFx0XHRpaSA9IFN0cmluZyhpIDwgMTAgPyAnMCcgKyBpIDogaSksXG5cdFx0XHRzOiBudW1iZXIgPSBkYXRlLmdldFNlY29uZHMoKSxcblx0XHRcdHNzID0gU3RyaW5nKHMgPCAxMCA/ICcwJyArIHMgOiBzKSxcblx0XHRcdG1zOiBudW1iZXIgPSBkYXRlLmdldE1pbGxpc2Vjb25kcygpLFxuXHRcdFx0YTogc3RyaW5nID0gSCA8IDEyID8gJ2FtJyA6ICdwbScsXG5cdFx0XHRBOiBzdHJpbmcgPSBhLnRvVXBwZXJDYXNlKCk7XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0RCxcblx0XHRcdEwsXG5cdFx0XHRsLFxuXHRcdFx0bGwsXG5cdFx0XHRkLFxuXHRcdFx0TSxcblx0XHRcdEYsXG5cdFx0XHRtLFxuXHRcdFx0bW0sXG5cdFx0XHRZLFxuXHRcdFx0eSxcblx0XHRcdGgsXG5cdFx0XHRoaCxcblx0XHRcdEgsXG5cdFx0XHRpLFxuXHRcdFx0aWksXG5cdFx0XHRzLFxuXHRcdFx0c3MsXG5cdFx0XHRtcyxcblx0XHRcdGEsXG5cdFx0XHRBLFxuXHRcdFx0Li4udGhpcy5jb21wYXJlKHRoaXMuZGF0ZSwgRGF0ZS5ub3coKSksXG5cdFx0fTtcblx0fVxuXG5cdC8qKlxuXHQgKiBEYXRlIHNldHRlci5cblx0ICpcblx0ICogQHBhcmFtIGRhdGVcblx0ICovXG5cdHNldERhdGUoZGF0ZTogT0RhdGVWYWx1ZSk6IHRoaXMge1xuXHRcdHRoaXMuZGF0ZSA9IG5ldyBEYXRlKGRhdGUpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqXG5cdCAqIERhdGUgZ2V0dGVyLlxuXHQgKi9cblx0Z2V0RGF0ZSgpOiBPRGF0ZVZhbHVlIHtcblx0XHRyZXR1cm4gdGhpcy5kYXRlO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgdW5peCBsaWtlIHRpbWVzdGFtcC5cblx0ICovXG5cdHN0YXRpYyB0aW1lc3RhbXAoKTogbnVtYmVyIHtcblx0XHRyZXR1cm4gTnVtYmVyKFN0cmluZyhEYXRlLm5vdygpKS5zbGljZSgwLCAtMykpO1xuXHR9XG59XG4iXX0=