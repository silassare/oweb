const FORMAT_REG = /(?<!\\)(?:\\\\)*(ms|ss|ii|hh|mm|ll|A|a|s|i|H|h|y|Y|m|F|M|d|l|L|D)/g;
export default class OWebDate {
    _appContext;
    date;
    constructor(_appContext, date = new Date()) {
        this._appContext = _appContext;
        this.date = date;
    }
    /**
     * Format date with a given format.
     */
    format(format = 'OW_TIME_DEFAULT_FORMAT', isLangKey = false) {
        const o = this.describe();
        if (isLangKey) {
            return this._appContext.i18n.toHuman(format, o);
        }
        return format.replace(FORMAT_REG, function stringChunkReplacer(...args) {
            return o[args[1]];
        });
    }
    fromNow() {
        return this.format(this.compare(this.date, Date.now()).format, true);
    }
    compare(_startDate, _endDate) {
        const startDate = new Date(_startDate);
        const endDate = new Date(_endDate);
        let format;
        const start = {
            time: startDate.getTime(),
            year: startDate.getFullYear(),
            month: startDate.getMonth(),
            date: startDate.getDate(),
            hour: startDate.getHours(),
            minute: startDate.getMinutes(),
        };
        const end = {
            time: endDate.getTime(),
            year: endDate.getFullYear(),
            month: endDate.getMonth(),
            date: endDate.getDate(),
            hour: endDate.getHours(),
            minute: endDate.getMinutes(),
        };
        const aSecond = 1000;
        const aMinute = 60 * aSecond;
        const anHour = 60 * aMinute;
        const aDay = 24 * anHour;
        const aWeek = 7 * aDay;
        const inPast = start.time > end.time;
        const msCount = Math.abs(start.time - end.time);
        const nSeconds = Math.floor(msCount / aSecond);
        const nMinutes = Math.floor(msCount / aMinute);
        const nHours = Math.floor(msCount / anHour);
        const nDays = Math.floor(msCount / aDay);
        const nWeeks = Math.floor(msCount / aWeek);
        const nMonths = Math.abs(end.year - start.year) * 12 + (end.month - start.month);
        const nYears = Math.floor(nMonths / 12);
        if (nSeconds < 5) {
            format = inPast ? 'OW_TIME_JUST_NOW' : 'OW_TIME_IN_FEW_SECONDS';
        }
        else if (nSeconds < 10) {
            format = inPast ? 'OW_TIME_FEW_SECONDS_AGO' : 'OW_TIME_IN_FEW_SECONDS';
        }
        else if (nSeconds < 55) {
            format = inPast ? 'OW_TIME_N_SECONDS_AGO' : 'OW_TIME_IN_N_SECONDS';
        }
        else if (nSeconds < 60) {
            format = inPast
                ? 'OW_TIME_LESS_THAN_A_MINUTE_AGO'
                : 'OW_TIME_IN_LESS_THAN_A_MINUTE';
        }
        else if (nSeconds < 70) {
            format = inPast
                ? 'OW_TIME_ABOUT_A_MINUTE_AGO'
                : 'OW_TIME_IN_ABOUT_A_MINUTE';
        }
        else if (nMinutes < 55) {
            format = inPast ? 'OW_TIME_N_MINUTES_AGO' : 'OW_TIME_IN_N_MINUTES';
        }
        else if (nMinutes < 70) {
            format = inPast
                ? 'OW_TIME_ABOUT_AN_HOUR_AGO'
                : 'OW_TIME_IN_ABOUT_AN_HOUR';
        }
        else if (nHours < 24) {
            format = inPast ? 'OW_TIME_N_HOURS_AGO' : 'OW_TIME_IN_N_HOURS';
        }
        else if (nDays < 7) {
            format = inPast ? 'OW_TIME_N_DAYS_AGO' : 'OW_TIME_IN_N_DAYS';
        }
        else if (nWeeks < 4) {
            format = inPast ? 'OW_TIME_N_WEEKS_AGO' : 'OW_TIME_IN_N_WEEKS';
        }
        else if (nMonths < 12) {
            format = inPast ? 'OW_TIME_N_MONTHS_AGO' : 'OW_TIME_IN_N_MONTHS';
        }
        else {
            format = inPast ? 'OW_TIME_N_YEARS_AGO' : 'OW_TIME_IN_N_YEARS';
        }
        // used in an elapse time or duration counter
        const cSeconds = Math.floor((msCount / aSecond) % 60);
        const cMinutes = Math.floor((msCount / aMinute) % 60);
        const cHours = Math.floor((msCount / anHour) % 24);
        const cDays = Math.floor(msCount / aDay);
        return {
            format,
            nSeconds,
            nMinutes,
            nHours,
            nDays,
            nWeeks,
            nMonths,
            nYears,
            inPast,
            cDays,
            cHours,
            cMinutes,
            cSeconds,
        };
    }
    /**
     * Returns date description object.
     */
    describe() {
        const i18n = this._appContext.i18n, dayNamesShort = i18n.toHuman('OW_TIME_DAY_NAMES_SHORT').split(','), dayNamesFull = i18n.toHuman('OW_TIME_DAY_NAMES_FULL').split(','), monthNamesShort = i18n.toHuman('OW_TIME_MONTH_NAMES_SHORT').split(','), monthNamesFull = i18n.toHuman('OW_TIME_MONTH_NAMES_FULL').split(','), date = new Date(this.date), y = date.getYear(), Y = date.getFullYear(), m = date.getMonth(), mm = String(m < 9 ? '0' + (m + 1) : m + 1), d = date.getDate(), l = date.getDay(), ll = l + 1, // l? l : 7,
        L = dayNamesFull[l], D = dayNamesShort[l], M = monthNamesShort[m], F = monthNamesFull[m], H = date.getHours(), h = H === 12 ? 12 : H % 12, hh = String(m <= 9 ? '0' + m : m), i = date.getMinutes(), ii = String(i < 10 ? '0' + i : i), s = date.getSeconds(), ss = String(s < 10 ? '0' + s : s), ms = date.getMilliseconds(), a = H < 12 ? 'am' : 'pm', A = a.toUpperCase();
        return {
            D,
            L,
            l,
            ll,
            d,
            M,
            F,
            m,
            mm,
            Y,
            y,
            h,
            hh,
            H,
            i,
            ii,
            s,
            ss,
            ms,
            a,
            A,
            ...this.compare(this.date, Date.now()),
        };
    }
    /**
     * Date setter.
     *
     * @param date
     */
    setDate(date) {
        this.date = new Date(date);
        return this;
    }
    /**
     * Date getter.
     */
    getDate() {
        return this.date;
    }
    /**
     * Returns unix like timestamp.
     */
    static timestamp() {
        return Number(String(Date.now()).slice(0, -3));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1dlYkRhdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvcGx1Z2lucy9PV2ViRGF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE4QkEsTUFBTSxVQUFVLEdBQ2Ysb0VBQW9FLENBQUM7QUFFdEUsTUFBTSxDQUFDLE9BQU8sT0FBTyxRQUFRO0lBRW5CO0lBQ0E7SUFGVCxZQUNTLFdBQW9CLEVBQ3BCLE9BQW1CLElBQUksSUFBSSxFQUFFO1FBRDdCLGdCQUFXLEdBQVgsV0FBVyxDQUFTO1FBQ3BCLFNBQUksR0FBSixJQUFJLENBQXlCO0lBQ25DLENBQUM7SUFFSjs7T0FFRztJQUNILE1BQU0sQ0FBQyxNQUFNLEdBQUcsd0JBQXdCLEVBQUUsU0FBUyxHQUFHLEtBQUs7UUFDMUQsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBUyxDQUFDO1FBRWpDLElBQUksU0FBUyxFQUFFO1lBQ2QsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ2hEO1FBRUQsT0FBTyxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxTQUFTLG1CQUFtQixDQUFDLEdBQUcsSUFBSTtZQUNyRSxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztJQUNKLENBQUM7SUFFRCxPQUFPO1FBQ04sT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUVELE9BQU8sQ0FBQyxVQUFzQixFQUFFLFFBQW9CO1FBQ25ELE1BQU0sU0FBUyxHQUFHLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3ZDLE1BQU0s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IGRheSBvZiB0aGUgd2VlayBzaG9ydCBuYW1lXG4gKiBMICBUaGUgZGF5IG9mIHRoZSB3ZWVrIGZ1bGwgbmFtZVxuICogbCBUaGUgZGF5IG9mIHRoZSB3ZWVrIDAgdG8gNlxuICogbGwgVGhlIGRheSBvZiB0aGUgd2VlayAxIHRvIDdcbiAqIGQgVGhlIGRheSBvZiB0aGUgbW9udGhcbiAqIE0gVGhlIG5hbWUgb2YgdGhlIG1vbnRoIGluIHRocmVlIG9yIGZvdXIgbGV0dGVyc1xuICogRiBUaGUgZnVsbCBuYW1lIG9mIHRoZSBtb250aFxuICogbSBUaGUgbnVtYmVyIG9mIHRoZSBtb250aCAwIHRvIDExXG4gKiBtbSBUaGUgbnVtYmVyIG9mIHRoZSBtb250aCAwMSB0byAxMlxuICogWSBUaGUgeWVhciBpbiBmb3VyIGRpZ2l0c1xuICogeSBUaGUgeWVhciBpbiB0d28gZGlnaXRzXG4gKiBoIFRoZSBob3VyIHVzaW5nIDAgdG8gMTJcbiAqIEggVGhlIGhvdXIgdXNpbmcgMCB0byAyM1xuICogaSBUaGUgbWludXRlcyAwIHRvIDU5XG4gKiBzIFRoZSBzZWNvbmRzIDAgdG8gNTlcbiAqIGEgYW0gLyBwbSBEaXNwbGF5XG4gKiBBIEFNIC8gUE0gZGlzcGxheVxuICpcbiAqIGlpIFRoZSBtaW51dGVzIDAwLCAwMSwuLi4sIDU5XG4gKiBzcyBUaGUgc2Vjb25kcyAwMCwgMDEsLi4uLCA1OVxuICogaGggVGhlIGhvdXIgMDEsLi4uLCAxMlxuICovXG5pbXBvcnQgT1dlYkFwcCBmcm9tICcuLi9PV2ViQXBwJztcblxuLypcblxuICovXG5leHBvcnQgdHlwZSBPRGF0ZVZhbHVlID0gRGF0ZSB8IG51bWJlciB8IHN0cmluZztcblxuY29uc3QgRk9STUFUX1JFRyA9XG5cdC8oPzwhXFxcXCkoPzpcXFxcXFxcXCkqKG1zfHNzfGlpfGhofG1tfGxsfEF8YXxzfGl8SHxofHl8WXxtfEZ8TXxkfGx8THxEKS9nO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBPV2ViRGF0ZSB7XG5cdGNvbnN0cnVjdG9yKFxuXHRcdHByaXZhdGUgX2FwcENvbnRleHQ6IE9XZWJBcHAsXG5cdFx0cHJpdmF0ZSBkYXRlOiBPRGF0ZVZhbHVlID0gbmV3IERhdGUoKVxuXHQpIHt9XG5cblx0LyoqXG5cdCAqIEZvcm1hdCBkYXRlIHdpdGggYSBnaXZlbiBmb3JtYXQuXG5cdCAqL1xuXHRmb3JtYXQoZm9ybWF0ID0gJ09XX1RJTUVfREVGQVVMVF9GT1JNQVQnLCBpc0xhbmdLZXkgPSBmYWxzZSk6IHN0cmluZyB7XG5cdFx0Y29uc3QgbyA9IHRoaXMuZGVzY3JpYmUoKSBhcyBhbnk7XG5cblx0XHRpZiAoaXNMYW5nS2V5KSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5fYXBwQ29udGV4dC5pMThuLnRvSHVtYW4oZm9ybWF0LCBvKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZm9ybWF0LnJlcGxhY2UoRk9STUFUX1JFRywgZnVuY3Rpb24gc3RyaW5nQ2h1bmtSZXBsYWNlciguLi5hcmdzKSB7XG5cdFx0XHRyZXR1cm4gb1thcmdzWzFdXTtcblx0XHR9KTtcblx0fVxuXG5cdGZyb21Ob3coKTogc3RyaW5nIHtcblx0XHRyZXR1cm4gdGhpcy5mb3JtYXQodGhpcy5jb21wYXJlKHRoaXMuZGF0ZSwgRGF0ZS5ub3coKSkuZm9ybWF0LCB0cnVlKTtcblx0fVxuXG5cdGNvbXBhcmUoX3N0YXJ0RGF0ZTogT0RhdGVWYWx1ZSwgX2VuZERhdGU6IE9EYXRlVmFsdWUpIHtcblx0XHRjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZShfc3RhcnREYXRlKTtcblx0XHRjb25zdCBlbmREYXRlID0gbmV3IERhdGUoX2VuZERhdGUpO1xuXHRcdGxldCBmb3JtYXQ6IHN0cmluZztcblxuXHRcdGNvbnN0IHN0YXJ0ID0ge1xuXHRcdFx0dGltZTogc3RhcnREYXRlLmdldFRpbWUoKSxcblx0XHRcdHllYXI6IHN0YXJ0RGF0ZS5nZXRGdWxsWWVhcigpLFxuXHRcdFx0bW9udGg6IHN0YXJ0RGF0ZS5nZXRNb250aCgpLFxuXHRcdFx0ZGF0ZTogc3RhcnREYXRlLmdldERhdGUoKSxcblx0XHRcdGhvdXI6IHN0YXJ0RGF0ZS5nZXRIb3VycygpLFxuXHRcdFx0bWludXRlOiBzdGFydERhdGUuZ2V0TWludXRlcygpLFxuXHRcdH07XG5cdFx0Y29uc3QgZW5kID0ge1xuXHRcdFx0dGltZTogZW5kRGF0ZS5nZXRUaW1lKCksXG5cdFx0XHR5ZWFyOiBlbmREYXRlLmdldEZ1bGxZZWFyKCksXG5cdFx0XHRtb250aDogZW5kRGF0ZS5nZXRNb250aCgpLFxuXHRcdFx0ZGF0ZTogZW5kRGF0ZS5nZXREYXRlKCksXG5cdFx0XHRob3VyOiBlbmREYXRlLmdldEhvdXJzKCksXG5cdFx0XHRtaW51dGU6IGVuZERhdGUuZ2V0TWludXRlcygpLFxuXHRcdH07XG5cblx0XHRjb25zdCBhU2Vjb25kID0gMTAwMDtcblx0XHRjb25zdCBhTWludXRlID0gNjAgKiBhU2Vjb25kO1xuXHRcdGNvbnN0IGFuSG91ciA9IDYwICogYU1pbnV0ZTtcblx0XHRjb25zdCBhRGF5ID0gMjQgKiBhbkhvdXI7XG5cdFx0Y29uc3QgYVdlZWsgPSA3ICogYURheTtcblxuXHRcdGNvbnN0IGluUGFzdCA9IHN0YXJ0LnRpbWUgPiBlbmQudGltZTtcblx0XHRjb25zdCBtc0NvdW50ID0gTWF0aC5hYnMoc3RhcnQudGltZSAtIGVuZC50aW1lKTtcblx0XHRjb25zdCBuU2Vjb25kcyA9IE1hdGguZmxvb3IobXNDb3VudCAvIGFTZWNvbmQpO1xuXHRcdGNvbnN0IG5NaW51dGVzID0gTWF0aC5mbG9vcihtc0NvdW50IC8gYU1pbnV0ZSk7XG5cdFx0Y29uc3QgbkhvdXJzID0gTWF0aC5mbG9vcihtc0NvdW50IC8gYW5Ib3VyKTtcblx0XHRjb25zdCBuRGF5cyA9IE1hdGguZmxvb3IobXNDb3VudCAvIGFEYXkpO1xuXHRcdGNvbnN0IG5XZWVrcyA9IE1hdGguZmxvb3IobXNDb3VudCAvIGFXZWVrKTtcblx0XHRjb25zdCBuTW9udGhzID1cblx0XHRcdE1hdGguYWJzKGVuZC55ZWFyIC0gc3RhcnQueWVhcikgKiAxMiArIChlbmQubW9udGggLSBzdGFydC5tb250aCk7XG5cdFx0Y29uc3QgblllYXJzID0gTWF0aC5mbG9vcihuTW9udGhzIC8gMTIpO1xuXG5cdFx0aWYgKG5TZWNvbmRzIDwgNSkge1xuXHRcdFx0Zm9ybWF0ID0gaW5QYXN0ID8gJ09XX1RJTUVfSlVTVF9OT1cnIDogJ09XX1RJTUVfSU5fRkVXX1NFQ09ORFMnO1xuXHRcdH0gZWxzZSBpZiAoblNlY29uZHMgPCAxMCkge1xuXHRcdFx0Zm9ybWF0ID0gaW5QYXN0ID8gJ09XX1RJTUVfRkVXX1NFQ09ORFNfQUdPJyA6ICdPV19USU1FX0lOX0ZFV19TRUNPTkRTJztcblx0XHR9IGVsc2UgaWYgKG5TZWNvbmRzIDwgNTUpIHtcblx0XHRcdGZvcm1hdCA9IGluUGFzdCA/ICdPV19USU1FX05fU0VDT05EU19BR08nIDogJ09XX1RJTUVfSU5fTl9TRUNPTkRTJztcblx0XHR9IGVsc2UgaWYgKG5TZWNvbmRzIDwgNjApIHtcblx0XHRcdGZvcm1hdCA9IGluUGFzdFxuXHRcdFx0XHQ/ICdPV19USU1FX0xFU1NfVEhBTl9BX01JTlVURV9BR08nXG5cdFx0XHRcdDogJ09XX1RJTUVfSU5fTEVTU19USEFOX0FfTUlOVVRFJztcblx0XHR9IGVsc2UgaWYgKG5TZWNvbmRzIDwgNzApIHtcblx0XHRcdGZvcm1hdCA9IGluUGFzdFxuXHRcdFx0XHQ/ICdPV19USU1FX0FCT1VUX0FfTUlOVVRFX0FHTydcblx0XHRcdFx0OiAnT1dfVElNRV9JTl9BQk9VVF9BX01JTlVURSc7XG5cdFx0fSBlbHNlIGlmIChuTWludXRlcyA8IDU1KSB7XG5cdFx0XHRmb3JtYXQgPSBpblBhc3QgPyAnT1dfVElNRV9OX01JTlVURVNfQUdPJyA6ICdPV19USU1FX0lOX05fTUlOVVRFUyc7XG5cdFx0fSBlbHNlIGlmIChuTWludXRlcyA8IDcwKSB7XG5cdFx0XHRmb3JtYXQgPSBpblBhc3Rcblx0XHRcdFx0PyAnT1dfVElNRV9BQk9VVF9BTl9IT1VSX0FHTydcblx0XHRcdFx0OiAnT1dfVElNRV9JTl9BQk9VVF9BTl9IT1VSJztcblx0XHR9IGVsc2UgaWYgKG5Ib3VycyA8IDI0KSB7XG5cdFx0XHRmb3JtYXQgPSBpblBhc3QgPyAnT1dfVElNRV9OX0hPVVJTX0FHTycgOiAnT1dfVElNRV9JTl9OX0hPVVJTJztcblx0XHR9IGVsc2UgaWYgKG5EYXlzIDwgNykge1xuXHRcdFx0Zm9ybWF0ID0gaW5QYXN0ID8gJ09XX1RJTUVfTl9EQVlTX0FHTycgOiAnT1dfVElNRV9JTl9OX0RBWVMnO1xuXHRcdH0gZWxzZSBpZiAobldlZWtzIDwgNCkge1xuXHRcdFx0Zm9ybWF0ID0gaW5QYXN0ID8gJ09XX1RJTUVfTl9XRUVLU19BR08nIDogJ09XX1RJTUVfSU5fTl9XRUVLUyc7XG5cdFx0fSBlbHNlIGlmIChuTW9udGhzIDwgMTIpIHtcblx0XHRcdGZvcm1hdCA9IGluUGFzdCA/ICdPV19USU1FX05fTU9OVEhTX0FHTycgOiAnT1dfVElNRV9JTl9OX01PTlRIUyc7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGZvcm1hdCA9IGluUGFzdCA/ICdPV19USU1FX05fWUVBUlNfQUdPJyA6ICdPV19USU1FX0lOX05fWUVBUlMnO1xuXHRcdH1cblxuXHRcdC8vIHVzZWQgaW4gYW4gZWxhcHNlIHRpbWUgb3IgZHVyYXRpb24gY291bnRlclxuXHRcdGNvbnN0IGNTZWNvbmRzID0gTWF0aC5mbG9vcigobXNDb3VudCAvIGFTZWNvbmQpICUgNjApO1xuXHRcdGNvbnN0IGNNaW51dGVzID0gTWF0aC5mbG9vcigobXNDb3VudCAvIGFNaW51dGUpICUgNjApO1xuXHRcdGNvbnN0IGNIb3VycyA9IE1hdGguZmxvb3IoKG1zQ291bnQgLyBhbkhvdXIpICUgMjQpO1xuXHRcdGNvbnN0IGNEYXlzID0gTWF0aC5mbG9vcihtc0NvdW50IC8gYURheSk7XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0Zm9ybWF0LFxuXHRcdFx0blNlY29uZHMsXG5cdFx0XHRuTWludXRlcyxcblx0XHRcdG5Ib3Vycyxcblx0XHRcdG5EYXlzLFxuXHRcdFx0bldlZWtzLFxuXHRcdFx0bk1vbnRocyxcblx0XHRcdG5ZZWFycyxcblx0XHRcdGluUGFzdCxcblx0XHRcdGNEYXlzLFxuXHRcdFx0Y0hvdXJzLFxuXHRcdFx0Y01pbnV0ZXMsXG5cdFx0XHRjU2Vjb25kcyxcblx0XHR9O1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgZGF0ZSBkZXNjcmlwdGlvbiBvYmplY3QuXG5cdCAqL1xuXHRkZXNjcmliZSgpIHtcblx0XHRjb25zdCBpMThuID0gdGhpcy5fYXBwQ29udGV4dC5pMThuLFxuXHRcdFx0ZGF5TmFtZXNTaG9ydCA9IGkxOG4udG9IdW1hbignT1dfVElNRV9EQVlfTkFNRVNfU0hPUlQnKS5zcGxpdCgnLCcpLFxuXHRcdFx0ZGF5TmFtZXNGdWxsID0gaTE4bi50b0h1bWFuKCdPV19USU1FX0RBWV9OQU1FU19GVUxMJykuc3BsaXQoJywnKSxcblx0XHRcdG1vbnRoTmFtZXNTaG9ydCA9IGkxOG4udG9IdW1hbignT1dfVElNRV9NT05USF9OQU1FU19TSE9SVCcpLnNwbGl0KCcsJyksXG5cdFx0XHRtb250aE5hbWVzRnVsbCA9IGkxOG4udG9IdW1hbignT1dfVElNRV9NT05USF9OQU1FU19GVUxMJykuc3BsaXQoJywnKSxcblx0XHRcdGRhdGUgPSBuZXcgRGF0ZSh0aGlzLmRhdGUpLFxuXHRcdFx0eTogbnVtYmVyID0gKGRhdGUgYXMgYW55KS5nZXRZZWFyKCksXG5cdFx0XHRZOiBudW1iZXIgPSBkYXRlLmdldEZ1bGxZZWFyKCksXG5cdFx0XHRtOiBudW1iZXIgPSBkYXRlLmdldE1vbnRoKCksXG5cdFx0XHRtbSA9IFN0cmluZyhtIDwgOSA/ICcwJyArIChtICsgMSkgOiBtICsgMSksXG5cdFx0XHRkOiBudW1iZXIgPSBkYXRlLmdldERhdGUoKSxcblx0XHRcdGw6IG51bWJlciA9IGRhdGUuZ2V0RGF5KCksXG5cdFx0XHRsbDogbnVtYmVyID0gbCArIDEsIC8vIGw/IGwgOiA3LFxuXHRcdFx0TDogc3RyaW5nID0gZGF5TmFtZXNGdWxsW2xdLFxuXHRcdFx0RDogc3RyaW5nID0gZGF5TmFtZXNTaG9ydFtsXSxcblx0XHRcdE06IHN0cmluZyA9IG1vbnRoTmFtZXNTaG9ydFttXSxcblx0XHRcdEY6IHN0cmluZyA9IG1vbnRoTmFtZXNGdWxsW21dLFxuXHRcdFx0SDogbnVtYmVyID0gZGF0ZS5nZXRIb3VycygpLFxuXHRcdFx0aDogbnVtYmVyID0gSCA9PT0gMTIgPyAxMiA6IEggJSAxMixcblx0XHRcdGhoID0gU3RyaW5nKG0gPD0gOSA/ICcwJyArIG0gOiBtKSxcblx0XHRcdGk6IG51bWJlciA9IGRhdGUuZ2V0TWludXRlcygpLFxuXHRcdFx0aWkgPSBTdHJpbmcoaSA8IDEwID8gJzAnICsgaSA6IGkpLFxuXHRcdFx0czogbnVtYmVyID0gZGF0ZS5nZXRTZWNvbmRzKCksXG5cdFx0XHRzcyA9IFN0cmluZyhzIDwgMTAgPyAnMCcgKyBzIDogcyksXG5cdFx0XHRtczogbnVtYmVyID0gZGF0ZS5nZXRNaWxsaXNlY29uZHMoKSxcblx0XHRcdGE6IHN0cmluZyA9IEggPCAxMiA/ICdhbScgOiAncG0nLFxuXHRcdFx0QTogc3RyaW5nID0gYS50b1VwcGVyQ2FzZSgpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdEQsXG5cdFx0XHRMLFxuXHRcdFx0bCxcblx0XHRcdGxsLFxuXHRcdFx0ZCxcblx0XHRcdE0sXG5cdFx0XHRGLFxuXHRcdFx0bSxcblx0XHRcdG1tLFxuXHRcdFx0WSxcblx0XHRcdHksXG5cdFx0XHRoLFxuXHRcdFx0aGgsXG5cdFx0XHRILFxuXHRcdFx0aSxcblx0XHRcdGlpLFxuXHRcdFx0cyxcblx0XHRcdHNzLFxuXHRcdFx0bXMsXG5cdFx0XHRhLFxuXHRcdFx0QSxcblx0XHRcdC4uLnRoaXMuY29tcGFyZSh0aGlzLmRhdGUsIERhdGUubm93KCkpLFxuXHRcdH07XG5cdH1cblxuXHQvKipcblx0ICogRGF0ZSBzZXR0ZXIuXG5cdCAqXG5cdCAqIEBwYXJhbSBkYXRlXG5cdCAqL1xuXHRzZXREYXRlKGRhdGU6IE9EYXRlVmFsdWUpOiB0aGlzIHtcblx0XHR0aGlzLmRhdGUgPSBuZXcgRGF0ZShkYXRlKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKlxuXHQgKiBEYXRlIGdldHRlci5cblx0ICovXG5cdGdldERhdGUoKTogT0RhdGVWYWx1ZSB7XG5cdFx0cmV0dXJuIHRoaXMuZGF0ZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIHVuaXggbGlrZSB0aW1lc3RhbXAuXG5cdCAqL1xuXHRzdGF0aWMgdGltZXN0YW1wKCk6IG51bWJlciB7XG5cdFx0cmV0dXJuIE51bWJlcihTdHJpbmcoRGF0ZS5ub3coKSkuc2xpY2UoMCwgLTMpKTtcblx0fVxufVxuIl19