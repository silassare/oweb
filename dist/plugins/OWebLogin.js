import OWebEvent from '../OWebEvent';
import { id } from '../utils/Utils';
export default class OWebLogin extends OWebEvent {
    constructor(appContext) {
        super();
        this.appContext = appContext;
    }
    loginWithEmail(form) {
        const m = this, ofv = this.appContext.getFormValidator(form, ['email', 'pass']);
        if (ofv.validate()) {
            m._tryLogin({
                email: ofv.getField('email'),
                pass: ofv.getField('pass'),
            });
        }
    }
    loginWithPhone(form) {
        const m = this, ofv = this.appContext.getFormValidator(form, ['phone', 'pass']);
        if (ofv.validate()) {
            m._tryLogin({
                phone: ofv.getField('phone'),
                pass: ofv.getField('pass'),
            });
        }
    }
    onError(handler) {
        return this.on(OWebLogin.EVT_LOGIN_ERROR, handler);
    }
    onSuccess(handler) {
        return this.on(OWebLogin.EVT_LOGIN_SUCCESS, handler);
    }
    _tryLogin(data) {
        const m = this, url = this.appContext.url.get('OZ_SERVER_LOGIN_SERVICE');
        this.appContext.request('POST', url, data, function (response) {
            m.trigger(OWebLogin.EVT_LOGIN_SUCCESS, [response]);
        }, function (response) {
            m.trigger(OWebLogin.EVT_LOGIN_ERROR, [response]);
        }, true);
    }
}
OWebLogin.SELF = id();
OWebLogin.EVT_LOGIN_ERROR = id();
OWebLogin.EVT_LOGIN_SUCCESS = id();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1dlYkxvZ2luLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3BsdWdpbnMvT1dlYkxvZ2luLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sU0FBUyxNQUFNLGNBQWMsQ0FBQztBQUNyQyxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFcEMsTUFBTSxDQUFDLE9BQU8sT0FBTyxTQUFVLFNBQVEsU0FBUztJQUsvQyxZQUE2QixVQUFtQjtRQUMvQyxLQUFLLEVBQUUsQ0FBQztRQURvQixlQUFVLEdBQVYsVUFBVSxDQUFTO0lBRWhELENBQUM7SUFFRCxjQUFjLENBQUMsSUFBcUI7UUFDbkMsTUFBTSxDQUFDLEdBQUcsSUFBSSxFQUNiLEdBQUcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBRWpFLElBQUksR0FBRyxDQUFDLFFBQVEsRUFBRSxFQUFFO1lBQ25CLENBQUMsQ0FBQyxTQUFTLENBQUM7Z0JBQ1gsS0FBSyxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDO2dCQUM1QixJQUFJLEVBQUUsR0FBRyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7YUFDMUIsQ0FBQyxDQUFDO1NBQ0g7SUFDRixDQUFDO0lBRUQsY0FBYyxDQUFDLElBQXFCO1FBQ25DLE1BQU0sQ0FBQyxHQUFHLElBQUksRUFDYixHQUFHLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUVqRSxJQUFJLEdBQUcsQ0FBQyxRQUFRLEVBQUUsRUFBRTtZQUNuQixDQUFDLENBQUMsU0FBUyxDQUFDO2dCQUNYLEtBQUssRUFBRSxHQUFHLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQztnQkFDNUIsSUFBSSxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO2FBQzFCLENBQUMsQ0FBQztTQUNIO0lBQ0YsQ0FBQztJQUVELE9BQU8sQ0FBQyxPQUFxRDtRQUM1RCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLGVBQWUsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRUQsU0FBUyxDQUFDLE9BQXFEO1FBQzlELE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUVELFNBQVMsQ0FBQyxJQUFTO1FBQ2xCLE1BQU0sQ0FBQyxHQUFHLElBQUksRUFDYixHQUFHLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFFMUQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQ3RCLE1BQU0sRUFDTixHQUFHLEVBQ0gsSUFBSSxFQUNKLFVBQVUsUUFBc0I7WUFDL0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQ3BELENBQUMsRUFDRCxVQUFVLFFBQWE7WUFDdEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNsRCxDQUFDLEVBQ0QsSUFBSSxDQUNKLENBQUM7SUFDSCxDQUFDOztBQXhEZSxjQUFJLEdBQUcsRUFBRSxFQUFFLENBQUM7QUFDWix5QkFBZSxHQUFHLEVBQUUsRUFBRSxDQUFDO0FBQ3ZCLDJCQUFpQixHQUFHLEVBQUUsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9XZWJBcHAgZnJvbSAnLi4vT1dlYkFwcCc7XHJcbmltcG9ydCB7IElDb21SZXNwb25zZSB9IGZyb20gJy4uL09XZWJDb20nO1xyXG5pbXBvcnQgT1dlYkV2ZW50IGZyb20gJy4uL09XZWJFdmVudCc7XHJcbmltcG9ydCB7IGlkIH0gZnJvbSAnLi4vdXRpbHMvVXRpbHMnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT1dlYkxvZ2luIGV4dGVuZHMgT1dlYkV2ZW50IHtcclxuXHRzdGF0aWMgcmVhZG9ubHkgU0VMRiA9IGlkKCk7XHJcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9MT0dJTl9FUlJPUiA9IGlkKCk7XHJcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9MT0dJTl9TVUNDRVNTID0gaWQoKTtcclxuXHJcblx0Y29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBhcHBDb250ZXh0OiBPV2ViQXBwKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdH1cclxuXHJcblx0bG9naW5XaXRoRW1haWwoZm9ybTogSFRNTEZvcm1FbGVtZW50KSB7XHJcblx0XHRjb25zdCBtID0gdGhpcyxcclxuXHRcdFx0b2Z2ID0gdGhpcy5hcHBDb250ZXh0LmdldEZvcm1WYWxpZGF0b3IoZm9ybSwgWydlbWFpbCcsICdwYXNzJ10pO1xyXG5cclxuXHRcdGlmIChvZnYudmFsaWRhdGUoKSkge1xyXG5cdFx0XHRtLl90cnlMb2dpbih7XHJcblx0XHRcdFx0ZW1haWw6IG9mdi5nZXRGaWVsZCgnZW1haWwnKSxcclxuXHRcdFx0XHRwYXNzOiBvZnYuZ2V0RmllbGQoJ3Bhc3MnKSxcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRsb2dpbldpdGhQaG9uZShmb3JtOiBIVE1MRm9ybUVsZW1lbnQpIHtcclxuXHRcdGNvbnN0IG0gPSB0aGlzLFxyXG5cdFx0XHRvZnYgPSB0aGlzLmFwcENvbnRleHQuZ2V0Rm9ybVZhbGlkYXRvcihmb3JtLCBbJ3Bob25lJywgJ3Bhc3MnXSk7XHJcblxyXG5cdFx0aWYgKG9mdi52YWxpZGF0ZSgpKSB7XHJcblx0XHRcdG0uX3RyeUxvZ2luKHtcclxuXHRcdFx0XHRwaG9uZTogb2Z2LmdldEZpZWxkKCdwaG9uZScpLFxyXG5cdFx0XHRcdHBhc3M6IG9mdi5nZXRGaWVsZCgncGFzcycpLFxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdG9uRXJyb3IoaGFuZGxlcjogKHRoaXM6IHRoaXMsIHJlc3BvbnNlOiBJQ29tUmVzcG9uc2UpID0+IHZvaWQpOiB0aGlzIHtcclxuXHRcdHJldHVybiB0aGlzLm9uKE9XZWJMb2dpbi5FVlRfTE9HSU5fRVJST1IsIGhhbmRsZXIpO1xyXG5cdH1cclxuXHJcblx0b25TdWNjZXNzKGhhbmRsZXI6ICh0aGlzOiB0aGlzLCByZXNwb25zZTogSUNvbVJlc3BvbnNlKSA9PiB2b2lkKTogdGhpcyB7XHJcblx0XHRyZXR1cm4gdGhpcy5vbihPV2ViTG9naW4uRVZUX0xPR0lOX1NVQ0NFU1MsIGhhbmRsZXIpO1xyXG5cdH1cclxuXHJcblx0X3RyeUxvZ2luKGRhdGE6IGFueSkge1xyXG5cdFx0Y29uc3QgbSA9IHRoaXMsXHJcblx0XHRcdHVybCA9IHRoaXMuYXBwQ29udGV4dC51cmwuZ2V0KCdPWl9TRVJWRVJfTE9HSU5fU0VSVklDRScpO1xyXG5cclxuXHRcdHRoaXMuYXBwQ29udGV4dC5yZXF1ZXN0KFxyXG5cdFx0XHQnUE9TVCcsXHJcblx0XHRcdHVybCxcclxuXHRcdFx0ZGF0YSxcclxuXHRcdFx0ZnVuY3Rpb24gKHJlc3BvbnNlOiBJQ29tUmVzcG9uc2UpIHtcclxuXHRcdFx0XHRtLnRyaWdnZXIoT1dlYkxvZ2luLkVWVF9MT0dJTl9TVUNDRVNTLCBbcmVzcG9uc2VdKTtcclxuXHRcdFx0fSxcclxuXHRcdFx0ZnVuY3Rpb24gKHJlc3BvbnNlOiBhbnkpIHtcclxuXHRcdFx0XHRtLnRyaWdnZXIoT1dlYkxvZ2luLkVWVF9MT0dJTl9FUlJPUiwgW3Jlc3BvbnNlXSk7XHJcblx0XHRcdH0sXHJcblx0XHRcdHRydWUsXHJcblx0XHQpO1xyXG5cdH1cclxufVxyXG4iXX0=