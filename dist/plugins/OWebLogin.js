import OWebEvent from "../OWebEvent";
export default class OWebLogin extends OWebEvent {
    constructor(app_context) {
        super();
        this.app_context = app_context;
    }
    loginWithEmail(form) {
        let m = this, ofv = this.app_context.getFormValidator(form, ["email", "pass"]);
        if (ofv.validate()) {
            let data = {
                email: ofv.getField("email"),
                pass: ofv.getField("pass")
            };
            m._tryLogin(data);
        }
    }
    loginWithPhone(form) {
        let m = this, ofv = this.app_context.getFormValidator(form, ["phone", "pass"]);
        if (ofv.validate()) {
            let data = {
                phone: ofv.getField("phone"),
                pass: ofv.getField("pass")
            };
            m._tryLogin(data);
        }
    }
    onError(handler) {
        return this.on(OWebLogin.EVT_LOGIN_ERROR, handler);
    }
    onSuccess(handler) {
        return this.on(OWebLogin.EVT_LOGIN_SUCCESS, handler);
    }
    _tryLogin(data) {
        let m = this, url = this.app_context.url.get("OZ_SERVER_LOGIN_SERVICE");
        this.app_context.request("POST", url, data, function (response) {
            m.trigger(OWebLogin.EVT_LOGIN_SUCCESS, [response]);
        }, function (response) {
            m.trigger(OWebLogin.EVT_LOGIN_ERROR, [response]);
        }, true);
    }
}
OWebLogin.SELF = "OWebLogin";
OWebLogin.EVT_LOGIN_ERROR = "OWebLogin:error";
OWebLogin.EVT_LOGIN_SUCCESS = "OWebLogin:success";
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1dlYkxvZ2luLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3BsdWdpbnMvT1dlYkxvZ2luLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sU0FBUyxNQUFNLGNBQWMsQ0FBQztBQUVyQyxNQUFNLENBQUMsT0FBTyxnQkFBaUIsU0FBUSxTQUFTO0lBTS9DLFlBQTZCLFdBQW9CO1FBQ2hELEtBQUssRUFBRSxDQUFDO1FBRG9CLGdCQUFXLEdBQVgsV0FBVyxDQUFTO0lBRWpELENBQUM7SUFFRCxjQUFjLENBQUMsSUFBcUI7UUFDbkMsSUFBSSxDQUFDLEdBQUssSUFBSSxFQUNiLEdBQUcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBRWxFLElBQUksR0FBRyxDQUFDLFFBQVEsRUFBRSxFQUFFO1lBQ25CLElBQUksSUFBSSxHQUFHO2dCQUNWLEtBQUssRUFBRSxHQUFHLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQztnQkFDNUIsSUFBSSxFQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO2FBQzNCLENBQUM7WUFFRixDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2xCO0lBQ0YsQ0FBQztJQUVELGNBQWMsQ0FBQyxJQUFxQjtRQUNuQyxJQUFJLENBQUMsR0FBSyxJQUFJLEVBQ2IsR0FBRyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFFbEUsSUFBSSxHQUFHLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDbkIsSUFBSSxJQUFJLEdBQUc7Z0JBQ1YsS0FBSyxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDO2dCQUM1QixJQUFJLEVBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7YUFDM0IsQ0FBQztZQUVGLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDbEI7SUFDRixDQUFDO0lBRUQsT0FBTyxDQUFDLE9BQXlDO1FBQ2hELE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsZUFBZSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRCxTQUFTLENBQUMsT0FBeUM7UUFDbEQsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRUQsU0FBUyxDQUFDLElBQVM7UUFDbEIsSUFBSSxDQUFDLEdBQUssSUFBSSxFQUNiLEdBQUcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMseUJBQXlCLENBQUMsQ0FBQztRQUUzRCxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxVQUFVLFFBQWE7WUFDbEUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQ3BELENBQUMsRUFBRSxVQUFVLFFBQWE7WUFDekIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNsRCxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDVixDQUFDOztBQXJEZSxjQUFJLEdBQWdCLFdBQVcsQ0FBQztBQUNoQyx5QkFBZSxHQUFLLGlCQUFpQixDQUFDO0FBQ3RDLDJCQUFpQixHQUFHLG1CQUFtQixDQUFDO0FBb0R4RCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9XZWJBcHAgZnJvbSBcIi4uL09XZWJBcHBcIjtcclxuaW1wb3J0IHtpQ29tUmVzcG9uc2V9IGZyb20gXCIuLi9PV2ViQ29tXCI7XHJcbmltcG9ydCBPV2ViRXZlbnQgZnJvbSBcIi4uL09XZWJFdmVudFwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT1dlYkxvZ2luIGV4dGVuZHMgT1dlYkV2ZW50IHtcclxuXHJcblx0c3RhdGljIHJlYWRvbmx5IFNFTEYgICAgICAgICAgICAgID0gXCJPV2ViTG9naW5cIjtcclxuXHRzdGF0aWMgcmVhZG9ubHkgRVZUX0xPR0lOX0VSUk9SICAgPSBcIk9XZWJMb2dpbjplcnJvclwiO1xyXG5cdHN0YXRpYyByZWFkb25seSBFVlRfTE9HSU5fU1VDQ0VTUyA9IFwiT1dlYkxvZ2luOnN1Y2Nlc3NcIjtcclxuXHJcblx0Y29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBhcHBfY29udGV4dDogT1dlYkFwcCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHR9XHJcblxyXG5cdGxvZ2luV2l0aEVtYWlsKGZvcm06IEhUTUxGb3JtRWxlbWVudCkge1xyXG5cdFx0bGV0IG0gICA9IHRoaXMsXHJcblx0XHRcdG9mdiA9IHRoaXMuYXBwX2NvbnRleHQuZ2V0Rm9ybVZhbGlkYXRvcihmb3JtLCBbXCJlbWFpbFwiLCBcInBhc3NcIl0pO1xyXG5cclxuXHRcdGlmIChvZnYudmFsaWRhdGUoKSkge1xyXG5cdFx0XHRsZXQgZGF0YSA9IHtcclxuXHRcdFx0XHRlbWFpbDogb2Z2LmdldEZpZWxkKFwiZW1haWxcIiksXHJcblx0XHRcdFx0cGFzcyA6IG9mdi5nZXRGaWVsZChcInBhc3NcIilcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdG0uX3RyeUxvZ2luKGRhdGEpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0bG9naW5XaXRoUGhvbmUoZm9ybTogSFRNTEZvcm1FbGVtZW50KSB7XHJcblx0XHRsZXQgbSAgID0gdGhpcyxcclxuXHRcdFx0b2Z2ID0gdGhpcy5hcHBfY29udGV4dC5nZXRGb3JtVmFsaWRhdG9yKGZvcm0sIFtcInBob25lXCIsIFwicGFzc1wiXSk7XHJcblxyXG5cdFx0aWYgKG9mdi52YWxpZGF0ZSgpKSB7XHJcblx0XHRcdGxldCBkYXRhID0ge1xyXG5cdFx0XHRcdHBob25lOiBvZnYuZ2V0RmllbGQoXCJwaG9uZVwiKSxcclxuXHRcdFx0XHRwYXNzIDogb2Z2LmdldEZpZWxkKFwicGFzc1wiKVxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0bS5fdHJ5TG9naW4oZGF0YSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRvbkVycm9yKGhhbmRsZXI6IChyZXNwb25zZTogaUNvbVJlc3BvbnNlKSA9PiB2b2lkKTogdGhpcyB7XHJcblx0XHRyZXR1cm4gdGhpcy5vbihPV2ViTG9naW4uRVZUX0xPR0lOX0VSUk9SLCBoYW5kbGVyKTtcclxuXHR9XHJcblxyXG5cdG9uU3VjY2VzcyhoYW5kbGVyOiAocmVzcG9uc2U6IGlDb21SZXNwb25zZSkgPT4gdm9pZCk6IHRoaXMge1xyXG5cdFx0cmV0dXJuIHRoaXMub24oT1dlYkxvZ2luLkVWVF9MT0dJTl9TVUNDRVNTLCBoYW5kbGVyKTtcclxuXHR9XHJcblxyXG5cdF90cnlMb2dpbihkYXRhOiBhbnkpIHtcclxuXHRcdGxldCBtICAgPSB0aGlzLFxyXG5cdFx0XHR1cmwgPSB0aGlzLmFwcF9jb250ZXh0LnVybC5nZXQoXCJPWl9TRVJWRVJfTE9HSU5fU0VSVklDRVwiKTtcclxuXHJcblx0XHR0aGlzLmFwcF9jb250ZXh0LnJlcXVlc3QoXCJQT1NUXCIsIHVybCwgZGF0YSwgZnVuY3Rpb24gKHJlc3BvbnNlOiBhbnkpIHtcclxuXHRcdFx0bS50cmlnZ2VyKE9XZWJMb2dpbi5FVlRfTE9HSU5fU1VDQ0VTUywgW3Jlc3BvbnNlXSk7XHJcblx0XHR9LCBmdW5jdGlvbiAocmVzcG9uc2U6IGFueSkge1xyXG5cdFx0XHRtLnRyaWdnZXIoT1dlYkxvZ2luLkVWVF9MT0dJTl9FUlJPUiwgW3Jlc3BvbnNlXSk7XHJcblx0XHR9LCB0cnVlKTtcclxuXHR9XHJcbn07XHJcbiJdfQ==