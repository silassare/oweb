import OWebConfigs from './OWebConfigs';
import OWebDataStore from './OWebDataStore';
import OWebEvent from './OWebEvent';
import OWebFormValidator from './OWebFormValidator';
import OWebRouter from './OWebRouter';
import OWebUrl from './OWebUrl';
import OWebView from './OWebView';
import OWebI18n from './OWebI18n';
import { id, logger } from './utils';
import OZone from './ozone';
export default class OWebApp extends OWebEvent {
    /**
     * OWebApp constructor.
     *
     * @param options
     */
    constructor(options) {
        super();
        this.options = options;
        this.ls = new OWebDataStore(this);
        this.configs = new OWebConfigs(this, options.appConfigs, options.userConfigs);
        this.url = new OWebUrl(this, options.urls);
        this.view = new OWebView();
        this.i18n = new OWebI18n();
        this.user = options.user.call(this);
        this._store = options.store.call(this);
        this._pager = options.pager.call(this);
        const ctx = this, baseUrl = this.configs.get('OW_APP_LOCAL_BASE_URL'), hashMode = this.configs.get('OW_APP_ROUTER_HASH_MODE');
        this.router = new OWebRouter(baseUrl, hashMode, function (target) {
            ctx.trigger(OWebApp.EVT_NOT_FOUND, [target]);
        });
        this.i18n.setDefaultLang(this.configs.get('OW_APP_DEFAULT_LANG'));
        this.oz = OZone.instantiate(this);
    }
    /**
     * Store getter.
     */
    get store() {
        return this._store;
    }
    /**
     * Pager instance getter.
     */
    get pager() {
        return this._pager;
    }
    /**
     * Store services shortcut.
     */
    get services() {
        return this.store.services;
    }
    /**
     * App name getter.
     */
    getAppName() {
        return this.options.name;
    }
    /**
     * Checks if we are running in mobile app.
     */
    isMobileApp() {
        return 'cordova' in window;
    }
    /**
     * Returns new form validator instance.
     *
     * @param form The html form element.
     * @param required The required fields names list.
     * @param excluded The fields names to exclude.
     * @param checkAll Force the validator to check all fields.
     */
    getFormValidator(form, required = [], excluded = [], checkAll = false) {
        return new OWebFormValidator(this, form, required, excluded, checkAll);
    }
    /**
     * Force login.
     *
     * > This will clear all saved data in the local storage.
     */
    forceLogin() {
        this.ls.clear();
        this.showLoginPage({});
    }
    /**
     * Reload the app.
     */
    reloadApp() {
        // TODO: instead of reloading the current location, find a way to browse to web app entry point
        // for android & ios restart the app
        // window.location.reload(true);
        this.showHomePage({});
    }
    /**
     * Destroy the app.
     *
     * > This will clear all saved data in the local storage.
     */
    destroyApp() {
        // erase data
        this.ls.clear();
        this.reloadApp();
    }
    /**
     * Close app.
     */
    closeApp() {
        // cordova
        if (window.navigator && window.navigator.app) {
            window.navigator.app.exitApp();
        }
        else {
            window.close();
        }
    }
    /**
     * To start the web app.
     */
    start() {
        logger.info('[OWebApp] app started!');
        this.trigger(OWebApp.EVT_APP_READY);
        return this;
    }
    /**
     * Called when app should show the home page.
     */
    showHomePage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_HOME, [options]);
    }
    /**
     * Called when app should show the login page.
     */
    showLoginPage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_LOGIN, [options]);
    }
    /**
     * Called when app should show the registration page.
     */
    showRegistrationPage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_LOGIN, [options]);
    }
    /**
     * Register handler for OWebApp.EVT_APP_READY event
     *
     * @param handler
     */
    onReady(handler) {
        return this.on(OWebApp.EVT_APP_READY, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_HOME event
     *
     * @param handler
     */
    onShowHomePage(handler) {
        return this.on(OWebApp.EVT_SHOW_HOME, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_LOGIN event
     *
     * @param handler
     */
    onShowLoginPage(handler) {
        return this.on(OWebApp.EVT_SHOW_LOGIN, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_REGISTRATION_PAGE event
     *
     * @param handler
     */
    onShowRegistrationPage(handler) {
        return this.on(OWebApp.EVT_SHOW_REGISTRATION_PAGE, handler);
    }
    /**
     * Register handler for OWebApp.EVT_NOT_FOUND event
     *
     * @param handler
     */
    onPageNotFound(handler) {
        return this.on(OWebApp.EVT_NOT_FOUND, handler);
    }
    /**
     * Creates new app instance.
     *
     * @param options
     */
    static create(options) {
        return new OWebApp(options);
    }
}
OWebApp.SELF = id();
OWebApp.EVT_APP_READY = id();
OWebApp.EVT_NOT_FOUND = id();
OWebApp.EVT_SHOW_HOME = id();
OWebApp.EVT_SHOW_LOGIN = id();
OWebApp.EVT_SHOW_REGISTRATION_PAGE = id();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1dlYkFwcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9PV2ViQXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sV0FBVyxNQUFNLGVBQWUsQ0FBQztBQUN4QyxPQUFPLGFBQWtDLE1BQU0saUJBQWlCLENBQUM7QUFDakUsT0FBTyxTQUFTLE1BQU0sYUFBYSxDQUFDO0FBQ3BDLE9BQU8saUJBQWlCLE1BQU0scUJBQXFCLENBQUM7QUFDcEQsT0FBTyxVQUE2QyxNQUFNLGNBQWMsQ0FBQztBQUN6RSxPQUFPLE9BQU8sTUFBTSxXQUFXLENBQUM7QUFDaEMsT0FBTyxRQUFRLE1BQU0sWUFBWSxDQUFDO0FBQ2xDLE9BQU8sUUFBUSxNQUFNLFlBQVksQ0FBQztBQUNsQyxPQUFPLEVBQUMsRUFBRSxFQUFFLE1BQU0sRUFBQyxNQUFNLFNBQVMsQ0FBQztBQUNuQyxPQUFPLEtBQUssTUFBTSxTQUFTLENBQUM7QUF3RTVCLE1BQU0sQ0FBQyxPQUFPLE9BQU8sT0FBOEcsU0FBUSxTQUFTO0lBb0JuSjs7OztPQUlHO0lBQ0gsWUFDa0IsT0FBZ0I7UUFFakMsS0FBSyxFQUFFLENBQUM7UUFGUyxZQUFPLEdBQVAsT0FBTyxDQUFTO1FBSWpDLElBQUksQ0FBQyxFQUFFLEdBQVEsSUFBSSxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLFdBQVcsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDOUUsSUFBSSxDQUFDLEdBQUcsR0FBTyxJQUFJLE9BQU8sQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9DLElBQUksQ0FBQyxJQUFJLEdBQU0sSUFBSSxRQUFRLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsSUFBSSxHQUFNLElBQUksUUFBUSxFQUFFLENBQUM7UUFDOUIsSUFBSSxDQUFDLElB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O09BSUc7SUFDSCxjQUFjLENBQ2IsT0FBNkQ7UUFFN0QsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxNQUFNLENBQUMsTUFBTSxDQUNaLE9BQWdCO1FBRWhCLE9BQU8sSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDN0IsQ0FBQzs7QUFoUGUsWUFBSSxHQUF5QixFQUFFLEVBQUUsQ0FBQztBQUNsQyxxQkFBYSxHQUFnQixFQUFFLEVBQUUsQ0FBQztBQUNsQyxxQkFBYSxHQUFnQixFQUFFLEVBQUUsQ0FBQztBQUNsQyxxQkFBYSxHQUFnQixFQUFFLEVBQUUsQ0FBQztBQUNsQyxzQkFBYyxHQUFlLEVBQUUsRUFBRSxDQUFDO0FBQ2xDLGtDQUEwQixHQUFHLEVBQUUsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9XZWJDb25maWdzIGZyb20gJy4vT1dlYkNvbmZpZ3MnO1xuaW1wb3J0IE9XZWJEYXRhU3RvcmUsIHtPSlNPTlNlcmlhbGl6YWJsZX0gZnJvbSAnLi9PV2ViRGF0YVN0b3JlJztcbmltcG9ydCBPV2ViRXZlbnQgZnJvbSAnLi9PV2ViRXZlbnQnO1xuaW1wb3J0IE9XZWJGb3JtVmFsaWRhdG9yIGZyb20gJy4vT1dlYkZvcm1WYWxpZGF0b3InO1xuaW1wb3J0IE9XZWJSb3V0ZXIsIHtPUm91dGVTdGF0ZU9iamVjdCwgT1JvdXRlVGFyZ2V0fSBmcm9tICcuL09XZWJSb3V0ZXInO1xuaW1wb3J0IE9XZWJVcmwgZnJvbSAnLi9PV2ViVXJsJztcbmltcG9ydCBPV2ViVmlldyBmcm9tICcuL09XZWJWaWV3JztcbmltcG9ydCBPV2ViSTE4biBmcm9tICcuL09XZWJJMThuJztcbmltcG9ydCB7aWQsIGxvZ2dlcn0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgT1pvbmUgZnJvbSAnLi9vem9uZSc7XG5pbXBvcnQgT1dlYlBhZ2VyLCB7T1BhZ2V9IGZyb20gJy4vT1dlYlBhZ2VyJztcbmltcG9ydCBPV2ViVXNlciBmcm9tICcuL09XZWJVc2VyJztcblxuZXhwb3J0IGludGVyZmFjZSBPVXJsTGlzdCB7XG5cdFtrZXk6IHN0cmluZ106IHN0cmluZztcblxuXHRPWl9TRVJWRVJfR0VUX0ZJTEVfVVJJOiBzdHJpbmc7XG5cdE9aX1NFUlZFUl9UTkVUX1NFUlZJQ0U6IHN0cmluZztcblx0T1pfU0VSVkVSX0xPR0lOX1NFUlZJQ0U6IHN0cmluZztcblx0T1pfU0VSVkVSX0xPR09VVF9TRVJWSUNFOiBzdHJpbmc7XG5cdE9aX1NFUlZFUl9TSUdOVVBfU0VSVklDRTogc3RyaW5nO1xuXHRPWl9TRVJWRVJfQUNDT1VOVF9SRUNPVkVSWV9TRVJWSUNFOiBzdHJpbmc7XG5cdE9aX1NFUlZFUl9QQVNTV09SRF9TRVJWSUNFOiBzdHJpbmc7XG5cdE9aX1NFUlZFUl9DQVBUQ0hBX1NFUlZJQ0U6IHN0cmluZztcblx0T1pfU0VSVkVSX1VQTE9BRF9TRVJWSUNFOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT0FwcENvbmZpZ3Mge1xuXHRba2V5OiBzdHJpbmddOiBPSlNPTlNlcmlhbGl6YWJsZTtcblxuXHRPV19BUFBfTkFNRTogc3RyaW5nO1xuXHRPV19BUFBfVkVSU0lPTjogc3RyaW5nO1xuXHRPV19BUFBfTE9DQUxfQkFTRV9VUkw6IHN0cmluZztcblx0T1dfQVBQX1JPVVRFUl9IQVNIX01PREU6IGJvb2xlYW47XG5cdE9XX0FQUF9BTExPV0VEX0NPVU5UUklFUzogc3RyaW5nW107XG5cdE9XX0FQUF9MT0dPX1NSQzogc3RyaW5nO1xuXHRPV19BUFBfQU5EUk9JRF9JRDogc3RyaW5nO1xuXHRPV19BUFBfVVBEQVRFUl9TQ1JJUFRfU1JDOiBzdHJpbmc7XG5cblx0T1pfQVBJX0tFWTogc3RyaW5nO1xuXHRPWl9BUElfS0VZX0hFQURFUl9OQU1FOiBzdHJpbmc7XG5cdE9aX0FQSV9BTExPV19SRUFMX01FVEhPRF9IRUFERVI6IGJvb2xlYW47XG5cdE9aX0FQSV9SRUFMX01FVEhPRF9IRUFERVJfTkFNRTogc3RyaW5nO1xuXHRPWl9BUElfQkFTRV9VUkw6IHN0cmluZztcblxuXHRPWl9DT0RFX1JFRzogc3RyaW5nO1xuXHRPWl9VU0VSX05BTUVfTUlOX0xFTkdUSDogbnVtYmVyO1xuXHRPWl9VU0VSX05BTUVfTUFYX0xFTkdUSDogbnVtYmVyO1xuXHRPWl9QQVNTX01JTl9MRU5HVEg6IG51bWJlcjtcblx0T1pfUEFTU19NQVhfTEVOR1RIOiBudW1iZXI7XG5cdE9aX1VTRVJfTUlOX0FHRTogbnVtYmVyO1xuXHRPWl9VU0VSX01BWF9BR0U6IG51bWJlcjtcblx0T1pfUFBJQ19NSU5fU0laRTogbnVtYmVyO1xuXHRPWl9VU0VSX0FMTE9XRURfR0VOREVSUzogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT1VzZXJDb25maWdzIHtcblx0W2tleTogc3RyaW5nXTogT0pTT05TZXJpYWxpemFibGU7XG5cblx0T1dfQVBQX0RFRkFVTFRfTEFORzogc3RyaW5nO1xuXHRPV19BUFBfQ09VTlRSWTogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE9TdG9yZSB7XG5cdFtrZXk6IHN0cmluZ106IGFueTtcblxuXHRzZXJ2aWNlczoge1xuXHRcdFtuYW1lOiBzdHJpbmddOiBhbnk7XG5cdH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT0FwcE9wdGlvbnM8U3RvcmUgZXh0ZW5kcyBPU3RvcmUsIFBhZ2UgZXh0ZW5kcyBPUGFnZT4ge1xuXHRuYW1lOiBzdHJpbmc7XG5cdGFwcENvbmZpZ3M6IE9BcHBDb25maWdzO1xuXHR1c2VyQ29uZmlnczogT1VzZXJDb25maWdzO1xuXHR1cmxzOiBPVXJsTGlzdDtcblx0dXNlcjogKHRoaXM6IE9XZWJBcHA8U3RvcmUsIFBhZ2UsIE9BcHBPcHRpb25zPFN0b3JlLCBQYWdlPj4pID0+IE9XZWJVc2VyPGFueT47XG5cdHN0b3JlOiAodGhpczogT1dlYkFwcDxTdG9yZSwgUGFnZSwgT0FwcE9wdGlvbnM8U3RvcmUsIFBhZ2U+PikgPT4gU3RvcmU7XG5cdHBhZ2VyOiAodGhpczogT1dlYkFwcDxTdG9yZSwgUGFnZSwgT0FwcE9wdGlvbnM8U3RvcmUsIFBhZ2U+PikgPT4gT1dlYlBhZ2VyPFBhZ2U+O1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBPV2ViQXBwPFN0b3JlIGV4dGVuZHMgT1N0b3JlID0gYW55LCBQYWdlIGV4dGVuZHMgT1BhZ2UgPSBhbnksIE9wdGlvbnMgZXh0ZW5kcyBPQXBwT3B0aW9uczxTdG9yZSwgUGFnZT4gPSBhbnk+IGV4dGVuZHMgT1dlYkV2ZW50IHtcblx0c3RhdGljIHJlYWRvbmx5IFNFTEYgICAgICAgICAgICAgICAgICAgICAgID0gaWQoKTtcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9BUFBfUkVBRFkgICAgICAgICAgICAgID0gaWQoKTtcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9OT1RfRk9VTkQgICAgICAgICAgICAgID0gaWQoKTtcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9TSE9XX0hPTUUgICAgICAgICAgICAgID0gaWQoKTtcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9TSE9XX0xPR0lOICAgICAgICAgICAgID0gaWQoKTtcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9TSE9XX1JFR0lTVFJBVElPTl9QQUdFID0gaWQoKTtcblxuXHRyZWFkb25seSB2aWV3OiBPV2ViVmlldztcblx0cmVhZG9ubHkgbHM6IE9XZWJEYXRhU3RvcmU7XG5cdHJlYWRvbmx5IHJvdXRlcjogT1dlYlJvdXRlcjtcblx0cmVhZG9ubHkgdXNlcjogT1dlYlVzZXI8YW55Pjtcblx0cmVhZG9ubHkgY29uZmlnczogT1dlYkNvbmZpZ3M8T0FwcENvbmZpZ3MsIE9Vc2VyQ29uZmlncz47XG5cdHJlYWRvbmx5IHVybDogT1dlYlVybDtcblx0cmVhZG9ubHkgaTE4bjogT1dlYkkxOG47XG5cdHJlYWRvbmx5IG96OiBPWm9uZTtcblxuXHRwcml2YXRlIHJlYWRvbmx5IF9zdG9yZTogU3RvcmU7XG5cdHByaXZhdGUgcmVhZG9ubHkgX3BhZ2VyOiBPV2ViUGFnZXI8UGFnZT47XG5cblx0LyoqXG5cdCAqIE9XZWJBcHAgY29uc3RydWN0b3IuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zXG5cdCAqL1xuXHRwcm90ZWN0ZWQgY29uc3RydWN0b3IoXG5cdFx0cHJpdmF0ZSByZWFkb25seSBvcHRpb25zOiBPcHRpb25zLFxuXHQpIHtcblx0XHRzdXBlcigpO1xuXG5cdFx0dGhpcy5scyAgICAgID0gbmV3IE9XZWJEYXRhU3RvcmUodGhpcyk7XG5cdFx0dGhpcy5jb25maWdzID0gbmV3IE9XZWJDb25maWdzKHRoaXMsIG9wdGlvbnMuYXBwQ29uZmlncywgb3B0aW9ucy51c2VyQ29uZmlncyk7XG5cdFx0dGhpcy51cmwgICAgID0gbmV3IE9XZWJVcmwodGhpcywgb3B0aW9ucy51cmxzKTtcblx0XHR0aGlzLnZpZXcgICAgPSBuZXcgT1dlYlZpZXcoKTtcblx0XHR0aGlzLmkxOG4gICAgPSBuZXcgT1dlYkkxOG4oKTtcblx0XHR0aGlzLnVzZXIgICAgPSBvcHRpb25zLnVzZXIuY2FsbCh0aGlzKTtcblx0XHR0aGlzLl9zdG9yZSAgPSBvcHRpb25zLnN0b3JlLmNhbGwodGhpcyk7XG5cdFx0dGhpcy5fcGFnZXIgID0gb3B0aW9ucy5wYWdlci5jYWxsKHRoaXMpO1xuXG5cdFx0Y29uc3QgY3R4ICAgICAgPSB0aGlzLFxuXHRcdFx0ICBiYXNlVXJsICA9IHRoaXMuY29uZmlncy5nZXQoJ09XX0FQUF9MT0NBTF9CQVNFX1VSTCcpLFxuXHRcdFx0ICBoYXNoTW9kZSA9IHRoaXMuY29uZmlncy5nZXQoJ09XX0FQUF9ST1VURVJfSEFTSF9NT0RFJyk7XG5cblx0XHR0aGlzLnJvdXRlciA9IG5ldyBPV2ViUm91dGVyKGJhc2VVcmwsIGhhc2hNb2RlLCBmdW5jdGlvbiAoXG5cdFx0XHR0YXJnZXQ6IE9Sb3V0ZVRhcmdldCxcblx0XHQpIHtcblx0XHRcdGN0eC50cmlnZ2VyKE9XZWJBcHAuRVZUX05PVF9GT1VORCwgW3RhcmdldF0pO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5pMThuLnNldERlZmF1bHRMYW5nKHRoaXMuY29uZmlncy5nZXQoJ09XX0FQUF9ERUZBVUxUX0xBTkcnKSk7XG5cblx0XHR0aGlzLm96ID0gT1pvbmUuaW5zdGFudGlhdGUodGhpcyk7XG5cdH1cblxuXHQvKipcblx0ICogU3RvcmUgZ2V0dGVyLlxuXHQgKi9cblx0Z2V0IHN0b3JlKCk6IFJldHVyblR5cGU8T3B0aW9uc1snc3RvcmUnXT4ge1xuXHRcdHJldHVybiB0aGlzLl9zdG9yZSBhcyBhbnk7XG5cdH1cblxuXHQvKipcblx0ICogUGFnZXIgaW5zdGFuY2UgZ2V0dGVyLlxuXHQgKi9cblx0Z2V0IHBhZ2VyKCk6IFJldHVyblR5cGU8T3B0aW9uc1sncGFnZXInXT4ge1xuXHRcdHJldHVybiB0aGlzLl9wYWdlciBhcyBhbnk7XG5cdH1cblxuXHQvKipcblx0ICogU3RvcmUgc2VydmljZXMgc2hvcnRjdXQuXG5cdCAqL1xuXHRnZXQgc2VydmljZXMoKTogUmV0dXJuVHlwZTxPcHRpb25zWydzdG9yZSddPlsnc2VydmljZXMnXSB7XG5cdFx0cmV0dXJuIHRoaXMuc3RvcmUuc2VydmljZXM7XG5cdH1cblxuXHQvKipcblx0ICogQXBwIG5hbWUgZ2V0dGVyLlxuXHQgKi9cblx0Z2V0QXBwTmFtZSgpOiBzdHJpbmcge1xuXHRcdHJldHVybiB0aGlzLm9wdGlvbnMubmFtZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDaGVja3MgaWYgd2UgYXJlIHJ1bm5pbmcgaW4gbW9iaWxlIGFwcC5cblx0ICovXG5cdGlzTW9iaWxlQXBwKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiAnY29yZG92YScgaW4gd2luZG93O1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgbmV3IGZvcm0gdmFsaWRhdG9yIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gZm9ybSBUaGUgaHRtbCBmb3JtIGVsZW1lbnQuXG5cdCAqIEBwYXJhbSByZXF1aXJlZCBUaGUgcmVxdWlyZWQgZmllbGRzIG5hbWVzIGxpc3QuXG5cdCAqIEBwYXJhbSBleGNsdWRlZCBUaGUgZmllbGRzIG5hbWVzIHRvIGV4Y2x1ZGUuXG5cdCAqIEBwYXJhbSBjaGVja0FsbCBGb3JjZSB0aGUgdmFsaWRhdG9yIHRvIGNoZWNrIGFsbCBmaWVsZHMuXG5cdCAqL1xuXHRnZXRGb3JtVmFsaWRhdG9yKFxuXHRcdGZvcm06IEhUTUxGb3JtRWxlbWVudCxcblx0XHRyZXF1aXJlZDogc3RyaW5nW10gPSBbXSxcblx0XHRleGNsdWRlZDogc3RyaW5nW10gPSBbXSxcblx0XHRjaGVja0FsbCAgICAgICAgICAgPSBmYWxzZSxcblx0KSB7XG5cdFx0cmV0dXJuIG5ldyBPV2ViRm9ybVZhbGlkYXRvcih0aGlzLCBmb3JtLCByZXF1aXJlZCwgZXhjbHVkZWQsIGNoZWNrQWxsKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBGb3JjZSBsb2dpbi5cblx0ICpcblx0ICogPiBUaGlzIHdpbGwgY2xlYXIgYWxsIHNhdmVkIGRhdGEgaW4gdGhlIGxvY2FsIHN0b3JhZ2UuXG5cdCAqL1xuXHRmb3JjZUxvZ2luKCkge1xuXHRcdHRoaXMubHMuY2xlYXIoKTtcblx0XHR0aGlzLnNob3dMb2dpblBhZ2Uoe30pO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlbG9hZCB0aGUgYXBwLlxuXHQgKi9cblx0cmVsb2FkQXBwKCkge1xuXHRcdC8vIFRPRE86IGluc3RlYWQgb2YgcmVsb2FkaW5nIHRoZSBjdXJyZW50IGxvY2F0aW9uLCBmaW5kIGEgd2F5IHRvIGJyb3dzZSB0byB3ZWIgYXBwIGVudHJ5IHBvaW50XG5cdFx0Ly8gZm9yIGFuZHJvaWQgJiBpb3MgcmVzdGFydCB0aGUgYXBwXG5cdFx0Ly8gd2luZG93LmxvY2F0aW9uLnJlbG9hZCh0cnVlKTtcblx0XHR0aGlzLnNob3dIb21lUGFnZSh7fSk7XG5cdH1cblxuXHQvKipcblx0ICogRGVzdHJveSB0aGUgYXBwLlxuXHQgKlxuXHQgKiA+IFRoaXMgd2lsbCBjbGVhciBhbGwgc2F2ZWQgZGF0YSBpbiB0aGUgbG9jYWwgc3RvcmFnZS5cblx0ICovXG5cdGRlc3Ryb3lBcHAoKSB7XG5cdFx0Ly8gZXJhc2UgZGF0YVxuXHRcdHRoaXMubHMuY2xlYXIoKTtcblx0XHR0aGlzLnJlbG9hZEFwcCgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENsb3NlIGFwcC5cblx0ICovXG5cdGNsb3NlQXBwKCkge1xuXHRcdC8vIGNvcmRvdmFcblx0XHRpZiAod2luZG93Lm5hdmlnYXRvciAmJiAod2luZG93Lm5hdmlnYXRvciBhcyBhbnkpLmFwcCkge1xuXHRcdFx0KHdpbmRvdy5uYXZpZ2F0b3IgYXMgYW55KS5hcHAuZXhpdEFwcCgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR3aW5kb3cuY2xvc2UoKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogVG8gc3RhcnQgdGhlIHdlYiBhcHAuXG5cdCAqL1xuXHRzdGFydCgpOiB0aGlzIHtcblx0XHRsb2dnZXIuaW5mbygnW09XZWJBcHBdIGFwcCBzdGFydGVkIScpO1xuXHRcdHRoaXMudHJpZ2dlcihPV2ViQXBwLkVWVF9BUFBfUkVBRFkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqXG5cdCAqIENhbGxlZCB3aGVuIGFwcCBzaG91bGQgc2hvdyB0aGUgaG9tZSBwYWdlLlxuXHQgKi9cblx0c2hvd0hvbWVQYWdlKG9wdGlvbnM6IE9Sb3V0ZVN0YXRlT2JqZWN0ID0ge30pIHtcblx0XHR0aGlzLnRyaWdnZXIoT1dlYkFwcC5FVlRfU0hPV19IT01FLCBbb3B0aW9uc10pO1xuXHR9XG5cblx0LyoqXG5cdCAqIENhbGxlZCB3aGVuIGFwcCBzaG91bGQgc2hvdyB0aGUgbG9naW4gcGFnZS5cblx0ICovXG5cdHNob3dMb2dpblBhZ2Uob3B0aW9uczogT1JvdXRlU3RhdGVPYmplY3QgPSB7fSkge1xuXHRcdHRoaXMudHJpZ2dlcihPV2ViQXBwLkVWVF9TSE9XX0xPR0lOLCBbb3B0aW9uc10pO1xuXHR9XG5cblx0LyoqXG5cdCAqIENhbGxlZCB3aGVuIGFwcCBzaG91bGQgc2hvdyB0aGUgcmVnaXN0cmF0aW9uIHBhZ2UuXG5cdCAqL1xuXHRzaG93UmVnaXN0cmF0aW9uUGFnZShvcHRpb25zOiBPUm91dGVTdGF0ZU9iamVjdCA9IHt9KSB7XG5cdFx0dGhpcy50cmlnZ2VyKE9XZWJBcHAuRVZUX1NIT1dfTE9HSU4sIFtvcHRpb25zXSk7XG5cdH1cblxuXHQvKipcblx0ICogUmVnaXN0ZXIgaGFuZGxlciBmb3IgT1dlYkFwcC5FVlRfQVBQX1JFQURZIGV2ZW50XG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVyXG5cdCAqL1xuXHRvblJlYWR5KGhhbmRsZXI6ICh0aGlzOiB0aGlzKSA9PiB2b2lkIHwgYm9vbGVhbikge1xuXHRcdHJldHVybiB0aGlzLm9uKE9XZWJBcHAuRVZUX0FQUF9SRUFEWSwgaGFuZGxlcik7XG5cdH1cblxuXHQvKipcblx0ICogUmVnaXN0ZXIgaGFuZGxlciBmb3IgT1dlYkFwcC5FVlRfU0hPV19IT01FIGV2ZW50XG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVyXG5cdCAqL1xuXHRvblNob3dIb21lUGFnZShcblx0XHRoYW5kbGVyOiAodGhpczogdGhpcywgb3B0aW9uczogT1JvdXRlU3RhdGVPYmplY3QpID0+IHZvaWQgfCBib29sZWFuLFxuXHQpIHtcblx0XHRyZXR1cm4gdGhpcy5vbihPV2ViQXBwLkVWVF9TSE9XX0hPTUUsIGhhbmRsZXIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlZ2lzdGVyIGhhbmRsZXIgZm9yIE9XZWJBcHAuRVZUX1NIT1dfTE9HSU4gZXZlbnRcblx0ICpcblx0ICogQHBhcmFtIGhhbmRsZXJcblx0ICovXG5cdG9uU2hvd0xvZ2luUGFnZShcblx0XHRoYW5kbGVyOiAodGhpczogdGhpcywgb3B0aW9uczogT1JvdXRlU3RhdGVPYmplY3QpID0+IHZvaWQgfCBib29sZWFuLFxuXHQpIHtcblx0XHRyZXR1cm4gdGhpcy5vbihPV2ViQXBwLkVWVF9TSE9XX0xPR0lOLCBoYW5kbGVyKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZWdpc3RlciBoYW5kbGVyIGZvciBPV2ViQXBwLkVWVF9TSE9XX1JFR0lTVFJBVElPTl9QQUdFIGV2ZW50XG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVyXG5cdCAqL1xuXHRvblNob3dSZWdpc3RyYXRpb25QYWdlKFxuXHRcdGhhbmRsZXI6ICh0aGlzOiB0aGlzLCBvcHRpb25zOiBPUm91dGVTdGF0ZU9iamVjdCkgPT4gdm9pZCB8IGJvb2xlYW4sXG5cdCkge1xuXHRcdHJldHVybiB0aGlzLm9uKE9XZWJBcHAuRVZUX1NIT1dfUkVHSVNUUkFUSU9OX1BBR0UsIGhhbmRsZXIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlZ2lzdGVyIGhhbmRsZXIgZm9yIE9XZWJBcHAuRVZUX05PVF9GT1VORCBldmVudFxuXHQgKlxuXHQgKiBAcGFyYW0gaGFuZGxlclxuXHQgKi9cblx0b25QYWdlTm90Rm91bmQoXG5cdFx0aGFuZGxlcjogKHRoaXM6IHRoaXMsIHRhcmdldDogT1JvdXRlVGFyZ2V0KSA9PiB2b2lkIHwgYm9vbGVhbixcblx0KSB7XG5cdFx0cmV0dXJuIHRoaXMub24oT1dlYkFwcC5FVlRfTk9UX0ZPVU5ELCBoYW5kbGVyKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIG5ldyBhcHAgaW5zdGFuY2UuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zXG5cdCAqL1xuXHRzdGF0aWMgY3JlYXRlPE9wdGlvbnMgZXh0ZW5kcyBPQXBwT3B0aW9uczxPU3RvcmUsIE9QYWdlPiA9IGFueT4oXG5cdFx0b3B0aW9uczogT3B0aW9ucyxcblx0KSB7XG5cdFx0cmV0dXJuIG5ldyBPV2ViQXBwKG9wdGlvbnMpO1xuXHR9XG5cbn1cbiJdfQ==