import OWebCom from './OWebCom';
import OWebConfigs from './OWebConfigs';
import OWebCurrentUser from './OWebCurrentUser';
import OWebDataStore from './OWebDataStore';
import OWebEvent from './OWebEvent';
import OWebFormValidator from './OWebFormValidator';
import OWebRouter from './OWebRouter';
import OWebUrl from './OWebUrl';
import OWebView from './OWebView';
import OWebDate from './plugins/OWebDate';
import Utils from './utils/Utils';
import OWebI18n from './OWebI18n';
import OWebPager from './OWebPager';
/**
 * @ignore
 */
const noop = () => { };
export default class OWebApp extends OWebEvent {
    /**
     * OWebApp constructor.
     *
     * @param name The app name.
     * @param configs The app config.
     * @param urls The app url list.
     * @param state The app state.
     */
    constructor(name, configs, urls) {
        super();
        this.name = name;
        this._requestDefaultOptions = {
            headers: {},
        };
        this.ls = new OWebDataStore(this);
        this.configs = new OWebConfigs(this, configs);
        this.url = new OWebUrl(this, urls);
        this.user = new OWebCurrentUser(this);
        this.view = new OWebView();
        this.pager = new OWebPager(this);
        this.i18n = new OWebI18n();
        const ctx = this, base_url = this.configs.get('OW_APP_LOCAL_BASE_URL'), hash_mode = false !== this.configs.get('OW_APP_ROUTER_HASH_MODE');
        this.router = new OWebRouter(base_url, hash_mode, function (target) {
            ctx.trigger(OWebApp.EVT_NOT_FOUND, [target]);
        });
        this.i18n.setDefaultLang(this.configs.get('OW_APP_DEFAULT_LANG'));
        let api_key_header = this.configs.get('OZ_API_KEY_HEADER_NAME');
        this._requestDefaultOptions.headers = {
            [api_key_header]: this.configs.get('OZ_API_KEY'),
        };
    }
    /**
     * Get request default options
     */
    getRequestDefaultOptions() {
        return Utils.copy(this._requestDefaultOptions);
    }
    /**
     * Set session token
     */
    setSessionToken(token) {
        let header_name = this.configs.get('OZ_SESSION_TOKEN_HEADER_NAME');
        if (header_name && token) {
            this._requestDefaultOptions.headers[header_name] = token;
        }
        return this;
    }
    /**
     * App name getter.
     */
    getAppName() {
        return this.name;
    }
    /**
     * Checks if we are running in mobile app.
     */
    isMobileApp() {
        return 'cordova' in window;
    }
    /**
     * Returns new form validator instance.
     *
     * @param form The html form element.
     * @param required The required fields names list.
     * @param excluded The fields names to exclude.
     * @param checkAll Force the validator to check all fields.
     */
    getFormValidator(form, required = [], excluded = [], checkAll = false) {
        return new OWebFormValidator(this, form, required, excluded, checkAll);
    }
    /**
     * Force login.
     *
     * > This will clear all saved data in the local storage.
     */
    forceLogin() {
        this.ls.clear();
        this.showLoginPage({});
    }
    /**
     * Reload the app.
     */
    reloadApp() {
        // TODO: instead of reloading the current location, find a way to browse to web app entry point
        // for android & ios restart the app
        // window.location.reload(true);
        this.showHomePage({});
    }
    /**
     * Destroy the app.
     *
     * > This will clear all saved data in the local storage.
     */
    destroyApp() {
        // erase data
        this.ls.clear();
        this.reloadApp();
    }
    /**
     * Close app.
     */
    closeApp() {
        // cordova
        if (window.navigator && window.navigator.app) {
            window.navigator.app.exitApp();
        }
        else {
            window.close();
        }
    }
    /**
     * Checks if user session is active.
     */
    sessionActive() {
        let now = new Date().getTime(); // milliseconds
        let hour = 60 * 60; // seconds
        let expire = this.user.getSessionExpire() - hour; // seconds
        return expire * 1000 > now;
    }
    /**
     * Checks if the current user has been authenticated.
     */
    userVerified() {
        return Boolean(this.user.getCurrentUser() && this.sessionActive());
    }
    /**
     * Send request and return promise.
     *
     * @param method The request method.
     * @param url The request url.
     * @param data The request payload.
     * @param freeze Force app view to be frozen.
     */
    requestPromise(method, url, data, freeze = false) {
        let m = this;
        return new Promise(function (resolve, reject) {
            m.request(method, url, data, resolve, reject, freeze);
        });
    }
    /**
     * Send request.
     *
     * @param method The request method.
     * @param url The request url.
     * @param data The request payload.
     * @param success Request success callback.
     * @param fail Request fail callback.
     * @param freeze Force app view to be frozen.
     */
    request(method, url, data, success = noop, fail = noop, freeze = false) {
        let app = this;
        if (freeze) {
            app.view.freeze();
        }
        let options = {
            url: url,
            method: method,
            data: data,
            badNewsShow: false,
        };
        let com = new OWebCom(this, options);
        com.on(OWebCom.EVT_COM_REQUEST_SUCCESS, (response) => {
            // setTimeout(function () {
            if (freeze) {
                app.view.unfreeze();
            }
            success.call(com, response);
            // }, 1000);
        })
            .on(OWebCom.EVT_COM_REQUEST_ERROR, (response) => {
            if (response['msg'] === 'OZ_ERROR_YOU_ARE_NOT_ADMIN') {
                app.destroyApp();
            }
            if (freeze) {
                app.view.unfreeze();
            }
            fail.call(com, response);
        })
            .on(OWebCom.EVT_COM_NETWORK_ERROR, () => {
            if (freeze) {
                app.view.unfreeze();
            }
            let response = {
                error: 1,
                msg: 'OZ_ERROR_REQUEST_FAIL',
                utime: OWebDate.timestamp(),
            };
            response.neterror = true;
            fail.call(com, response);
        })
            .send();
        return com;
    }
    /**
     * To start the web app.
     */
    start() {
        console.log('[OWebApp] app started!');
        this.trigger(OWebApp.EVT_APP_READY);
        return this;
    }
    /**
     * Called when app should show the home page.
     */
    showHomePage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_HOME, [options]);
    }
    /**
     * Called when app should show the login page.
     */
    showLoginPage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_LOGIN, [options]);
    }
    /**
     * Called when app should show the registration page.
     */
    showRegistrationPage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_LOGIN, [options]);
    }
    /**
     * Register handler for OWebApp.EVT_APP_READY event
     *
     * @param handler
     */
    onReady(handler) {
        return this.on(OWebApp.EVT_APP_READY, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_HOME event
     *
     * @param handler
     */
    onShowHomePage(handler) {
        return this.on(OWebApp.EVT_SHOW_HOME, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_LOGIN event
     *
     * @param handler
     */
    onShowLoginPage(handler) {
        return this.on(OWebApp.EVT_SHOW_LOGIN, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_REGISTRATION_PAGE event
     *
     * @param handler
     */
    onShowRegistrationPage(handler) {
        return this.on(OWebApp.EVT_SHOW_REGISTRATION_PAGE, handler);
    }
    /**
     * Register handler for OWebApp.EVT_NOT_FOUND event
     *
     * @param handler
     */
    onPageNotFound(handler) {
        return this.on(OWebApp.EVT_NOT_FOUND, handler);
    }
}
OWebApp.SELF = Utils.id();
OWebApp.EVT_APP_READY = Utils.id();
OWebApp.EVT_NOT_FOUND = Utils.id();
OWebApp.EVT_SHOW_HOME = Utils.id();
OWebApp.EVT_SHOW_LOGIN = Utils.id();
OWebApp.EVT_SHOW_REGISTRATION_PAGE = Utils.id();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1dlYkFwcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9PV2ViQXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sT0FBeUIsTUFBTSxXQUFXLENBQUM7QUFDbEQsT0FBTyxXQUE0QixNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLGVBQWUsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRCxPQUFPLGFBQWEsTUFBTSxpQkFBaUIsQ0FBQztBQUM1QyxPQUFPLFNBQVMsTUFBTSxhQUFhLENBQUM7QUFDcEMsT0FBTyxpQkFBaUIsTUFBTSxxQkFBcUIsQ0FBQztBQUNwRCxPQUFPLFVBQStDLE1BQU0sY0FBYyxDQUFDO0FBQzNFLE9BQU8sT0FBcUIsTUFBTSxXQUFXLENBQUM7QUFDOUMsT0FBTyxRQUFRLE1BQU0sWUFBWSxDQUFDO0FBQ2xDLE9BQU8sUUFBUSxNQUFNLG9CQUFvQixDQUFDO0FBQzFDLE9BQU8sS0FBSyxNQUFNLGVBQWUsQ0FBQztBQUNsQyxPQUFPLFFBQVEsTUFBTSxZQUFZLENBQUM7QUFDbEMsT0FBTyxTQUFTLE1BQU0sYUFBYSxDQUFDO0FBRXBDOztHQUVHO0FBQ0gsTUFBTSxJQUFJLEdBQUcsR0FBRyxFQUFFLEdBQUUsQ0FBQyxDQUFDO0FBRXRCLE1BQU0sQ0FBQyxPQUFPLE9BQU8sT0FBUSxTQUFRLFNBQVM7SUFxQjdDOzs7Ozs7O09BT0c7SUFDSCxZQUNrQixJQUFZLEVBQzdCLE9BQW9CLEVBQ3BCLElBQWM7UUFFZCxLQUFLLEVBQUUsQ0FBQztRQUpTLFNBQUksR0FBSixJQUFJLENBQVE7UUF0QmIsMkJBQXNCLEdBQVE7WUFDOUMsT0FBTyxFQUFFLEVBQUU7U0FDWCxDQUFDO1FBMEJELElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLFdBQVcsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDOUMsSUFB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Q0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGNBQWMsQ0FDYixPQUFtRTtRQUVuRSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGVBQWUsQ0FDZCxPQUFtRTtRQUVuRSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILHNCQUFzQixDQUNyQixPQUFtRTtRQUVuRSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLDBCQUEwQixFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsY0FBYyxDQUNiLE9BQTZEO1FBRTdELE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2hELENBQUM7O0FBeFZlLFlBQUksR0FBRyxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDbEIscUJBQWEsR0FBRyxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDM0IscUJBQWEsR0FBRyxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDM0IscUJBQWEsR0FBRyxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDM0Isc0JBQWMsR0FBRyxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDNUIsa0NBQTBCLEdBQUcsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9XZWJDb20sIHsgaUNvbVJlc3BvbnNlIH0gZnJvbSAnLi9PV2ViQ29tJztcbmltcG9ydCBPV2ViQ29uZmlncywgeyB0Q29uZmlnTGlzdCB9IGZyb20gJy4vT1dlYkNvbmZpZ3MnO1xuaW1wb3J0IE9XZWJDdXJyZW50VXNlciBmcm9tICcuL09XZWJDdXJyZW50VXNlcic7XG5pbXBvcnQgT1dlYkRhdGFTdG9yZSBmcm9tICcuL09XZWJEYXRhU3RvcmUnO1xuaW1wb3J0IE9XZWJFdmVudCBmcm9tICcuL09XZWJFdmVudCc7XG5pbXBvcnQgT1dlYkZvcm1WYWxpZGF0b3IgZnJvbSAnLi9PV2ViRm9ybVZhbGlkYXRvcic7XG5pbXBvcnQgT1dlYlJvdXRlciwgeyB0Um91dGVUYXJnZXQsIHRSb3V0ZVN0YXRlT2JqZWN0IH0gZnJvbSAnLi9PV2ViUm91dGVyJztcbmltcG9ydCBPV2ViVXJsLCB7IHRVcmxMaXN0IH0gZnJvbSAnLi9PV2ViVXJsJztcbmltcG9ydCBPV2ViVmlldyBmcm9tICcuL09XZWJWaWV3JztcbmltcG9ydCBPV2ViRGF0ZSBmcm9tICcuL3BsdWdpbnMvT1dlYkRhdGUnO1xuaW1wb3J0IFV0aWxzIGZyb20gJy4vdXRpbHMvVXRpbHMnO1xuaW1wb3J0IE9XZWJJMThuIGZyb20gJy4vT1dlYkkxOG4nO1xuaW1wb3J0IE9XZWJQYWdlciBmcm9tICcuL09XZWJQYWdlcic7XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5jb25zdCBub29wID0gKCkgPT4ge307XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE9XZWJBcHAgZXh0ZW5kcyBPV2ViRXZlbnQge1xuXHRzdGF0aWMgcmVhZG9ubHkgU0VMRiA9IFV0aWxzLmlkKCk7XG5cdHN0YXRpYyByZWFkb25seSBFVlRfQVBQX1JFQURZID0gVXRpbHMuaWQoKTtcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9OT1RfRk9VTkQgPSBVdGlscy5pZCgpO1xuXHRzdGF0aWMgcmVhZG9ubHkgRVZUX1NIT1dfSE9NRSA9IFV0aWxzLmlkKCk7XG5cdHN0YXRpYyByZWFkb25seSBFVlRfU0hPV19MT0dJTiA9IFV0aWxzLmlkKCk7XG5cdHN0YXRpYyByZWFkb25seSBFVlRfU0hPV19SRUdJU1RSQVRJT05fUEFHRSA9IFV0aWxzLmlkKCk7XG5cblx0cHJpdmF0ZSByZWFkb25seSBfcmVxdWVzdERlZmF1bHRPcHRpb25zOiBhbnkgPSB7XG5cdFx0aGVhZGVyczoge30sXG5cdH07XG5cblx0cmVhZG9ubHkgdmlldzogT1dlYlZpZXc7XG5cdHJlYWRvbmx5IHBhZ2VyOiBPV2ViUGFnZXI8YW55Pjtcblx0cmVhZG9ubHkgbHM6IE9XZWJEYXRhU3RvcmU7XG5cdHJlYWRvbmx5IHJvdXRlcjogT1dlYlJvdXRlcjtcblx0cmVhZG9ubHkgdXNlcjogT1dlYkN1cnJlbnRVc2VyO1xuXHRyZWFkb25seSBjb25maWdzOiBPV2ViQ29uZmlncztcblx0cmVhZG9ubHkgdXJsOiBPV2ViVXJsO1xuXHRyZWFkb25seSBpMThuOiBPV2ViSTE4bjtcblxuXHQvKipcblx0ICogT1dlYkFwcCBjb25zdHJ1Y3Rvci5cblx0ICpcblx0ICogQHBhcmFtIG5hbWUgVGhlIGFwcCBuYW1lLlxuXHQgKiBAcGFyYW0gY29uZmlncyBUaGUgYXBwIGNvbmZpZy5cblx0ICogQHBhcmFtIHVybHMgVGhlIGFwcCB1cmwgbGlzdC5cblx0ICogQHBhcmFtIHN0YXRlIFRoZSBhcHAgc3RhdGUuXG5cdCAqL1xuXHRwcm90ZWN0ZWQgY29uc3RydWN0b3IoXG5cdFx0cHJpdmF0ZSByZWFkb25seSBuYW1lOiBzdHJpbmcsXG5cdFx0Y29uZmlnczogdENvbmZpZ0xpc3QsXG5cdFx0dXJsczogdFVybExpc3Rcblx0KSB7XG5cdFx0c3VwZXIoKTtcblxuXHRcdHRoaXMubHMgPSBuZXcgT1dlYkRhdGFTdG9yZSh0aGlzKTtcblx0XHR0aGlzLmNvbmZpZ3MgPSBuZXcgT1dlYkNvbmZpZ3ModGhpcywgY29uZmlncyk7XG5cdFx0dGhpcy51cmwgPSBuZXcgT1dlYlVybCh0aGlzLCB1cmxzKTtcblx0XHR0aGlzLnVzZXIgPSBuZXcgT1dlYkN1cnJlbnRVc2VyKHRoaXMpO1xuXHRcdHRoaXMudmlldyA9IG5ldyBPV2ViVmlldygpO1xuXHRcdHRoaXMucGFnZXIgPSBuZXcgT1dlYlBhZ2VyKHRoaXMpO1xuXHRcdHRoaXMuaTE4biA9IG5ldyBPV2ViSTE4bigpO1xuXG5cdFx0Y29uc3QgY3R4ID0gdGhpcyxcblx0XHRcdGJhc2VfdXJsID0gdGhpcy5jb25maWdzLmdldCgnT1dfQVBQX0xPQ0FMX0JBU0VfVVJMJyksXG5cdFx0XHRoYXNoX21vZGUgPSBmYWxzZSAhPT0gdGhpcy5jb25maWdzLmdldCgnT1dfQVBQX1JPVVRFUl9IQVNIX01PREUnKTtcblxuXHRcdHRoaXMucm91dGVyID0gbmV3IE9XZWJSb3V0ZXIoYmFzZV91cmwsIGhhc2hfbW9kZSwgZnVuY3Rpb24oXG5cdFx0XHR0YXJnZXQ6IHRSb3V0ZVRhcmdldFxuXHRcdCkge1xuXHRcdFx0Y3R4LnRyaWdnZXIoT1dlYkFwcC5FVlRfTk9UX0ZPVU5ELCBbdGFyZ2V0XSk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLmkxOG4uc2V0RGVmYXVsdExhbmcodGhpcy5jb25maWdzLmdldCgnT1dfQVBQX0RFRkFVTFRfTEFORycpKTtcblxuXHRcdGxldCBhcGlfa2V5X2hlYWRlciA9IHRoaXMuY29uZmlncy5nZXQoJ09aX0FQSV9LRVlfSEVBREVSX05BTUUnKTtcblx0XHR0aGlzLl9yZXF1ZXN0RGVmYXVsdE9wdGlvbnMuaGVhZGVycyA9IHtcblx0XHRcdFthcGlfa2V5X2hlYWRlcl06IHRoaXMuY29uZmlncy5nZXQoJ09aX0FQSV9LRVknKSxcblx0XHR9O1xuXHR9XG5cblx0LyoqXG5cdCAqIEdldCByZXF1ZXN0IGRlZmF1bHQgb3B0aW9uc1xuXHQgKi9cblx0Z2V0UmVxdWVzdERlZmF1bHRPcHRpb25zKCkge1xuXHRcdHJldHVybiBVdGlscy5jb3B5KHRoaXMuX3JlcXVlc3REZWZhdWx0T3B0aW9ucyk7XG5cdH1cblxuXHQvKipcblx0ICogU2V0IHNlc3Npb24gdG9rZW5cblx0ICovXG5cdHNldFNlc3Npb25Ub2tlbih0b2tlbjogc3RyaW5nKSB7XG5cdFx0bGV0IGhlYWRlcl9uYW1lID0gdGhpcy5jb25maWdzLmdldCgnT1pfU0VTU0lPTl9UT0tFTl9IRUFERVJfTkFNRScpO1xuXG5cdFx0aWYgKGhlYWRlcl9uYW1lICYmIHRva2VuKSB7XG5cdFx0XHR0aGlzLl9yZXF1ZXN0RGVmYXVsdE9wdGlvbnMuaGVhZGVyc1toZWFkZXJfbmFtZV0gPSB0b2tlbjtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKlxuXHQgKiBBcHAgbmFtZSBnZXR0ZXIuXG5cdCAqL1xuXHRnZXRBcHBOYW1lKCk6IHN0cmluZyB7XG5cdFx0cmV0dXJuIHRoaXMubmFtZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDaGVja3MgaWYgd2UgYXJlIHJ1bm5pbmcgaW4gbW9iaWxlIGFwcC5cblx0ICovXG5cdGlzTW9iaWxlQXBwKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiAnY29yZG92YScgaW4gd2luZG93O1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgbmV3IGZvcm0gdmFsaWRhdG9yIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gZm9ybSBUaGUgaHRtbCBmb3JtIGVsZW1lbnQuXG5cdCAqIEBwYXJhbSByZXF1aXJlZCBUaGUgcmVxdWlyZWQgZmllbGRzIG5hbWVzIGxpc3QuXG5cdCAqIEBwYXJhbSBleGNsdWRlZCBUaGUgZmllbGRzIG5hbWVzIHRvIGV4Y2x1ZGUuXG5cdCAqIEBwYXJhbSBjaGVja0FsbCBGb3JjZSB0aGUgdmFsaWRhdG9yIHRvIGNoZWNrIGFsbCBmaWVsZHMuXG5cdCAqL1xuXHRnZXRGb3JtVmFsaWRhdG9yKFxuXHRcdGZvcm06IEhUTUxGb3JtRWxlbWVudCxcblx0XHRyZXF1aXJlZDogQXJyYXk8c3RyaW5nPiA9IFtdLFxuXHRcdGV4Y2x1ZGVkOiBBcnJheTxzdHJpbmc+ID0gW10sXG5cdFx0Y2hlY2tBbGw6IGJvb2xlYW4gPSBmYWxzZVxuXHQpIHtcblx0XHRyZXR1cm4gbmV3IE9XZWJGb3JtVmFsaWRhdG9yKHRoaXMsIGZvcm0sIHJlcXVpcmVkLCBleGNsdWRlZCwgY2hlY2tBbGwpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEZvcmNlIGxvZ2luLlxuXHQgKlxuXHQgKiA+IFRoaXMgd2lsbCBjbGVhciBhbGwgc2F2ZWQgZGF0YSBpbiB0aGUgbG9jYWwgc3RvcmFnZS5cblx0ICovXG5cdGZvcmNlTG9naW4oKSB7XG5cdFx0dGhpcy5scy5jbGVhcigpO1xuXHRcdHRoaXMuc2hvd0xvZ2luUGFnZSh7fSk7XG5cdH1cblxuXHQvKipcblx0ICogUmVsb2FkIHRoZSBhcHAuXG5cdCAqL1xuXHRyZWxvYWRBcHAoKSB7XG5cdFx0Ly8gVE9ETzogaW5zdGVhZCBvZiByZWxvYWRpbmcgdGhlIGN1cnJlbnQgbG9jYXRpb24sIGZpbmQgYSB3YXkgdG8gYnJvd3NlIHRvIHdlYiBhcHAgZW50cnkgcG9pbnRcblx0XHQvLyBmb3IgYW5kcm9pZCAmIGlvcyByZXN0YXJ0IHRoZSBhcHBcblx0XHQvLyB3aW5kb3cubG9jYXRpb24ucmVsb2FkKHRydWUpO1xuXHRcdHRoaXMuc2hvd0hvbWVQYWdlKHt9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBEZXN0cm95IHRoZSBhcHAuXG5cdCAqXG5cdCAqID4gVGhpcyB3aWxsIGNsZWFyIGFsbCBzYXZlZCBkYXRhIGluIHRoZSBsb2NhbCBzdG9yYWdlLlxuXHQgKi9cblx0ZGVzdHJveUFwcCgpIHtcblx0XHQvLyBlcmFzZSBkYXRhXG5cdFx0dGhpcy5scy5jbGVhcigpO1xuXHRcdHRoaXMucmVsb2FkQXBwKCk7XG5cdH1cblxuXHQvKipcblx0ICogQ2xvc2UgYXBwLlxuXHQgKi9cblx0Y2xvc2VBcHAoKSB7XG5cdFx0Ly8gY29yZG92YVxuXHRcdGlmICh3aW5kb3cubmF2aWdhdG9yICYmICh3aW5kb3cubmF2aWdhdG9yIGFzIGFueSkuYXBwKSB7XG5cdFx0XHQod2luZG93Lm5hdmlnYXRvciBhcyBhbnkpLmFwcC5leGl0QXBwKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHdpbmRvdy5jbG9zZSgpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBDaGVja3MgaWYgdXNlciBzZXNzaW9uIGlzIGFjdGl2ZS5cblx0ICovXG5cdHNlc3Npb25BY3RpdmUoKTogYm9vbGVhbiB7XG5cdFx0bGV0IG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOyAvLyBtaWxsaXNlY29uZHNcblx0XHRsZXQgaG91ciA9IDYwICogNjA7IC8vIHNlY29uZHNcblx0XHRsZXQgZXhwaXJlID0gdGhpcy51c2VyLmdldFNlc3Npb25FeHBpcmUoKSAtIGhvdXI7IC8vIHNlY29uZHNcblx0XHRyZXR1cm4gZXhwaXJlICogMTAwMCA+IG5vdztcblx0fVxuXG5cdC8qKlxuXHQgKiBDaGVja3MgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgYmVlbiBhdXRoZW50aWNhdGVkLlxuXHQgKi9cblx0dXNlclZlcmlmaWVkKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiBCb29sZWFuKHRoaXMudXNlci5nZXRDdXJyZW50VXNlcigpICYmIHRoaXMuc2Vzc2lvbkFjdGl2ZSgpKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBTZW5kIHJlcXVlc3QgYW5kIHJldHVybiBwcm9taXNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gbWV0aG9kIFRoZSByZXF1ZXN0IG1ldGhvZC5cblx0ICogQHBhcmFtIHVybCBUaGUgcmVxdWVzdCB1cmwuXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSByZXF1ZXN0IHBheWxvYWQuXG5cdCAqIEBwYXJhbSBmcmVlemUgRm9yY2UgYXBwIHZpZXcgdG8gYmUgZnJvemVuLlxuXHQgKi9cblx0cmVxdWVzdFByb21pc2UoXG5cdFx0bWV0aG9kOiBzdHJpbmcsXG5cdFx0dXJsOiBzdHJpbmcsXG5cdFx0ZGF0YTogYW55LFxuXHRcdGZyZWV6ZTogYm9vbGVhbiA9IGZhbHNlXG5cdCk6IFByb21pc2U8aUNvbVJlc3BvbnNlPiB7XG5cdFx0bGV0IG0gPSB0aGlzO1xuXHRcdHJldHVybiBuZXcgUHJvbWlzZTxpQ29tUmVzcG9uc2U+KGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdFx0bS5yZXF1ZXN0KG1ldGhvZCwgdXJsLCBkYXRhLCByZXNvbHZlLCByZWplY3QsIGZyZWV6ZSk7XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogU2VuZCByZXF1ZXN0LlxuXHQgKlxuXHQgKiBAcGFyYW0gbWV0aG9kIFRoZSByZXF1ZXN0IG1ldGhvZC5cblx0ICogQHBhcmFtIHVybCBUaGUgcmVxdWVzdCB1cmwuXG5cdCAqIEBwYXJhbSBkYXRhIFRoZSByZXF1ZXN0IHBheWxvYWQuXG5cdCAqIEBwYXJhbSBzdWNjZXNzIFJlcXVlc3Qgc3VjY2VzcyBjYWxsYmFjay5cblx0ICogQHBhcmFtIGZhaWwgUmVxdWVzdCBmYWlsIGNhbGxiYWNrLlxuXHQgKiBAcGFyYW0gZnJlZXplIEZvcmNlIGFwcCB2aWV3IHRvIGJlIGZyb3plbi5cblx0ICovXG5cdHJlcXVlc3QoXG5cdFx0bWV0aG9kOiBzdHJpbmcsXG5cdFx0dXJsOiBzdHJpbmcsXG5cdFx0ZGF0YTogYW55LFxuXHRcdHN1Y2Nlc3M6ICh0aGlzOiBPV2ViQ29tLCByZXNwb25zZTogaUNvbVJlc3BvbnNlKSA9PiB2b2lkID0gbm9vcCxcblx0XHRmYWlsOiAodGhpczogT1dlYkNvbSwgcmVzcG9uc2U6IGlDb21SZXNwb25zZSkgPT4gdm9pZCA9IG5vb3AsXG5cdFx0ZnJlZXplOiBib29sZWFuID0gZmFsc2Vcblx0KTogT1dlYkNvbSB7XG5cdFx0bGV0IGFwcCA9IHRoaXM7XG5cblx0XHRpZiAoZnJlZXplKSB7XG5cdFx0XHRhcHAudmlldy5mcmVlemUoKTtcblx0XHR9XG5cblx0XHRsZXQgb3B0aW9ucyA9IHtcblx0XHRcdHVybDogdXJsLFxuXHRcdFx0bWV0aG9kOiBtZXRob2QsXG5cdFx0XHRkYXRhOiBkYXRhLFxuXHRcdFx0YmFkTmV3c1Nob3c6IGZhbHNlLFxuXHRcdH07XG5cblx0XHRsZXQgY29tID0gbmV3IE9XZWJDb20odGhpcywgb3B0aW9ucyk7XG5cdFx0Y29tLm9uKE9XZWJDb20uRVZUX0NPTV9SRVFVRVNUX1NVQ0NFU1MsIChyZXNwb25zZTogaUNvbVJlc3BvbnNlKSA9PiB7XG5cdFx0XHQvLyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblx0XHRcdGlmIChmcmVlemUpIHtcblx0XHRcdFx0YXBwLnZpZXcudW5mcmVlemUoKTtcblx0XHRcdH1cblxuXHRcdFx0c3VjY2Vzcy5jYWxsKGNvbSwgcmVzcG9uc2UpO1xuXHRcdFx0Ly8gfSwgMTAwMCk7XG5cdFx0fSlcblx0XHRcdC5vbihPV2ViQ29tLkVWVF9DT01fUkVRVUVTVF9FUlJPUiwgKHJlc3BvbnNlOiBpQ29tUmVzcG9uc2UpID0+IHtcblx0XHRcdFx0aWYgKHJlc3BvbnNlWydtc2cnXSA9PT0gJ09aX0VSUk9SX1lPVV9BUkVfTk9UX0FETUlOJykge1xuXHRcdFx0XHRcdGFwcC5kZXN0cm95QXBwKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZnJlZXplKSB7XG5cdFx0XHRcdFx0YXBwLnZpZXcudW5mcmVlemUoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGZhaWwuY2FsbChjb20sIHJlc3BvbnNlKTtcblx0XHRcdH0pXG5cdFx0XHQub24oT1dlYkNvbS5FVlRfQ09NX05FVFdPUktfRVJST1IsICgpID0+IHtcblx0XHRcdFx0aWYgKGZyZWV6ZSkge1xuXHRcdFx0XHRcdGFwcC52aWV3LnVuZnJlZXplKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0bGV0IHJlc3BvbnNlOiBpQ29tUmVzcG9uc2UgPSB7XG5cdFx0XHRcdFx0ZXJyb3I6IDEsXG5cdFx0XHRcdFx0bXNnOiAnT1pfRVJST1JfUkVRVUVTVF9GQUlMJyxcblx0XHRcdFx0XHR1dGltZTogT1dlYkRhdGUudGltZXN0YW1wKCksXG5cdFx0XHRcdH07XG5cblx0XHRcdFx0cmVzcG9uc2UubmV0ZXJyb3IgPSB0cnVlO1xuXG5cdFx0XHRcdGZhaWwuY2FsbChjb20sIHJlc3BvbnNlKTtcblx0XHRcdH0pXG5cdFx0XHQuc2VuZCgpO1xuXG5cdFx0cmV0dXJuIGNvbTtcblx0fVxuXG5cdC8qKlxuXHQgKiBUbyBzdGFydCB0aGUgd2ViIGFwcC5cblx0ICovXG5cdHN0YXJ0KCk6IHRoaXMge1xuXHRcdGNvbnNvbGUubG9nKCdbT1dlYkFwcF0gYXBwIHN0YXJ0ZWQhJyk7XG5cdFx0dGhpcy50cmlnZ2VyKE9XZWJBcHAuRVZUX0FQUF9SRUFEWSk7XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHQvKipcblx0ICogQ2FsbGVkIHdoZW4gYXBwIHNob3VsZCBzaG93IHRoZSBob21lIHBhZ2UuXG5cdCAqL1xuXHRzaG93SG9tZVBhZ2Uob3B0aW9uczogdFJvdXRlU3RhdGVPYmplY3QgPSB7fSkge1xuXHRcdHRoaXMudHJpZ2dlcihPV2ViQXBwLkVWVF9TSE9XX0hPTUUsIFtvcHRpb25zXSk7XG5cdH1cblxuXHQvKipcblx0ICogQ2FsbGVkIHdoZW4gYXBwIHNob3VsZCBzaG93IHRoZSBsb2dpbiBwYWdlLlxuXHQgKi9cblx0c2hvd0xvZ2luUGFnZShvcHRpb25zOiB0Um91dGVTdGF0ZU9iamVjdCA9IHt9KSB7XG5cdFx0dGhpcy50cmlnZ2VyKE9XZWJBcHAuRVZUX1NIT1dfTE9HSU4sIFtvcHRpb25zXSk7XG5cdH1cblxuXHQvKipcblx0ICogQ2FsbGVkIHdoZW4gYXBwIHNob3VsZCBzaG93IHRoZSByZWdpc3RyYXRpb24gcGFnZS5cblx0ICovXG5cdHNob3dSZWdpc3RyYXRpb25QYWdlKG9wdGlvbnM6IHRSb3V0ZVN0YXRlT2JqZWN0ID0ge30pIHtcblx0XHR0aGlzLnRyaWdnZXIoT1dlYkFwcC5FVlRfU0hPV19MT0dJTiwgW29wdGlvbnNdKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZWdpc3RlciBoYW5kbGVyIGZvciBPV2ViQXBwLkVWVF9BUFBfUkVBRFkgZXZlbnRcblx0ICpcblx0ICogQHBhcmFtIGhhbmRsZXJcblx0ICovXG5cdG9uUmVhZHkoaGFuZGxlcjogKHRoaXM6IHRoaXMpID0+IHZvaWQgfCBib29sZWFuKSB7XG5cdFx0cmV0dXJuIHRoaXMub24oT1dlYkFwcC5FVlRfQVBQX1JFQURZLCBoYW5kbGVyKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZWdpc3RlciBoYW5kbGVyIGZvciBPV2ViQXBwLkVWVF9TSE9XX0hPTUUgZXZlbnRcblx0ICpcblx0ICogQHBhcmFtIGhhbmRsZXJcblx0ICovXG5cdG9uU2hvd0hvbWVQYWdlKFxuXHRcdGhhbmRsZXI6ICh0aGlzOiB0aGlzLCBvcHRpb25zOiB0Um91dGVTdGF0ZU9iamVjdCkgPT4gdm9pZCB8IGJvb2xlYW5cblx0KSB7XG5cdFx0cmV0dXJuIHRoaXMub24oT1dlYkFwcC5FVlRfU0hPV19IT01FLCBoYW5kbGVyKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZWdpc3RlciBoYW5kbGVyIGZvciBPV2ViQXBwLkVWVF9TSE9XX0xPR0lOIGV2ZW50XG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVyXG5cdCAqL1xuXHRvblNob3dMb2dpblBhZ2UoXG5cdFx0aGFuZGxlcjogKHRoaXM6IHRoaXMsIG9wdGlvbnM6IHRSb3V0ZVN0YXRlT2JqZWN0KSA9PiB2b2lkIHwgYm9vbGVhblxuXHQpIHtcblx0XHRyZXR1cm4gdGhpcy5vbihPV2ViQXBwLkVWVF9TSE9XX0xPR0lOLCBoYW5kbGVyKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZWdpc3RlciBoYW5kbGVyIGZvciBPV2ViQXBwLkVWVF9TSE9XX1JFR0lTVFJBVElPTl9QQUdFIGV2ZW50XG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVyXG5cdCAqL1xuXHRvblNob3dSZWdpc3RyYXRpb25QYWdlKFxuXHRcdGhhbmRsZXI6ICh0aGlzOiB0aGlzLCBvcHRpb25zOiB0Um91dGVTdGF0ZU9iamVjdCkgPT4gdm9pZCB8IGJvb2xlYW5cblx0KSB7XG5cdFx0cmV0dXJuIHRoaXMub24oT1dlYkFwcC5FVlRfU0hPV19SRUdJU1RSQVRJT05fUEFHRSwgaGFuZGxlcik7XG5cdH1cblxuXHQvKipcblx0ICogUmVnaXN0ZXIgaGFuZGxlciBmb3IgT1dlYkFwcC5FVlRfTk9UX0ZPVU5EIGV2ZW50XG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVyXG5cdCAqL1xuXHRvblBhZ2VOb3RGb3VuZChcblx0XHRoYW5kbGVyOiAodGhpczogdGhpcywgdGFyZ2V0OiB0Um91dGVUYXJnZXQpID0+IHZvaWQgfCBib29sZWFuXG5cdCkge1xuXHRcdHJldHVybiB0aGlzLm9uKE9XZWJBcHAuRVZUX05PVF9GT1VORCwgaGFuZGxlcik7XG5cdH1cbn1cbiJdfQ==