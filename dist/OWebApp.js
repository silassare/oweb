import OWebConfigs from './OWebConfigs';
import OWebDataStore from './OWebDataStore';
import OWebEvent from './OWebEvent';
import OWebForm from './OWebForm';
import OWebRouter from './OWebRouter';
import OWebUrl from './OWebUrl';
import OWebView from './OWebView';
import OWebI18n from './OWebI18n';
import { assign, id, logger } from './utils';
import OZone from './ozone';
import OWebXHR from './OWebXHR';
import defaultAppConfigs from './default/app.configs';
import defaultUserConfigs from './default/user.configs';
import defaultAppUrls from './default/app.urls';
import { OFormDOMFormAdapter, OFormObjectAdapter } from './OWebFormAdapter';
import { globalRoot } from './env';
export default class OWebApp extends OWebEvent {
    options;
    static SELF = id();
    static EVT_APP_READY = id();
    static EVT_NOT_FOUND = id();
    static EVT_SHOW_HOME = id();
    static EVT_SHOW_LOGIN = id();
    static EVT_SHOW_REGISTRATION_PAGE = id();
    view;
    ls;
    router;
    configs;
    url;
    i18n;
    oz;
    _user;
    _store;
    _pager;
    /**
     * OWebApp constructor.
     *
     * @param options
     */
    constructor(options) {
        super();
        this.options = options;
        this.ls = new OWebDataStore(this);
        this.configs = new OWebConfigs(this, assign({}, defaultAppConfigs, options.appConfigs), assign({}, defaultUserConfigs, options.userConfigs));
        this.url = new OWebUrl(this, assign({}, defaultAppUrls, options.urls));
        this.view = new OWebView();
        this.i18n = new OWebI18n(this);
        this._user = options.user.call(this);
        this._store = options.store.call(this);
        this._pager = options.pager.call(this);
        const ctx = this, baseUrl = this.configs.get('OW_APP_LOCAL_BASE_URL'), hashMode = this.configs.get('OW_APP_ROUTER_HASH_MODE');
        this.router = new OWebRouter(baseUrl, hashMode, function notFoundHandler(target) {
            ctx.trigger(OWebApp.EVT_NOT_FOUND, [target]);
        });
        this.i18n.setLang(this.configs.get('OW_APP_DEFAULT_LANG'));
        this.oz = OZone.instantiate(this);
    }
    /**
     * Build an HTTP request.
     *
     * @param url
     * @param options
     */
    request(url, options = {}) {
        logger.debug('[Net] new request', url, options);
        const event = function event(type) {
            return function eventHandler(...args) {
                logger.debug('[Net] event %s', type, url, options, args);
            };
        };
        const o = new OWebXHR(url, {
            withCredentials: true,
            ...options,
        });
        o.onFinish(event('onFinished'))
            .onError(event('onError'))
            .onFail(event('onFailed'))
            .onHttpError(event('onHttpError'))
            .onHttpSuccess(event('onHttpSuccess'))
            .onGoodNews(event('onGoodNews'))
            .onBadNews(event('onBadNews'))
            .onDownloadProgress(event('onDownloadProgress'))
            .onUploadProgress(event('onUploadProgress'))
            .onResponse(event('onResponse'));
        return o;
    }
    /**
     * User getter.
     */
    get user() {
        return this._user;
    }
    /**
     * Store getter.
     */
    get store() {
        return this._store;
    }
    /**
     * Pager instance getter.
     */
    get pager() {
        return this._pager;
    }
    /**
     * App name getter.
     */
    getAppName() {
        return this.options.name;
    }
    /**
     * Checks if we are running in mobile app.
     */
    isMobileApp() {
        return 'cordova' in window;
    }
    /**
     * Returns new oweb form instance.
     *
     * @param form The html form element.
     * @param required The required fields names list.
     * @param excluded The fields names to exclude.
     * @param checkAll Force the validator to check all fields.
     * @param verbose Log warning.
     *
     * @deprecated use {@link OWebApp.form}
     */
    getFormValidator(form, required = [], excluded = [], checkAll = false, verbose = false) {
        return this.form(form, required, excluded, checkAll, verbose);
    }
    /**
     * Returns new oweb form instance.
     *
     * @param form The html form element.
     * @param required The required fields names list.
     * @param excluded The fields names to exclude.
     * @param checkAll Force the validator to check all fields.
     * @param verbose Log warning.
     */
    form(form, required = [], excluded = [], checkAll = false, verbose = false) {
        return new OWebForm(this, form instanceof HTMLFormElement
            ? new OFormDOMFormAdapter(form)
            : new OFormObjectAdapter(form), required, excluded, checkAll, verbose);
    }
    /**
     * Force login.
     *
     * > This will clear all saved data in the local storage.
     */
    forceLogin() {
        this.ls.clear();
        this.showLoginPage({});
    }
    /**
     * Reload the app.
     */
    reloadApp() {
        // TODO: instead of reloading the current location, find a way to browse to web app entry point
        // for android & ios restart the app
        // window.location.reload(true);
        this.showHomePage({});
    }
    /**
     * Destroy the app.
     *
     * > This will clear all saved data in the local storage.
     */
    destroyApp() {
        // erase data
        this.ls.clear();
        this.reloadApp();
    }
    /**
     * Close app.
     */
    closeApp() {
        // cordova
        if (globalRoot.navigator && globalRoot.navigator.app) {
            globalRoot.navigator.app.exitApp();
        }
        else {
            globalRoot.close();
        }
    }
    /**
     * To start the web app.
     */
    start() {
        logger.info('[OWebApp] app started!');
        this.trigger(OWebApp.EVT_APP_READY);
        return this;
    }
    /**
     * Called when app should show the home page.
     */
    showHomePage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_HOME, [options]);
    }
    /**
     * Called when app should show the login page.
     */
    showLoginPage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_LOGIN, [options]);
    }
    /**
     * Called when app should show the registration page.
     */
    showRegistrationPage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_LOGIN, [options]);
    }
    /**
     * Register handler for OWebApp.EVT_APP_READY event
     *
     * @param handler
     */
    onReady(handler) {
        return this.on(OWebApp.EVT_APP_READY, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_HOME event
     *
     * @param handler
     */
    onShowHomePage(handler) {
        return this.on(OWebApp.EVT_SHOW_HOME, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_LOGIN event
     *
     * @param handler
     */
    onShowLoginPage(handler) {
        return this.on(OWebApp.EVT_SHOW_LOGIN, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_REGISTRATION_PAGE event
     *
     * @param handler
     */
    onShowRegistrationPage(handler) {
        return this.on(OWebApp.EVT_SHOW_REGISTRATION_PAGE, handler);
    }
    /**
     * Register handler for OWebApp.EVT_NOT_FOUND event
     *
     * @param handler
     */
    onPageNotFound(handler) {
        return this.on(OWebApp.EVT_NOT_FOUND, handler);
    }
    /**
     * Creates new app instance.
     *
     * @param options
     */
    static create(options) {
        return new OWebApp(options);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1dlYkFwcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9PV2ViQXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sV0FBVyxNQUFNLGVBQWUsQ0FBQztBQUN4QyxPQUFPLGFBQTZCLE1BQU0saUJBQWlCLENBQUM7QUFDNUQsT0FBTyxTQUFTLE1BQU0sYUFBYSxDQUFDO0FBQ3BDLE9BQU8sUUFBZ0MsTUFBTSxZQUFZLENBQUM7QUFDMUQsT0FBTyxVQUErQyxNQUFNLGNBQWMsQ0FBQztBQUMzRSxPQUFPLE9BQU8sTUFBTSxXQUFXLENBQUM7QUFDaEMsT0FBTyxRQUFRLE1BQU0sWUFBWSxDQUFDO0FBQ2xDLE9BQU8sUUFBUSxNQUFNLFlBQVksQ0FBQztBQUNsQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDN0MsT0FBTyxLQUFLLE1BQU0sU0FBUyxDQUFDO0FBSTVCLE9BQU8sT0FBTyxNQUFNLFdBQVcsQ0FBQztBQUNoQyxPQUFPLGlCQUFpQixNQUFNLHVCQUF1QixDQUFDO0FBQ3RELE9BQU8sa0JBQWtCLE1BQU0sd0JBQXdCLENBQUM7QUFDeEQsT0FBTyxjQUFjLE1BQU0sb0JBQW9CLENBQUM7QUFDaEQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLGtCQUFrQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDNUUsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLE9BQU8sQ0FBQztBQWdGakMsTUFBTSxDQUFDLE9BQU8sT0FBTyxPQUtuQixTQUFRLFNBQVM7SUE0QnFCO0lBM0J2QyxNQUFNLENBQVUsSUFBSSxHQUFHLEVBQUUsRUFBRSxDQUFDO0lBQzVCLE1BQU0sQ0FBVSxhQUFhLEdBQUcsRUFBRSxFQUFFLENBQUM7SUFDckMsTUFBTSxDQUFVLGFBQWEsR0FBRyxFQUFFLEVBQUUsQ0FBQztJQUNyQyxNQUFNLENBQVUsYUFBYSxHQUFHLEVBQUUsRUFBRSxDQUFDO0lBQ3JD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RUFBRSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxzQkFBc0IsQ0FDckIsT0FBbUU7UUFFbkUsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQywwQkFBMEIsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM3RCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGNBQWMsQ0FDYixPQUE2RDtRQUU3RCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILE1BQU0sQ0FBQyxNQUFNLENBQ1osT0FBZ0I7UUFFaEIsT0FBTyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM3QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9XZWJDb25maWdzIGZyb20gJy4vT1dlYkNvbmZpZ3MnO1xuaW1wb3J0IE9XZWJEYXRhU3RvcmUsIHsgT0pTT05WYWx1ZSB9IGZyb20gJy4vT1dlYkRhdGFTdG9yZSc7XG5pbXBvcnQgT1dlYkV2ZW50IGZyb20gJy4vT1dlYkV2ZW50JztcbmltcG9ydCBPV2ViRm9ybSwgeyBPV2ViRm9ybURlZmluaXRpb24gfSBmcm9tICcuL09XZWJGb3JtJztcbmltcG9ydCBPV2ViUm91dGVyLCB7IE9Sb3V0ZVN0YXRlT2JqZWN0LCBPUm91dGVUYXJnZXQgfSBmcm9tICcuL09XZWJSb3V0ZXInO1xuaW1wb3J0IE9XZWJVcmwgZnJvbSAnLi9PV2ViVXJsJztcbmltcG9ydCBPV2ViVmlldyBmcm9tICcuL09XZWJWaWV3JztcbmltcG9ydCBPV2ViSTE4biBmcm9tICcuL09XZWJJMThuJztcbmltcG9ydCB7IGFzc2lnbiwgaWQsIGxvZ2dlciB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IE9ab25lIGZyb20gJy4vb3pvbmUnO1xuaW1wb3J0IE9XZWJQYWdlciwgeyBPUGFnZSwgT1BhZ2VSb3V0ZSB9IGZyb20gJy4vT1dlYlBhZ2VyJztcbmltcG9ydCBPV2ViVXNlciBmcm9tICcuL09XZWJVc2VyJztcbmltcG9ydCB7IE9OZXRSZXF1ZXN0T3B0aW9ucyB9IGZyb20gJy4vT1dlYk5ldCc7XG5pbXBvcnQgT1dlYlhIUiBmcm9tICcuL09XZWJYSFInO1xuaW1wb3J0IGRlZmF1bHRBcHBDb25maWdzIGZyb20gJy4vZGVmYXVsdC9hcHAuY29uZmlncyc7XG5pbXBvcnQgZGVmYXVsdFVzZXJDb25maWdzIGZyb20gJy4vZGVmYXVsdC91c2VyLmNvbmZpZ3MnO1xuaW1wb3J0IGRlZmF1bHRBcHBVcmxzIGZyb20gJy4vZGVmYXVsdC9hcHAudXJscyc7XG5pbXBvcnQgeyBPRm9ybURPTUZvcm1BZGFwdGVyLCBPRm9ybU9iamVjdEFkYXB0ZXIgfSBmcm9tICcuL09XZWJGb3JtQWRhcHRlcic7XG5pbXBvcnQge2dsb2JhbFJvb3R9IGZyb20gJy4vZW52JztcblxuZXhwb3J0IGludGVyZmFjZSBPVXJsTGlzdCB7XG5cdFtrZXk6IHN0cmluZ106IHN0cmluZztcblxuXHRPWl9TRVJWRVJfR0VUX0ZJTEVfVVJJOiBzdHJpbmc7XG5cdE9aX1NFUlZFUl9UTkVUX1NFUlZJQ0U6IHN0cmluZztcblx0T1pfU0VSVkVSX0xPR0lOX1NFUlZJQ0U6IHN0cmluZztcblx0T1pfU0VSVkVSX0xPR09VVF9TRVJWSUNFOiBzdHJpbmc7XG5cdE9aX1NFUlZFUl9TSUdOVVBfU0VSVklDRTogc3RyaW5nO1xuXHRPWl9TRVJWRVJfQUNDT1VOVF9SRUNPVkVSWV9TRVJWSUNFOiBzdHJpbmc7XG5cdE9aX1NFUlZFUl9QQVNTV09SRF9TRVJWSUNFOiBzdHJpbmc7XG5cdE9aX1NFUlZFUl9DQVBUQ0hBX1NFUlZJQ0U6IHN0cmluZztcblx0T1pfU0VSVkVSX1VQTE9BRF9TRVJWSUNFOiBzdHJpbmc7XG5cblx0T1dfQVBQX1BBVEhfU0lHTl9VUDogc3RyaW5nO1xuXHRPV19BUFBfUEFUSF9MT0dPVVQ6IHN0cmluZztcblx0T1dfQVBQX1BBVEhfTE9HSU46IHN0cmluZztcblx0T1dfQVBQX1BBVEhfSE9NRTogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE9BcHBDb25maWdzIHtcblx0W2tleTogc3RyaW5nXTogT0pTT05WYWx1ZTtcblxuXHRPV19BUFBfTkFNRTogc3RyaW5nO1xuXHRPV19BUFBfVkVSU0lPTjogc3RyaW5nO1xuXHRPV19BUFBfTE9DQUxfQkFTRV9VUkw6IHN0cmluZztcblx0T1dfQVBQX1JPVVRFUl9IQVNIX01PREU6IGJvb2xlYW47XG5cdE9XX0FQUF9BTExPV0VEX0NPVU5UUklFUzogc3RyaW5nW107XG5cblx0T1pfQVBJX0tFWTogc3RyaW5nO1xuXHRPWl9BUElfS0VZX0hFQURFUl9OQU1FOiBzdHJpbmc7XG5cdE9aX0FQSV9BTExPV19SRUFMX01FVEhPRF9IRUFERVI6IGJvb2xlYW47XG5cdE9aX0FQSV9SRUFMX01FVEhPRF9IRUFERVJfTkFNRTogc3RyaW5nO1xuXHRPWl9BUElfQkFTRV9VUkw6IHN0cmluZztcblxuXHRPWl9DT0RFX1JFRzogc3RyaW5nO1xuXHRPWl9VU0VSX05BTUVfTUlOX0xFTkdUSDogbnVtYmVyO1xuXHRPWl9VU0VSX05BTUVfTUFYX0xFTkdUSDogbnVtYmVyO1xuXHRPWl9QQVNTX01JTl9MRU5HVEg6IG51bWJlcjtcblx0T1pfUEFTU19NQVhfTEVOR1RIOiBudW1iZXI7XG5cdE9aX1VTRVJfTUlOX0FHRTogbnVtYmVyO1xuXHRPWl9VU0VSX01BWF9BR0U6IG51bWJlcjtcblx0T1pfUFBJQ19NSU5fU0laRTogbnVtYmVyO1xuXHRPWl9VU0VSX0FMTE9XRURfR0VOREVSUzogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT1VzZXJDb25maWdzIHtcblx0W2tleTogc3RyaW5nXTogT0pTT05WYWx1ZTtcblxuXHRPV19BUFBfREVGQVVMVF9MQU5HOiBzdHJpbmc7XG5cdE9XX0FQUF9DT1VOVFJZOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT1N0b3JlIHtcblx0W2tleTogc3RyaW5nXTogYW55O1xufVxuXG5leHBvcnQgdHlwZSBPVXNlciA9IHtcblx0W2tleTogc3RyaW5nXTogYW55O1xufTtcbmV4cG9ydCBpbnRlcmZhY2UgT0FwcE9wdGlvbnM8XG5cdFN0b3JlIGV4dGVuZHMgT1N0b3JlID0gT1N0b3JlLFxuXHRQYWdlIGV4dGVuZHMgT1BhZ2U8T1BhZ2VSb3V0ZT4gPSBPUGFnZTxPUGFnZVJvdXRlPixcblx0VXNlciBleHRlbmRzIE9Vc2VyID0gT1VzZXIsXG5cdEFwcENvbmZpZ3MgZXh0ZW5kcyBQYXJ0aWFsPE9BcHBDb25maWdzPiA9IFBhcnRpYWw8T0FwcENvbmZpZ3M+LFxuXHRVc2VyQ29uZmlncyBleHRlbmRzIFBhcnRpYWw8T1VzZXJDb25maWdzPiA9IFBhcnRpYWw8T1VzZXJDb25maWdzPixcblx0VXJsTGlzdCBleHRlbmRzIFBhcnRpYWw8T1VybExpc3Q+ID0gUGFydGlhbDxPVXJsTGlzdD4sXG5cdENvbnRleHQgPSBPV2ViQXBwPFN0b3JlLCBQYWdlLCBVc2VyPlxuPiB7XG5cdG5hbWU6IHN0cmluZztcblx0YXBwQ29uZmlnczogQXBwQ29uZmlncztcblx0dXNlckNvbmZpZ3M6IFVzZXJDb25maWdzO1xuXHR1cmxzOiBVcmxMaXN0O1xuXG5cdHVzZXI6ICh0aGlzOiBDb250ZXh0KSA9PiBPV2ViVXNlcjxVc2VyPjtcblx0c3RvcmU6ICh0aGlzOiBDb250ZXh0KSA9PiBTdG9yZTtcblx0cGFnZXI6ICh0aGlzOiBDb250ZXh0KSA9PiBPV2ViUGFnZXI8UGFnZT47XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE9XZWJBcHA8XG5cdFN0b3JlIGV4dGVuZHMgT1N0b3JlID0gT1N0b3JlLFxuXHRQYWdlIGV4dGVuZHMgT1BhZ2UgPSBPUGFnZSxcblx0VXNlciBleHRlbmRzIE9Vc2VyID0gT1VzZXIsXG5cdE9wdGlvbnMgZXh0ZW5kcyBPQXBwT3B0aW9uczxTdG9yZSwgUGFnZSwgVXNlcj4gPSBhbnlcbj4gZXh0ZW5kcyBPV2ViRXZlbnQge1xuXHRzdGF0aWMgcmVhZG9ubHkgU0VMRiA9IGlkKCk7XG5cdHN0YXRpYyByZWFkb25seSBFVlRfQVBQX1JFQURZID0gaWQoKTtcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9OT1RfRk9VTkQgPSBpZCgpO1xuXHRzdGF0aWMgcmVhZG9ubHkgRVZUX1NIT1dfSE9NRSA9IGlkKCk7XG5cdHN0YXRpYyByZWFkb25seSBFVlRfU0hPV19MT0dJTiA9IGlkKCk7XG5cdHN0YXRpYyByZWFkb25seSBFVlRfU0hPV19SRUdJU1RSQVRJT05fUEFHRSA9IGlkKCk7XG5cblx0cmVhZG9ubHkgdmlldzogT1dlYlZpZXc7XG5cdHJlYWRvbmx5IGxzOiBPV2ViRGF0YVN0b3JlO1xuXHRyZWFkb25seSByb3V0ZXI6IE9XZWJSb3V0ZXI7XG5cdHJlYWRvbmx5IGNvbmZpZ3M6IE9XZWJDb25maWdzPFxuXHRcdE9BcHBDb25maWdzICYgT3B0aW9uc1snYXBwQ29uZmlncyddLFxuXHRcdE9Vc2VyQ29uZmlncyAmIE9wdGlvbnNbJ3VzZXJDb25maWdzJ11cblx0Pjtcblx0cmVhZG9ubHkgdXJsOiBPV2ViVXJsO1xuXHRyZWFkb25seSBpMThuOiBPV2ViSTE4bjtcblx0cmVhZG9ubHkgb3o6IE9ab25lO1xuXG5cdHByaXZhdGUgcmVhZG9ubHkgX3VzZXI6IE9XZWJVc2VyPFVzZXI+O1xuXHRwcml2YXRlIHJlYWRvbmx5IF9zdG9yZTogU3RvcmU7XG5cdHByaXZhdGUgcmVhZG9ubHkgX3BhZ2VyOiBPV2ViUGFnZXI8UGFnZT47XG5cblx0LyoqXG5cdCAqIE9XZWJBcHAgY29uc3RydWN0b3IuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zXG5cdCAqL1xuXHRwcm90ZWN0ZWQgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBvcHRpb25zOiBPcHRpb25zKSB7XG5cdFx0c3VwZXIoKTtcblxuXHRcdHRoaXMubHMgPSBuZXcgT1dlYkRhdGFTdG9yZSh0aGlzKTtcblx0XHR0aGlzLmNvbmZpZ3MgPSBuZXcgT1dlYkNvbmZpZ3MoXG5cdFx0XHR0aGlzLFxuXHRcdFx0YXNzaWduKHt9LCBkZWZhdWx0QXBwQ29uZmlncywgb3B0aW9ucy5hcHBDb25maWdzKSxcblx0XHRcdGFzc2lnbih7fSwgZGVmYXVsdFVzZXJDb25maWdzLCBvcHRpb25zLnVzZXJDb25maWdzKVxuXHRcdCk7XG5cdFx0dGhpcy51cmwgPSBuZXcgT1dlYlVybCh0aGlzLCBhc3NpZ24oe30sIGRlZmF1bHRBcHBVcmxzLCBvcHRpb25zLnVybHMpKTtcblx0XHR0aGlzLnZpZXcgPSBuZXcgT1dlYlZpZXcoKTtcblx0XHR0aGlzLmkxOG4gPSBuZXcgT1dlYkkxOG4odGhpcyk7XG5cdFx0dGhpcy5fdXNlciA9IG9wdGlvbnMudXNlci5jYWxsKHRoaXMpO1xuXHRcdHRoaXMuX3N0b3JlID0gb3B0aW9ucy5zdG9yZS5jYWxsKHRoaXMpO1xuXHRcdHRoaXMuX3BhZ2VyID0gb3B0aW9ucy5wYWdlci5jYWxsKHRoaXMpO1xuXG5cdFx0Y29uc3QgY3R4ID0gdGhpcyxcblx0XHRcdGJhc2VVcmwgPSB0aGlzLmNvbmZpZ3MuZ2V0KCdPV19BUFBfTE9DQUxfQkFTRV9VUkwnKSxcblx0XHRcdGhhc2hNb2RlID0gdGhpcy5jb25maWdzLmdldCgnT1dfQVBQX1JPVVRFUl9IQVNIX01PREUnKTtcblxuXHRcdHRoaXMucm91dGVyID0gbmV3IE9XZWJSb3V0ZXIoYmFzZVVybCwgaGFzaE1vZGUsIGZ1bmN0aW9uIG5vdEZvdW5kSGFuZGxlcihcblx0XHRcdHRhcmdldDogT1JvdXRlVGFyZ2V0XG5cdFx0KSB7XG5cdFx0XHRjdHgudHJpZ2dlcihPV2ViQXBwLkVWVF9OT1RfRk9VTkQsIFt0YXJnZXRdKTtcblx0XHR9KTtcblxuXHRcdHRoaXMuaTE4bi5zZXRMYW5nKHRoaXMuY29uZmlncy5nZXQoJ09XX0FQUF9ERUZBVUxUX0xBTkcnKSk7XG5cblx0XHR0aGlzLm96ID0gT1pvbmUuaW5zdGFudGlhdGUodGhpcyk7XG5cdH1cblxuXHQvKipcblx0ICogQnVpbGQgYW4gSFRUUCByZXF1ZXN0LlxuXHQgKlxuXHQgKiBAcGFyYW0gdXJsXG5cdCAqIEBwYXJhbSBvcHRpb25zXG5cdCAqL1xuXHRyZXF1ZXN0PFJlc3BvbnNlPihcblx0XHR1cmw6IHN0cmluZyxcblx0XHRvcHRpb25zOiBQYXJ0aWFsPE9OZXRSZXF1ZXN0T3B0aW9uczxSZXNwb25zZT4+ID0ge30gYXMgYW55XG5cdCk6IE9XZWJYSFI8UmVzcG9uc2U+IHtcblx0XHRsb2dnZXIuZGVidWcoJ1tOZXRdIG5ldyByZXF1ZXN0JywgdXJsLCBvcHRpb25zKTtcblxuXHRcdGNvbnN0IGV2ZW50ID0gZnVuY3Rpb24gZXZlbnQodHlwZTogc3RyaW5nKSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24gZXZlbnRIYW5kbGVyKC4uLmFyZ3M6IGFueVtdKTogdm9pZCB7XG5cdFx0XHRcdGxvZ2dlci5kZWJ1ZygnW05ldF0gZXZlbnQgJXMnLCB0eXBlLCB1cmwsIG9wdGlvbnMsIGFyZ3MpO1xuXHRcdFx0fTtcblx0XHR9O1xuXG5cdFx0Y29uc3QgbyA9IG5ldyBPV2ViWEhSPFJlc3BvbnNlPih1cmwsIHtcblx0XHRcdHdpdGhDcmVkZW50aWFsczogdHJ1ZSxcblx0XHRcdC4uLm9wdGlvbnMsXG5cdFx0fSk7XG5cblx0XHRvLm9uRmluaXNoKGV2ZW50KCdvbkZpbmlzaGVkJykpXG5cdFx0XHQub25FcnJvcihldmVudCgnb25FcnJvcicpKVxuXHRcdFx0Lm9uRmFpbChldmVudCgnb25GYWlsZWQnKSlcblx0XHRcdC5vbkh0dHBFcnJvcihldmVudCgnb25IdHRwRXJyb3InKSlcblx0XHRcdC5vbkh0dHBTdWNjZXNzKGV2ZW50KCdvbkh0dHBTdWNjZXNzJykpXG5cdFx0XHQub25Hb29kTmV3cyhldmVudCgnb25Hb29kTmV3cycpKVxuXHRcdFx0Lm9uQmFkTmV3cyhldmVudCgnb25CYWROZXdzJykpXG5cdFx0XHQub25Eb3dubG9hZFByb2dyZXNzKGV2ZW50KCdvbkRvd25sb2FkUHJvZ3Jlc3MnKSlcblx0XHRcdC5vblVwbG9hZFByb2dyZXNzKGV2ZW50KCdvblVwbG9hZFByb2dyZXNzJykpXG5cdFx0XHQub25SZXNwb25zZShldmVudCgnb25SZXNwb25zZScpKTtcblxuXHRcdHJldHVybiBvO1xuXHR9XG5cblx0LyoqXG5cdCAqIFVzZXIgZ2V0dGVyLlxuXHQgKi9cblx0Z2V0IHVzZXIoKTogUmV0dXJuVHlwZTxPcHRpb25zWyd1c2VyJ10+IHtcblx0XHRyZXR1cm4gdGhpcy5fdXNlciBhcyBSZXR1cm5UeXBlPE9wdGlvbnNbJ3VzZXInXT47XG5cdH1cblxuXHQvKipcblx0ICogU3RvcmUgZ2V0dGVyLlxuXHQgKi9cblx0Z2V0IHN0b3JlKCk6IFJldHVyblR5cGU8T3B0aW9uc1snc3RvcmUnXT4ge1xuXHRcdHJldHVybiB0aGlzLl9zdG9yZSBhcyBSZXR1cm5UeXBlPE9wdGlvbnNbJ3N0b3JlJ10+O1xuXHR9XG5cblx0LyoqXG5cdCAqIFBhZ2VyIGluc3RhbmNlIGdldHRlci5cblx0ICovXG5cdGdldCBwYWdlcigpOiBSZXR1cm5UeXBlPE9wdGlvbnNbJ3BhZ2VyJ10+IHtcblx0XHRyZXR1cm4gdGhpcy5fcGFnZXIgYXMgUmV0dXJuVHlwZTxPcHRpb25zWydwYWdlciddPjtcblx0fVxuXG5cdC8qKlxuXHQgKiBBcHAgbmFtZSBnZXR0ZXIuXG5cdCAqL1xuXHRnZXRBcHBOYW1lKCk6IHN0cmluZyB7XG5cdFx0cmV0dXJuIHRoaXMub3B0aW9ucy5uYW1lO1xuXHR9XG5cblx0LyoqXG5cdCAqIENoZWNrcyBpZiB3ZSBhcmUgcnVubmluZyBpbiBtb2JpbGUgYXBwLlxuXHQgKi9cblx0aXNNb2JpbGVBcHAoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuICdjb3Jkb3ZhJyBpbiB3aW5kb3c7XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyBuZXcgb3dlYiBmb3JtIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gZm9ybSBUaGUgaHRtbCBmb3JtIGVsZW1lbnQuXG5cdCAqIEBwYXJhbSByZXF1aXJlZCBUaGUgcmVxdWlyZWQgZmllbGRzIG5hbWVzIGxpc3QuXG5cdCAqIEBwYXJhbSBleGNsdWRlZCBUaGUgZmllbGRzIG5hbWVzIHRvIGV4Y2x1ZGUuXG5cdCAqIEBwYXJhbSBjaGVja0FsbCBGb3JjZSB0aGUgdmFsaWRhdG9yIHRvIGNoZWNrIGFsbCBmaWVsZHMuXG5cdCAqIEBwYXJhbSB2ZXJib3NlIExvZyB3YXJuaW5nLlxuXHQgKlxuXHQgKiBAZGVwcmVjYXRlZCB1c2Uge0BsaW5rIE9XZWJBcHAuZm9ybX1cblx0ICovXG5cdGdldEZvcm1WYWxpZGF0b3IoXG5cdFx0Zm9ybTogT1dlYkZvcm1EZWZpbml0aW9uIHwgSFRNTEZvcm1FbGVtZW50LFxuXHRcdHJlcXVpcmVkOiBzdHJpbmdbXSA9IFtdLFxuXHRcdGV4Y2x1ZGVkOiBzdHJpbmdbXSA9IFtdLFxuXHRcdGNoZWNrQWxsID0gZmFsc2UsXG5cdFx0dmVyYm9zZSA9IGZhbHNlXG5cdCk6IE9XZWJGb3JtIHtcblx0XHRyZXR1cm4gdGhpcy5mb3JtKGZvcm0sIHJlcXVpcmVkLCBleGNsdWRlZCwgY2hlY2tBbGwsIHZlcmJvc2UpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgbmV3IG93ZWIgZm9ybSBpbnN0YW5jZS5cblx0ICpcblx0ICogQHBhcmFtIGZvcm0gVGhlIGh0bWwgZm9ybSBlbGVtZW50LlxuXHQgKiBAcGFyYW0gcmVxdWlyZWQgVGhlIHJlcXVpcmVkIGZpZWxkcyBuYW1lcyBsaXN0LlxuXHQgKiBAcGFyYW0gZXhjbHVkZWQgVGhlIGZpZWxkcyBuYW1lcyB0byBleGNsdWRlLlxuXHQgKiBAcGFyYW0gY2hlY2tBbGwgRm9yY2UgdGhlIHZhbGlkYXRvciB0byBjaGVjayBhbGwgZmllbGRzLlxuXHQgKiBAcGFyYW0gdmVyYm9zZSBMb2cgd2FybmluZy5cblx0ICovXG5cdGZvcm0oXG5cdFx0Zm9ybTogT1dlYkZvcm1EZWZpbml0aW9uIHwgSFRNTEZvcm1FbGVtZW50LFxuXHRcdHJlcXVpcmVkOiBzdHJpbmdbXSA9IFtdLFxuXHRcdGV4Y2x1ZGVkOiBzdHJpbmdbXSA9IFtdLFxuXHRcdGNoZWNrQWxsID0gZmFsc2UsXG5cdFx0dmVyYm9zZSA9IGZhbHNlXG5cdCk6IE9XZWJGb3JtIHtcblx0XHRyZXR1cm4gbmV3IE9XZWJGb3JtKFxuXHRcdFx0dGhpcyxcblx0XHRcdGZvcm0gaW5zdGFuY2VvZiBIVE1MRm9ybUVsZW1lbnRcblx0XHRcdFx0PyBuZXcgT0Zvcm1ET01Gb3JtQWRhcHRlcihmb3JtKVxuXHRcdFx0XHQ6IG5ldyBPRm9ybU9iamVjdEFkYXB0ZXIoZm9ybSksXG5cdFx0XHRyZXF1aXJlZCxcblx0XHRcdGV4Y2x1ZGVkLFxuXHRcdFx0Y2hlY2tBbGwsXG5cdFx0XHR2ZXJib3NlXG5cdFx0KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBGb3JjZSBsb2dpbi5cblx0ICpcblx0ICogPiBUaGlzIHdpbGwgY2xlYXIgYWxsIHNhdmVkIGRhdGEgaW4gdGhlIGxvY2FsIHN0b3JhZ2UuXG5cdCAqL1xuXHRmb3JjZUxvZ2luKCk6IHZvaWQge1xuXHRcdHRoaXMubHMuY2xlYXIoKTtcblx0XHR0aGlzLnNob3dMb2dpblBhZ2Uoe30pO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlbG9hZCB0aGUgYXBwLlxuXHQgKi9cblx0cmVsb2FkQXBwKCk6IHZvaWQge1xuXHRcdC8vIFRPRE86IGluc3RlYWQgb2YgcmVsb2FkaW5nIHRoZSBjdXJyZW50IGxvY2F0aW9uLCBmaW5kIGEgd2F5IHRvIGJyb3dzZSB0byB3ZWIgYXBwIGVudHJ5IHBvaW50XG5cdFx0Ly8gZm9yIGFuZHJvaWQgJiBpb3MgcmVzdGFydCB0aGUgYXBwXG5cdFx0Ly8gd2luZG93LmxvY2F0aW9uLnJlbG9hZCh0cnVlKTtcblx0XHR0aGlzLnNob3dIb21lUGFnZSh7fSk7XG5cdH1cblxuXHQvKipcblx0ICogRGVzdHJveSB0aGUgYXBwLlxuXHQgKlxuXHQgKiA+IFRoaXMgd2lsbCBjbGVhciBhbGwgc2F2ZWQgZGF0YSBpbiB0aGUgbG9jYWwgc3RvcmFnZS5cblx0ICovXG5cdGRlc3Ryb3lBcHAoKTogdm9pZCB7XG5cdFx0Ly8gZXJhc2UgZGF0YVxuXHRcdHRoaXMubHMuY2xlYXIoKTtcblx0XHR0aGlzLnJlbG9hZEFwcCgpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENsb3NlIGFwcC5cblx0ICovXG5cdGNsb3NlQXBwKCk6IHZvaWQge1xuXHRcdC8vIGNvcmRvdmFcblx0XHRpZiAoZ2xvYmFsUm9vdC5uYXZpZ2F0b3IgJiYgKGdsb2JhbFJvb3QubmF2aWdhdG9yIGFzIGFueSkuYXBwKSB7XG5cdFx0XHQoZ2xvYmFsUm9vdC5uYXZpZ2F0b3IgYXMgYW55KS5hcHAuZXhpdEFwcCgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRnbG9iYWxSb290LmNsb3NlKCk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIFRvIHN0YXJ0IHRoZSB3ZWIgYXBwLlxuXHQgKi9cblx0c3RhcnQoKTogdGhpcyB7XG5cdFx0bG9nZ2VyLmluZm8oJ1tPV2ViQXBwXSBhcHAgc3RhcnRlZCEnKTtcblx0XHR0aGlzLnRyaWdnZXIoT1dlYkFwcC5FVlRfQVBQX1JFQURZKTtcblx0XHRyZXR1cm4gdGhpcztcblx0fVxuXG5cdC8qKlxuXHQgKiBDYWxsZWQgd2hlbiBhcHAgc2hvdWxkIHNob3cgdGhlIGhvbWUgcGFnZS5cblx0ICovXG5cdHNob3dIb21lUGFnZShvcHRpb25zOiBPUm91dGVTdGF0ZU9iamVjdCA9IHt9KTogdm9pZCB7XG5cdFx0dGhpcy50cmlnZ2VyKE9XZWJBcHAuRVZUX1NIT1dfSE9NRSwgW29wdGlvbnNdKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDYWxsZWQgd2hlbiBhcHAgc2hvdWxkIHNob3cgdGhlIGxvZ2luIHBhZ2UuXG5cdCAqL1xuXHRzaG93TG9naW5QYWdlKG9wdGlvbnM6IE9Sb3V0ZVN0YXRlT2JqZWN0ID0ge30pOiB2b2lkIHtcblx0XHR0aGlzLnRyaWdnZXIoT1dlYkFwcC5FVlRfU0hPV19MT0dJTiwgW29wdGlvbnNdKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDYWxsZWQgd2hlbiBhcHAgc2hvdWxkIHNob3cgdGhlIHJlZ2lzdHJhdGlvbiBwYWdlLlxuXHQgKi9cblx0c2hvd1JlZ2lzdHJhdGlvblBhZ2Uob3B0aW9uczogT1JvdXRlU3RhdGVPYmplY3QgPSB7fSk6IHZvaWQge1xuXHRcdHRoaXMudHJpZ2dlcihPV2ViQXBwLkVWVF9TSE9XX0xPR0lOLCBbb3B0aW9uc10pO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlZ2lzdGVyIGhhbmRsZXIgZm9yIE9XZWJBcHAuRVZUX0FQUF9SRUFEWSBldmVudFxuXHQgKlxuXHQgKiBAcGFyYW0gaGFuZGxlclxuXHQgKi9cblx0b25SZWFkeShoYW5kbGVyOiAodGhpczogdGhpcykgPT4gdm9pZCB8IGJvb2xlYW4pOiB0aGlzIHtcblx0XHRyZXR1cm4gdGhpcy5vbihPV2ViQXBwLkVWVF9BUFBfUkVBRFksIGhhbmRsZXIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlZ2lzdGVyIGhhbmRsZXIgZm9yIE9XZWJBcHAuRVZUX1NIT1dfSE9NRSBldmVudFxuXHQgKlxuXHQgKiBAcGFyYW0gaGFuZGxlclxuXHQgKi9cblx0b25TaG93SG9tZVBhZ2UoXG5cdFx0aGFuZGxlcjogKHRoaXM6IHRoaXMsIG9wdGlvbnM6IE9Sb3V0ZVN0YXRlT2JqZWN0KSA9PiB2b2lkIHwgYm9vbGVhblxuXHQpOiB0aGlzIHtcblx0XHRyZXR1cm4gdGhpcy5vbihPV2ViQXBwLkVWVF9TSE9XX0hPTUUsIGhhbmRsZXIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlZ2lzdGVyIGhhbmRsZXIgZm9yIE9XZWJBcHAuRVZUX1NIT1dfTE9HSU4gZXZlbnRcblx0ICpcblx0ICogQHBhcmFtIGhhbmRsZXJcblx0ICovXG5cdG9uU2hvd0xvZ2luUGFnZShcblx0XHRoYW5kbGVyOiAodGhpczogdGhpcywgb3B0aW9uczogT1JvdXRlU3RhdGVPYmplY3QpID0+IHZvaWQgfCBib29sZWFuXG5cdCk6IHRoaXMge1xuXHRcdHJldHVybiB0aGlzLm9uKE9XZWJBcHAuRVZUX1NIT1dfTE9HSU4sIGhhbmRsZXIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlZ2lzdGVyIGhhbmRsZXIgZm9yIE9XZWJBcHAuRVZUX1NIT1dfUkVHSVNUUkFUSU9OX1BBR0UgZXZlbnRcblx0ICpcblx0ICogQHBhcmFtIGhhbmRsZXJcblx0ICovXG5cdG9uU2hvd1JlZ2lzdHJhdGlvblBhZ2UoXG5cdFx0aGFuZGxlcjogKHRoaXM6IHRoaXMsIG9wdGlvbnM6IE9Sb3V0ZVN0YXRlT2JqZWN0KSA9PiB2b2lkIHwgYm9vbGVhblxuXHQpOiB0aGlzIHtcblx0XHRyZXR1cm4gdGhpcy5vbihPV2ViQXBwLkVWVF9TSE9XX1JFR0lTVFJBVElPTl9QQUdFLCBoYW5kbGVyKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZWdpc3RlciBoYW5kbGVyIGZvciBPV2ViQXBwLkVWVF9OT1RfRk9VTkQgZXZlbnRcblx0ICpcblx0ICogQHBhcmFtIGhhbmRsZXJcblx0ICovXG5cdG9uUGFnZU5vdEZvdW5kKFxuXHRcdGhhbmRsZXI6ICh0aGlzOiB0aGlzLCB0YXJnZXQ6IE9Sb3V0ZVRhcmdldCkgPT4gdm9pZCB8IGJvb2xlYW5cblx0KTogdGhpcyB7XG5cdFx0cmV0dXJuIHRoaXMub24oT1dlYkFwcC5FVlRfTk9UX0ZPVU5ELCBoYW5kbGVyKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIG5ldyBhcHAgaW5zdGFuY2UuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zXG5cdCAqL1xuXHRzdGF0aWMgY3JlYXRlPE9wdGlvbnMgZXh0ZW5kcyBPQXBwT3B0aW9uczxPU3RvcmUsIE9QYWdlLCBPVXNlcj4gPSBhbnk+KFxuXHRcdG9wdGlvbnM6IE9wdGlvbnNcblx0KTogT1dlYkFwcDxhbnksIGFueSwgYW55LCBPcHRpb25zPiB7XG5cdFx0cmV0dXJuIG5ldyBPV2ViQXBwKG9wdGlvbnMpO1xuXHR9XG59XG4iXX0=