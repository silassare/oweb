import OWebConfigs from './OWebConfigs';
import OWebDataStore from './OWebDataStore';
import OWebEvent from './OWebEvent';
import OWebFormValidator from './OWebFormValidator';
import OWebRouter from './OWebRouter';
import OWebUrl from './OWebUrl';
import OWebView from './OWebView';
import OWebI18n from './OWebI18n';
import { assign, id, logger } from './utils';
import OZone from './ozone';
import OWebXHR from './OWebXHR';
import defaultAppConfigs from './default/app.configs';
import defaultUserConfigs from './default/user.configs';
import defaultAppUrls from './default/app.urls';
export default class OWebApp extends OWebEvent {
    options;
    static SELF = id();
    static EVT_APP_READY = id();
    static EVT_NOT_FOUND = id();
    static EVT_SHOW_HOME = id();
    static EVT_SHOW_LOGIN = id();
    static EVT_SHOW_REGISTRATION_PAGE = id();
    view;
    ls;
    router;
    user;
    configs;
    url;
    i18n;
    oz;
    _store;
    _pager;
    /**
     * OWebApp constructor.
     *
     * @param options
     */
    constructor(options) {
        super();
        this.options = options;
        this.ls = new OWebDataStore(this);
        this.configs = new OWebConfigs(this, assign({}, defaultAppConfigs, options.appConfigs), assign({}, defaultUserConfigs, options.userConfigs));
        this.url = new OWebUrl(this, assign({}, defaultAppUrls, options.urls));
        this.view = new OWebView();
        this.i18n = new OWebI18n();
        this.user = options.user.call(this);
        this._store = options.store.call(this);
        this._pager = options.pager.call(this);
        const ctx = this, baseUrl = this.configs.get('OW_APP_LOCAL_BASE_URL'), hashMode = this.configs.get('OW_APP_ROUTER_HASH_MODE');
        this.router = new OWebRouter(baseUrl, hashMode, function notFoundHandler(target) {
            ctx.trigger(OWebApp.EVT_NOT_FOUND, [target]);
        });
        this.i18n.setDefaultLang(this.configs.get('OW_APP_DEFAULT_LANG'));
        this.oz = OZone.instantiate(this);
    }
    /**
     * Build an HTTP request.
     *
     * @param url
     * @param options
     */
    request(url, options = {}) {
        logger.debug('[Net] new request', url, options);
        const event = function event(type) {
            return function eventHandler() {
                logger.debug('[Net] event %s', type, url, options);
            };
        };
        const o = new OWebXHR(url, {
            withCredentials: true,
            ...options,
        });
        o.onFinish(event('onFinished'))
            .onError(event('onError'))
            .onFail(event('onFailed'))
            .onHttpError(event('onHttpError'))
            .onHttpSuccess(event('onHttpSuccess'))
            .onGoodNews(event('onGoodNews'))
            .onBadNews(event('onBadNews'))
            .onDownloadProgress(event('onDownloadProgress'))
            .onUploadProgress(event('onUploadProgress'))
            .onResponse(event('onResponse'));
        return o;
    }
    /**
     * Store getter.
     */
    get store() {
        return this._store;
    }
    /**
     * Pager instance getter.
     */
    get pager() {
        return this._pager;
    }
    /**
     * App name getter.
     */
    getAppName() {
        return this.options.name;
    }
    /**
     * Checks if we are running in mobile app.
     */
    isMobileApp() {
        return 'cordova' in window;
    }
    /**
     * Returns new form validator instance.
     *
     * @param form The html form element.
     * @param required The required fields names list.
     * @param excluded The fields names to exclude.
     * @param checkAll Force the validator to check all fields.
     * @param verbose Log warning.
     */
    getFormValidator(form, required = [], excluded = [], checkAll = false, verbose = false) {
        return new OWebFormValidator(this, form, required, excluded, checkAll, verbose);
    }
    /**
     * Force login.
     *
     * > This will clear all saved data in the local storage.
     */
    forceLogin() {
        this.ls.clear();
        this.showLoginPage({});
    }
    /**
     * Reload the app.
     */
    reloadApp() {
        // TODO: instead of reloading the current location, find a way to browse to web app entry point
        // for android & ios restart the app
        // window.location.reload(true);
        this.showHomePage({});
    }
    /**
     * Destroy the app.
     *
     * > This will clear all saved data in the local storage.
     */
    destroyApp() {
        // erase data
        this.ls.clear();
        this.reloadApp();
    }
    /**
     * Close app.
     */
    closeApp() {
        // cordova
        if (window.navigator && window.navigator.app) {
            window.navigator.app.exitApp();
        }
        else {
            window.close();
        }
    }
    /**
     * To start the web app.
     */
    start() {
        logger.info('[OWebApp] app started!');
        this.trigger(OWebApp.EVT_APP_READY);
        return this;
    }
    /**
     * Called when app should show the home page.
     */
    showHomePage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_HOME, [options]);
    }
    /**
     * Called when app should show the login page.
     */
    showLoginPage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_LOGIN, [options]);
    }
    /**
     * Called when app should show the registration page.
     */
    showRegistrationPage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_LOGIN, [options]);
    }
    /**
     * Register handler for OWebApp.EVT_APP_READY event
     *
     * @param handler
     */
    onReady(handler) {
        return this.on(OWebApp.EVT_APP_READY, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_HOME event
     *
     * @param handler
     */
    onShowHomePage(handler) {
        return this.on(OWebApp.EVT_SHOW_HOME, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_LOGIN event
     *
     * @param handler
     */
    onShowLoginPage(handler) {
        return this.on(OWebApp.EVT_SHOW_LOGIN, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_REGISTRATION_PAGE event
     *
     * @param handler
     */
    onShowRegistrationPage(handler) {
        return this.on(OWebApp.EVT_SHOW_REGISTRATION_PAGE, handler);
    }
    /**
     * Register handler for OWebApp.EVT_NOT_FOUND event
     *
     * @param handler
     */
    onPageNotFound(handler) {
        return this.on(OWebApp.EVT_NOT_FOUND, handler);
    }
    /**
     * Creates new app instance.
     *
     * @param options
     */
    static create(options) {
        return new OWebApp(options);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1dlYkFwcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9PV2ViQXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sV0FBVyxNQUFNLGVBQWUsQ0FBQztBQUN4QyxPQUFPLGFBQTZCLE1BQU0saUJBQWlCLENBQUM7QUFDNUQsT0FBTyxTQUFTLE1BQU0sYUFBYSxDQUFDO0FBQ3BDLE9BQU8saUJBQTRCLE1BQU0scUJBQXFCLENBQUM7QUFDL0QsT0FBTyxVQUErQyxNQUFNLGNBQWMsQ0FBQztBQUMzRSxPQUFPLE9BQU8sTUFBTSxXQUFXLENBQUM7QUFDaEMsT0FBTyxRQUFRLE1BQU0sWUFBWSxDQUFDO0FBQ2xDLE9BQU8sUUFBUSxNQUFNLFlBQVksQ0FBQztBQUNsQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDN0MsT0FBTyxLQUFLLE1BQU0sU0FBUyxDQUFDO0FBSTVCLE9BQU8sT0FBTyxNQUFNLFdBQVcsQ0FBQztBQUNoQyxPQUFPLGlCQUFpQixNQUFNLHVCQUF1QixDQUFDO0FBQ3RELE9BQU8sa0JBQWtCLE1BQU0sd0JBQXdCLENBQUM7QUFDeEQsT0FBTyxjQUFjLE1BQU0sb0JBQW9CLENBQUM7QUFrRmhELE1BQU0sQ0FBQyxPQUFPLE9BQU8sT0FLbkIsU0FBUSxTQUFTO0lBeUJxQjtJQXhCdkMsTUFBTSxDQUFVLElBQUksR0FBRyxFQUFFLEVBQUUsQ0FBQztJQUM1QixNQUFNLENBQVUsYUFBYSxHQUFHLEVBQUUsRUFBRSxDQUFDO0lBQ3JDLE1BQU0sQ0FBVSxhQUFhLEdBQUcsRUFBRSxFQUFFLENBQUM7SUFDckMsTUFBTSxDQUFVLGFBQWEsR0FBRyxFQUFFLEVBQUUsQ0FBQztJQUNyQyxNQUFNLENBQVUsY0FBYyxHQUFHLEVBQUUsRUFBRSxDQUFDO0lBQ3RDLE1BQU0sQ0FBVSwwQkFBMEIsR0FBRyxFQUFFLEVBQUUsQ0FBQztJQUV6QyxJQUFJLENBQVc7SUFDZixFQUFFLENBQWdCO0lBQ2xCLE1BQU0sQ0FBYTtJQUNuQixJQUFJLENBQWlCO0lBQ3JCLE9BQU8sQ0FBeUM7SUFDaEQsR0FBRyxDQUFVO0lBQ2IsSUFBSSxDQUFXO0lBQ2YsRUFBRSxDQUFRO0lBRUYsTUFBTSxDQUFRO0lBQ2QsTUFBTSxDQUFrQjtJQUV6Qzs7OztPQUlHO0lBQ0gsWUFBdUMsT0FBZ0I7UUFDdEQsS0FBSyxFQUFFLENBQUM7UUFEOEIsWUFBTyxHQUFQLE9BQU8sQ0FBUztRQUd0RCxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxXQUFXLENBQzdCLElBQUksRUFDSixNQUFNLENBQUMsRUFBRSxFQUFFLGlCQUFpQixFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFDakQsTUFBTSxDQUFDLEVBQUUsRUFBRSxrQkFBa0IsRUFBRSxPQUFPLENBQUMsV0FBVyxDQUFDLENBQ25ELENBQUM7UUFDRixJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsRUFBRSxFQUFFLGNBQWMsRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN2RSxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksUUFBUSxFQUFFLENBQUM7UUFDM0IsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2QyxJQUFJLENBQUMsTUFBTSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXZDLE1BQU0sR0FBRyxHQUFHLElBQUksRUFDZixPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsRUFDbkQsUUFBUSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFFeEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLFVBQVUsQ0FDM0IsT0FBTyxFQUNQLFFBQVEsRUFDUixTQUFTLGVBQWUsQ0FBQyxNQUFvQjtZQUM1QyxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQzlDLENBQUMsQ0FDRCxDQUFDO1FBRUYsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDO1FBRWxFLElBQUksQ0FBQyxFQUFFLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxPQUFPLENBQ04sR0FBVyxFQUNYLFVBQWlELEVBQUU7UUFFbkQsTUFBTSxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFaEQsTUFBTSxLQUFLLEdBQUcsU0FBUyxLQUFLLENBQUMsSUFBWTtZQUN4QyxPQUFPLFNBQVMsWUFBWTtnQkFDM0IsTUFBTSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ3BELENBQUMsQ0FBQztRQUNILENBQUMsQ0FBQztRQUVGLE1BQU0sQ0FBQyxHQUFHLElBQUksT0FBTyxDQUFXLEdBQUcsRUFBRTtZQUNwQyxlQUFlLEVBQUUsSUFBSTtZQUNyQixHQUFHLE9BQU87U0FDVixDQUFDLENBQUM7UUFFSCxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQzthQUM3QixPQUFPLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO2FBQ3pCLE1BQU0sQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7YUFDekIsV0FBVyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQzthQUNqQyxhQUFhLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO2FBQ3JDLFVBQVUsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7YUFDL0IsU0FBUyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQzthQUM3QixrQkFBa0IsQ0FBQyxLQUFLLENBQUMsb0JBQW9CLENBQUMsQ0FBQzthQUMvQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQzthQUMzQyxVQUFVLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7UUFFbEMsT0FBTyxDQUFDLENBQUM7SUFDVixDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLEtBQUs7UUFDUixPQUFPLElBQUksQ0FBQyxNQUFhLENBQUM7SUFDM0IsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBSSxLQUFLO1FBQ1IsT0FBTyxJQUFJLENBQUMsTUFBYSxDQUFDO0lBQzNCLENBQUM7SUFFRDs7T0FFRztJQUNILFVBQVU7UUFDVCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBQzFCLENBQUM7SUFFRDs7T0FFRztJQUNILFdBQVc7UUFDVixPQUFPLFNBQVMsSUFBSSxNQUFNLENBQUM7SUFDNUIsQ0FBQztJQUVEOzs7Ozs7OztPQVFHO0lBQ0gsZ0JBQWdCLENBQ2YsSUFBVyxFQUNYLFdBQXFCLEVBQUUsRUFDdkIsV0FBcUIsRUFBRSxFQUN2QixRQUFRLEdBQUcsS0FBSyxFQUNoQixPQUFPLEdBQUcsS0FBSztRQUVmLE9BQU8sSUFBSSxpQkFBaUIsQ0FDM0IsSUFBSSxFQUNKLElBQUksRUFDSixRQUFRLEVBQ1IsUUFBUSxFQUNSLFFBQVEsRUFDUixPQUFPLENBQ1AsQ0FBQztJQUNILENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsVUFBVTtRQUNULElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxTQUFTO1FBQ1IsK0ZBQStGO1FBQy9GLG9DQUFvQztRQUNwQyxnQ0FBZ0M7UUFDaEMsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN2QixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILFVBQVU7UUFDVCxhQUFhO1FBQ2IsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNoQixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbEIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsUUFBUTtRQUNQLFVBQVU7UUFDVixJQUFJLE1BQU0sQ0FBQyxTQUFTLElBQUssTUFBTSxDQUFDLFNBQWlCLENBQUMsR0FBRyxFQUFFO1lBQ3JELE1BQU0sQ0FBQyxTQUFpQixDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztTQUN4QzthQUFNO1lBQ04sTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ2Y7SUFDRixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLO1FBQ0osTUFBTSxDQUFDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1FBQ3RDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3BDLE9BQU8sSUFBSSxDQUFDO0lBQ2IsQ0FBQztJQUVEOztPQUVHO0lBQ0gsWUFBWSxDQUFDLFVBQTZCLEVBQUU7UUFDM0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxhQUFhLENBQUMsVUFBNkIsRUFBRTtRQUM1QyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFRDs7T0FFRztJQUNILG9CQUFvQixDQUFDLFVBQTZCLEVBQUU7UUFDbkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILE9BQU8sQ0FBQyxPQUF1QztRQUM5QyxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGNBQWMsQ0FDYixPQUFtRTtRQUVuRSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGVBQWUsQ0FDZCxPQUFtRTtRQUVuRSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILHNCQUFzQixDQUNyQixPQUFtRTtRQUVuRSxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLDBCQUEwQixFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsY0FBYyxDQUNiLE9BQTZEO1FBRTdELE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLE1BQU0sQ0FDWixPQUFnQjtRQUVoQixPQUFPLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzdCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgT1dlYkNvbmZpZ3MgZnJvbSAnLi9PV2ViQ29uZmlncyc7XG5pbXBvcnQgT1dlYkRhdGFTdG9yZSwgeyBPSlNPTlZhbHVlIH0gZnJvbSAnLi9PV2ViRGF0YVN0b3JlJztcbmltcG9ydCBPV2ViRXZlbnQgZnJvbSAnLi9PV2ViRXZlbnQnO1xuaW1wb3J0IE9XZWJGb3JtVmFsaWRhdG9yLCB7IE9Gb3JtIH0gZnJvbSAnLi9PV2ViRm9ybVZhbGlkYXRvcic7XG5pbXBvcnQgT1dlYlJvdXRlciwgeyBPUm91dGVTdGF0ZU9iamVjdCwgT1JvdXRlVGFyZ2V0IH0gZnJvbSAnLi9PV2ViUm91dGVyJztcbmltcG9ydCBPV2ViVXJsIGZyb20gJy4vT1dlYlVybCc7XG5pbXBvcnQgT1dlYlZpZXcgZnJvbSAnLi9PV2ViVmlldyc7XG5pbXBvcnQgT1dlYkkxOG4gZnJvbSAnLi9PV2ViSTE4bic7XG5pbXBvcnQgeyBhc3NpZ24sIGlkLCBsb2dnZXIgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCBPWm9uZSBmcm9tICcuL296b25lJztcbmltcG9ydCBPV2ViUGFnZXIsIHsgT1BhZ2UgfSBmcm9tICcuL09XZWJQYWdlcic7XG5pbXBvcnQgT1dlYlVzZXIgZnJvbSAnLi9PV2ViVXNlcic7XG5pbXBvcnQgeyBPTmV0UmVxdWVzdE9wdGlvbnMgfSBmcm9tICcuL09XZWJOZXQnO1xuaW1wb3J0IE9XZWJYSFIgZnJvbSAnLi9PV2ViWEhSJztcbmltcG9ydCBkZWZhdWx0QXBwQ29uZmlncyBmcm9tICcuL2RlZmF1bHQvYXBwLmNvbmZpZ3MnO1xuaW1wb3J0IGRlZmF1bHRVc2VyQ29uZmlncyBmcm9tICcuL2RlZmF1bHQvdXNlci5jb25maWdzJztcbmltcG9ydCBkZWZhdWx0QXBwVXJscyBmcm9tICcuL2RlZmF1bHQvYXBwLnVybHMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIE9VcmxMaXN0IHtcblx0W2tleTogc3RyaW5nXTogc3RyaW5nO1xuXG5cdE9aX1NFUlZFUl9HRVRfRklMRV9VUkk6IHN0cmluZztcblx0T1pfU0VSVkVSX1RORVRfU0VSVklDRTogc3RyaW5nO1xuXHRPWl9TRVJWRVJfTE9HSU5fU0VSVklDRTogc3RyaW5nO1xuXHRPWl9TRVJWRVJfTE9HT1VUX1NFUlZJQ0U6IHN0cmluZztcblx0T1pfU0VSVkVSX1NJR05VUF9TRVJWSUNFOiBzdHJpbmc7XG5cdE9aX1NFUlZFUl9BQ0NPVU5UX1JFQ09WRVJZX1NFUlZJQ0U6IHN0cmluZztcblx0T1pfU0VSVkVSX1BBU1NXT1JEX1NFUlZJQ0U6IHN0cmluZztcblx0T1pfU0VSVkVSX0NBUFRDSEFfU0VSVklDRTogc3RyaW5nO1xuXHRPWl9TRVJWRVJfVVBMT0FEX1NFUlZJQ0U6IHN0cmluZztcblxuXHRPV19BUFBfUEFUSF9TSUdOX1VQOiBzdHJpbmc7XG5cdE9XX0FQUF9QQVRIX0xPR09VVDogc3RyaW5nO1xuXHRPV19BUFBfUEFUSF9MT0dJTjogc3RyaW5nO1xuXHRPV19BUFBfUEFUSF9IT01FOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT0FwcENvbmZpZ3Mge1xuXHRba2V5OiBzdHJpbmddOiBPSlNPTlZhbHVlO1xuXG5cdE9XX0FQUF9OQU1FOiBzdHJpbmc7XG5cdE9XX0FQUF9WRVJTSU9OOiBzdHJpbmc7XG5cdE9XX0FQUF9MT0NBTF9CQVNFX1VSTDogc3RyaW5nO1xuXHRPV19BUFBfUk9VVEVSX0hBU0hfTU9ERTogYm9vbGVhbjtcblx0T1dfQVBQX0FMTE9XRURfQ09VTlRSSUVTOiBzdHJpbmdbXTtcblxuXHRPWl9BUElfS0VZOiBzdHJpbmc7XG5cdE9aX0FQSV9LRVlfSEVBREVSX05BTUU6IHN0cmluZztcblx0T1pfQVBJX0FMTE9XX1JFQUxfTUVUSE9EX0hFQURFUjogYm9vbGVhbjtcblx0T1pfQVBJX1JFQUxfTUVUSE9EX0hFQURFUl9OQU1FOiBzdHJpbmc7XG5cdE9aX0FQSV9CQVNFX1VSTDogc3RyaW5nO1xuXG5cdE9aX0NPREVfUkVHOiBzdHJpbmc7XG5cdE9aX1VTRVJfTkFNRV9NSU5fTEVOR1RIOiBudW1iZXI7XG5cdE9aX1VTRVJfTkFNRV9NQVhfTEVOR1RIOiBudW1iZXI7XG5cdE9aX1BBU1NfTUlOX0xFTkdUSDogbnVtYmVyO1xuXHRPWl9QQVNTX01BWF9MRU5HVEg6IG51bWJlcjtcblx0T1pfVVNFUl9NSU5fQUdFOiBudW1iZXI7XG5cdE9aX1VTRVJfTUFYX0FHRTogbnVtYmVyO1xuXHRPWl9QUElDX01JTl9TSVpFOiBudW1iZXI7XG5cdE9aX1VTRVJfQUxMT1dFRF9HRU5ERVJTOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPVXNlckNvbmZpZ3Mge1xuXHRba2V5OiBzdHJpbmddOiBPSlNPTlZhbHVlO1xuXG5cdE9XX0FQUF9ERUZBVUxUX0xBTkc6IHN0cmluZztcblx0T1dfQVBQX0NPVU5UUlk6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPU3RvcmUge1xuXHRba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cbmV4cG9ydCB0eXBlIE9Vc2VyID0ge1xuXHRba2V5OiBzdHJpbmddOiBhbnk7XG59O1xuXG5leHBvcnQgaW50ZXJmYWNlIE9BcHBPcHRpb25zPFxuXHRTdG9yZSBleHRlbmRzIE9TdG9yZSxcblx0UGFnZSBleHRlbmRzIE9QYWdlLFxuXHRVc2VyIGV4dGVuZHMgT1VzZXJcbj4ge1xuXHRuYW1lOiBzdHJpbmc7XG5cdGFwcENvbmZpZ3M6IFBhcnRpYWw8T0FwcENvbmZpZ3M+O1xuXHR1c2VyQ29uZmlnczogUGFydGlhbDxPVXNlckNvbmZpZ3M+O1xuXHR1cmxzOiBQYXJ0aWFsPE9VcmxMaXN0Pjtcblx0dXNlcjogKFxuXHRcdHRoaXM6IE9XZWJBcHA8U3RvcmUsIFBhZ2UsIFVzZXIsIE9BcHBPcHRpb25zPFN0b3JlLCBQYWdlLCBVc2VyPj4sXG5cdCkgPT4gT1dlYlVzZXI8VXNlcj47XG5cdHN0b3JlOiAoXG5cdFx0dGhpczogT1dlYkFwcDxTdG9yZSwgUGFnZSwgVXNlciwgT0FwcE9wdGlvbnM8U3RvcmUsIFBhZ2UsIFVzZXI+Pixcblx0KSA9PiBTdG9yZTtcblx0cGFnZXI6IChcblx0XHR0aGlzOiBPV2ViQXBwPFN0b3JlLCBQYWdlLCBVc2VyLCBPQXBwT3B0aW9uczxTdG9yZSwgUGFnZSwgVXNlcj4+LFxuXHQpID0+IE9XZWJQYWdlcjxQYWdlPjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT1dlYkFwcDxcblx0U3RvcmUgZXh0ZW5kcyBPU3RvcmUgPSBhbnksXG5cdFBhZ2UgZXh0ZW5kcyBPUGFnZSA9IGFueSxcblx0VXNlciBleHRlbmRzIE9Vc2VyID0gYW55LFxuXHRPcHRpb25zIGV4dGVuZHMgT0FwcE9wdGlvbnM8U3RvcmUsIFBhZ2UsIFVzZXI+ID0gYW55XG4+IGV4dGVuZHMgT1dlYkV2ZW50IHtcblx0c3RhdGljIHJlYWRvbmx5IFNFTEYgPSBpZCgpO1xuXHRzdGF0aWMgcmVhZG9ubHkgRVZUX0FQUF9SRUFEWSA9IGlkKCk7XG5cdHN0YXRpYyByZWFkb25seSBFVlRfTk9UX0ZPVU5EID0gaWQoKTtcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9TSE9XX0hPTUUgPSBpZCgpO1xuXHRzdGF0aWMgcmVhZG9ubHkgRVZUX1NIT1dfTE9HSU4gPSBpZCgpO1xuXHRzdGF0aWMgcmVhZG9ubHkgRVZUX1NIT1dfUkVHSVNUUkFUSU9OX1BBR0UgPSBpZCgpO1xuXG5cdHJlYWRvbmx5IHZpZXc6IE9XZWJWaWV3O1xuXHRyZWFkb25seSBsczogT1dlYkRhdGFTdG9yZTtcblx0cmVhZG9ubHkgcm91dGVyOiBPV2ViUm91dGVyO1xuXHRyZWFkb25seSB1c2VyOiBPV2ViVXNlcjxVc2VyPjtcblx0cmVhZG9ubHkgY29uZmlnczogT1dlYkNvbmZpZ3M8T0FwcENvbmZpZ3MsIE9Vc2VyQ29uZmlncz47XG5cdHJlYWRvbmx5IHVybDogT1dlYlVybDtcblx0cmVhZG9ubHkgaTE4bjogT1dlYkkxOG47XG5cdHJlYWRvbmx5IG96OiBPWm9uZTtcblxuXHRwcml2YXRlIHJlYWRvbmx5IF9zdG9yZTogU3RvcmU7XG5cdHByaXZhdGUgcmVhZG9ubHkgX3BhZ2VyOiBPV2ViUGFnZXI8UGFnZT47XG5cblx0LyoqXG5cdCAqIE9XZWJBcHAgY29uc3RydWN0b3IuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zXG5cdCAqL1xuXHRwcm90ZWN0ZWQgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBvcHRpb25zOiBPcHRpb25zKSB7XG5cdFx0c3VwZXIoKTtcblxuXHRcdHRoaXMubHMgPSBuZXcgT1dlYkRhdGFTdG9yZSh0aGlzKTtcblx0XHR0aGlzLmNvbmZpZ3MgPSBuZXcgT1dlYkNvbmZpZ3MoXG5cdFx0XHR0aGlzLFxuXHRcdFx0YXNzaWduKHt9LCBkZWZhdWx0QXBwQ29uZmlncywgb3B0aW9ucy5hcHBDb25maWdzKSxcblx0XHRcdGFzc2lnbih7fSwgZGVmYXVsdFVzZXJDb25maWdzLCBvcHRpb25zLnVzZXJDb25maWdzKVxuXHRcdCk7XG5cdFx0dGhpcy51cmwgPSBuZXcgT1dlYlVybCh0aGlzLCBhc3NpZ24oe30sIGRlZmF1bHRBcHBVcmxzLCBvcHRpb25zLnVybHMpKTtcblx0XHR0aGlzLnZpZXcgPSBuZXcgT1dlYlZpZXcoKTtcblx0XHR0aGlzLmkxOG4gPSBuZXcgT1dlYkkxOG4oKTtcblx0XHR0aGlzLnVzZXIgPSBvcHRpb25zLnVzZXIuY2FsbCh0aGlzKTtcblx0XHR0aGlzLl9zdG9yZSA9IG9wdGlvbnMuc3RvcmUuY2FsbCh0aGlzKTtcblx0XHR0aGlzLl9wYWdlciA9IG9wdGlvbnMucGFnZXIuY2FsbCh0aGlzKTtcblxuXHRcdGNvbnN0IGN0eCA9IHRoaXMsXG5cdFx0XHRiYXNlVXJsID0gdGhpcy5jb25maWdzLmdldCgnT1dfQVBQX0xPQ0FMX0JBU0VfVVJMJyksXG5cdFx0XHRoYXNoTW9kZSA9IHRoaXMuY29uZmlncy5nZXQoJ09XX0FQUF9ST1VURVJfSEFTSF9NT0RFJyk7XG5cblx0XHR0aGlzLnJvdXRlciA9IG5ldyBPV2ViUm91dGVyKFxuXHRcdFx0YmFzZVVybCxcblx0XHRcdGhhc2hNb2RlLFxuXHRcdFx0ZnVuY3Rpb24gbm90Rm91bmRIYW5kbGVyKHRhcmdldDogT1JvdXRlVGFyZ2V0KSB7XG5cdFx0XHRcdGN0eC50cmlnZ2VyKE9XZWJBcHAuRVZUX05PVF9GT1VORCwgW3RhcmdldF0pO1xuXHRcdFx0fVxuXHRcdCk7XG5cblx0XHR0aGlzLmkxOG4uc2V0RGVmYXVsdExhbmcodGhpcy5jb25maWdzLmdldCgnT1dfQVBQX0RFRkFVTFRfTEFORycpKTtcblxuXHRcdHRoaXMub3ogPSBPWm9uZS5pbnN0YW50aWF0ZSh0aGlzKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBCdWlsZCBhbiBIVFRQIHJlcXVlc3QuXG5cdCAqXG5cdCAqIEBwYXJhbSB1cmxcblx0ICogQHBhcmFtIG9wdGlvbnNcblx0ICovXG5cdHJlcXVlc3Q8UmVzcG9uc2U+KFxuXHRcdHVybDogc3RyaW5nLFxuXHRcdG9wdGlvbnM6IFBhcnRpYWw8T05ldFJlcXVlc3RPcHRpb25zPFJlc3BvbnNlPj4gPSB7fVxuXHQpOiBPV2ViWEhSPFJlc3BvbnNlPiB7XG5cdFx0bG9nZ2VyLmRlYnVnKCdbTmV0XSBuZXcgcmVxdWVzdCcsIHVybCwgb3B0aW9ucyk7XG5cblx0XHRjb25zdCBldmVudCA9IGZ1bmN0aW9uIGV2ZW50KHR5cGU6IHN0cmluZykge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uIGV2ZW50SGFuZGxlcigpOiB2b2lkIHtcblx0XHRcdFx0bG9nZ2VyLmRlYnVnKCdbTmV0XSBldmVudCAlcycsIHR5cGUsIHVybCwgb3B0aW9ucyk7XG5cdFx0XHR9O1xuXHRcdH07XG5cblx0XHRjb25zdCBvID0gbmV3IE9XZWJYSFI8UmVzcG9uc2U+KHVybCwge1xuXHRcdFx0d2l0aENyZWRlbnRpYWxzOiB0cnVlLFxuXHRcdFx0Li4ub3B0aW9ucyxcblx0XHR9KTtcblxuXHRcdG8ub25GaW5pc2goZXZlbnQoJ29uRmluaXNoZWQnKSlcblx0XHRcdC5vbkVycm9yKGV2ZW50KCdvbkVycm9yJykpXG5cdFx0XHQub25GYWlsKGV2ZW50KCdvbkZhaWxlZCcpKVxuXHRcdFx0Lm9uSHR0cEVycm9yKGV2ZW50KCdvbkh0dHBFcnJvcicpKVxuXHRcdFx0Lm9uSHR0cFN1Y2Nlc3MoZXZlbnQoJ29uSHR0cFN1Y2Nlc3MnKSlcblx0XHRcdC5vbkdvb2ROZXdzKGV2ZW50KCdvbkdvb2ROZXdzJykpXG5cdFx0XHQub25CYWROZXdzKGV2ZW50KCdvbkJhZE5ld3MnKSlcblx0XHRcdC5vbkRvd25sb2FkUHJvZ3Jlc3MoZXZlbnQoJ29uRG93bmxvYWRQcm9ncmVzcycpKVxuXHRcdFx0Lm9uVXBsb2FkUHJvZ3Jlc3MoZXZlbnQoJ29uVXBsb2FkUHJvZ3Jlc3MnKSlcblx0XHRcdC5vblJlc3BvbnNlKGV2ZW50KCdvblJlc3BvbnNlJykpO1xuXG5cdFx0cmV0dXJuIG87XG5cdH1cblxuXHQvKipcblx0ICogU3RvcmUgZ2V0dGVyLlxuXHQgKi9cblx0Z2V0IHN0b3JlKCk6IFJldHVyblR5cGU8T3B0aW9uc1snc3RvcmUnXT4ge1xuXHRcdHJldHVybiB0aGlzLl9zdG9yZSBhcyBhbnk7XG5cdH1cblxuXHQvKipcblx0ICogUGFnZXIgaW5zdGFuY2UgZ2V0dGVyLlxuXHQgKi9cblx0Z2V0IHBhZ2VyKCk6IFJldHVyblR5cGU8T3B0aW9uc1sncGFnZXInXT4ge1xuXHRcdHJldHVybiB0aGlzLl9wYWdlciBhcyBhbnk7XG5cdH1cblxuXHQvKipcblx0ICogQXBwIG5hbWUgZ2V0dGVyLlxuXHQgKi9cblx0Z2V0QXBwTmFtZSgpOiBzdHJpbmcge1xuXHRcdHJldHVybiB0aGlzLm9wdGlvbnMubmFtZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDaGVja3MgaWYgd2UgYXJlIHJ1bm5pbmcgaW4gbW9iaWxlIGFwcC5cblx0ICovXG5cdGlzTW9iaWxlQXBwKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiAnY29yZG92YScgaW4gd2luZG93O1xuXHR9XG5cblx0LyoqXG5cdCAqIFJldHVybnMgbmV3IGZvcm0gdmFsaWRhdG9yIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gZm9ybSBUaGUgaHRtbCBmb3JtIGVsZW1lbnQuXG5cdCAqIEBwYXJhbSByZXF1aXJlZCBUaGUgcmVxdWlyZWQgZmllbGRzIG5hbWVzIGxpc3QuXG5cdCAqIEBwYXJhbSBleGNsdWRlZCBUaGUgZmllbGRzIG5hbWVzIHRvIGV4Y2x1ZGUuXG5cdCAqIEBwYXJhbSBjaGVja0FsbCBGb3JjZSB0aGUgdmFsaWRhdG9yIHRvIGNoZWNrIGFsbCBmaWVsZHMuXG5cdCAqIEBwYXJhbSB2ZXJib3NlIExvZyB3YXJuaW5nLlxuXHQgKi9cblx0Z2V0Rm9ybVZhbGlkYXRvcihcblx0XHRmb3JtOiBPRm9ybSxcblx0XHRyZXF1aXJlZDogc3RyaW5nW10gPSBbXSxcblx0XHRleGNsdWRlZDogc3RyaW5nW10gPSBbXSxcblx0XHRjaGVja0FsbCA9IGZhbHNlLFxuXHRcdHZlcmJvc2UgPSBmYWxzZVxuXHQpOiBPV2ViRm9ybVZhbGlkYXRvciB7XG5cdFx0cmV0dXJuIG5ldyBPV2ViRm9ybVZhbGlkYXRvcihcblx0XHRcdHRoaXMsXG5cdFx0XHRmb3JtLFxuXHRcdFx0cmVxdWlyZWQsXG5cdFx0XHRleGNsdWRlZCxcblx0XHRcdGNoZWNrQWxsLFxuXHRcdFx0dmVyYm9zZVxuXHRcdCk7XG5cdH1cblxuXHQvKipcblx0ICogRm9yY2UgbG9naW4uXG5cdCAqXG5cdCAqID4gVGhpcyB3aWxsIGNsZWFyIGFsbCBzYXZlZCBkYXRhIGluIHRoZSBsb2NhbCBzdG9yYWdlLlxuXHQgKi9cblx0Zm9yY2VMb2dpbigpOnZvaWQge1xuXHRcdHRoaXMubHMuY2xlYXIoKTtcblx0XHR0aGlzLnNob3dMb2dpblBhZ2Uoe30pO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlbG9hZCB0aGUgYXBwLlxuXHQgKi9cblx0cmVsb2FkQXBwKCk6dm9pZCB7XG5cdFx0Ly8gVE9ETzogaW5zdGVhZCBvZiByZWxvYWRpbmcgdGhlIGN1cnJlbnQgbG9jYXRpb24sIGZpbmQgYSB3YXkgdG8gYnJvd3NlIHRvIHdlYiBhcHAgZW50cnkgcG9pbnRcblx0XHQvLyBmb3IgYW5kcm9pZCAmIGlvcyByZXN0YXJ0IHRoZSBhcHBcblx0XHQvLyB3aW5kb3cubG9jYXRpb24ucmVsb2FkKHRydWUpO1xuXHRcdHRoaXMuc2hvd0hvbWVQYWdlKHt9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBEZXN0cm95IHRoZSBhcHAuXG5cdCAqXG5cdCAqID4gVGhpcyB3aWxsIGNsZWFyIGFsbCBzYXZlZCBkYXRhIGluIHRoZSBsb2NhbCBzdG9yYWdlLlxuXHQgKi9cblx0ZGVzdHJveUFwcCgpOnZvaWQge1xuXHRcdC8vIGVyYXNlIGRhdGFcblx0XHR0aGlzLmxzLmNsZWFyKCk7XG5cdFx0dGhpcy5yZWxvYWRBcHAoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDbG9zZSBhcHAuXG5cdCAqL1xuXHRjbG9zZUFwcCgpOnZvaWQge1xuXHRcdC8vIGNvcmRvdmFcblx0XHRpZiAod2luZG93Lm5hdmlnYXRvciAmJiAod2luZG93Lm5hdmlnYXRvciBhcyBhbnkpLmFwcCkge1xuXHRcdFx0KHdpbmRvdy5uYXZpZ2F0b3IgYXMgYW55KS5hcHAuZXhpdEFwcCgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR3aW5kb3cuY2xvc2UoKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogVG8gc3RhcnQgdGhlIHdlYiBhcHAuXG5cdCAqL1xuXHRzdGFydCgpOiB0aGlzIHtcblx0XHRsb2dnZXIuaW5mbygnW09XZWJBcHBdIGFwcCBzdGFydGVkIScpO1xuXHRcdHRoaXMudHJpZ2dlcihPV2ViQXBwLkVWVF9BUFBfUkVBRFkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqXG5cdCAqIENhbGxlZCB3aGVuIGFwcCBzaG91bGQgc2hvdyB0aGUgaG9tZSBwYWdlLlxuXHQgKi9cblx0c2hvd0hvbWVQYWdlKG9wdGlvbnM6IE9Sb3V0ZVN0YXRlT2JqZWN0ID0ge30pOnZvaWQge1xuXHRcdHRoaXMudHJpZ2dlcihPV2ViQXBwLkVWVF9TSE9XX0hPTUUsIFtvcHRpb25zXSk7XG5cdH1cblxuXHQvKipcblx0ICogQ2FsbGVkIHdoZW4gYXBwIHNob3VsZCBzaG93IHRoZSBsb2dpbiBwYWdlLlxuXHQgKi9cblx0c2hvd0xvZ2luUGFnZShvcHRpb25zOiBPUm91dGVTdGF0ZU9iamVjdCA9IHt9KTp2b2lkIHtcblx0XHR0aGlzLnRyaWdnZXIoT1dlYkFwcC5FVlRfU0hPV19MT0dJTiwgW29wdGlvbnNdKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDYWxsZWQgd2hlbiBhcHAgc2hvdWxkIHNob3cgdGhlIHJlZ2lzdHJhdGlvbiBwYWdlLlxuXHQgKi9cblx0c2hvd1JlZ2lzdHJhdGlvblBhZ2Uob3B0aW9uczogT1JvdXRlU3RhdGVPYmplY3QgPSB7fSk6dm9pZCB7XG5cdFx0dGhpcy50cmlnZ2VyKE9XZWJBcHAuRVZUX1NIT1dfTE9HSU4sIFtvcHRpb25zXSk7XG5cdH1cblxuXHQvKipcblx0ICogUmVnaXN0ZXIgaGFuZGxlciBmb3IgT1dlYkFwcC5FVlRfQVBQX1JFQURZIGV2ZW50XG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVyXG5cdCAqL1xuXHRvblJlYWR5KGhhbmRsZXI6ICh0aGlzOiB0aGlzKSA9PiB2b2lkIHwgYm9vbGVhbik6dGhpcyB7XG5cdFx0cmV0dXJuIHRoaXMub24oT1dlYkFwcC5FVlRfQVBQX1JFQURZLCBoYW5kbGVyKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZWdpc3RlciBoYW5kbGVyIGZvciBPV2ViQXBwLkVWVF9TSE9XX0hPTUUgZXZlbnRcblx0ICpcblx0ICogQHBhcmFtIGhhbmRsZXJcblx0ICovXG5cdG9uU2hvd0hvbWVQYWdlKFxuXHRcdGhhbmRsZXI6ICh0aGlzOiB0aGlzLCBvcHRpb25zOiBPUm91dGVTdGF0ZU9iamVjdCkgPT4gdm9pZCB8IGJvb2xlYW5cblx0KTp0aGlzIHtcblx0XHRyZXR1cm4gdGhpcy5vbihPV2ViQXBwLkVWVF9TSE9XX0hPTUUsIGhhbmRsZXIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlZ2lzdGVyIGhhbmRsZXIgZm9yIE9XZWJBcHAuRVZUX1NIT1dfTE9HSU4gZXZlbnRcblx0ICpcblx0ICogQHBhcmFtIGhhbmRsZXJcblx0ICovXG5cdG9uU2hvd0xvZ2luUGFnZShcblx0XHRoYW5kbGVyOiAodGhpczogdGhpcywgb3B0aW9uczogT1JvdXRlU3RhdGVPYmplY3QpID0+IHZvaWQgfCBib29sZWFuXG5cdCkgOnRoaXN7XG5cdFx0cmV0dXJuIHRoaXMub24oT1dlYkFwcC5FVlRfU0hPV19MT0dJTiwgaGFuZGxlcik7XG5cdH1cblxuXHQvKipcblx0ICogUmVnaXN0ZXIgaGFuZGxlciBmb3IgT1dlYkFwcC5FVlRfU0hPV19SRUdJU1RSQVRJT05fUEFHRSBldmVudFxuXHQgKlxuXHQgKiBAcGFyYW0gaGFuZGxlclxuXHQgKi9cblx0b25TaG93UmVnaXN0cmF0aW9uUGFnZShcblx0XHRoYW5kbGVyOiAodGhpczogdGhpcywgb3B0aW9uczogT1JvdXRlU3RhdGVPYmplY3QpID0+IHZvaWQgfCBib29sZWFuXG5cdCk6dGhpcyB7XG5cdFx0cmV0dXJuIHRoaXMub24oT1dlYkFwcC5FVlRfU0hPV19SRUdJU1RSQVRJT05fUEFHRSwgaGFuZGxlcik7XG5cdH1cblxuXHQvKipcblx0ICogUmVnaXN0ZXIgaGFuZGxlciBmb3IgT1dlYkFwcC5FVlRfTk9UX0ZPVU5EIGV2ZW50XG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVyXG5cdCAqL1xuXHRvblBhZ2VOb3RGb3VuZChcblx0XHRoYW5kbGVyOiAodGhpczogdGhpcywgdGFyZ2V0OiBPUm91dGVUYXJnZXQpID0+IHZvaWQgfCBib29sZWFuXG5cdCk6dGhpcyB7XG5cdFx0cmV0dXJuIHRoaXMub24oT1dlYkFwcC5FVlRfTk9UX0ZPVU5ELCBoYW5kbGVyKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBDcmVhdGVzIG5ldyBhcHAgaW5zdGFuY2UuXG5cdCAqXG5cdCAqIEBwYXJhbSBvcHRpb25zXG5cdCAqL1xuXHRzdGF0aWMgY3JlYXRlPE9wdGlvbnMgZXh0ZW5kcyBPQXBwT3B0aW9uczxPU3RvcmUsIE9QYWdlLCBPVXNlcj4gPSBhbnk+KFxuXHRcdG9wdGlvbnM6IE9wdGlvbnNcblx0KTogT1dlYkFwcDxhbnksIGFueSwgYW55LCBPcHRpb25zPiB7XG5cdFx0cmV0dXJuIG5ldyBPV2ViQXBwKG9wdGlvbnMpO1xuXHR9XG59XG4iXX0=