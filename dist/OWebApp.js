import OWebConfigs from './OWebConfigs';
import OWebDataStore from './OWebDataStore';
import OWebEvent from './OWebEvent';
import OWebForm from './OWebForm';
import OWebRouter from './OWebRouter';
import OWebUrl from './OWebUrl';
import OWebView from './OWebView';
import OWebI18n from './OWebI18n';
import { assign, id, logger } from './utils';
import OZone from './ozone';
import OWebXHR from './OWebXHR';
import defaultAppConfigs from './default/app.configs';
import defaultUserConfigs from './default/user.configs';
import defaultAppUrls from './default/app.urls';
import { OFormDOMFormAdapter, OFormObjectAdapter } from './OWebFormAdapter';
import { globalRoot } from './env';
export default class OWebApp extends OWebEvent {
    options;
    static SELF = id();
    static EVT_APP_READY = id();
    static EVT_NOT_FOUND = id();
    static EVT_SHOW_HOME = id();
    static EVT_SHOW_LOGIN = id();
    static EVT_SHOW_REGISTRATION_PAGE = id();
    view;
    ls;
    router;
    configs;
    url;
    i18n;
    oz;
    _user;
    _store;
    _pager;
    /**
     * OWebApp constructor.
     *
     * @param options
     */
    constructor(options) {
        super();
        this.options = options;
        this.ls = new OWebDataStore(this);
        this.configs = new OWebConfigs(this, assign({}, defaultAppConfigs, options.appConfigs), assign({}, defaultUserConfigs, options.userConfigs));
        this.url = new OWebUrl(this, assign({}, defaultAppUrls, options.urls));
        this.view = new OWebView();
        this.i18n = new OWebI18n(this);
        this._user = options.user.call(this);
        this._store = options.store.call(this);
        this._pager = options.pager.call(this);
        const ctx = this, baseUrl = this.configs.get('OW_APP_LOCAL_BASE_URL'), hashMode = this.configs.get('OW_APP_ROUTER_HASH_MODE');
        this.router = new OWebRouter(baseUrl, hashMode, function notFoundHandler(target) {
            ctx.trigger(OWebApp.EVT_NOT_FOUND, [target]);
        });
        this.i18n.setLang(this.configs.get('OW_APP_DEFAULT_LANG'));
        this.oz = OZone.instantiate(this);
    }
    /**
     * Build an HTTP request.
     *
     * @param url
     * @param options
     */
    request(url, options = {}) {
        logger.debug('[Net] new request', url, options);
        const event = function event(type) {
            return function eventHandler(...args) {
                logger.debug('[Net] event %s', type, url, options, args);
            };
        };
        const o = new OWebXHR(url, {
            withCredentials: true,
            ...options,
        });
        o.onFinish(event('onFinished'))
            .onError(event('onError'))
            .onFail(event('onFailed'))
            .onHttpError(event('onHttpError'))
            .onHttpSuccess(event('onHttpSuccess'))
            .onGoodNews(event('onGoodNews'))
            .onBadNews(event('onBadNews'))
            .onDownloadProgress(event('onDownloadProgress'))
            .onUploadProgress(event('onUploadProgress'))
            .onResponse(event('onResponse'));
        return o;
    }
    /**
     * User getter.
     */
    get user() {
        return this._user;
    }
    /**
     * Store getter.
     */
    get store() {
        return this._store;
    }
    /**
     * Pager instance getter.
     */
    get pager() {
        return this._pager;
    }
    /**
     * App name getter.
     */
    getAppName() {
        return this.options.name;
    }
    /**
     * Checks if we are running in mobile app.
     */
    isMobileApp() {
        return 'cordova' in window;
    }
    /**
     * Returns new oweb form instance.
     *
     * @param form The html form element.
     * @param required The required fields names list.
     * @param excluded The fields names to exclude.
     * @param checkAll Force the validator to check all fields.
     * @param verbose Log warning.
     *
     * @deprecated use {@link OWebApp.form}
     */
    getFormValidator(form, required = [], excluded = [], checkAll = false, verbose = false) {
        return this.form(form, required, excluded, checkAll, verbose);
    }
    /**
     * Returns new oweb form instance.
     *
     * @param form The html form element.
     * @param required The required fields names list.
     * @param excluded The fields names to exclude.
     * @param checkAll Force the validator to check all fields.
     * @param verbose Log warning.
     */
    form(form, required = [], excluded = [], checkAll = false, verbose = false) {
        return new OWebForm(this, form instanceof HTMLFormElement
            ? new OFormDOMFormAdapter(form)
            : new OFormObjectAdapter(form), required, excluded, checkAll, verbose);
    }
    /**
     * Force login.
     *
     * > This will clear all saved data in the local storage.
     */
    forceLogin() {
        this.ls.clear();
        this.showLoginPage({});
    }
    /**
     * Reload the app.
     */
    reloadApp() {
        // TODO: instead of reloading the current location, find a way to browse to web app entry point
        // for android & ios restart the app
        // window.location.reload(true);
        this.showHomePage({});
    }
    /**
     * Destroy the app.
     *
     * > This will clear all saved data in the local storage.
     */
    destroyApp() {
        // erase data
        this.ls.clear();
        this.reloadApp();
    }
    /**
     * Close app.
     */
    closeApp() {
        // cordova
        if (globalRoot.navigator && globalRoot.navigator.app) {
            globalRoot.navigator.app.exitApp();
        }
        else {
            globalRoot.close();
        }
    }
    /**
     * To start the web app.
     */
    start() {
        logger.info('[OWebApp] app started!');
        this.trigger(OWebApp.EVT_APP_READY);
        return this;
    }
    /**
     * Called when app should show the home page.
     */
    showHomePage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_HOME, [options]);
    }
    /**
     * Called when app should show the login page.
     */
    showLoginPage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_LOGIN, [options]);
    }
    /**
     * Called when app should show the registration page.
     */
    showRegistrationPage(options = {}) {
        this.trigger(OWebApp.EVT_SHOW_LOGIN, [options]);
    }
    /**
     * Register handler for OWebApp.EVT_APP_READY event
     *
     * @param handler
     */
    onReady(handler) {
        return this.on(OWebApp.EVT_APP_READY, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_HOME event
     *
     * @param handler
     */
    onShowHomePage(handler) {
        return this.on(OWebApp.EVT_SHOW_HOME, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_LOGIN event
     *
     * @param handler
     */
    onShowLoginPage(handler) {
        return this.on(OWebApp.EVT_SHOW_LOGIN, handler);
    }
    /**
     * Register handler for OWebApp.EVT_SHOW_REGISTRATION_PAGE event
     *
     * @param handler
     */
    onShowRegistrationPage(handler) {
        return this.on(OWebApp.EVT_SHOW_REGISTRATION_PAGE, handler);
    }
    /**
     * Register handler for OWebApp.EVT_NOT_FOUND event
     *
     * @param handler
     */
    onPageNotFound(handler) {
        return this.on(OWebApp.EVT_NOT_FOUND, handler);
    }
    /**
     * Creates new app instance.
     *
     * @param options
     */
    static create(options) {
        return new OWebApp(options);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT1dlYkFwcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9PV2ViQXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sV0FBVyxNQUFNLGVBQWUsQ0FBQztBQUN4QyxPQUFPLGFBQTZCLE1BQU0saUJBQWlCLENBQUM7QUFDNUQsT0FBTyxTQUFTLE1BQU0sYUFBYSxDQUFDO0FBQ3BDLE9BQU8sUUFBZ0MsTUFBTSxZQUFZLENBQUM7QUFDMUQsT0FBTyxVQUErQyxNQUFNLGNBQWMsQ0FBQztBQUMzRSxPQUFPLE9BQU8sTUFBTSxXQUFXLENBQUM7QUFDaEMsT0FBTyxRQUFRLE1BQU0sWUFBWSxDQUFDO0FBQ2xDLE9BQU8sUUFBUSxNQUFNLFlBQVksQ0FBQztBQUNsQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDN0MsT0FBTyxLQUFLLE1BQU0sU0FBUyxDQUFDO0FBSTVCLE9BQU8sT0FBTyxNQUFNLFdBQVcsQ0FBQztBQUNoQyxPQUFPLGlCQUFpQixNQUFNLHVCQUF1QixDQUFDO0FBQ3RELE9BQU8sa0JBQWtCLE1BQU0sd0JBQXdCLENBQUM7QUFDeEQsT0FBTyxjQUFjLE1BQU0sb0JBQW9CLENBQUM7QUFDaEQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLGtCQUFrQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDNUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLE9BQU8sQ0FBQztBQWdGbkMsTUFBTSxDQUFDLE9BQU8sT0FBTyxPQUtuQixTQUFRLFNBQVM7SUE0QnFCO0lBM0J2QyxNQUFNLENBQVUsSUFBSSxHQUFHLEVBQUUsRUFBRSxDQUFDO0lBQzVCLE1BQU0sQ0FBVSxhQUFhLEdBQUcsRUFBRSxFQUFFLENBQUM7SUFDckMsTUFBTSxDQUFVLGFBQWEsR0FBRyxFQUFFLEVBQUUsQ0FBQztJQUNyQyxNQUFNLENBQVUsYUFBYSxHQUFHLEVBQUUsRUFBRSxDQUFDO0lBQ3JD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RUFBRSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxzQkFBc0IsQ0FDckIsT0FBbUU7UUFFbkUsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQywwQkFBMEIsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM3RCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGNBQWMsQ0FDYixPQUE2RDtRQUU3RCxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILE1BQU0sQ0FBQyxNQUFNLENBQ1osT0FBZ0I7UUFFaEIsT0FBTyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM3QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE9XZWJDb25maWdzIGZyb20gJy4vT1dlYkNvbmZpZ3MnO1xuaW1wb3J0IE9XZWJEYXRhU3RvcmUsIHsgT0pTT05WYWx1ZSB9IGZyb20gJy4vT1dlYkRhdGFTdG9yZSc7XG5pbXBvcnQgT1dlYkV2ZW50IGZyb20gJy4vT1dlYkV2ZW50JztcbmltcG9ydCBPV2ViRm9ybSwgeyBPV2ViRm9ybURlZmluaXRpb24gfSBmcm9tICcuL09XZWJGb3JtJztcbmltcG9ydCBPV2ViUm91dGVyLCB7IE9Sb3V0ZVN0YXRlT2JqZWN0LCBPUm91dGVUYXJnZXQgfSBmcm9tICcuL09XZWJSb3V0ZXInO1xuaW1wb3J0IE9XZWJVcmwgZnJvbSAnLi9PV2ViVXJsJztcbmltcG9ydCBPV2ViVmlldyBmcm9tICcuL09XZWJWaWV3JztcbmltcG9ydCBPV2ViSTE4biBmcm9tICcuL09XZWJJMThuJztcbmltcG9ydCB7IGFzc2lnbiwgaWQsIGxvZ2dlciB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IE9ab25lIGZyb20gJy4vb3pvbmUnO1xuaW1wb3J0IE9XZWJQYWdlciwgeyBPUGFnZSwgT1BhZ2VSb3V0ZSB9IGZyb20gJy4vT1dlYlBhZ2VyJztcbmltcG9ydCBPV2ViVXNlciBmcm9tICcuL09XZWJVc2VyJztcbmltcG9ydCB7IE9OZXRSZXF1ZXN0T3B0aW9ucyB9IGZyb20gJy4vT1dlYk5ldCc7XG5pbXBvcnQgT1dlYlhIUiBmcm9tICcuL09XZWJYSFInO1xuaW1wb3J0IGRlZmF1bHRBcHBDb25maWdzIGZyb20gJy4vZGVmYXVsdC9hcHAuY29uZmlncyc7XG5pbXBvcnQgZGVmYXVsdFVzZXJDb25maWdzIGZyb20gJy4vZGVmYXVsdC91c2VyLmNvbmZpZ3MnO1xuaW1wb3J0IGRlZmF1bHRBcHBVcmxzIGZyb20gJy4vZGVmYXVsdC9hcHAudXJscyc7XG5pbXBvcnQgeyBPRm9ybURPTUZvcm1BZGFwdGVyLCBPRm9ybU9iamVjdEFkYXB0ZXIgfSBmcm9tICcuL09XZWJGb3JtQWRhcHRlcic7XG5pbXBvcnQgeyBnbG9iYWxSb290IH0gZnJvbSAnLi9lbnYnO1xuXG5leHBvcnQgaW50ZXJmYWNlIE9VcmxMaXN0IHtcblx0W2tleTogc3RyaW5nXTogc3RyaW5nO1xuXG5cdE9aX1NFUlZFUl9HRVRfRklMRV9VUkk6IHN0cmluZztcblx0T1pfU0VSVkVSX1RORVRfU0VSVklDRTogc3RyaW5nO1xuXHRPWl9TRVJWRVJfTE9HSU5fU0VSVklDRTogc3RyaW5nO1xuXHRPWl9TRVJWRVJfTE9HT1VUX1NFUlZJQ0U6IHN0cmluZztcblx0T1pfU0VSVkVSX1NJR05VUF9TRVJWSUNFOiBzdHJpbmc7XG5cdE9aX1NFUlZFUl9BQ0NPVU5UX1JFQ09WRVJZX1NFUlZJQ0U6IHN0cmluZztcblx0T1pfU0VSVkVSX1BBU1NXT1JEX1NFUlZJQ0U6IHN0cmluZztcblx0T1pfU0VSVkVSX0NBUFRDSEFfU0VSVklDRTogc3RyaW5nO1xuXHRPWl9TRVJWRVJfVVBMT0FEX1NFUlZJQ0U6IHN0cmluZztcblxuXHRPV19BUFBfUEFUSF9TSUdOX1VQOiBzdHJpbmc7XG5cdE9XX0FQUF9QQVRIX0xPR09VVDogc3RyaW5nO1xuXHRPV19BUFBfUEFUSF9MT0dJTjogc3RyaW5nO1xuXHRPV19BUFBfUEFUSF9IT01FOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT0FwcENvbmZpZ3Mge1xuXHRba2V5OiBzdHJpbmddOiBPSlNPTlZhbHVlO1xuXG5cdE9XX0FQUF9OQU1FOiBzdHJpbmc7XG5cdE9XX0FQUF9WRVJTSU9OOiBzdHJpbmc7XG5cdE9XX0FQUF9MT0NBTF9CQVNFX1VSTDogc3RyaW5nO1xuXHRPV19BUFBfUk9VVEVSX0hBU0hfTU9ERTogYm9vbGVhbjtcblx0T1dfQVBQX0FMTE9XRURfQ09VTlRSSUVTOiBzdHJpbmdbXTtcblxuXHRPWl9BUElfS0VZOiBzdHJpbmc7XG5cdE9aX0FQSV9LRVlfSEVBREVSX05BTUU6IHN0cmluZztcblx0T1pfQVBJX0FMTE9XX1JFQUxfTUVUSE9EX0hFQURFUjogYm9vbGVhbjtcblx0T1pfQVBJX1JFQUxfTUVUSE9EX0hFQURFUl9OQU1FOiBzdHJpbmc7XG5cdE9aX0FQSV9CQVNFX1VSTDogc3RyaW5nO1xuXG5cdE9aX0NPREVfUkVHOiBzdHJpbmc7XG5cdE9aX1VTRVJfTkFNRV9NSU5fTEVOR1RIOiBudW1iZXI7XG5cdE9aX1VTRVJfTkFNRV9NQVhfTEVOR1RIOiBudW1iZXI7XG5cdE9aX1BBU1NfTUlOX0xFTkdUSDogbnVtYmVyO1xuXHRPWl9QQVNTX01BWF9MRU5HVEg6IG51bWJlcjtcblx0T1pfVVNFUl9NSU5fQUdFOiBudW1iZXI7XG5cdE9aX1VTRVJfTUFYX0FHRTogbnVtYmVyO1xuXHRPWl9QUElDX01JTl9TSVpFOiBudW1iZXI7XG5cdE9aX1VTRVJfQUxMT1dFRF9HRU5ERVJTOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPVXNlckNvbmZpZ3Mge1xuXHRba2V5OiBzdHJpbmddOiBPSlNPTlZhbHVlO1xuXG5cdE9XX0FQUF9ERUZBVUxUX0xBTkc6IHN0cmluZztcblx0T1dfQVBQX0NPVU5UUlk6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPU3RvcmUge1xuXHRba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cbmV4cG9ydCB0eXBlIE9Vc2VyID0ge1xuXHRba2V5OiBzdHJpbmddOiBhbnk7XG59O1xuZXhwb3J0IGludGVyZmFjZSBPQXBwT3B0aW9uczxcblx0U3RvcmUgZXh0ZW5kcyBPU3RvcmUgPSBPU3RvcmUsXG5cdFBhZ2UgZXh0ZW5kcyBPUGFnZTxPUGFnZVJvdXRlPiA9IE9QYWdlPE9QYWdlUm91dGU+LFxuXHRVc2VyIGV4dGVuZHMgT1VzZXIgPSBPVXNlcixcblx0QXBwQ29uZmlncyBleHRlbmRzIFBhcnRpYWw8T0FwcENvbmZpZ3M+ID0gUGFydGlhbDxPQXBwQ29uZmlncz4sXG5cdFVzZXJDb25maWdzIGV4dGVuZHMgUGFydGlhbDxPVXNlckNvbmZpZ3M+ID0gUGFydGlhbDxPVXNlckNvbmZpZ3M+LFxuXHRVcmxMaXN0IGV4dGVuZHMgUGFydGlhbDxPVXJsTGlzdD4gPSBQYXJ0aWFsPE9VcmxMaXN0Pixcblx0Q29udGV4dCA9IE9XZWJBcHA8U3RvcmUsIFBhZ2UsIFVzZXI+XG4+IHtcblx0bmFtZTogc3RyaW5nO1xuXHRhcHBDb25maWdzOiBBcHBDb25maWdzO1xuXHR1c2VyQ29uZmlnczogVXNlckNvbmZpZ3M7XG5cdHVybHM6IFVybExpc3Q7XG5cblx0dXNlcjogKHRoaXM6IENvbnRleHQpID0+IE9XZWJVc2VyPFVzZXI+O1xuXHRzdG9yZTogKHRoaXM6IENvbnRleHQpID0+IFN0b3JlO1xuXHRwYWdlcjogKHRoaXM6IENvbnRleHQpID0+IE9XZWJQYWdlcjxQYWdlPjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT1dlYkFwcDxcblx0U3RvcmUgZXh0ZW5kcyBPU3RvcmUgPSBPU3RvcmUsXG5cdFBhZ2UgZXh0ZW5kcyBPUGFnZSA9IE9QYWdlLFxuXHRVc2VyIGV4dGVuZHMgT1VzZXIgPSBPVXNlcixcblx0T3B0aW9ucyBleHRlbmRzIE9BcHBPcHRpb25zPFN0b3JlLCBQYWdlLCBVc2VyPiA9IGFueVxuPiBleHRlbmRzIE9XZWJFdmVudCB7XG5cdHN0YXRpYyByZWFkb25seSBTRUxGID0gaWQoKTtcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9BUFBfUkVBRFkgPSBpZCgpO1xuXHRzdGF0aWMgcmVhZG9ubHkgRVZUX05PVF9GT1VORCA9IGlkKCk7XG5cdHN0YXRpYyByZWFkb25seSBFVlRfU0hPV19IT01FID0gaWQoKTtcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9TSE9XX0xPR0lOID0gaWQoKTtcblx0c3RhdGljIHJlYWRvbmx5IEVWVF9TSE9XX1JFR0lTVFJBVElPTl9QQUdFID0gaWQoKTtcblxuXHRyZWFkb25seSB2aWV3OiBPV2ViVmlldztcblx0cmVhZG9ubHkgbHM6IE9XZWJEYXRhU3RvcmU7XG5cdHJlYWRvbmx5IHJvdXRlcjogT1dlYlJvdXRlcjtcblx0cmVhZG9ubHkgY29uZmlnczogT1dlYkNvbmZpZ3M8XG5cdFx0T0FwcENvbmZpZ3MgJiBPcHRpb25zWydhcHBDb25maWdzJ10sXG5cdFx0T1VzZXJDb25maWdzICYgT3B0aW9uc1sndXNlckNvbmZpZ3MnXVxuXHQ+O1xuXHRyZWFkb25seSB1cmw6IE9XZWJVcmw7XG5cdHJlYWRvbmx5IGkxOG46IE9XZWJJMThuO1xuXHRyZWFkb25seSBvejogT1pvbmU7XG5cblx0cHJpdmF0ZSByZWFkb25seSBfdXNlcjogT1dlYlVzZXI8VXNlcj47XG5cdHByaXZhdGUgcmVhZG9ubHkgX3N0b3JlOiBTdG9yZTtcblx0cHJpdmF0ZSByZWFkb25seSBfcGFnZXI6IE9XZWJQYWdlcjxQYWdlPjtcblxuXHQvKipcblx0ICogT1dlYkFwcCBjb25zdHJ1Y3Rvci5cblx0ICpcblx0ICogQHBhcmFtIG9wdGlvbnNcblx0ICovXG5cdHByb3RlY3RlZCBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IG9wdGlvbnM6IE9wdGlvbnMpIHtcblx0XHRzdXBlcigpO1xuXG5cdFx0dGhpcy5scyA9IG5ldyBPV2ViRGF0YVN0b3JlKHRoaXMpO1xuXHRcdHRoaXMuY29uZmlncyA9IG5ldyBPV2ViQ29uZmlncyhcblx0XHRcdHRoaXMsXG5cdFx0XHRhc3NpZ24oe30sIGRlZmF1bHRBcHBDb25maWdzLCBvcHRpb25zLmFwcENvbmZpZ3MpLFxuXHRcdFx0YXNzaWduKHt9LCBkZWZhdWx0VXNlckNvbmZpZ3MsIG9wdGlvbnMudXNlckNvbmZpZ3MpXG5cdFx0KTtcblx0XHR0aGlzLnVybCA9IG5ldyBPV2ViVXJsKHRoaXMsIGFzc2lnbih7fSwgZGVmYXVsdEFwcFVybHMsIG9wdGlvbnMudXJscykpO1xuXHRcdHRoaXMudmlldyA9IG5ldyBPV2ViVmlldygpO1xuXHRcdHRoaXMuaTE4biA9IG5ldyBPV2ViSTE4bih0aGlzKTtcblx0XHR0aGlzLl91c2VyID0gb3B0aW9ucy51c2VyLmNhbGwodGhpcyk7XG5cdFx0dGhpcy5fc3RvcmUgPSBvcHRpb25zLnN0b3JlLmNhbGwodGhpcyk7XG5cdFx0dGhpcy5fcGFnZXIgPSBvcHRpb25zLnBhZ2VyLmNhbGwodGhpcyk7XG5cblx0XHRjb25zdCBjdHggPSB0aGlzLFxuXHRcdFx0YmFzZVVybCA9IHRoaXMuY29uZmlncy5nZXQoJ09XX0FQUF9MT0NBTF9CQVNFX1VSTCcpLFxuXHRcdFx0aGFzaE1vZGUgPSB0aGlzLmNvbmZpZ3MuZ2V0KCdPV19BUFBfUk9VVEVSX0hBU0hfTU9ERScpO1xuXG5cdFx0dGhpcy5yb3V0ZXIgPSBuZXcgT1dlYlJvdXRlcihiYXNlVXJsLCBoYXNoTW9kZSwgZnVuY3Rpb24gbm90Rm91bmRIYW5kbGVyKFxuXHRcdFx0dGFyZ2V0OiBPUm91dGVUYXJnZXRcblx0XHQpIHtcblx0XHRcdGN0eC50cmlnZ2VyKE9XZWJBcHAuRVZUX05PVF9GT1VORCwgW3RhcmdldF0pO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5pMThuLnNldExhbmcodGhpcy5jb25maWdzLmdldCgnT1dfQVBQX0RFRkFVTFRfTEFORycpKTtcblxuXHRcdHRoaXMub3ogPSBPWm9uZS5pbnN0YW50aWF0ZSh0aGlzKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBCdWlsZCBhbiBIVFRQIHJlcXVlc3QuXG5cdCAqXG5cdCAqIEBwYXJhbSB1cmxcblx0ICogQHBhcmFtIG9wdGlvbnNcblx0ICovXG5cdHJlcXVlc3Q8UmVzcG9uc2U+KFxuXHRcdHVybDogc3RyaW5nLFxuXHRcdG9wdGlvbnM6IFBhcnRpYWw8T05ldFJlcXVlc3RPcHRpb25zPFJlc3BvbnNlPj4gPSB7fSBhcyBhbnlcblx0KTogT1dlYlhIUjxSZXNwb25zZT4ge1xuXHRcdGxvZ2dlci5kZWJ1ZygnW05ldF0gbmV3IHJlcXVlc3QnLCB1cmwsIG9wdGlvbnMpO1xuXG5cdFx0Y29uc3QgZXZlbnQgPSBmdW5jdGlvbiBldmVudCh0eXBlOiBzdHJpbmcpIHtcblx0XHRcdHJldHVybiBmdW5jdGlvbiBldmVudEhhbmRsZXIoLi4uYXJnczogYW55W10pOiB2b2lkIHtcblx0XHRcdFx0bG9nZ2VyLmRlYnVnKCdbTmV0XSBldmVudCAlcycsIHR5cGUsIHVybCwgb3B0aW9ucywgYXJncyk7XG5cdFx0XHR9O1xuXHRcdH07XG5cblx0XHRjb25zdCBvID0gbmV3IE9XZWJYSFI8UmVzcG9uc2U+KHVybCwge1xuXHRcdFx0d2l0aENyZWRlbnRpYWxzOiB0cnVlLFxuXHRcdFx0Li4ub3B0aW9ucyxcblx0XHR9KTtcblxuXHRcdG8ub25GaW5pc2goZXZlbnQoJ29uRmluaXNoZWQnKSlcblx0XHRcdC5vbkVycm9yKGV2ZW50KCdvbkVycm9yJykpXG5cdFx0XHQub25GYWlsKGV2ZW50KCdvbkZhaWxlZCcpKVxuXHRcdFx0Lm9uSHR0cEVycm9yKGV2ZW50KCdvbkh0dHBFcnJvcicpKVxuXHRcdFx0Lm9uSHR0cFN1Y2Nlc3MoZXZlbnQoJ29uSHR0cFN1Y2Nlc3MnKSlcblx0XHRcdC5vbkdvb2ROZXdzKGV2ZW50KCdvbkdvb2ROZXdzJykpXG5cdFx0XHQub25CYWROZXdzKGV2ZW50KCdvbkJhZE5ld3MnKSlcblx0XHRcdC5vbkRvd25sb2FkUHJvZ3Jlc3MoZXZlbnQoJ29uRG93bmxvYWRQcm9ncmVzcycpKVxuXHRcdFx0Lm9uVXBsb2FkUHJvZ3Jlc3MoZXZlbnQoJ29uVXBsb2FkUHJvZ3Jlc3MnKSlcblx0XHRcdC5vblJlc3BvbnNlKGV2ZW50KCdvblJlc3BvbnNlJykpO1xuXG5cdFx0cmV0dXJuIG87XG5cdH1cblxuXHQvKipcblx0ICogVXNlciBnZXR0ZXIuXG5cdCAqL1xuXHRnZXQgdXNlcigpOiBSZXR1cm5UeXBlPE9wdGlvbnNbJ3VzZXInXT4ge1xuXHRcdHJldHVybiB0aGlzLl91c2VyIGFzIFJldHVyblR5cGU8T3B0aW9uc1sndXNlciddPjtcblx0fVxuXG5cdC8qKlxuXHQgKiBTdG9yZSBnZXR0ZXIuXG5cdCAqL1xuXHRnZXQgc3RvcmUoKTogUmV0dXJuVHlwZTxPcHRpb25zWydzdG9yZSddPiB7XG5cdFx0cmV0dXJuIHRoaXMuX3N0b3JlIGFzIFJldHVyblR5cGU8T3B0aW9uc1snc3RvcmUnXT47XG5cdH1cblxuXHQvKipcblx0ICogUGFnZXIgaW5zdGFuY2UgZ2V0dGVyLlxuXHQgKi9cblx0Z2V0IHBhZ2VyKCk6IFJldHVyblR5cGU8T3B0aW9uc1sncGFnZXInXT4ge1xuXHRcdHJldHVybiB0aGlzLl9wYWdlciBhcyBSZXR1cm5UeXBlPE9wdGlvbnNbJ3BhZ2VyJ10+O1xuXHR9XG5cblx0LyoqXG5cdCAqIEFwcCBuYW1lIGdldHRlci5cblx0ICovXG5cdGdldEFwcE5hbWUoKTogc3RyaW5nIHtcblx0XHRyZXR1cm4gdGhpcy5vcHRpb25zLm5hbWU7XG5cdH1cblxuXHQvKipcblx0ICogQ2hlY2tzIGlmIHdlIGFyZSBydW5uaW5nIGluIG1vYmlsZSBhcHAuXG5cdCAqL1xuXHRpc01vYmlsZUFwcCgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gJ2NvcmRvdmEnIGluIHdpbmRvdztcblx0fVxuXG5cdC8qKlxuXHQgKiBSZXR1cm5zIG5ldyBvd2ViIGZvcm0gaW5zdGFuY2UuXG5cdCAqXG5cdCAqIEBwYXJhbSBmb3JtIFRoZSBodG1sIGZvcm0gZWxlbWVudC5cblx0ICogQHBhcmFtIHJlcXVpcmVkIFRoZSByZXF1aXJlZCBmaWVsZHMgbmFtZXMgbGlzdC5cblx0ICogQHBhcmFtIGV4Y2x1ZGVkIFRoZSBmaWVsZHMgbmFtZXMgdG8gZXhjbHVkZS5cblx0ICogQHBhcmFtIGNoZWNrQWxsIEZvcmNlIHRoZSB2YWxpZGF0b3IgdG8gY2hlY2sgYWxsIGZpZWxkcy5cblx0ICogQHBhcmFtIHZlcmJvc2UgTG9nIHdhcm5pbmcuXG5cdCAqXG5cdCAqIEBkZXByZWNhdGVkIHVzZSB7QGxpbmsgT1dlYkFwcC5mb3JtfVxuXHQgKi9cblx0Z2V0Rm9ybVZhbGlkYXRvcihcblx0XHRmb3JtOiBPV2ViRm9ybURlZmluaXRpb24gfCBIVE1MRm9ybUVsZW1lbnQsXG5cdFx0cmVxdWlyZWQ6IHN0cmluZ1tdID0gW10sXG5cdFx0ZXhjbHVkZWQ6IHN0cmluZ1tdID0gW10sXG5cdFx0Y2hlY2tBbGwgPSBmYWxzZSxcblx0XHR2ZXJib3NlID0gZmFsc2Vcblx0KTogT1dlYkZvcm0ge1xuXHRcdHJldHVybiB0aGlzLmZvcm0oZm9ybSwgcmVxdWlyZWQsIGV4Y2x1ZGVkLCBjaGVja0FsbCwgdmVyYm9zZSk7XG5cdH1cblxuXHQvKipcblx0ICogUmV0dXJucyBuZXcgb3dlYiBmb3JtIGluc3RhbmNlLlxuXHQgKlxuXHQgKiBAcGFyYW0gZm9ybSBUaGUgaHRtbCBmb3JtIGVsZW1lbnQuXG5cdCAqIEBwYXJhbSByZXF1aXJlZCBUaGUgcmVxdWlyZWQgZmllbGRzIG5hbWVzIGxpc3QuXG5cdCAqIEBwYXJhbSBleGNsdWRlZCBUaGUgZmllbGRzIG5hbWVzIHRvIGV4Y2x1ZGUuXG5cdCAqIEBwYXJhbSBjaGVja0FsbCBGb3JjZSB0aGUgdmFsaWRhdG9yIHRvIGNoZWNrIGFsbCBmaWVsZHMuXG5cdCAqIEBwYXJhbSB2ZXJib3NlIExvZyB3YXJuaW5nLlxuXHQgKi9cblx0Zm9ybShcblx0XHRmb3JtOiBPV2ViRm9ybURlZmluaXRpb24gfCBIVE1MRm9ybUVsZW1lbnQsXG5cdFx0cmVxdWlyZWQ6IHN0cmluZ1tdID0gW10sXG5cdFx0ZXhjbHVkZWQ6IHN0cmluZ1tdID0gW10sXG5cdFx0Y2hlY2tBbGwgPSBmYWxzZSxcblx0XHR2ZXJib3NlID0gZmFsc2Vcblx0KTogT1dlYkZvcm0ge1xuXHRcdHJldHVybiBuZXcgT1dlYkZvcm0oXG5cdFx0XHR0aGlzLFxuXHRcdFx0Zm9ybSBpbnN0YW5jZW9mIEhUTUxGb3JtRWxlbWVudFxuXHRcdFx0XHQ/IG5ldyBPRm9ybURPTUZvcm1BZGFwdGVyKGZvcm0pXG5cdFx0XHRcdDogbmV3IE9Gb3JtT2JqZWN0QWRhcHRlcihmb3JtKSxcblx0XHRcdHJlcXVpcmVkLFxuXHRcdFx0ZXhjbHVkZWQsXG5cdFx0XHRjaGVja0FsbCxcblx0XHRcdHZlcmJvc2Vcblx0XHQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEZvcmNlIGxvZ2luLlxuXHQgKlxuXHQgKiA+IFRoaXMgd2lsbCBjbGVhciBhbGwgc2F2ZWQgZGF0YSBpbiB0aGUgbG9jYWwgc3RvcmFnZS5cblx0ICovXG5cdGZvcmNlTG9naW4oKTogdm9pZCB7XG5cdFx0dGhpcy5scy5jbGVhcigpO1xuXHRcdHRoaXMuc2hvd0xvZ2luUGFnZSh7fSk7XG5cdH1cblxuXHQvKipcblx0ICogUmVsb2FkIHRoZSBhcHAuXG5cdCAqL1xuXHRyZWxvYWRBcHAoKTogdm9pZCB7XG5cdFx0Ly8gVE9ETzogaW5zdGVhZCBvZiByZWxvYWRpbmcgdGhlIGN1cnJlbnQgbG9jYXRpb24sIGZpbmQgYSB3YXkgdG8gYnJvd3NlIHRvIHdlYiBhcHAgZW50cnkgcG9pbnRcblx0XHQvLyBmb3IgYW5kcm9pZCAmIGlvcyByZXN0YXJ0IHRoZSBhcHBcblx0XHQvLyB3aW5kb3cubG9jYXRpb24ucmVsb2FkKHRydWUpO1xuXHRcdHRoaXMuc2hvd0hvbWVQYWdlKHt9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBEZXN0cm95IHRoZSBhcHAuXG5cdCAqXG5cdCAqID4gVGhpcyB3aWxsIGNsZWFyIGFsbCBzYXZlZCBkYXRhIGluIHRoZSBsb2NhbCBzdG9yYWdlLlxuXHQgKi9cblx0ZGVzdHJveUFwcCgpOiB2b2lkIHtcblx0XHQvLyBlcmFzZSBkYXRhXG5cdFx0dGhpcy5scy5jbGVhcigpO1xuXHRcdHRoaXMucmVsb2FkQXBwKCk7XG5cdH1cblxuXHQvKipcblx0ICogQ2xvc2UgYXBwLlxuXHQgKi9cblx0Y2xvc2VBcHAoKTogdm9pZCB7XG5cdFx0Ly8gY29yZG92YVxuXHRcdGlmIChnbG9iYWxSb290Lm5hdmlnYXRvciAmJiAoZ2xvYmFsUm9vdC5uYXZpZ2F0b3IgYXMgYW55KS5hcHApIHtcblx0XHRcdChnbG9iYWxSb290Lm5hdmlnYXRvciBhcyBhbnkpLmFwcC5leGl0QXBwKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGdsb2JhbFJvb3QuY2xvc2UoKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogVG8gc3RhcnQgdGhlIHdlYiBhcHAuXG5cdCAqL1xuXHRzdGFydCgpOiB0aGlzIHtcblx0XHRsb2dnZXIuaW5mbygnW09XZWJBcHBdIGFwcCBzdGFydGVkIScpO1xuXHRcdHRoaXMudHJpZ2dlcihPV2ViQXBwLkVWVF9BUFBfUkVBRFkpO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9XG5cblx0LyoqXG5cdCAqIENhbGxlZCB3aGVuIGFwcCBzaG91bGQgc2hvdyB0aGUgaG9tZSBwYWdlLlxuXHQgKi9cblx0c2hvd0hvbWVQYWdlKG9wdGlvbnM6IE9Sb3V0ZVN0YXRlT2JqZWN0ID0ge30pOiB2b2lkIHtcblx0XHR0aGlzLnRyaWdnZXIoT1dlYkFwcC5FVlRfU0hPV19IT01FLCBbb3B0aW9uc10pO1xuXHR9XG5cblx0LyoqXG5cdCAqIENhbGxlZCB3aGVuIGFwcCBzaG91bGQgc2hvdyB0aGUgbG9naW4gcGFnZS5cblx0ICovXG5cdHNob3dMb2dpblBhZ2Uob3B0aW9uczogT1JvdXRlU3RhdGVPYmplY3QgPSB7fSk6IHZvaWQge1xuXHRcdHRoaXMudHJpZ2dlcihPV2ViQXBwLkVWVF9TSE9XX0xPR0lOLCBbb3B0aW9uc10pO1xuXHR9XG5cblx0LyoqXG5cdCAqIENhbGxlZCB3aGVuIGFwcCBzaG91bGQgc2hvdyB0aGUgcmVnaXN0cmF0aW9uIHBhZ2UuXG5cdCAqL1xuXHRzaG93UmVnaXN0cmF0aW9uUGFnZShvcHRpb25zOiBPUm91dGVTdGF0ZU9iamVjdCA9IHt9KTogdm9pZCB7XG5cdFx0dGhpcy50cmlnZ2VyKE9XZWJBcHAuRVZUX1NIT1dfTE9HSU4sIFtvcHRpb25zXSk7XG5cdH1cblxuXHQvKipcblx0ICogUmVnaXN0ZXIgaGFuZGxlciBmb3IgT1dlYkFwcC5FVlRfQVBQX1JFQURZIGV2ZW50XG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVyXG5cdCAqL1xuXHRvblJlYWR5KGhhbmRsZXI6ICh0aGlzOiB0aGlzKSA9PiB2b2lkIHwgYm9vbGVhbik6IHRoaXMge1xuXHRcdHJldHVybiB0aGlzLm9uKE9XZWJBcHAuRVZUX0FQUF9SRUFEWSwgaGFuZGxlcik7XG5cdH1cblxuXHQvKipcblx0ICogUmVnaXN0ZXIgaGFuZGxlciBmb3IgT1dlYkFwcC5FVlRfU0hPV19IT01FIGV2ZW50XG5cdCAqXG5cdCAqIEBwYXJhbSBoYW5kbGVyXG5cdCAqL1xuXHRvblNob3dIb21lUGFnZShcblx0XHRoYW5kbGVyOiAodGhpczogdGhpcywgb3B0aW9uczogT1JvdXRlU3RhdGVPYmplY3QpID0+IHZvaWQgfCBib29sZWFuXG5cdCk6IHRoaXMge1xuXHRcdHJldHVybiB0aGlzLm9uKE9XZWJBcHAuRVZUX1NIT1dfSE9NRSwgaGFuZGxlcik7XG5cdH1cblxuXHQvKipcblx0ICogUmVnaXN0ZXIgaGFuZGxlciBmb3IgT1dlYkFwcC5FVlRfU0hPV19MT0dJTiBldmVudFxuXHQgKlxuXHQgKiBAcGFyYW0gaGFuZGxlclxuXHQgKi9cblx0b25TaG93TG9naW5QYWdlKFxuXHRcdGhhbmRsZXI6ICh0aGlzOiB0aGlzLCBvcHRpb25zOiBPUm91dGVTdGF0ZU9iamVjdCkgPT4gdm9pZCB8IGJvb2xlYW5cblx0KTogdGhpcyB7XG5cdFx0cmV0dXJuIHRoaXMub24oT1dlYkFwcC5FVlRfU0hPV19MT0dJTiwgaGFuZGxlcik7XG5cdH1cblxuXHQvKipcblx0ICogUmVnaXN0ZXIgaGFuZGxlciBmb3IgT1dlYkFwcC5FVlRfU0hPV19SRUdJU1RSQVRJT05fUEFHRSBldmVudFxuXHQgKlxuXHQgKiBAcGFyYW0gaGFuZGxlclxuXHQgKi9cblx0b25TaG93UmVnaXN0cmF0aW9uUGFnZShcblx0XHRoYW5kbGVyOiAodGhpczogdGhpcywgb3B0aW9uczogT1JvdXRlU3RhdGVPYmplY3QpID0+IHZvaWQgfCBib29sZWFuXG5cdCk6IHRoaXMge1xuXHRcdHJldHVybiB0aGlzLm9uKE9XZWJBcHAuRVZUX1NIT1dfUkVHSVNUUkFUSU9OX1BBR0UsIGhhbmRsZXIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFJlZ2lzdGVyIGhhbmRsZXIgZm9yIE9XZWJBcHAuRVZUX05PVF9GT1VORCBldmVudFxuXHQgKlxuXHQgKiBAcGFyYW0gaGFuZGxlclxuXHQgKi9cblx0b25QYWdlTm90Rm91bmQoXG5cdFx0aGFuZGxlcjogKHRoaXM6IHRoaXMsIHRhcmdldDogT1JvdXRlVGFyZ2V0KSA9PiB2b2lkIHwgYm9vbGVhblxuXHQpOiB0aGlzIHtcblx0XHRyZXR1cm4gdGhpcy5vbihPV2ViQXBwLkVWVF9OT1RfRk9VTkQsIGhhbmRsZXIpO1xuXHR9XG5cblx0LyoqXG5cdCAqIENyZWF0ZXMgbmV3IGFwcCBpbnN0YW5jZS5cblx0ICpcblx0ICogQHBhcmFtIG9wdGlvbnNcblx0ICovXG5cdHN0YXRpYyBjcmVhdGU8T3B0aW9ucyBleHRlbmRzIE9BcHBPcHRpb25zPE9TdG9yZSwgT1BhZ2UsIE9Vc2VyPiA9IGFueT4oXG5cdFx0b3B0aW9uczogT3B0aW9uc1xuXHQpOiBPV2ViQXBwPGFueSwgYW55LCBhbnksIE9wdGlvbnM+IHtcblx0XHRyZXR1cm4gbmV3IE9XZWJBcHAob3B0aW9ucyk7XG5cdH1cbn1cbiJdfQ==